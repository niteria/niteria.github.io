<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
-----------------------------------------------------------------------------
--
-- (c) The University of Glasgow 2001-2003
--
-- Access to system tools: gcc, cp, rm etc
--
-----------------------------------------------------------------------------
-}</span><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span class="hs-pragma">{-# LANGUAGE CPP, ScopedTypeVariables #-}</span><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">SysTools</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-14"></a><span>        </span><span class="hs-comment">-- Initialisation</span><span>
</span><a name="line-15"></a><span>        </span><a href="SysTools.html#initSysTools"><span class="hs-identifier hs-var">initSysTools</span></a><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span>        </span><span class="hs-comment">-- Interface to system tools</span><span>
</span><a name="line-18"></a><span>        </span><a href="SysTools.html#runUnlit"><span class="hs-identifier hs-var">runUnlit</span></a><span class="hs-special">,</span><span> </span><a href="SysTools.html#runCpp"><span class="hs-identifier hs-var">runCpp</span></a><span class="hs-special">,</span><span> </span><a href="SysTools.html#runCc"><span class="hs-identifier hs-var">runCc</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- [Option] -&gt; IO ()</span><span>
</span><a name="line-19"></a><span>        </span><a href="SysTools.html#runPp"><span class="hs-identifier hs-var">runPp</span></a><span class="hs-special">,</span><span>                   </span><span class="hs-comment">-- [Option] -&gt; IO ()</span><span>
</span><a name="line-20"></a><span>        </span><a href="SysTools.html#runSplit"><span class="hs-identifier hs-var">runSplit</span></a><span class="hs-special">,</span><span>                </span><span class="hs-comment">-- [Option] -&gt; IO ()</span><span>
</span><a name="line-21"></a><span>        </span><a href="SysTools.html#runAs"><span class="hs-identifier hs-var">runAs</span></a><span class="hs-special">,</span><span> </span><a href="SysTools.html#runLink"><span class="hs-identifier hs-var">runLink</span></a><span class="hs-special">,</span><span> </span><a href="SysTools.html#runLibtool"><span class="hs-identifier hs-var">runLibtool</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- [Option] -&gt; IO ()</span><span>
</span><a name="line-22"></a><span>        </span><a href="SysTools.html#runMkDLL"><span class="hs-identifier hs-var">runMkDLL</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>        </span><a href="SysTools.html#runWindres"><span class="hs-identifier hs-var">runWindres</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>        </span><a href="SysTools.html#runLlvmOpt"><span class="hs-identifier hs-var">runLlvmOpt</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>        </span><a href="SysTools.html#runLlvmLlc"><span class="hs-identifier hs-var">runLlvmLlc</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>        </span><a href="SysTools.html#runClang"><span class="hs-identifier hs-var">runClang</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>        </span><a href="SysTools.html#figureLlvmVersion"><span class="hs-identifier hs-var">figureLlvmVersion</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span>        </span><a href="SysTools.html#getLinkerInfo"><span class="hs-identifier hs-var">getLinkerInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>        </span><a href="SysTools.html#getCompilerInfo"><span class="hs-identifier hs-var">getCompilerInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span>        </span><a href="SysTools.html#linkDynLib"><span class="hs-identifier hs-var">linkDynLib</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span>        </span><a href="SysTools.html#askLd"><span class="hs-identifier hs-var">askLd</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span>        </span><a href="SysTools.html#touch"><span class="hs-identifier hs-var">touch</span></a><span class="hs-special">,</span><span>                  </span><span class="hs-comment">-- String -&gt; String -&gt; IO ()</span><span>
</span><a name="line-37"></a><span>        </span><a href="SysTools.html#copy"><span class="hs-identifier hs-var">copy</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>        </span><a href="SysTools.html#copyWithHeader"><span class="hs-identifier hs-var">copyWithHeader</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span>        </span><span class="hs-comment">-- Temporary-file management</span><span>
</span><a name="line-41"></a><span>        </span><a href="DynFlags.html#setTmpDir"><span class="hs-identifier hs-var">setTmpDir</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>        </span><a href="SysTools.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a><span class="hs-special">,</span><span> </span><a href="SysTools.html#newTempLibName"><span class="hs-identifier hs-var">newTempLibName</span></a><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>        </span><a href="SysTools.html#cleanTempDirs"><span class="hs-identifier hs-var">cleanTempDirs</span></a><span class="hs-special">,</span><span> </span><a href="SysTools.html#cleanTempFiles"><span class="hs-identifier hs-var">cleanTempFiles</span></a><span class="hs-special">,</span><span> </span><a href="SysTools.html#cleanTempFilesExcept"><span class="hs-identifier hs-var">cleanTempFilesExcept</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>        </span><a href="SysTools.html#addFilesToClean"><span class="hs-identifier hs-var">addFilesToClean</span></a><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span>        </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span>        </span><span class="hs-comment">-- frameworks</span><span>
</span><a name="line-49"></a><span>        </span><a href="SysTools.html#getPkgFrameworkOpts"><span class="hs-identifier hs-var">getPkgFrameworkOpts</span></a><span class="hs-special">,</span><span>
</span><a name="line-50"></a><span>        </span><a href="SysTools.html#getFrameworkOpts"><span class="hs-identifier hs-var">getFrameworkOpts</span></a><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;</span><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><a href="DriverPhases.html"><span class="hs-identifier">DriverPhases</span></a><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><a href="Module.html"><span class="hs-identifier">Module</span></a><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><a href="Packages.html"><span class="hs-identifier">Packages</span></a><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><a href="Config.html"><span class="hs-identifier">Config</span></a><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><a href="ErrUtils.html"><span class="hs-identifier">ErrUtils</span></a><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><a href="Panic.html"><span class="hs-identifier">Panic</span></a><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><a href="Platform.html"><span class="hs-identifier">Platform</span></a><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><a href="Exception.html"><span class="hs-identifier">Exception</span></a><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><a href="LlvmCodeGen.Base.html"><span class="hs-identifier">LlvmCodeGen</span><span class="hs-operator">.</span><span class="hs-identifier">Base</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#llvmVersionStr"><span class="hs-identifier hs-var">llvmVersionStr</span></a><span class="hs-special">,</span><span> </span><a href="LlvmCodeGen.Base.html#supportedLlvmVersion"><span class="hs-identifier hs-var">supportedLlvmVersion</span></a><span class="hs-special">)</span><span>
</span><a name="line-70"></a><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.IORef.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IORef</span></a><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span></a><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/System.Exit.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Exit</span></a><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/System.Environment.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Environment</span></a><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><a href="../filepath-1.4.1.1/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">FilePath</span></a><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/System.IO.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span></a><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/System.IO.Error.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">Error</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">IO</span><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><a href="../directory-1.3.0.2/src/%{MODULE/./-}.html#%{NAME}/System.Directory.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Directory</span></a><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Char.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Char</span></a><span>
</span><a name="line-80"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.List.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span></a><span>
</span><a name="line-81"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Map.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Map</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-82"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Set.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Set</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Set</span><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span class="hs-cpp">#ifndef mingw32_HOST_OS</span><span>
</span><a name="line-85"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/System.Posix.Internals.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Posix</span><span class="hs-operator">.</span><span class="hs-identifier">Internals</span></a><span>
</span><a name="line-86"></a><span class="hs-cpp">#else /* Must be Win32 */</span><span>
</span><a name="line-87"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span>
</span><a name="line-88"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">C</span><span class="hs-operator">.</span><span class="hs-identifier">String</span><span>
</span><a name="line-89"></a><span class="hs-cpp">#if MIN_VERSION_Win32(2,5,0)</span><span>
</span><a name="line-90"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Win32</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Win32</span><span>
</span><a name="line-91"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-92"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Win32</span><span class="hs-operator">.</span><span class="hs-identifier">Info</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Win32</span><span>
</span><a name="line-93"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-94"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Win32</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DWORD</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">LPTSTR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">HANDLE</span><span class="hs-special">)</span><span>
</span><a name="line-95"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Win32</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">failIfNull</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">failIf</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">iNVALID_HANDLE_VALUE</span><span class="hs-special">)</span><span>
</span><a name="line-96"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Win32</span><span class="hs-operator">.</span><span class="hs-identifier">File</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">createFile</span><span class="hs-special">,</span><span class="hs-identifier">closeHandle</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gENERIC_READ</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fILE_SHARE_READ</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">oPEN_EXISTING</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fILE_ATTRIBUTE_NORMAL</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fILE_FLAG_BACKUP_SEMANTICS</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-97"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Win32</span><span class="hs-operator">.</span><span class="hs-identifier">DLL</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">loadLibrary</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">getProcAddress</span><span class="hs-special">)</span><span>
</span><a name="line-98"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-99"></a><span>
</span><a name="line-100"></a><span class="hs-keyword">import</span><span> </span><a href="../process-1.4.3.0/src/%{MODULE/./-}.html#%{NAME}/System.Process.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Process</span></a><span>
</span><a name="line-101"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Concurrent.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Concurrent</span></a><span>
</span><a name="line-102"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-103"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span>           </span><span class="hs-special">(</span><span> </span><a href="SrcLoc.html#SrcLoc"><span class="hs-identifier hs-type">SrcLoc</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#mkSrcLoc"><span class="hs-identifier hs-var">mkSrcLoc</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#mkSrcSpan"><span class="hs-identifier hs-var">mkSrcSpan</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span class="hs-cpp">#ifdef mingw32_HOST_OS</span><span>
</span><a name="line-106"></a><span class="hs-cpp"># if defined(i386_HOST_ARCH)</span><span>
</span><a name="line-107"></a><span class="hs-cpp">#  define WINDOWS_CCONV stdcall</span><span>
</span><a name="line-108"></a><span class="hs-cpp"># elif defined(x86_64_HOST_ARCH)</span><span>
</span><a name="line-109"></a><span class="hs-cpp">#  define WINDOWS_CCONV ccall</span><span>
</span><a name="line-110"></a><span class="hs-cpp"># else</span><span>
</span><a name="line-111"></a><span class="hs-cpp">#  error Unknown mingw32 arch</span><span>
</span><a name="line-112"></a><span class="hs-cpp"># endif</span><span>
</span><a name="line-113"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span class="hs-comment">{-
How GHC finds its files
~~~~~~~~~~~~~~~~~~~~~~~

[Note topdir]

GHC needs various support files (library packages, RTS etc), plus
various auxiliary programs (cp, gcc, etc).  It starts by finding topdir,
the root of GHC's support files

On Unix:
  - ghc always has a shell wrapper that passes a -B&lt;dir&gt; option

On Windows:
  - ghc never has a shell wrapper.
  - we can find the location of the ghc binary, which is
        $topdir/&lt;foo&gt;/&lt;something&gt;.exe
    where &lt;something&gt; may be &quot;ghc&quot;, &quot;ghc-stage2&quot;, or similar
  - we strip off the &quot;&lt;foo&gt;/&lt;something&gt;.exe&quot; to leave $topdir.

from topdir we can find package.conf, ghc-asm, etc.


SysTools.initSysProgs figures out exactly where all the auxiliary programs
are, and initialises mutable variables to make it easy to call them.
To to this, it makes use of definitions in Config.hs, which is a Haskell
file containing variables whose value is figured out by the build system.

Config.hs contains two sorts of things

  cGCC,         The *names* of the programs
  cCPP            e.g.  cGCC = gcc
  cUNLIT                cCPP = gcc -E
  etc           They do *not* include paths


  cUNLIT_DIR   The *path* to the directory containing unlit, split etc
  cSPLIT_DIR   *relative* to the root of the build tree,
                   for use when running *in-place* in a build tree (only)



---------------------------------------------
NOTES for an ALTERNATIVE scheme (i.e *not* what is currently implemented):

Another hair-brained scheme for simplifying the current tool location
nightmare in GHC: Simon originally suggested using another
configuration file along the lines of GCC's specs file - which is fine
except that it means adding code to read yet another configuration
file.  What I didn't notice is that the current package.conf is
general enough to do this:

Package
    {name = &quot;tools&quot;,    import_dirs = [],  source_dirs = [],
     library_dirs = [], hs_libraries = [], extra_libraries = [],
     include_dirs = [], c_includes = [],   package_deps = [],
     extra_ghc_opts = [&quot;-pgmc/usr/bin/gcc&quot;,&quot;-pgml${topdir}/bin/unlit&quot;, ... etc.],
     extra_cc_opts = [], extra_ld_opts = []}

Which would have the advantage that we get to collect together in one
place the path-specific package stuff with the path-specific tool
stuff.
                End of NOTES
---------------------------------------------

************************************************************************
*                                                                      *
\subsection{Initialisation}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span class="hs-identifier">initSysTools</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span>    </span><span class="hs-comment">-- Maybe TopDir path (without the '-B' prefix)</span><span>
</span><a name="line-188"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="DynFlags.html#Settings"><span class="hs-identifier hs-type">Settings</span></a><span>     </span><span class="hs-comment">-- Set all the mutable variables above, holding</span><span>
</span><a name="line-189"></a><span>                                </span><span class="hs-comment">--      (a) the system programs</span><span>
</span><a name="line-190"></a><span>                                </span><span class="hs-comment">--      (b) the package-config file</span><span>
</span><a name="line-191"></a><span>                                </span><span class="hs-comment">--      (c) the GHC usage message</span><span>
</span><a name="line-192"></a><a name="initSysTools"><a href="SysTools.html#initSysTools"><span class="hs-identifier">initSysTools</span></a></a><span> </span><a name="local-6989586621679414356"><a href="#local-6989586621679414356"><span class="hs-identifier">mbMinusB</span></a></a><span>
</span><a name="line-193"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679414357"><a href="#local-6989586621679414357"><span class="hs-identifier">top_dir</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#findTopDir"><span class="hs-identifier hs-var">findTopDir</span></a><span> </span><a href="#local-6989586621679414356"><span class="hs-identifier hs-var">mbMinusB</span></a><span>
</span><a name="line-194"></a><span>             </span><span class="hs-comment">-- see [Note topdir]</span><span>
</span><a name="line-195"></a><span>             </span><span class="hs-comment">-- NB: top_dir is assumed to be in standard Unix</span><span>
</span><a name="line-196"></a><span>             </span><span class="hs-comment">-- format, '/' separated</span><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414358"><a href="#local-6989586621679414358"><span class="hs-identifier">settingsFile</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414357"><span class="hs-identifier hs-var">top_dir</span></a><span> </span><a href="../filepath-1.4.1.1/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a><span> </span><span class="hs-string">&quot;settings&quot;</span><span>
</span><a name="line-199"></a><span>           </span><a name="local-6989586621679414359"><a href="#local-6989586621679414359"><span class="hs-identifier">platformConstantsFile</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414357"><span class="hs-identifier hs-var">top_dir</span></a><span> </span><a href="../filepath-1.4.1.1/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a><span> </span><span class="hs-string">&quot;platformConstants&quot;</span><span>
</span><a name="line-200"></a><span>           </span><span class="hs-identifier">installed</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span>
</span><a name="line-201"></a><span>           </span><a name="local-6989586621679414360"><a href="#local-6989586621679414360"><span class="hs-identifier">installed</span></a></a><span> </span><a name="local-6989586621679414362"><a href="#local-6989586621679414362"><span class="hs-identifier">file</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414357"><span class="hs-identifier hs-var">top_dir</span></a><span> </span><a href="../filepath-1.4.1.1/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a><span> </span><a href="#local-6989586621679414362"><span class="hs-identifier hs-var">file</span></a><span>
</span><a name="line-202"></a><span>           </span><span class="hs-identifier">libexec</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span>
</span><a name="line-203"></a><span>           </span><a name="local-6989586621679414361"><a href="#local-6989586621679414361"><span class="hs-identifier">libexec</span></a></a><span> </span><a name="local-6989586621679414363"><a href="#local-6989586621679414363"><span class="hs-identifier">file</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414357"><span class="hs-identifier hs-var">top_dir</span></a><span> </span><a href="../filepath-1.4.1.1/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a><span> </span><span class="hs-string">&quot;bin&quot;</span><span> </span><a href="../filepath-1.4.1.1/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a><span> </span><a href="#local-6989586621679414363"><span class="hs-identifier hs-var">file</span></a><span>
</span><a name="line-204"></a><span>
</span><a name="line-205"></a><span>       </span><a name="local-6989586621679414364"><a href="#local-6989586621679414364"><span class="hs-identifier">settingsStr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/System.IO.html#readFile"><span class="hs-identifier hs-var">readFile</span></a><span> </span><a href="#local-6989586621679414358"><span class="hs-identifier hs-var">settingsFile</span></a><span>
</span><a name="line-206"></a><span>       </span><a name="local-6989586621679414365"><a href="#local-6989586621679414365"><span class="hs-identifier">platformConstantsStr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/System.IO.html#readFile"><span class="hs-identifier hs-var">readFile</span></a><span> </span><a href="#local-6989586621679414359"><span class="hs-identifier hs-var">platformConstantsFile</span></a><span>
</span><a name="line-207"></a><span>       </span><a name="local-6989586621679414367"><a href="#local-6989586621679414367"><span class="hs-identifier">mySettings</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Util.html#maybeReadFuzzy"><span class="hs-identifier hs-var">maybeReadFuzzy</span></a><span> </span><a href="#local-6989586621679414364"><span class="hs-identifier hs-var">settingsStr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-208"></a><span>                     </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679414366"><a href="#local-6989586621679414366"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-209"></a><span>                         </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679414366"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-210"></a><span>                     </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-211"></a><span>                         </span><a href="Panic.html#pgmError"><span class="hs-identifier hs-var">pgmError</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Can't parse &quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679414358"><span class="hs-identifier hs-var">settingsFile</span></a><span class="hs-special">)</span><span>
</span><a name="line-212"></a><span>       </span><a name="local-6989586621679414369"><a href="#local-6989586621679414369"><span class="hs-identifier">platformConstants</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Util.html#maybeReadFuzzy"><span class="hs-identifier hs-var">maybeReadFuzzy</span></a><span> </span><a href="#local-6989586621679414365"><span class="hs-identifier hs-var">platformConstantsStr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-213"></a><span>                            </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679414368"><a href="#local-6989586621679414368"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-214"></a><span>                                </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679414368"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-215"></a><span>                            </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-216"></a><span>                                </span><a href="Panic.html#pgmError"><span class="hs-identifier hs-var">pgmError</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Can't parse &quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span>
</span><a name="line-217"></a><span>                                          </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679414359"><span class="hs-identifier hs-var">platformConstantsFile</span></a><span class="hs-special">)</span><span>
</span><a name="line-218"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414370"><a href="#local-6989586621679414370"><span class="hs-identifier">getSetting</span></a></a><span> </span><a name="local-6989586621679414373"><a href="#local-6989586621679414373"><span class="hs-identifier">key</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#lookup"><span class="hs-identifier hs-var">lookup</span></a><span> </span><a href="#local-6989586621679414373"><span class="hs-identifier hs-var">key</span></a><span> </span><a href="#local-6989586621679414367"><span class="hs-identifier hs-var">mySettings</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-219"></a><span>                            </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679414374"><a href="#local-6989586621679414374"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-220"></a><span>                                </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">case</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#stripPrefix"><span class="hs-identifier hs-var">stripPrefix</span></a><span> </span><span class="hs-string">&quot;$topdir&quot;</span><span> </span><a href="#local-6989586621679414374"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-221"></a><span>                                         </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-222"></a><span>                                             </span><a href="#local-6989586621679414357"><span class="hs-identifier hs-var">top_dir</span></a><span>
</span><a name="line-223"></a><span>                                         </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679414375"><a href="#local-6989586621679414375"><span class="hs-identifier">xs'</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679414376"><a href="#local-6989586621679414376"><span class="hs-identifier">c</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-224"></a><span>                                          </span><span class="hs-glyph">|</span><span> </span><a href="../filepath-1.4.1.1/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#isPathSeparator"><span class="hs-identifier hs-var">isPathSeparator</span></a><span> </span><a href="#local-6989586621679414376"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-225"></a><span>                                             </span><a href="#local-6989586621679414357"><span class="hs-identifier hs-var">top_dir</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414375"><span class="hs-identifier hs-var">xs'</span></a><span>
</span><a name="line-226"></a><span>                                         </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-227"></a><span>                                             </span><a href="#local-6989586621679414374"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-228"></a><span>                            </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#pgmError"><span class="hs-identifier hs-var">pgmError</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;No entry for &quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679414373"><span class="hs-identifier hs-var">key</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot; in &quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679414358"><span class="hs-identifier hs-var">settingsFile</span></a><span class="hs-special">)</span><span>
</span><a name="line-229"></a><span>           </span><a name="local-6989586621679414371"><a href="#local-6989586621679414371"><span class="hs-identifier">getBooleanSetting</span></a></a><span> </span><a name="local-6989586621679414377"><a href="#local-6989586621679414377"><span class="hs-identifier">key</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#lookup"><span class="hs-identifier hs-var">lookup</span></a><span> </span><a href="#local-6989586621679414377"><span class="hs-identifier hs-var">key</span></a><span> </span><a href="#local-6989586621679414367"><span class="hs-identifier hs-var">mySettings</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-230"></a><span>                                   </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-string">&quot;YES&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-231"></a><span>                                   </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-string">&quot;NO&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-232"></a><span>                                   </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679414378"><a href="#local-6989586621679414378"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#pgmError"><span class="hs-identifier hs-var">pgmError</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Bad value for &quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679414377"><span class="hs-identifier hs-var">key</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot;: &quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679414378"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-233"></a><span>                                   </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#pgmError"><span class="hs-identifier hs-var">pgmError</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;No entry for &quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679414377"><span class="hs-identifier hs-var">key</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot; in &quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679414358"><span class="hs-identifier hs-var">settingsFile</span></a><span class="hs-special">)</span><span>
</span><a name="line-234"></a><span>           </span><a name="local-6989586621679414372"><a href="#local-6989586621679414372"><span class="hs-identifier">readSetting</span></a></a><span> </span><a name="local-6989586621679414379"><a href="#local-6989586621679414379"><span class="hs-identifier">key</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#lookup"><span class="hs-identifier hs-var">lookup</span></a><span> </span><a href="#local-6989586621679414379"><span class="hs-identifier hs-var">key</span></a><span> </span><a href="#local-6989586621679414367"><span class="hs-identifier hs-var">mySettings</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-235"></a><span>                             </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679414380"><a href="#local-6989586621679414380"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-236"></a><span>                                 </span><span class="hs-keyword">case</span><span> </span><a href="Util.html#maybeRead"><span class="hs-identifier hs-var">maybeRead</span></a><span> </span><a href="#local-6989586621679414380"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-237"></a><span>                                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679414381"><a href="#local-6989586621679414381"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679414381"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-238"></a><span>                                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#pgmError"><span class="hs-identifier hs-var">pgmError</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Failed to read &quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679414379"><span class="hs-identifier hs-var">key</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot; value &quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679414380"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-239"></a><span>                             </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#pgmError"><span class="hs-identifier hs-var">pgmError</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;No entry for &quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679414379"><span class="hs-identifier hs-var">key</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot; in &quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679414358"><span class="hs-identifier hs-var">settingsFile</span></a><span class="hs-special">)</span><span>
</span><a name="line-240"></a><span>       </span><a name="local-6989586621679414382"><a href="#local-6989586621679414382"><span class="hs-identifier">crossCompiling</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414371"><span class="hs-identifier hs-var">getBooleanSetting</span></a><span> </span><span class="hs-string">&quot;cross compiling&quot;</span><span>
</span><a name="line-241"></a><span>       </span><a name="local-6989586621679414383"><a href="#local-6989586621679414383"><span class="hs-identifier">targetArch</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414372"><span class="hs-identifier hs-var">readSetting</span></a><span> </span><span class="hs-string">&quot;target arch&quot;</span><span>
</span><a name="line-242"></a><span>       </span><a name="local-6989586621679414384"><a href="#local-6989586621679414384"><span class="hs-identifier">targetOS</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414372"><span class="hs-identifier hs-var">readSetting</span></a><span> </span><span class="hs-string">&quot;target os&quot;</span><span>
</span><a name="line-243"></a><span>       </span><a name="local-6989586621679414385"><a href="#local-6989586621679414385"><span class="hs-identifier">targetWordSize</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414372"><span class="hs-identifier hs-var">readSetting</span></a><span> </span><span class="hs-string">&quot;target word size&quot;</span><span>
</span><a name="line-244"></a><span>       </span><a name="local-6989586621679414386"><a href="#local-6989586621679414386"><span class="hs-identifier">targetUnregisterised</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414371"><span class="hs-identifier hs-var">getBooleanSetting</span></a><span> </span><span class="hs-string">&quot;Unregisterised&quot;</span><span>
</span><a name="line-245"></a><span>       </span><a name="local-6989586621679414387"><a href="#local-6989586621679414387"><span class="hs-identifier">targetHasGnuNonexecStack</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414372"><span class="hs-identifier hs-var">readSetting</span></a><span> </span><span class="hs-string">&quot;target has GNU nonexec stack&quot;</span><span>
</span><a name="line-246"></a><span>       </span><a name="local-6989586621679414388"><a href="#local-6989586621679414388"><span class="hs-identifier">targetHasIdentDirective</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414372"><span class="hs-identifier hs-var">readSetting</span></a><span> </span><span class="hs-string">&quot;target has .ident directive&quot;</span><span>
</span><a name="line-247"></a><span>       </span><a name="local-6989586621679414389"><a href="#local-6989586621679414389"><span class="hs-identifier">targetHasSubsectionsViaSymbols</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414372"><span class="hs-identifier hs-var">readSetting</span></a><span> </span><span class="hs-string">&quot;target has subsections via symbols&quot;</span><span>
</span><a name="line-248"></a><span>       </span><a name="local-6989586621679414390"><a href="#local-6989586621679414390"><span class="hs-identifier">myExtraGccViaCFlags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414370"><span class="hs-identifier hs-var">getSetting</span></a><span> </span><span class="hs-string">&quot;GCC extra via C opts&quot;</span><span>
</span><a name="line-249"></a><span>       </span><span class="hs-comment">-- On Windows, mingw is distributed with GHC,</span><span>
</span><a name="line-250"></a><span>       </span><span class="hs-comment">-- so we look in TopDir/../mingw/bin</span><span>
</span><a name="line-251"></a><span>       </span><span class="hs-comment">-- It would perhaps be nice to be able to override this</span><span>
</span><a name="line-252"></a><span>       </span><span class="hs-comment">-- with the settings file, but it would be a little fiddly</span><span>
</span><a name="line-253"></a><span>       </span><span class="hs-comment">-- to make that possible, so for now you can't.</span><span>
</span><a name="line-254"></a><span>       </span><a name="local-6989586621679414391"><a href="#local-6989586621679414391"><span class="hs-identifier">gcc_prog</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414370"><span class="hs-identifier hs-var">getSetting</span></a><span> </span><span class="hs-string">&quot;C compiler command&quot;</span><span>
</span><a name="line-255"></a><span>       </span><a name="local-6989586621679414392"><a href="#local-6989586621679414392"><span class="hs-identifier">gcc_args_str</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414370"><span class="hs-identifier hs-var">getSetting</span></a><span> </span><span class="hs-string">&quot;C compiler flags&quot;</span><span>
</span><a name="line-256"></a><span>       </span><a name="local-6989586621679414393"><a href="#local-6989586621679414393"><span class="hs-identifier">gccSupportsNoPie</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414371"><span class="hs-identifier hs-var">getBooleanSetting</span></a><span> </span><span class="hs-string">&quot;C compiler supports -no-pie&quot;</span><span>
</span><a name="line-257"></a><span>       </span><a name="local-6989586621679414394"><a href="#local-6989586621679414394"><span class="hs-identifier">cpp_prog</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414370"><span class="hs-identifier hs-var">getSetting</span></a><span> </span><span class="hs-string">&quot;Haskell CPP command&quot;</span><span>
</span><a name="line-258"></a><span>       </span><a name="local-6989586621679414395"><a href="#local-6989586621679414395"><span class="hs-identifier">cpp_args_str</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414370"><span class="hs-identifier hs-var">getSetting</span></a><span> </span><span class="hs-string">&quot;Haskell CPP flags&quot;</span><span>
</span><a name="line-259"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414396"><a href="#local-6989586621679414396"><span class="hs-identifier">unreg_gcc_args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679414386"><span class="hs-identifier hs-var">targetUnregisterised</span></a><span>
</span><a name="line-260"></a><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;-DNO_REGS&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;-DUSE_MINIINTERPRETER&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-261"></a><span>                            </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-262"></a><span>           </span><span class="hs-comment">-- TABLES_NEXT_TO_CODE affects the info table layout.</span><span>
</span><a name="line-263"></a><span>           </span><a name="local-6989586621679414397"><a href="#local-6989586621679414397"><span class="hs-identifier">tntc_gcc_args</span></a></a><span>
</span><a name="line-264"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#mkTablesNextToCode"><span class="hs-identifier hs-var">mkTablesNextToCode</span></a><span> </span><a href="#local-6989586621679414386"><span class="hs-identifier hs-var">targetUnregisterised</span></a><span>
</span><a name="line-265"></a><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;-DTABLES_NEXT_TO_CODE&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-266"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-267"></a><span>           </span><a name="local-6989586621679414398"><a href="#local-6989586621679414398"><span class="hs-identifier">cpp_args</span></a></a><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#words"><span class="hs-identifier hs-var">words</span></a><span> </span><a href="#local-6989586621679414395"><span class="hs-identifier hs-var">cpp_args_str</span></a><span class="hs-special">)</span><span>
</span><a name="line-268"></a><span>           </span><a name="local-6989586621679414399"><a href="#local-6989586621679414399"><span class="hs-identifier">gcc_args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#words"><span class="hs-identifier hs-var">words</span></a><span> </span><a href="#local-6989586621679414392"><span class="hs-identifier hs-var">gcc_args_str</span></a><span>
</span><a name="line-269"></a><span>                               </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414396"><span class="hs-identifier hs-var">unreg_gcc_args</span></a><span>
</span><a name="line-270"></a><span>                               </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414397"><span class="hs-identifier hs-var">tntc_gcc_args</span></a><span class="hs-special">)</span><span>
</span><a name="line-271"></a><span>       </span><a name="local-6989586621679414400"><a href="#local-6989586621679414400"><span class="hs-identifier">ldSupportsCompactUnwind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414371"><span class="hs-identifier hs-var">getBooleanSetting</span></a><span> </span><span class="hs-string">&quot;ld supports compact unwind&quot;</span><span>
</span><a name="line-272"></a><span>       </span><a name="local-6989586621679414401"><a href="#local-6989586621679414401"><span class="hs-identifier">ldSupportsBuildId</span></a></a><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414371"><span class="hs-identifier hs-var">getBooleanSetting</span></a><span> </span><span class="hs-string">&quot;ld supports build-id&quot;</span><span>
</span><a name="line-273"></a><span>       </span><a name="local-6989586621679414402"><a href="#local-6989586621679414402"><span class="hs-identifier">ldSupportsFilelist</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414371"><span class="hs-identifier hs-var">getBooleanSetting</span></a><span> </span><span class="hs-string">&quot;ld supports filelist&quot;</span><span>
</span><a name="line-274"></a><span>       </span><a name="local-6989586621679414403"><a href="#local-6989586621679414403"><span class="hs-identifier">ldIsGnuLd</span></a></a><span>               </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414371"><span class="hs-identifier hs-var">getBooleanSetting</span></a><span> </span><span class="hs-string">&quot;ld is GNU ld&quot;</span><span>
</span><a name="line-275"></a><span>       </span><a name="local-6989586621679414404"><a href="#local-6989586621679414404"><span class="hs-identifier">perl_path</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414370"><span class="hs-identifier hs-var">getSetting</span></a><span> </span><span class="hs-string">&quot;perl command&quot;</span><span>
</span><a name="line-276"></a><span>
</span><a name="line-277"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414405"><a href="#local-6989586621679414405"><span class="hs-identifier">pkgconfig_path</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414360"><span class="hs-identifier hs-var">installed</span></a><span> </span><span class="hs-string">&quot;package.conf.d&quot;</span><span>
</span><a name="line-278"></a><span>           </span><a name="local-6989586621679414406"><a href="#local-6989586621679414406"><span class="hs-identifier">ghc_usage_msg_path</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414360"><span class="hs-identifier hs-var">installed</span></a><span> </span><span class="hs-string">&quot;ghc-usage.txt&quot;</span><span>
</span><a name="line-279"></a><span>           </span><a name="local-6989586621679414407"><a href="#local-6989586621679414407"><span class="hs-identifier">ghci_usage_msg_path</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414360"><span class="hs-identifier hs-var">installed</span></a><span> </span><span class="hs-string">&quot;ghci-usage.txt&quot;</span><span>
</span><a name="line-280"></a><span>
</span><a name="line-281"></a><span>             </span><span class="hs-comment">-- For all systems, unlit, split, mangle are GHC utilities</span><span>
</span><a name="line-282"></a><span>             </span><span class="hs-comment">-- architecture-specific stuff is done when building Config.hs</span><span>
</span><a name="line-283"></a><span>           </span><a name="local-6989586621679414408"><a href="#local-6989586621679414408"><span class="hs-identifier">unlit_path</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414361"><span class="hs-identifier hs-var">libexec</span></a><span> </span><a href="Config.html#cGHC_UNLIT_PGM"><span class="hs-identifier hs-var">cGHC_UNLIT_PGM</span></a><span>
</span><a name="line-284"></a><span>
</span><a name="line-285"></a><span>             </span><span class="hs-comment">-- split is a Perl script</span><span>
</span><a name="line-286"></a><span>           </span><a name="local-6989586621679414409"><a href="#local-6989586621679414409"><span class="hs-identifier">split_script</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414361"><span class="hs-identifier hs-var">libexec</span></a><span> </span><a href="Config.html#cGHC_SPLIT_PGM"><span class="hs-identifier hs-var">cGHC_SPLIT_PGM</span></a><span>
</span><a name="line-287"></a><span>
</span><a name="line-288"></a><span>       </span><a name="local-6989586621679414410"><a href="#local-6989586621679414410"><span class="hs-identifier">windres_path</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414370"><span class="hs-identifier hs-var">getSetting</span></a><span> </span><span class="hs-string">&quot;windres command&quot;</span><span>
</span><a name="line-289"></a><span>       </span><a name="local-6989586621679414411"><a href="#local-6989586621679414411"><span class="hs-identifier">libtool_path</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414370"><span class="hs-identifier hs-var">getSetting</span></a><span> </span><span class="hs-string">&quot;libtool command&quot;</span><span>
</span><a name="line-290"></a><span>
</span><a name="line-291"></a><span>       </span><a name="local-6989586621679414412"><a href="#local-6989586621679414412"><span class="hs-identifier">tmpdir</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../directory-1.3.0.2/src/%{MODULE/./-}.html#%{NAME}/System.Directory.html#getTemporaryDirectory"><span class="hs-identifier hs-var">getTemporaryDirectory</span></a><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span>       </span><a name="local-6989586621679414413"><a href="#local-6989586621679414413"><span class="hs-identifier">touch_path</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414370"><span class="hs-identifier hs-var">getSetting</span></a><span> </span><span class="hs-string">&quot;touch command&quot;</span><span>
</span><a name="line-294"></a><span>
</span><a name="line-295"></a><span>       </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- On Win32 we don't want to rely on #!/bin/perl, so we prepend</span><span>
</span><a name="line-296"></a><span>           </span><span class="hs-comment">-- a call to Perl to get the invocation of split.</span><span>
</span><a name="line-297"></a><span>           </span><span class="hs-comment">-- On Unix, scripts are invoked using the '#!' method.  Binary</span><span>
</span><a name="line-298"></a><span>           </span><span class="hs-comment">-- installations of GHC on Unix place the correct line on the</span><span>
</span><a name="line-299"></a><span>           </span><span class="hs-comment">-- front of the script at installation time, so we don't want</span><span>
</span><a name="line-300"></a><span>           </span><span class="hs-comment">-- to wire-in our knowledge of $(PERL) on the host system here.</span><span>
</span><a name="line-301"></a><span>           </span><span class="hs-special">(</span><a name="local-6989586621679414414"><a href="#local-6989586621679414414"><span class="hs-identifier">split_prog</span></a></a><span class="hs-special">,</span><span>  </span><a name="local-6989586621679414415"><a href="#local-6989586621679414415"><span class="hs-identifier">split_args</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-302"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a href="Util.html#isWindowsHost"><span class="hs-identifier hs-var">isWindowsHost</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414404"><span class="hs-identifier hs-var">perl_path</span></a><span class="hs-special">,</span><span>    </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="#local-6989586621679414409"><span class="hs-identifier hs-var">split_script</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-303"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414409"><span class="hs-identifier hs-var">split_script</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-304"></a><span>       </span><a name="local-6989586621679414416"><a href="#local-6989586621679414416"><span class="hs-identifier">mkdll_prog</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414370"><span class="hs-identifier hs-var">getSetting</span></a><span> </span><span class="hs-string">&quot;dllwrap command&quot;</span><span>
</span><a name="line-305"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414417"><a href="#local-6989586621679414417"><span class="hs-identifier">mkdll_args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-306"></a><span>
</span><a name="line-307"></a><span>       </span><span class="hs-comment">-- cpp is derived from gcc on all platforms</span><span>
</span><a name="line-308"></a><span>       </span><span class="hs-comment">-- HACK, see setPgmP below. We keep 'words' here to remember to fix</span><span>
</span><a name="line-309"></a><span>       </span><span class="hs-comment">-- Config.hs one day.</span><span>
</span><a name="line-310"></a><span>
</span><a name="line-311"></a><span>
</span><a name="line-312"></a><span>       </span><span class="hs-comment">-- Other things being equal, as and ld are simply gcc</span><span>
</span><a name="line-313"></a><span>       </span><a name="local-6989586621679414418"><a href="#local-6989586621679414418"><span class="hs-identifier">gcc_link_args_str</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414370"><span class="hs-identifier hs-var">getSetting</span></a><span> </span><span class="hs-string">&quot;C compiler link flags&quot;</span><span>
</span><a name="line-314"></a><span>       </span><span class="hs-keyword">let</span><span>   </span><a name="local-6989586621679414419"><a href="#local-6989586621679414419"><span class="hs-identifier">as_prog</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414391"><span class="hs-identifier hs-var">gcc_prog</span></a><span>
</span><a name="line-315"></a><span>             </span><a name="local-6989586621679414420"><a href="#local-6989586621679414420"><span class="hs-identifier">as_args</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414399"><span class="hs-identifier hs-var">gcc_args</span></a><span>
</span><a name="line-316"></a><span>             </span><a name="local-6989586621679414421"><a href="#local-6989586621679414421"><span class="hs-identifier">ld_prog</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414391"><span class="hs-identifier hs-var">gcc_prog</span></a><span>
</span><a name="line-317"></a><span>             </span><a name="local-6989586621679414422"><a href="#local-6989586621679414422"><span class="hs-identifier">ld_args</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414399"><span class="hs-identifier hs-var">gcc_args</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#words"><span class="hs-identifier hs-var">words</span></a><span> </span><a href="#local-6989586621679414418"><span class="hs-identifier hs-var">gcc_link_args_str</span></a><span class="hs-special">)</span><span>
</span><a name="line-318"></a><span>
</span><a name="line-319"></a><span>       </span><span class="hs-comment">-- We just assume on command line</span><span>
</span><a name="line-320"></a><span>       </span><a name="local-6989586621679414423"><a href="#local-6989586621679414423"><span class="hs-identifier">lc_prog</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414370"><span class="hs-identifier hs-var">getSetting</span></a><span> </span><span class="hs-string">&quot;LLVM llc command&quot;</span><span>
</span><a name="line-321"></a><span>       </span><a name="local-6989586621679414424"><a href="#local-6989586621679414424"><span class="hs-identifier">lo_prog</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414370"><span class="hs-identifier hs-var">getSetting</span></a><span> </span><span class="hs-string">&quot;LLVM opt command&quot;</span><span>
</span><a name="line-322"></a><span>
</span><a name="line-323"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414425"><a href="#local-6989586621679414425"><span class="hs-identifier">iserv_prog</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414361"><span class="hs-identifier hs-var">libexec</span></a><span> </span><span class="hs-string">&quot;ghc-iserv&quot;</span><span>
</span><a name="line-324"></a><span>
</span><a name="line-325"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414426"><a href="#local-6989586621679414426"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Platform.html#Platform"><span class="hs-identifier hs-var">Platform</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-326"></a><span>                          </span><span class="hs-identifier">platformArch</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414383"><span class="hs-identifier hs-var">targetArch</span></a><span class="hs-special">,</span><span>
</span><a name="line-327"></a><span>                          </span><span class="hs-identifier">platformOS</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414384"><span class="hs-identifier hs-var">targetOS</span></a><span class="hs-special">,</span><span>
</span><a name="line-328"></a><span>                          </span><span class="hs-identifier">platformWordSize</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414385"><span class="hs-identifier hs-var">targetWordSize</span></a><span class="hs-special">,</span><span>
</span><a name="line-329"></a><span>                          </span><span class="hs-identifier">platformUnregisterised</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414386"><span class="hs-identifier hs-var">targetUnregisterised</span></a><span class="hs-special">,</span><span>
</span><a name="line-330"></a><span>                          </span><span class="hs-identifier">platformHasGnuNonexecStack</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414387"><span class="hs-identifier hs-var">targetHasGnuNonexecStack</span></a><span class="hs-special">,</span><span>
</span><a name="line-331"></a><span>                          </span><span class="hs-identifier">platformHasIdentDirective</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414388"><span class="hs-identifier hs-var">targetHasIdentDirective</span></a><span class="hs-special">,</span><span>
</span><a name="line-332"></a><span>                          </span><span class="hs-identifier">platformHasSubsectionsViaSymbols</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414389"><span class="hs-identifier hs-var">targetHasSubsectionsViaSymbols</span></a><span class="hs-special">,</span><span>
</span><a name="line-333"></a><span>                          </span><span class="hs-identifier">platformIsCrossCompiling</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414382"><span class="hs-identifier hs-var">crossCompiling</span></a><span>
</span><a name="line-334"></a><span>                      </span><span class="hs-special">}</span><span>
</span><a name="line-335"></a><span>
</span><a name="line-336"></a><span>       </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="DynFlags.html#Settings"><span class="hs-identifier hs-var">Settings</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-337"></a><span>                    </span><span class="hs-identifier">sTargetPlatform</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414426"><span class="hs-identifier hs-var">platform</span></a><span class="hs-special">,</span><span>
</span><a name="line-338"></a><span>                    </span><span class="hs-identifier">sTmpDir</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="../filepath-1.4.1.1/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#normalise"><span class="hs-identifier hs-var">normalise</span></a><span> </span><a href="#local-6989586621679414412"><span class="hs-identifier hs-var">tmpdir</span></a><span class="hs-special">,</span><span>
</span><a name="line-339"></a><span>                    </span><span class="hs-identifier">sGhcUsagePath</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414406"><span class="hs-identifier hs-var">ghc_usage_msg_path</span></a><span class="hs-special">,</span><span>
</span><a name="line-340"></a><span>                    </span><span class="hs-identifier">sGhciUsagePath</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414407"><span class="hs-identifier hs-var">ghci_usage_msg_path</span></a><span class="hs-special">,</span><span>
</span><a name="line-341"></a><span>                    </span><span class="hs-identifier">sTopDir</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414357"><span class="hs-identifier hs-var">top_dir</span></a><span class="hs-special">,</span><span>
</span><a name="line-342"></a><span>                    </span><span class="hs-identifier">sRawSettings</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414367"><span class="hs-identifier hs-var">mySettings</span></a><span class="hs-special">,</span><span>
</span><a name="line-343"></a><span>                    </span><span class="hs-identifier">sExtraGccViaCFlags</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#words"><span class="hs-identifier hs-var">words</span></a><span> </span><a href="#local-6989586621679414390"><span class="hs-identifier hs-var">myExtraGccViaCFlags</span></a><span class="hs-special">,</span><span>
</span><a name="line-344"></a><span>                    </span><span class="hs-identifier">sSystemPackageConfig</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414405"><span class="hs-identifier hs-var">pkgconfig_path</span></a><span class="hs-special">,</span><span>
</span><a name="line-345"></a><span>                    </span><span class="hs-identifier">sLdSupportsCompactUnwind</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414400"><span class="hs-identifier hs-var">ldSupportsCompactUnwind</span></a><span class="hs-special">,</span><span>
</span><a name="line-346"></a><span>                    </span><span class="hs-identifier">sLdSupportsBuildId</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414401"><span class="hs-identifier hs-var">ldSupportsBuildId</span></a><span class="hs-special">,</span><span>
</span><a name="line-347"></a><span>                    </span><span class="hs-identifier">sLdSupportsFilelist</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414402"><span class="hs-identifier hs-var">ldSupportsFilelist</span></a><span class="hs-special">,</span><span>
</span><a name="line-348"></a><span>                    </span><span class="hs-identifier">sLdIsGnuLd</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414403"><span class="hs-identifier hs-var">ldIsGnuLd</span></a><span class="hs-special">,</span><span>
</span><a name="line-349"></a><span>                    </span><span class="hs-identifier">sGccSupportsNoPie</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414393"><span class="hs-identifier hs-var">gccSupportsNoPie</span></a><span class="hs-special">,</span><span>
</span><a name="line-350"></a><span>                    </span><span class="hs-identifier">sProgramName</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;ghc&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-351"></a><span>                    </span><span class="hs-identifier">sProjectVersion</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Config.html#cProjectVersion"><span class="hs-identifier hs-var">cProjectVersion</span></a><span class="hs-special">,</span><span>
</span><a name="line-352"></a><span>                    </span><span class="hs-identifier">sPgm_L</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414408"><span class="hs-identifier hs-var">unlit_path</span></a><span class="hs-special">,</span><span>
</span><a name="line-353"></a><span>                    </span><span class="hs-identifier">sPgm_P</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414394"><span class="hs-identifier hs-var">cpp_prog</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679414398"><span class="hs-identifier hs-var">cpp_args</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-354"></a><span>                    </span><span class="hs-identifier">sPgm_F</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-355"></a><span>                    </span><span class="hs-identifier">sPgm_c</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414391"><span class="hs-identifier hs-var">gcc_prog</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679414399"><span class="hs-identifier hs-var">gcc_args</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-356"></a><span>                    </span><span class="hs-identifier">sPgm_s</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414414"><span class="hs-identifier hs-var">split_prog</span></a><span class="hs-special">,</span><a href="#local-6989586621679414415"><span class="hs-identifier hs-var">split_args</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-357"></a><span>                    </span><span class="hs-identifier">sPgm_a</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414419"><span class="hs-identifier hs-var">as_prog</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679414420"><span class="hs-identifier hs-var">as_args</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-358"></a><span>                    </span><span class="hs-identifier">sPgm_l</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414421"><span class="hs-identifier hs-var">ld_prog</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679414422"><span class="hs-identifier hs-var">ld_args</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-359"></a><span>                    </span><span class="hs-identifier">sPgm_dll</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414416"><span class="hs-identifier hs-var">mkdll_prog</span></a><span class="hs-special">,</span><a href="#local-6989586621679414417"><span class="hs-identifier hs-var">mkdll_args</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-360"></a><span>                    </span><span class="hs-identifier">sPgm_T</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414413"><span class="hs-identifier hs-var">touch_path</span></a><span class="hs-special">,</span><span>
</span><a name="line-361"></a><span>                    </span><span class="hs-identifier">sPgm_windres</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414410"><span class="hs-identifier hs-var">windres_path</span></a><span class="hs-special">,</span><span>
</span><a name="line-362"></a><span>                    </span><span class="hs-identifier">sPgm_libtool</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414411"><span class="hs-identifier hs-var">libtool_path</span></a><span class="hs-special">,</span><span>
</span><a name="line-363"></a><span>                    </span><span class="hs-identifier">sPgm_lo</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414424"><span class="hs-identifier hs-var">lo_prog</span></a><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-364"></a><span>                    </span><span class="hs-identifier">sPgm_lc</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414423"><span class="hs-identifier hs-var">lc_prog</span></a><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-365"></a><span>                    </span><span class="hs-identifier">sPgm_i</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414425"><span class="hs-identifier hs-var">iserv_prog</span></a><span class="hs-special">,</span><span>
</span><a name="line-366"></a><span>                    </span><span class="hs-identifier">sOpt_L</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-367"></a><span>                    </span><span class="hs-identifier">sOpt_P</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-368"></a><span>                    </span><span class="hs-identifier">sOpt_F</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-369"></a><span>                    </span><span class="hs-identifier">sOpt_c</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-370"></a><span>                    </span><span class="hs-identifier">sOpt_a</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-371"></a><span>                    </span><span class="hs-identifier">sOpt_l</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-372"></a><span>                    </span><span class="hs-identifier">sOpt_windres</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-373"></a><span>                    </span><span class="hs-identifier">sOpt_lo</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-374"></a><span>                    </span><span class="hs-identifier">sOpt_lc</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-375"></a><span>                    </span><span class="hs-identifier">sOpt_i</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-376"></a><span>                    </span><span class="hs-identifier">sPlatformConstants</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414369"><span class="hs-identifier hs-var">platformConstants</span></a><span>
</span><a name="line-377"></a><span>             </span><span class="hs-special">}</span><span>
</span><a name="line-378"></a><span>
</span><a name="line-379"></a><span class="hs-comment">-- returns a Unix-format path (relying on getBaseDir to do so too)</span><span>
</span><a name="line-380"></a><span class="hs-identifier">findTopDir</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-comment">-- Maybe TopDir path (without the '-B' prefix).</span><span>
</span><a name="line-381"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span>    </span><span class="hs-comment">-- TopDir (in Unix format '/' separated)</span><span>
</span><a name="line-382"></a><a name="findTopDir"><a href="SysTools.html#findTopDir"><span class="hs-identifier">findTopDir</span></a></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679414427"><a href="#local-6989586621679414427"><span class="hs-identifier">minusb</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../filepath-1.4.1.1/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#normalise"><span class="hs-identifier hs-var">normalise</span></a><span> </span><a href="#local-6989586621679414427"><span class="hs-identifier hs-var">minusb</span></a><span class="hs-special">)</span><span>
</span><a name="line-383"></a><span class="hs-identifier">findTopDir</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-384"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- Get directory of executable</span><span>
</span><a name="line-385"></a><span>         </span><a name="local-6989586621679414428"><a href="#local-6989586621679414428"><span class="hs-identifier">maybe_exec_dir</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#getBaseDir"><span class="hs-identifier hs-var">getBaseDir</span></a><span>
</span><a name="line-386"></a><span>         </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679414428"><span class="hs-identifier hs-var">maybe_exec_dir</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-387"></a><span>             </span><span class="hs-comment">-- &quot;Just&quot; on Windows, &quot;Nothing&quot; on unix</span><span>
</span><a name="line-388"></a><span>             </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a><span> </span><span class="hs-special">(</span><a href="Panic.html#InstallationError"><span class="hs-identifier hs-var">InstallationError</span></a><span> </span><span class="hs-string">&quot;missing -B&lt;dir&gt; option&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-389"></a><span>             </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679414429"><a href="#local-6989586621679414429"><span class="hs-identifier">dir</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679414429"><span class="hs-identifier hs-var">dir</span></a><span>
</span><a name="line-390"></a><span>
</span><a name="line-391"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Running an external program}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-398"></a><span>
</span><a name="line-399"></a><span class="hs-identifier">runUnlit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-400"></a><a name="runUnlit"><a href="SysTools.html#runUnlit"><span class="hs-identifier">runUnlit</span></a></a><span> </span><a name="local-6989586621679414430"><a href="#local-6989586621679414430"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414431"><a href="#local-6989586621679414431"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-401"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414432"><a href="#local-6989586621679414432"><span class="hs-identifier">prog</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#pgm_L"><span class="hs-identifier hs-var">pgm_L</span></a><span> </span><a href="#local-6989586621679414430"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-402"></a><span>      </span><a name="local-6989586621679414433"><a href="#local-6989586621679414433"><span class="hs-identifier">opts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#getOpts"><span class="hs-identifier hs-var">getOpts</span></a><span> </span><a href="#local-6989586621679414430"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="DynFlags.html#opt_L"><span class="hs-identifier hs-var">opt_L</span></a><span>
</span><a name="line-403"></a><span>  </span><a href="SysTools.html#runSomething"><span class="hs-identifier hs-var">runSomething</span></a><span> </span><a href="#local-6989586621679414430"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-string">&quot;Literate pre-processor&quot;</span><span> </span><a href="#local-6989586621679414432"><span class="hs-identifier hs-var">prog</span></a><span>
</span><a name="line-404"></a><span>               </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="#local-6989586621679414433"><span class="hs-identifier hs-var">opts</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414431"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-405"></a><span>
</span><a name="line-406"></a><span class="hs-identifier">runCpp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-407"></a><a name="runCpp"><a href="SysTools.html#runCpp"><span class="hs-identifier">runCpp</span></a></a><span> </span><a name="local-6989586621679414434"><a href="#local-6989586621679414434"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414435"><a href="#local-6989586621679414435"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>   </span><span class="hs-keyword">do</span><span>
</span><a name="line-408"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679414436"><a href="#local-6989586621679414436"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><a name="local-6989586621679414437"><a href="#local-6989586621679414437"><span class="hs-identifier">args0</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#pgm_P"><span class="hs-identifier hs-var">pgm_P</span></a><span> </span><a href="#local-6989586621679414434"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-409"></a><span>      </span><a name="local-6989586621679414438"><a href="#local-6989586621679414438"><span class="hs-identifier">args1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#getOpts"><span class="hs-identifier hs-var">getOpts</span></a><span> </span><a href="#local-6989586621679414434"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="DynFlags.html#opt_P"><span class="hs-identifier hs-var">opt_P</span></a><span class="hs-special">)</span><span>
</span><a name="line-410"></a><span>      </span><a name="local-6989586621679414439"><a href="#local-6989586621679414439"><span class="hs-identifier">args2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-string">&quot;-Werror&quot;</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_WarnIsError"><span class="hs-identifier hs-var">Opt_WarnIsError</span></a><span> </span><a href="#local-6989586621679414434"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">]</span><span>
</span><a name="line-411"></a><span>                </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-string">&quot;-Wundef&quot;</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#wopt"><span class="hs-identifier hs-var">wopt</span></a><span> </span><a href="DynFlags.html#Opt_WarnCPPUndef"><span class="hs-identifier hs-var">Opt_WarnCPPUndef</span></a><span> </span><a href="#local-6989586621679414434"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">]</span><span>
</span><a name="line-412"></a><span>  </span><a name="local-6989586621679414440"><a href="#local-6989586621679414440"><span class="hs-identifier">mb_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#getGccEnv"><span class="hs-identifier hs-var">getGccEnv</span></a><span> </span><a href="#local-6989586621679414439"><span class="hs-identifier hs-var">args2</span></a><span>
</span><a name="line-413"></a><span>  </span><a href="SysTools.html#runSomethingFiltered"><span class="hs-identifier hs-var">runSomethingFiltered</span></a><span> </span><a href="#local-6989586621679414434"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a><span>  </span><span class="hs-string">&quot;C pre-processor&quot;</span><span> </span><a href="#local-6989586621679414436"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-414"></a><span>                       </span><span class="hs-special">(</span><a href="#local-6989586621679414437"><span class="hs-identifier hs-var">args0</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414438"><span class="hs-identifier hs-var">args1</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414439"><span class="hs-identifier hs-var">args2</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414435"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414440"><span class="hs-identifier hs-var">mb_env</span></a><span>
</span><a name="line-415"></a><span>
</span><a name="line-416"></a><span class="hs-identifier">runPp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-417"></a><a name="runPp"><a href="SysTools.html#runPp"><span class="hs-identifier">runPp</span></a></a><span> </span><a name="local-6989586621679414441"><a href="#local-6989586621679414441"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414442"><a href="#local-6989586621679414442"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>   </span><span class="hs-keyword">do</span><span>
</span><a name="line-418"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414443"><a href="#local-6989586621679414443"><span class="hs-identifier">prog</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#pgm_F"><span class="hs-identifier hs-var">pgm_F</span></a><span> </span><a href="#local-6989586621679414441"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-419"></a><span>      </span><a name="local-6989586621679414444"><a href="#local-6989586621679414444"><span class="hs-identifier">opts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#getOpts"><span class="hs-identifier hs-var">getOpts</span></a><span> </span><a href="#local-6989586621679414441"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="DynFlags.html#opt_F"><span class="hs-identifier hs-var">opt_F</span></a><span class="hs-special">)</span><span>
</span><a name="line-420"></a><span>  </span><a href="SysTools.html#runSomething"><span class="hs-identifier hs-var">runSomething</span></a><span> </span><a href="#local-6989586621679414441"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-string">&quot;Haskell pre-processor&quot;</span><span> </span><a href="#local-6989586621679414443"><span class="hs-identifier hs-var">prog</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414442"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414444"><span class="hs-identifier hs-var">opts</span></a><span class="hs-special">)</span><span>
</span><a name="line-421"></a><span>
</span><a name="line-422"></a><span class="hs-identifier">runCc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-423"></a><a name="runCc"><a href="SysTools.html#runCc"><span class="hs-identifier">runCc</span></a></a><span> </span><a name="local-6989586621679414445"><a href="#local-6989586621679414445"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414446"><a href="#local-6989586621679414446"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>   </span><span class="hs-keyword">do</span><span>
</span><a name="line-424"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679414475"><a href="#local-6989586621679414475"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><a name="local-6989586621679414476"><a href="#local-6989586621679414476"><span class="hs-identifier">args0</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#pgm_c"><span class="hs-identifier hs-var">pgm_c</span></a><span> </span><a href="#local-6989586621679414445"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-425"></a><span>      </span><a name="local-6989586621679414477"><a href="#local-6989586621679414477"><span class="hs-identifier">args1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#getOpts"><span class="hs-identifier hs-var">getOpts</span></a><span> </span><a href="#local-6989586621679414445"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="DynFlags.html#opt_c"><span class="hs-identifier hs-var">opt_c</span></a><span class="hs-special">)</span><span>
</span><a name="line-426"></a><span>      </span><a name="local-6989586621679414478"><a href="#local-6989586621679414478"><span class="hs-identifier">args2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414476"><span class="hs-identifier hs-var">args0</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414477"><span class="hs-identifier hs-var">args1</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414446"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-427"></a><span>  </span><a name="local-6989586621679414479"><a href="#local-6989586621679414479"><span class="hs-identifier">mb_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#getGccEnv"><span class="hs-identifier hs-var">getGccEnv</span></a><span> </span><a href="#local-6989586621679414478"><span class="hs-identifier hs-var">args2</span></a><span>
</span><a name="line-428"></a><span>  </span><a href="SysTools.html#runSomethingResponseFile"><span class="hs-identifier hs-var">runSomethingResponseFile</span></a><span> </span><a href="#local-6989586621679414445"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679414447"><span class="hs-identifier hs-var">cc_filter</span></a><span> </span><span class="hs-string">&quot;C Compiler&quot;</span><span> </span><a href="#local-6989586621679414475"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679414478"><span class="hs-identifier hs-var">args2</span></a><span> </span><a href="#local-6989586621679414479"><span class="hs-identifier hs-var">mb_env</span></a><span>
</span><a name="line-429"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-430"></a><span>  </span><span class="hs-comment">-- discard some harmless warnings from gcc that we can't turn off</span><span>
</span><a name="line-431"></a><span>  </span><a name="local-6989586621679414447"><a href="#local-6989586621679414447"><span class="hs-identifier">cc_filter</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#unlines"><span class="hs-identifier hs-var">unlines</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-6989586621679414448"><span class="hs-identifier hs-var">doFilter</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#lines"><span class="hs-identifier hs-var">lines</span></a><span>
</span><a name="line-432"></a><span>
</span><a name="line-433"></a><span>  </span><span class="hs-comment">{-
  gcc gives warnings in chunks like so:
      In file included from /foo/bar/baz.h:11,
                       from /foo/bar/baz2.h:22,
                       from wibble.c:33:
      /foo/flibble:14: global register variable ...
      /foo/flibble:15: warning: call-clobbered r...
  We break it up into its chunks, remove any call-clobbered register
  warnings from each chunk, and then delete any chunks that we have
  emptied of warnings.
  -}</span><span>
</span><a name="line-444"></a><span>  </span><a name="local-6989586621679414448"><a href="#local-6989586621679414448"><span class="hs-identifier">doFilter</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414451"><span class="hs-identifier hs-var">unChunkWarnings</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-6989586621679414450"><span class="hs-identifier hs-var">filterWarnings</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-6989586621679414449"><span class="hs-identifier hs-var">chunkWarnings</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-445"></a><span>  </span><span class="hs-comment">-- We can't assume that the output will start with an &quot;In file inc...&quot;</span><span>
</span><a name="line-446"></a><span>  </span><span class="hs-comment">-- line, so we start off expecting a list of warnings rather than a</span><span>
</span><a name="line-447"></a><span>  </span><span class="hs-comment">-- location stack.</span><span>
</span><a name="line-448"></a><span>  </span><span class="hs-identifier">chunkWarnings</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- The location stack to use for the next</span><span>
</span><a name="line-449"></a><span>                            </span><span class="hs-comment">-- list of warnings</span><span>
</span><a name="line-450"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- The remaining lines to look at</span><span>
</span><a name="line-451"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-452"></a><span>  </span><a name="local-6989586621679414449"><a href="#local-6989586621679414449"><span class="hs-identifier">chunkWarnings</span></a></a><span> </span><a name="local-6989586621679414455"><a href="#local-6989586621679414455"><span class="hs-identifier">loc_stack</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679414455"><span class="hs-identifier hs-var">loc_stack</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-453"></a><span>  </span><span class="hs-identifier">chunkWarnings</span><span> </span><a name="local-6989586621679414456"><a href="#local-6989586621679414456"><span class="hs-identifier">loc_stack</span></a></a><span> </span><a name="local-6989586621679414457"><a href="#local-6989586621679414457"><span class="hs-identifier">xs</span></a></a><span>
</span><a name="line-454"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#break"><span class="hs-identifier hs-var">break</span></a><span> </span><a href="#local-6989586621679414452"><span class="hs-identifier hs-var">loc_stack_start</span></a><span> </span><a href="#local-6989586621679414457"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-455"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679414458"><a href="#local-6989586621679414458"><span class="hs-identifier">warnings</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414459"><a href="#local-6989586621679414459"><span class="hs-identifier">lss</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679414460"><a href="#local-6989586621679414460"><span class="hs-identifier">xs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-456"></a><span>            </span><span class="hs-keyword">case</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#span"><span class="hs-identifier hs-var">span</span></a><span> </span><a href="#local-6989586621679414453"><span class="hs-identifier hs-var">loc_start_continuation</span></a><span> </span><a href="#local-6989586621679414460"><span class="hs-identifier hs-var">xs'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-457"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679414461"><a href="#local-6989586621679414461"><span class="hs-identifier">lsc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414462"><a href="#local-6989586621679414462"><span class="hs-identifier">xs''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-458"></a><span>                </span><span class="hs-special">(</span><a href="#local-6989586621679414456"><span class="hs-identifier hs-var">loc_stack</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679414458"><span class="hs-identifier hs-var">warnings</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679414449"><span class="hs-identifier hs-var">chunkWarnings</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414459"><span class="hs-identifier hs-var">lss</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679414461"><span class="hs-identifier hs-var">lsc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414462"><span class="hs-identifier hs-var">xs''</span></a><span>
</span><a name="line-459"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679414456"><span class="hs-identifier hs-var">loc_stack</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679414457"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-460"></a><span>
</span><a name="line-461"></a><span>  </span><span class="hs-identifier">filterWarnings</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-462"></a><span>  </span><a name="local-6989586621679414450"><a href="#local-6989586621679414450"><span class="hs-identifier">filterWarnings</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-463"></a><span>  </span><span class="hs-comment">-- If the warnings are already empty then we are probably doing</span><span>
</span><a name="line-464"></a><span>  </span><span class="hs-comment">-- something wrong, so don't delete anything</span><span>
</span><a name="line-465"></a><span>  </span><span class="hs-identifier">filterWarnings</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679414463"><a href="#local-6989586621679414463"><span class="hs-identifier">xs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679414464"><a href="#local-6989586621679414464"><span class="hs-identifier">zs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414463"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679414450"><span class="hs-identifier hs-var">filterWarnings</span></a><span> </span><a href="#local-6989586621679414464"><span class="hs-identifier hs-var">zs</span></a><span>
</span><a name="line-466"></a><span>  </span><span class="hs-identifier">filterWarnings</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679414465"><a href="#local-6989586621679414465"><span class="hs-identifier">xs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414466"><a href="#local-6989586621679414466"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679414467"><a href="#local-6989586621679414467"><span class="hs-identifier">zs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="#local-6989586621679414454"><span class="hs-identifier hs-var">wantedWarning</span></a><span> </span><a href="#local-6989586621679414466"><span class="hs-identifier hs-var">ys</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-467"></a><span>                                       </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679414450"><span class="hs-identifier hs-var">filterWarnings</span></a><span> </span><a href="#local-6989586621679414467"><span class="hs-identifier hs-var">zs</span></a><span>
</span><a name="line-468"></a><span>                                       </span><a name="local-6989586621679414468"><a href="#local-6989586621679414468"><span class="hs-identifier">ys'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414465"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679414468"><span class="hs-identifier hs-var">ys'</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679414450"><span class="hs-identifier hs-var">filterWarnings</span></a><span> </span><a href="#local-6989586621679414467"><span class="hs-identifier hs-var">zs</span></a><span>
</span><a name="line-469"></a><span>
</span><a name="line-470"></a><span>  </span><span class="hs-identifier">unChunkWarnings</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span>
</span><a name="line-471"></a><span>  </span><a name="local-6989586621679414451"><a href="#local-6989586621679414451"><span class="hs-identifier">unChunkWarnings</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-472"></a><span>  </span><span class="hs-identifier">unChunkWarnings</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679414469"><a href="#local-6989586621679414469"><span class="hs-identifier">xs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414470"><a href="#local-6989586621679414470"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679414471"><a href="#local-6989586621679414471"><span class="hs-identifier">zs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414469"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414470"><span class="hs-identifier hs-var">ys</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414451"><span class="hs-identifier hs-var">unChunkWarnings</span></a><span> </span><a href="#local-6989586621679414471"><span class="hs-identifier hs-var">zs</span></a><span>
</span><a name="line-473"></a><span>
</span><a name="line-474"></a><span>  </span><a name="local-6989586621679414452"><a href="#local-6989586621679414452"><span class="hs-identifier">loc_stack_start</span></a></a><span>        </span><a name="local-6989586621679414472"><a href="#local-6989586621679414472"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;In file included from &quot;</span><span> </span><span class="hs-special">`</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#isPrefixOf"><span class="hs-identifier hs-var">isPrefixOf</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679414472"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-475"></a><span>  </span><a name="local-6989586621679414453"><a href="#local-6989586621679414453"><span class="hs-identifier">loc_start_continuation</span></a></a><span> </span><a name="local-6989586621679414473"><a href="#local-6989586621679414473"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;                 from &quot;</span><span> </span><span class="hs-special">`</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#isPrefixOf"><span class="hs-identifier hs-var">isPrefixOf</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679414473"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-476"></a><span>  </span><a name="local-6989586621679414454"><a href="#local-6989586621679414454"><span class="hs-identifier">wantedWarning</span></a></a><span> </span><a name="local-6989586621679414474"><a href="#local-6989586621679414474"><span class="hs-identifier">w</span></a></a><span>
</span><a name="line-477"></a><span>   </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;warning: call-clobbered register used&quot;</span><span> </span><span class="hs-special">`</span><a href="SysTools.html#isContainedIn"><span class="hs-identifier hs-var">isContainedIn</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679414474"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-478"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-479"></a><span>
</span><a name="line-480"></a><span class="hs-identifier">isContainedIn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-481"></a><a name="local-6989586621679414480"><a href="#local-6989586621679414480"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-special">`</span><a name="isContainedIn"><a href="SysTools.html#isContainedIn"><span class="hs-identifier">isContainedIn</span></a></a><span class="hs-special">`</span><span> </span><a name="local-6989586621679414481"><a href="#local-6989586621679414481"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414480"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#isPrefixOf"><span class="hs-identifier hs-var">isPrefixOf</span></a><span class="hs-special">`</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#tails"><span class="hs-identifier hs-var">tails</span></a><span> </span><a href="#local-6989586621679414481"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span>
</span><a name="line-482"></a><span>
</span><a name="line-483"></a><span class="hs-comment">-- | Run the linker with some arguments and return the output</span><span>
</span><a name="line-484"></a><span class="hs-identifier">askLd</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span>
</span><a name="line-485"></a><a name="askLd"><a href="SysTools.html#askLd"><span class="hs-identifier">askLd</span></a></a><span> </span><a name="local-6989586621679414482"><a href="#local-6989586621679414482"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414483"><a href="#local-6989586621679414483"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-486"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679414484"><a href="#local-6989586621679414484"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><a name="local-6989586621679414485"><a href="#local-6989586621679414485"><span class="hs-identifier">args0</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#pgm_l"><span class="hs-identifier hs-var">pgm_l</span></a><span> </span><a href="#local-6989586621679414482"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-487"></a><span>      </span><a name="local-6989586621679414486"><a href="#local-6989586621679414486"><span class="hs-identifier">args1</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#getOpts"><span class="hs-identifier hs-var">getOpts</span></a><span> </span><a href="#local-6989586621679414482"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="DynFlags.html#opt_l"><span class="hs-identifier hs-var">opt_l</span></a><span class="hs-special">)</span><span>
</span><a name="line-488"></a><span>      </span><a name="local-6989586621679414487"><a href="#local-6989586621679414487"><span class="hs-identifier">args2</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414485"><span class="hs-identifier hs-var">args0</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414486"><span class="hs-identifier hs-var">args1</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414483"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-489"></a><span>  </span><a name="local-6989586621679414488"><a href="#local-6989586621679414488"><span class="hs-identifier">mb_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#getGccEnv"><span class="hs-identifier hs-var">getGccEnv</span></a><span> </span><a href="#local-6989586621679414487"><span class="hs-identifier hs-var">args2</span></a><span>
</span><a name="line-490"></a><span>  </span><a href="SysTools.html#runSomethingWith"><span class="hs-identifier hs-var">runSomethingWith</span></a><span> </span><a href="#local-6989586621679414482"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-string">&quot;gcc&quot;</span><span> </span><a href="#local-6989586621679414484"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679414487"><span class="hs-identifier hs-var">args2</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679414489"><a href="#local-6989586621679414489"><span class="hs-identifier">real_args</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-491"></a><span>    </span><a href="SysTools.html#readCreateProcessWithExitCode%27"><span class="hs-identifier hs-var">readCreateProcessWithExitCode'</span></a><span> </span><span class="hs-special">(</span><a href="../process-1.4.3.0/src/%{MODULE/./-}.html#%{NAME}/System.Process.html#proc"><span class="hs-identifier hs-var">proc</span></a><span> </span><a href="#local-6989586621679414484"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679414489"><span class="hs-identifier hs-var">real_args</span></a><span class="hs-special">)</span><span class="hs-special">{</span><span> </span><span class="hs-identifier">env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414488"><span class="hs-identifier hs-var">mb_env</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-492"></a><span>
</span><a name="line-493"></a><span class="hs-comment">-- Similar to System.Process.readCreateProcessWithExitCode, but stderr is</span><span>
</span><a name="line-494"></a><span class="hs-comment">-- inherited from the parent process, and output to stderr is not captured.</span><span>
</span><a name="line-495"></a><span class="hs-identifier">readCreateProcessWithExitCode'</span><span>
</span><a name="line-496"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="../process-1.4.3.0/src/%{MODULE/./-}.html#%{NAME}/System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-type">CreateProcess</span></a><span>
</span><a name="line-497"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Exception.html#ExitCode"><span class="hs-identifier hs-type">ExitCode</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- ^ stdout</span><span>
</span><a name="line-498"></a><a name="readCreateProcessWithExitCode%27"><a href="SysTools.html#readCreateProcessWithExitCode%27"><span class="hs-identifier">readCreateProcessWithExitCode'</span></a></a><span> </span><a name="local-6989586621679414490"><a href="#local-6989586621679414490"><span class="hs-identifier">proc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-499"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679414491"><a href="#local-6989586621679414491"><span class="hs-identifier">outh</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679414492"><a href="#local-6989586621679414492"><span class="hs-identifier">pid</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-500"></a><span>        </span><a href="../process-1.4.3.0/src/%{MODULE/./-}.html#%{NAME}/System.Process.html#createProcess"><span class="hs-identifier hs-var">createProcess</span></a><span> </span><a href="#local-6989586621679414490"><span class="hs-identifier hs-var">proc</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">std_out</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../process-1.4.3.0/src/%{MODULE/./-}.html#%{NAME}/System.Process.Common.html#CreatePipe"><span class="hs-identifier hs-var">CreatePipe</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-501"></a><span>
</span><a name="line-502"></a><span>    </span><span class="hs-comment">-- fork off a thread to start consuming the output</span><span>
</span><a name="line-503"></a><span>    </span><a name="local-6989586621679414493"><a href="#local-6989586621679414493"><span class="hs-identifier">output</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.Text.html#hGetContents"><span class="hs-identifier hs-var">hGetContents</span></a><span> </span><a href="#local-6989586621679414491"><span class="hs-identifier hs-var">outh</span></a><span>
</span><a name="line-504"></a><span>    </span><a name="local-6989586621679414494"><a href="#local-6989586621679414494"><span class="hs-identifier">outMVar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.MVar.html#newEmptyMVar"><span class="hs-identifier hs-var">newEmptyMVar</span></a><span>
</span><a name="line-505"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Conc.Sync.html#forkIO"><span class="hs-identifier hs-var">forkIO</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#evaluate"><span class="hs-identifier hs-var">evaluate</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-6989586621679414493"><span class="hs-identifier hs-var">output</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.MVar.html#putMVar"><span class="hs-identifier hs-var">putMVar</span></a><span> </span><a href="#local-6989586621679414494"><span class="hs-identifier hs-var">outMVar</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-506"></a><span>
</span><a name="line-507"></a><span>    </span><span class="hs-comment">-- wait on the output</span><span>
</span><a name="line-508"></a><span>    </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.MVar.html#takeMVar"><span class="hs-identifier hs-var">takeMVar</span></a><span> </span><a href="#local-6989586621679414494"><span class="hs-identifier hs-var">outMVar</span></a><span>
</span><a name="line-509"></a><span>    </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.html#hClose"><span class="hs-identifier hs-var">hClose</span></a><span> </span><a href="#local-6989586621679414491"><span class="hs-identifier hs-var">outh</span></a><span>
</span><a name="line-510"></a><span>
</span><a name="line-511"></a><span>    </span><span class="hs-comment">-- wait on the process</span><span>
</span><a name="line-512"></a><span>    </span><a name="local-6989586621679414495"><a href="#local-6989586621679414495"><span class="hs-identifier">ex</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../process-1.4.3.0/src/%{MODULE/./-}.html#%{NAME}/System.Process.html#waitForProcess"><span class="hs-identifier hs-var">waitForProcess</span></a><span> </span><a href="#local-6989586621679414492"><span class="hs-identifier hs-var">pid</span></a><span>
</span><a name="line-513"></a><span>
</span><a name="line-514"></a><span>    </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414495"><span class="hs-identifier hs-var">ex</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679414493"><span class="hs-identifier hs-var">output</span></a><span class="hs-special">)</span><span>
</span><a name="line-515"></a><span>
</span><a name="line-516"></a><span class="hs-identifier">replaceVar</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-517"></a><a name="replaceVar"><a href="SysTools.html#replaceVar"><span class="hs-identifier">replaceVar</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679414496"><a href="#local-6989586621679414496"><span class="hs-identifier">var</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414497"><a href="#local-6989586621679414497"><span class="hs-identifier">value</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679414498"><a href="#local-6989586621679414498"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-518"></a><span>    </span><span class="hs-special">(</span><a href="#local-6989586621679414496"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679414497"><span class="hs-identifier hs-var">value</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679414499"><a href="#local-6989586621679414499"><span class="hs-identifier">var'</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679414496"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679414499"><span class="hs-identifier hs-var">var'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414498"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-519"></a><span>
</span><a name="line-520"></a><span class="hs-comment">-- | Version of @System.Process.readProcessWithExitCode@ that takes a</span><span>
</span><a name="line-521"></a><span class="hs-comment">-- key-value tuple to insert into the environment.</span><span>
</span><a name="line-522"></a><span class="hs-identifier">readProcessEnvWithExitCode</span><span>
</span><a name="line-523"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-comment">-- ^ program path</span><span>
</span><a name="line-524"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ program args</span><span>
</span><a name="line-525"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ addition to the environment</span><span>
</span><a name="line-526"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Exception.html#ExitCode"><span class="hs-identifier hs-type">ExitCode</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ (exit_code, stdout, stderr)</span><span>
</span><a name="line-527"></a><a name="readProcessEnvWithExitCode"><a href="SysTools.html#readProcessEnvWithExitCode"><span class="hs-identifier">readProcessEnvWithExitCode</span></a></a><span> </span><a name="local-6989586621679414500"><a href="#local-6989586621679414500"><span class="hs-identifier">prog</span></a></a><span> </span><a name="local-6989586621679414501"><a href="#local-6989586621679414501"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621679414502"><a href="#local-6989586621679414502"><span class="hs-identifier">env_update</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-528"></a><span>    </span><a name="local-6989586621679414503"><a href="#local-6989586621679414503"><span class="hs-identifier">current_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/System.Environment.html#getEnvironment"><span class="hs-identifier hs-var">getEnvironment</span></a><span>
</span><a name="line-529"></a><span>    </span><a href="../process-1.4.3.0/src/%{MODULE/./-}.html#%{NAME}/System.Process.html#readCreateProcessWithExitCode"><span class="hs-identifier hs-var">readCreateProcessWithExitCode</span></a><span> </span><span class="hs-special">(</span><a href="../process-1.4.3.0/src/%{MODULE/./-}.html#%{NAME}/System.Process.html#proc"><span class="hs-identifier hs-var">proc</span></a><span> </span><a href="#local-6989586621679414500"><span class="hs-identifier hs-var">prog</span></a><span> </span><a href="#local-6989586621679414501"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-530"></a><span>        </span><span class="hs-identifier">env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="SysTools.html#replaceVar"><span class="hs-identifier hs-var">replaceVar</span></a><span> </span><a href="#local-6989586621679414502"><span class="hs-identifier hs-var">env_update</span></a><span> </span><a href="#local-6989586621679414503"><span class="hs-identifier hs-var">current_env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-531"></a><span>
</span><a name="line-532"></a><span class="hs-comment">-- Don't let gcc localize version info string, #8825</span><span>
</span><a name="line-533"></a><span class="hs-identifier">c_locale_env</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span>
</span><a name="line-534"></a><a name="c_locale_env"><a href="SysTools.html#c_locale_env"><span class="hs-identifier">c_locale_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;LANGUAGE&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;C&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-535"></a><span>
</span><a name="line-536"></a><span class="hs-comment">-- If the -B&lt;dir&gt; option is set, add &lt;dir&gt; to PATH.  This works around</span><span>
</span><a name="line-537"></a><span class="hs-comment">-- a bug in gcc on Windows Vista where it can't find its auxiliary</span><span>
</span><a name="line-538"></a><span class="hs-comment">-- binaries (see bug #1110).</span><span>
</span><a name="line-539"></a><span class="hs-identifier">getGccEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">,</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-540"></a><a name="getGccEnv"><a href="SysTools.html#getGccEnv"><span class="hs-identifier">getGccEnv</span></a></a><span> </span><a name="local-6989586621679414504"><a href="#local-6989586621679414504"><span class="hs-identifier">opts</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-541"></a><span>  </span><span class="hs-keyword">if</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621679414505"><span class="hs-identifier hs-var">b_dirs</span></a><span>
</span><a name="line-542"></a><span>     </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-543"></a><span>     </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679414513"><a href="#local-6989586621679414513"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/System.Environment.html#getEnvironment"><span class="hs-identifier hs-var">getEnvironment</span></a><span>
</span><a name="line-544"></a><span>             </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-6989586621679414507"><span class="hs-identifier hs-var">mangle_path</span></a><span> </span><a href="#local-6989586621679414513"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-545"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-546"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679414505"><a href="#local-6989586621679414505"><span class="hs-identifier">b_dirs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#partitionWith"><span class="hs-identifier hs-var">partitionWith</span></a><span> </span><a href="#local-6989586621679414506"><span class="hs-identifier hs-var">get_b_opt</span></a><span> </span><a href="#local-6989586621679414504"><span class="hs-identifier hs-var">opts</span></a><span>
</span><a name="line-547"></a><span>
</span><a name="line-548"></a><span>  </span><a name="local-6989586621679414506"><a href="#local-6989586621679414506"><span class="hs-identifier">get_b_opt</span></a></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-special">(</span><span class="hs-char">'-'</span><span class="hs-glyph">:</span><span class="hs-char">'B'</span><span class="hs-glyph">:</span><a name="local-6989586621679414508"><a href="#local-6989586621679414508"><span class="hs-identifier">dir</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a><span> </span><a href="#local-6989586621679414508"><span class="hs-identifier hs-var">dir</span></a><span>
</span><a name="line-549"></a><span>  </span><span class="hs-identifier">get_b_opt</span><span> </span><a name="local-6989586621679414509"><a href="#local-6989586621679414509"><span class="hs-identifier">other</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><a href="#local-6989586621679414509"><span class="hs-identifier hs-var">other</span></a><span>
</span><a name="line-550"></a><span>
</span><a name="line-551"></a><span>  </span><a name="local-6989586621679414507"><a href="#local-6989586621679414507"><span class="hs-identifier">mangle_path</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679414510"><a href="#local-6989586621679414510"><span class="hs-identifier">path</span></a></a><span class="hs-special">,</span><a name="local-6989586621679414511"><a href="#local-6989586621679414511"><span class="hs-identifier">paths</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Unicode.html#toUpper"><span class="hs-identifier hs-var">toUpper</span></a><span> </span><a href="#local-6989586621679414510"><span class="hs-identifier hs-var">path</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-string">&quot;PATH&quot;</span><span>
</span><a name="line-552"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414510"><span class="hs-identifier hs-var">path</span></a><span class="hs-special">,</span><span> </span><span class="hs-char">'\&quot;'</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a><span> </span><a href="#local-6989586621679414505"><span class="hs-identifier hs-var">b_dirs</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot;\&quot;;&quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414511"><span class="hs-identifier hs-var">paths</span></a><span class="hs-special">)</span><span>
</span><a name="line-553"></a><span>  </span><span class="hs-identifier">mangle_path</span><span> </span><a name="local-6989586621679414512"><a href="#local-6989586621679414512"><span class="hs-identifier">other</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414512"><span class="hs-identifier hs-var">other</span></a><span>
</span><a name="line-554"></a><span>
</span><a name="line-555"></a><span class="hs-identifier">runSplit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-556"></a><a name="runSplit"><a href="SysTools.html#runSplit"><span class="hs-identifier">runSplit</span></a></a><span> </span><a name="local-6989586621679414514"><a href="#local-6989586621679414514"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414515"><a href="#local-6989586621679414515"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-557"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679414516"><a href="#local-6989586621679414516"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><a name="local-6989586621679414517"><a href="#local-6989586621679414517"><span class="hs-identifier">args0</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#pgm_s"><span class="hs-identifier hs-var">pgm_s</span></a><span> </span><a href="#local-6989586621679414514"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-558"></a><span>  </span><a href="SysTools.html#runSomething"><span class="hs-identifier hs-var">runSomething</span></a><span> </span><a href="#local-6989586621679414514"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-string">&quot;Splitter&quot;</span><span> </span><a href="#local-6989586621679414516"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414517"><span class="hs-identifier hs-var">args0</span></a><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><a href="#local-6989586621679414515"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-559"></a><span>
</span><a name="line-560"></a><span class="hs-identifier">runAs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-561"></a><a name="runAs"><a href="SysTools.html#runAs"><span class="hs-identifier">runAs</span></a></a><span> </span><a name="local-6989586621679414518"><a href="#local-6989586621679414518"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414519"><a href="#local-6989586621679414519"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-562"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679414520"><a href="#local-6989586621679414520"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><a name="local-6989586621679414521"><a href="#local-6989586621679414521"><span class="hs-identifier">args0</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#pgm_a"><span class="hs-identifier hs-var">pgm_a</span></a><span> </span><a href="#local-6989586621679414518"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-563"></a><span>      </span><a name="local-6989586621679414522"><a href="#local-6989586621679414522"><span class="hs-identifier">args1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#getOpts"><span class="hs-identifier hs-var">getOpts</span></a><span> </span><a href="#local-6989586621679414518"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="DynFlags.html#opt_a"><span class="hs-identifier hs-var">opt_a</span></a><span class="hs-special">)</span><span>
</span><a name="line-564"></a><span>      </span><a name="local-6989586621679414523"><a href="#local-6989586621679414523"><span class="hs-identifier">args2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414521"><span class="hs-identifier hs-var">args0</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414522"><span class="hs-identifier hs-var">args1</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414519"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-565"></a><span>  </span><a name="local-6989586621679414524"><a href="#local-6989586621679414524"><span class="hs-identifier">mb_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#getGccEnv"><span class="hs-identifier hs-var">getGccEnv</span></a><span> </span><a href="#local-6989586621679414523"><span class="hs-identifier hs-var">args2</span></a><span>
</span><a name="line-566"></a><span>  </span><a href="SysTools.html#runSomethingFiltered"><span class="hs-identifier hs-var">runSomethingFiltered</span></a><span> </span><a href="#local-6989586621679414518"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-string">&quot;Assembler&quot;</span><span> </span><a href="#local-6989586621679414520"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679414523"><span class="hs-identifier hs-var">args2</span></a><span> </span><a href="#local-6989586621679414524"><span class="hs-identifier hs-var">mb_env</span></a><span>
</span><a name="line-567"></a><span>
</span><a name="line-568"></a><span class="hs-comment">-- | Run the LLVM Optimiser</span><span>
</span><a name="line-569"></a><span class="hs-identifier">runLlvmOpt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-570"></a><a name="runLlvmOpt"><a href="SysTools.html#runLlvmOpt"><span class="hs-identifier">runLlvmOpt</span></a></a><span> </span><a name="local-6989586621679414525"><a href="#local-6989586621679414525"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414526"><a href="#local-6989586621679414526"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-571"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679414527"><a href="#local-6989586621679414527"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><a name="local-6989586621679414528"><a href="#local-6989586621679414528"><span class="hs-identifier">args0</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#pgm_lo"><span class="hs-identifier hs-var">pgm_lo</span></a><span> </span><a href="#local-6989586621679414525"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-572"></a><span>      </span><a name="local-6989586621679414529"><a href="#local-6989586621679414529"><span class="hs-identifier">args1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#getOpts"><span class="hs-identifier hs-var">getOpts</span></a><span> </span><a href="#local-6989586621679414525"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="DynFlags.html#opt_lo"><span class="hs-identifier hs-var">opt_lo</span></a><span class="hs-special">)</span><span>
</span><a name="line-573"></a><span>  </span><a href="SysTools.html#runSomething"><span class="hs-identifier hs-var">runSomething</span></a><span> </span><a href="#local-6989586621679414525"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-string">&quot;LLVM Optimiser&quot;</span><span> </span><a href="#local-6989586621679414527"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414528"><span class="hs-identifier hs-var">args0</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414529"><span class="hs-identifier hs-var">args1</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414526"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-574"></a><span>
</span><a name="line-575"></a><span class="hs-comment">-- | Run the LLVM Compiler</span><span>
</span><a name="line-576"></a><span class="hs-identifier">runLlvmLlc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-577"></a><a name="runLlvmLlc"><a href="SysTools.html#runLlvmLlc"><span class="hs-identifier">runLlvmLlc</span></a></a><span> </span><a name="local-6989586621679414530"><a href="#local-6989586621679414530"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414531"><a href="#local-6989586621679414531"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-578"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679414532"><a href="#local-6989586621679414532"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><a name="local-6989586621679414533"><a href="#local-6989586621679414533"><span class="hs-identifier">args0</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#pgm_lc"><span class="hs-identifier hs-var">pgm_lc</span></a><span> </span><a href="#local-6989586621679414530"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-579"></a><span>      </span><a name="local-6989586621679414534"><a href="#local-6989586621679414534"><span class="hs-identifier">args1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#getOpts"><span class="hs-identifier hs-var">getOpts</span></a><span> </span><a href="#local-6989586621679414530"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="DynFlags.html#opt_lc"><span class="hs-identifier hs-var">opt_lc</span></a><span class="hs-special">)</span><span>
</span><a name="line-580"></a><span>  </span><a href="SysTools.html#runSomething"><span class="hs-identifier hs-var">runSomething</span></a><span> </span><a href="#local-6989586621679414530"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-string">&quot;LLVM Compiler&quot;</span><span> </span><a href="#local-6989586621679414532"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414533"><span class="hs-identifier hs-var">args0</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414534"><span class="hs-identifier hs-var">args1</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414531"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-581"></a><span>
</span><a name="line-582"></a><span class="hs-comment">-- | Run the clang compiler (used as an assembler for the LLVM</span><span>
</span><a name="line-583"></a><span class="hs-comment">-- backend on OS X as LLVM doesn't support the OS X system</span><span>
</span><a name="line-584"></a><span class="hs-comment">-- assembler)</span><span>
</span><a name="line-585"></a><span class="hs-identifier">runClang</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-586"></a><a name="runClang"><a href="SysTools.html#runClang"><span class="hs-identifier">runClang</span></a></a><span> </span><a name="local-6989586621679414535"><a href="#local-6989586621679414535"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414536"><a href="#local-6989586621679414536"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-587"></a><span>  </span><span class="hs-comment">-- we simply assume its available on the PATH</span><span>
</span><a name="line-588"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414537"><a href="#local-6989586621679414537"><span class="hs-identifier">clang</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;clang&quot;</span><span>
</span><a name="line-589"></a><span>      </span><span class="hs-comment">-- be careful what options we call clang with</span><span>
</span><a name="line-590"></a><span>      </span><span class="hs-comment">-- see #5903 and #7617 for bugs caused by this.</span><span>
</span><a name="line-591"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679414538"><a href="#local-6989586621679414538"><span class="hs-identifier">args0</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#pgm_a"><span class="hs-identifier hs-var">pgm_a</span></a><span> </span><a href="#local-6989586621679414535"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-592"></a><span>      </span><a name="local-6989586621679414539"><a href="#local-6989586621679414539"><span class="hs-identifier">args1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#getOpts"><span class="hs-identifier hs-var">getOpts</span></a><span> </span><a href="#local-6989586621679414535"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="DynFlags.html#opt_a"><span class="hs-identifier hs-var">opt_a</span></a><span class="hs-special">)</span><span>
</span><a name="line-593"></a><span>      </span><a name="local-6989586621679414540"><a href="#local-6989586621679414540"><span class="hs-identifier">args2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414538"><span class="hs-identifier hs-var">args0</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414539"><span class="hs-identifier hs-var">args1</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414536"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-594"></a><span>  </span><a name="local-6989586621679414541"><a href="#local-6989586621679414541"><span class="hs-identifier">mb_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#getGccEnv"><span class="hs-identifier hs-var">getGccEnv</span></a><span> </span><a href="#local-6989586621679414540"><span class="hs-identifier hs-var">args2</span></a><span>
</span><a name="line-595"></a><span>  </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#catch"><span class="hs-identifier hs-var">Exception</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">catch</span></a><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span>
</span><a name="line-596"></a><span>        </span><a href="SysTools.html#runSomethingFiltered"><span class="hs-identifier hs-var">runSomethingFiltered</span></a><span> </span><a href="#local-6989586621679414535"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-string">&quot;Clang (Assembler)&quot;</span><span> </span><a href="#local-6989586621679414537"><span class="hs-identifier hs-var">clang</span></a><span> </span><a href="#local-6989586621679414540"><span class="hs-identifier hs-var">args2</span></a><span> </span><a href="#local-6989586621679414541"><span class="hs-identifier hs-var">mb_env</span></a><span>
</span><a name="line-597"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-598"></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679414542"><a href="#local-6989586621679414542"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Exception.html#SomeException"><span class="hs-identifier hs-type">SomeException</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-599"></a><span>        </span><a href="ErrUtils.html#errorMsg"><span class="hs-identifier hs-var">errorMsg</span></a><span> </span><a href="#local-6989586621679414535"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-600"></a><span>            </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Error running clang! you need clang installed to use the&quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span>
</span><a name="line-601"></a><span>                  </span><span class="hs-string">&quot; LLVM backend&quot;</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%24%2B%24"><span class="hs-operator hs-var">$+$</span></a><span>
</span><a name="line-602"></a><span>            </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;(or GHC tried to execute clang incorrectly)&quot;</span><span>
</span><a name="line-603"></a><span>        </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#throwIO"><span class="hs-identifier hs-var">throwIO</span></a><span> </span><a href="#local-6989586621679414542"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-604"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-605"></a><span>
</span><a name="line-606"></a><span class="hs-comment">-- | Figure out which version of LLVM we are running this session</span><span>
</span><a name="line-607"></a><span class="hs-identifier">figureLlvmVersion</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-608"></a><a name="figureLlvmVersion"><a href="SysTools.html#figureLlvmVersion"><span class="hs-identifier">figureLlvmVersion</span></a></a><span> </span><a name="local-6989586621679414543"><a href="#local-6989586621679414543"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-609"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679414544"><a href="#local-6989586621679414544"><span class="hs-identifier">pgm</span></a></a><span class="hs-special">,</span><a name="local-6989586621679414545"><a href="#local-6989586621679414545"><span class="hs-identifier">opts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#pgm_lc"><span class="hs-identifier hs-var">pgm_lc</span></a><span> </span><a href="#local-6989586621679414543"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-610"></a><span>      </span><a name="local-6989586621679414546"><a href="#local-6989586621679414546"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="Util.html#notNull"><span class="hs-identifier hs-var">notNull</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#showOpt"><span class="hs-identifier hs-var">showOpt</span></a><span> </span><a href="#local-6989586621679414545"><span class="hs-identifier hs-var">opts</span></a><span class="hs-special">)</span><span>
</span><a name="line-611"></a><span>      </span><span class="hs-comment">-- we grab the args even though they should be useless just in</span><span>
</span><a name="line-612"></a><span>      </span><span class="hs-comment">-- case the user is using a customised 'llc' that requires some</span><span>
</span><a name="line-613"></a><span>      </span><span class="hs-comment">-- of the options they've specified. llc doesn't care what other</span><span>
</span><a name="line-614"></a><span>      </span><span class="hs-comment">-- options are specified when '-version' is used.</span><span>
</span><a name="line-615"></a><span>      </span><a name="local-6989586621679414547"><a href="#local-6989586621679414547"><span class="hs-identifier">args'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414546"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;-version&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-616"></a><span>  </span><a name="local-6989586621679414556"><a href="#local-6989586621679414556"><span class="hs-identifier">ver</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Exception.html#catchIO"><span class="hs-identifier hs-var">catchIO</span></a><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span>
</span><a name="line-617"></a><span>             </span><span class="hs-special">(</span><a name="local-6989586621679414548"><a href="#local-6989586621679414548"><span class="hs-identifier">pin</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414549"><a href="#local-6989586621679414549"><span class="hs-identifier">pout</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414550"><a href="#local-6989586621679414550"><span class="hs-identifier">perr</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../process-1.4.3.0/src/%{MODULE/./-}.html#%{NAME}/System.Process.html#runInteractiveProcess"><span class="hs-identifier hs-var">runInteractiveProcess</span></a><span> </span><a href="#local-6989586621679414544"><span class="hs-identifier hs-var">pgm</span></a><span> </span><a href="#local-6989586621679414547"><span class="hs-identifier hs-var">args'</span></a><span>
</span><a name="line-618"></a><span>                                             </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-619"></a><span>             </span><span class="hs-comment">{- &gt; llc -version
                  LLVM (http://llvm.org/):
                    LLVM version 3.5.2
                    ...
             -}</span><span>
</span><a name="line-624"></a><span>             </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.html#hSetBinaryMode"><span class="hs-identifier hs-var">hSetBinaryMode</span></a><span> </span><a href="#local-6989586621679414549"><span class="hs-identifier hs-var">pout</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-625"></a><span>             </span><span class="hs-identifier">_</span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.Text.html#hGetLine"><span class="hs-identifier hs-var">hGetLine</span></a><span> </span><a href="#local-6989586621679414549"><span class="hs-identifier hs-var">pout</span></a><span>
</span><a name="line-626"></a><span>             </span><a name="local-6989586621679414551"><a href="#local-6989586621679414551"><span class="hs-identifier">vline</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#dropWhile"><span class="hs-identifier hs-var">dropWhile</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Unicode.html#isDigit"><span class="hs-identifier hs-var">isDigit</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span class="hs-special">`</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.Text.html#hGetLine"><span class="hs-identifier hs-var">hGetLine</span></a><span> </span><a href="#local-6989586621679414549"><span class="hs-identifier hs-var">pout</span></a><span>
</span><a name="line-627"></a><span>             </span><a name="local-6989586621679414554"><a href="#local-6989586621679414554"><span class="hs-identifier">v</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#span"><span class="hs-identifier hs-var">span</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-char">'.'</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414551"><span class="hs-identifier hs-var">vline</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-628"></a><span>                        </span><span class="hs-special">(</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fail"><span class="hs-identifier hs-var">fail</span></a><span> </span><span class="hs-string">&quot;no digits!&quot;</span><span>
</span><a name="line-629"></a><span>                        </span><span class="hs-special">(</span><a name="local-6989586621679414552"><a href="#local-6989586621679414552"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621679414553"><a href="#local-6989586621679414553"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Text.Read.html#read"><span class="hs-identifier hs-var">read</span></a><span> </span><a href="#local-6989586621679414552"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-630"></a><span>                                        </span><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Text.Read.html#read"><span class="hs-identifier hs-var">read</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#takeWhile"><span class="hs-identifier hs-var">takeWhile</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Unicode.html#isDigit"><span class="hs-identifier hs-var">isDigit</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#drop"><span class="hs-identifier hs-var">drop</span></a><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679414553"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-631"></a><span>
</span><a name="line-632"></a><span>             </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.html#hClose"><span class="hs-identifier hs-var">hClose</span></a><span> </span><a href="#local-6989586621679414548"><span class="hs-identifier hs-var">pin</span></a><span>
</span><a name="line-633"></a><span>             </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.html#hClose"><span class="hs-identifier hs-var">hClose</span></a><span> </span><a href="#local-6989586621679414549"><span class="hs-identifier hs-var">pout</span></a><span>
</span><a name="line-634"></a><span>             </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.html#hClose"><span class="hs-identifier hs-var">hClose</span></a><span> </span><a href="#local-6989586621679414550"><span class="hs-identifier hs-var">perr</span></a><span>
</span><a name="line-635"></a><span>             </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679414554"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-636"></a><span>            </span><span class="hs-special">)</span><span>
</span><a name="line-637"></a><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679414555"><a href="#local-6989586621679414555"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-638"></a><span>                </span><a href="ErrUtils.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a><span> </span><a href="#local-6989586621679414543"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">2</span><span>
</span><a name="line-639"></a><span>                    </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Error (figuring out LLVM version):&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-640"></a><span>                     </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679414555"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-641"></a><span>                </span><a href="ErrUtils.html#errorMsg"><span class="hs-identifier hs-var">errorMsg</span></a><span> </span><a href="#local-6989586621679414543"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span>
</span><a name="line-642"></a><span>                    </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Warning:&quot;</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">9</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-643"></a><span>                          </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Couldn't figure out LLVM version!&quot;</span><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span>
</span><a name="line-644"></a><span>                          </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Make sure you have installed LLVM &quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span>
</span><a name="line-645"></a><span>                                </span><a href="LlvmCodeGen.Base.html#llvmVersionStr"><span class="hs-identifier hs-var">llvmVersionStr</span></a><span> </span><a href="LlvmCodeGen.Base.html#supportedLlvmVersion"><span class="hs-identifier hs-var">supportedLlvmVersion</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-646"></a><span>                </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span>
</span><a name="line-647"></a><span>  </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679414556"><span class="hs-identifier hs-var">ver</span></a><span>
</span><a name="line-648"></a><span>
</span><a name="line-649"></a><span class="hs-comment">{- Note [Windows stack usage]

See: Trac #8870 (and #8834 for related info) and #12186

On Windows, occasionally we need to grow the stack. In order to do
this, we would normally just bump the stack pointer - but there's a
catch on Windows.

If the stack pointer is bumped by more than a single page, then the
pages between the initial pointer and the resulting location must be
properly committed by the Windows virtual memory subsystem. This is
only needed in the event we bump by more than one page (i.e 4097 bytes
or more).

Windows compilers solve this by emitting a call to a special function
called _chkstk, which does this committing of the pages for you.

The reason this was causing a segfault was because due to the fact the
new code generator tends to generate larger functions, we needed more
stack space in GHC itself. In the x86 codegen, we needed approximately
~12kb of stack space in one go, which caused the process to segfault,
as the intervening pages were not committed.

GCC can emit such a check for us automatically but only when the flag
-fstack-check is used.

See https://gcc.gnu.org/onlinedocs/gnat_ugn/Stack-Overflow-Checking.html
for more information.

-}</span><span>
</span><a name="line-679"></a><span>
</span><a name="line-680"></a><span class="hs-comment">{- Note [Run-time linker info]

See also: Trac #5240, Trac #6063, Trac #10110

Before 'runLink', we need to be sure to get the relevant information
about the linker we're using at runtime to see if we need any extra
options. For example, GNU ld requires '--reduce-memory-overheads' and
'--hash-size=31' in order to use reasonable amounts of memory (see
trac #5240.) But this isn't supported in GNU gold.

Generally, the linker changing from what was detected at ./configure
time has always been possible using -pgml, but on Linux it can happen
'transparently' by installing packages like binutils-gold, which
change what /usr/bin/ld actually points to.

Clang vs GCC notes:

For gcc, 'gcc -Wl,--version' gives a bunch of output about how to
invoke the linker before the version information string. For 'clang',
the version information for 'ld' is all that's output. For this
reason, we typically need to slurp up all of the standard error output
and look through it.

Other notes:

We cache the LinkerInfo inside DynFlags, since clients may link
multiple times. The definition of LinkerInfo is there to avoid a
circular dependency.

-}</span><span>
</span><a name="line-710"></a><span>
</span><a name="line-711"></a><span class="hs-comment">{- Note [ELF needed shared libs]

Some distributions change the link editor's default handling of
ELF DT_NEEDED tags to include only those shared objects that are
needed to resolve undefined symbols. For Template Haskell we need
the last temporary shared library also if it is not needed for the
currently linked temporary shared library. We specify --no-as-needed
to override the default. This flag exists in GNU ld and GNU gold.

The flag is only needed on ELF systems. On Windows (PE) and Mac OS X
(Mach-O) the flag is not needed.

-}</span><span>
</span><a name="line-724"></a><span>
</span><a name="line-725"></a><span class="hs-comment">{- Note [Windows static libGCC]

The GCC versions being upgraded to in #10726 are configured with
dynamic linking of libgcc supported. This results in libgcc being
linked dynamically when a shared library is created.

This introduces thus an extra dependency on GCC dll that was not
needed before by shared libraries created with GHC. This is a particular
issue on Windows because you get a non-obvious error due to this missing
dependency. This dependent dll is also not commonly on your path.

For this reason using the static libgcc is preferred as it preserves
the same behaviour that existed before. There are however some very good
reasons to have the shared version as well as described on page 181 of
https://gcc.gnu.org/onlinedocs/gcc-5.2.0/gcc.pdf :

&quot;There are several situations in which an application should use the
 shared &#8216;libgcc&#8217; instead of the static version. The most common of these
 is when the application wishes to throw and catch exceptions across different
 shared libraries. In that case, each of the libraries as well as the application
 itself should use the shared &#8216;libgcc&#8217;. &quot;

-}</span><span>
</span><a name="line-748"></a><span>
</span><a name="line-749"></a><span class="hs-identifier">neededLinkArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#LinkerInfo"><span class="hs-identifier hs-type">LinkerInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span>
</span><a name="line-750"></a><a name="neededLinkArgs"><a href="SysTools.html#neededLinkArgs"><span class="hs-identifier">neededLinkArgs</span></a></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#GnuLD"><span class="hs-identifier hs-var">GnuLD</span></a><span> </span><a name="local-6989586621679414557"><a href="#local-6989586621679414557"><span class="hs-identifier">o</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414557"><span class="hs-identifier hs-var">o</span></a><span>
</span><a name="line-751"></a><span class="hs-identifier">neededLinkArgs</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#GnuGold"><span class="hs-identifier hs-var">GnuGold</span></a><span> </span><a name="local-6989586621679414558"><a href="#local-6989586621679414558"><span class="hs-identifier">o</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414558"><span class="hs-identifier hs-var">o</span></a><span>
</span><a name="line-752"></a><span class="hs-identifier">neededLinkArgs</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#DarwinLD"><span class="hs-identifier hs-var">DarwinLD</span></a><span> </span><a name="local-6989586621679414559"><a href="#local-6989586621679414559"><span class="hs-identifier">o</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414559"><span class="hs-identifier hs-var">o</span></a><span>
</span><a name="line-753"></a><span class="hs-identifier">neededLinkArgs</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#SolarisLD"><span class="hs-identifier hs-var">SolarisLD</span></a><span> </span><a name="local-6989586621679414560"><a href="#local-6989586621679414560"><span class="hs-identifier">o</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414560"><span class="hs-identifier hs-var">o</span></a><span>
</span><a name="line-754"></a><span class="hs-identifier">neededLinkArgs</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#AixLD"><span class="hs-identifier hs-var">AixLD</span></a><span> </span><a name="local-6989586621679414561"><a href="#local-6989586621679414561"><span class="hs-identifier">o</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414561"><span class="hs-identifier hs-var">o</span></a><span>
</span><a name="line-755"></a><span class="hs-identifier">neededLinkArgs</span><span> </span><a href="DynFlags.html#UnknownLD"><span class="hs-identifier hs-var">UnknownLD</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-756"></a><span>
</span><a name="line-757"></a><span class="hs-comment">-- Grab linker info and cache it in DynFlags.</span><span>
</span><a name="line-758"></a><span class="hs-identifier">getLinkerInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="DynFlags.html#LinkerInfo"><span class="hs-identifier hs-type">LinkerInfo</span></a><span>
</span><a name="line-759"></a><a name="getLinkerInfo"><a href="SysTools.html#getLinkerInfo"><span class="hs-identifier">getLinkerInfo</span></a></a><span> </span><a name="local-6989586621679414562"><a href="#local-6989586621679414562"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-760"></a><span>  </span><a name="local-6989586621679414563"><a href="#local-6989586621679414563"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">rtldInfo</span><span> </span><a href="#local-6989586621679414562"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-761"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679414563"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-762"></a><span>    </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679414564"><a href="#local-6989586621679414564"><span class="hs-identifier">v</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679414564"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-763"></a><span>    </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-764"></a><span>      </span><a name="local-6989586621679414565"><a href="#local-6989586621679414565"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#getLinkerInfo%27"><span class="hs-identifier hs-var">getLinkerInfo'</span></a><span> </span><a href="#local-6989586621679414562"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-765"></a><span>      </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#writeIORef"><span class="hs-identifier hs-var">writeIORef</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">rtldInfo</span><span> </span><a href="#local-6989586621679414562"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679414565"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-766"></a><span>      </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679414565"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-767"></a><span>
</span><a name="line-768"></a><span class="hs-comment">-- See Note [Run-time linker info].</span><span>
</span><a name="line-769"></a><span class="hs-identifier">getLinkerInfo'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="DynFlags.html#LinkerInfo"><span class="hs-identifier hs-type">LinkerInfo</span></a><span>
</span><a name="line-770"></a><a name="getLinkerInfo%27"><a href="SysTools.html#getLinkerInfo%27"><span class="hs-identifier">getLinkerInfo'</span></a></a><span> </span><a name="local-6989586621679414566"><a href="#local-6989586621679414566"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-771"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414567"><a href="#local-6989586621679414567"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a><span> </span><a href="#local-6989586621679414566"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-772"></a><span>      </span><a name="local-6989586621679414568"><a href="#local-6989586621679414568"><span class="hs-identifier">os</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><a href="#local-6989586621679414567"><span class="hs-identifier hs-var">platform</span></a><span>
</span><a name="line-773"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621679414569"><a href="#local-6989586621679414569"><span class="hs-identifier">pgm</span></a></a><span class="hs-special">,</span><a name="local-6989586621679414570"><a href="#local-6989586621679414570"><span class="hs-identifier">args0</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#pgm_l"><span class="hs-identifier hs-var">pgm_l</span></a><span> </span><a href="#local-6989586621679414566"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-774"></a><span>      </span><a name="local-6989586621679414571"><a href="#local-6989586621679414571"><span class="hs-identifier">args1</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#getOpts"><span class="hs-identifier hs-var">getOpts</span></a><span> </span><a href="#local-6989586621679414566"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="DynFlags.html#opt_l"><span class="hs-identifier hs-var">opt_l</span></a><span class="hs-special">)</span><span>
</span><a name="line-775"></a><span>      </span><a name="local-6989586621679414572"><a href="#local-6989586621679414572"><span class="hs-identifier">args2</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414570"><span class="hs-identifier hs-var">args0</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414571"><span class="hs-identifier hs-var">args1</span></a><span>
</span><a name="line-776"></a><span>      </span><a name="local-6989586621679414573"><a href="#local-6989586621679414573"><span class="hs-identifier">args3</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="Util.html#notNull"><span class="hs-identifier hs-var">notNull</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#showOpt"><span class="hs-identifier hs-var">showOpt</span></a><span> </span><a href="#local-6989586621679414572"><span class="hs-identifier hs-var">args2</span></a><span class="hs-special">)</span><span>
</span><a name="line-777"></a><span>
</span><a name="line-778"></a><span>      </span><span class="hs-comment">-- Try to grab the info from the process output.</span><span>
</span><a name="line-779"></a><span>      </span><a name="local-6989586621679414574"><a href="#local-6989586621679414574"><span class="hs-identifier">parseLinkerInfo</span></a></a><span> </span><a name="local-6989586621679414575"><a href="#local-6989586621679414575"><span class="hs-identifier">stdo</span></a></a><span> </span><a name="local-6989586621679414576"><a href="#local-6989586621679414576"><span class="hs-identifier">_stde</span></a></a><span> </span><a name="local-6989586621679414577"><a href="#local-6989586621679414577"><span class="hs-identifier">_exitc</span></a></a><span>
</span><a name="line-780"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;GNU ld&quot;</span><span> </span><span class="hs-special">`</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#isPrefixOf"><span class="hs-identifier hs-var">isPrefixOf</span></a><span class="hs-special">`</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414575"><span class="hs-identifier hs-var">stdo</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-781"></a><span>          </span><span class="hs-comment">-- GNU ld specifically needs to use less memory. This especially</span><span>
</span><a name="line-782"></a><span>          </span><span class="hs-comment">-- hurts on small object files. Trac #5240.</span><span>
</span><a name="line-783"></a><span>          </span><span class="hs-comment">-- Set DT_NEEDED for all shared libraries. Trac #10110.</span><span>
</span><a name="line-784"></a><span>          </span><span class="hs-comment">-- TODO: Investigate if these help or hurt when using split sections.</span><span>
</span><a name="line-785"></a><span>          </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#GnuLD"><span class="hs-identifier hs-var">GnuLD</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;-Wl,--hash-size=31&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-786"></a><span>                                      </span><span class="hs-string">&quot;-Wl,--reduce-memory-overheads&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-787"></a><span>                                      </span><span class="hs-comment">-- ELF specific flag</span><span>
</span><a name="line-788"></a><span>                                      </span><span class="hs-comment">-- see Note [ELF needed shared libs]</span><span>
</span><a name="line-789"></a><span>                                      </span><span class="hs-string">&quot;-Wl,--no-as-needed&quot;</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-790"></a><span>
</span><a name="line-791"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;GNU gold&quot;</span><span> </span><span class="hs-special">`</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#isPrefixOf"><span class="hs-identifier hs-var">isPrefixOf</span></a><span class="hs-special">`</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414575"><span class="hs-identifier hs-var">stdo</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-792"></a><span>          </span><span class="hs-comment">-- GNU gold only needs --no-as-needed. Trac #10110.</span><span>
</span><a name="line-793"></a><span>          </span><span class="hs-comment">-- ELF specific flag, see Note [ELF needed shared libs]</span><span>
</span><a name="line-794"></a><span>          </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#GnuGold"><span class="hs-identifier hs-var">GnuGold</span></a><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-string">&quot;-Wl,--no-as-needed&quot;</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-795"></a><span>
</span><a name="line-796"></a><span>         </span><span class="hs-comment">-- Unknown linker.</span><span>
</span><a name="line-797"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fail"><span class="hs-identifier hs-var">fail</span></a><span> </span><span class="hs-string">&quot;invalid --version output, or linker is unsupported&quot;</span><span>
</span><a name="line-798"></a><span>
</span><a name="line-799"></a><span>  </span><span class="hs-comment">-- Process the executable call</span><span>
</span><a name="line-800"></a><span>  </span><a name="local-6989586621679414582"><a href="#local-6989586621679414582"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Exception.html#catchIO"><span class="hs-identifier hs-var">catchIO</span></a><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span>
</span><a name="line-801"></a><span>             </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679414568"><span class="hs-identifier hs-var">os</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-802"></a><span>               </span><a href="Platform.html#OSSolaris2"><span class="hs-identifier hs-var">OSSolaris2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-803"></a><span>                 </span><span class="hs-comment">-- Solaris uses its own Solaris linker. Even all</span><span>
</span><a name="line-804"></a><span>                 </span><span class="hs-comment">-- GNU C are recommended to configure with Solaris</span><span>
</span><a name="line-805"></a><span>                 </span><span class="hs-comment">-- linker instead of using GNU binutils linker. Also</span><span>
</span><a name="line-806"></a><span>                 </span><span class="hs-comment">-- all GCC distributed with Solaris follows this rule</span><span>
</span><a name="line-807"></a><span>                 </span><span class="hs-comment">-- precisely so we assume here, the Solaris linker is</span><span>
</span><a name="line-808"></a><span>                 </span><span class="hs-comment">-- used.</span><span>
</span><a name="line-809"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="DynFlags.html#SolarisLD"><span class="hs-identifier hs-var">SolarisLD</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-810"></a><span>               </span><a href="Platform.html#OSAIX"><span class="hs-identifier hs-var">OSAIX</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-811"></a><span>                 </span><span class="hs-comment">-- IBM AIX uses its own non-binutils linker as well</span><span>
</span><a name="line-812"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="DynFlags.html#AixLD"><span class="hs-identifier hs-var">AixLD</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-813"></a><span>               </span><a href="Platform.html#OSDarwin"><span class="hs-identifier hs-var">OSDarwin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-814"></a><span>                 </span><span class="hs-comment">-- Darwin has neither GNU Gold or GNU LD, but a strange linker</span><span>
</span><a name="line-815"></a><span>                 </span><span class="hs-comment">-- that doesn't support --version. We can just assume that's</span><span>
</span><a name="line-816"></a><span>                 </span><span class="hs-comment">-- what we're using.</span><span>
</span><a name="line-817"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="DynFlags.html#DarwinLD"><span class="hs-identifier hs-var">DarwinLD</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-818"></a><span>               </span><a href="Platform.html#OSiOS"><span class="hs-identifier hs-var">OSiOS</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-819"></a><span>                 </span><span class="hs-comment">-- Ditto for iOS</span><span>
</span><a name="line-820"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="DynFlags.html#DarwinLD"><span class="hs-identifier hs-var">DarwinLD</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-821"></a><span>               </span><a href="Platform.html#OSMinGW32"><span class="hs-identifier hs-var">OSMinGW32</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-822"></a><span>                 </span><span class="hs-comment">-- GHC doesn't support anything but GNU ld on Windows anyway.</span><span>
</span><a name="line-823"></a><span>                 </span><span class="hs-comment">-- Process creation is also fairly expensive on win32, so</span><span>
</span><a name="line-824"></a><span>                 </span><span class="hs-comment">-- we short-circuit here.</span><span>
</span><a name="line-825"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="DynFlags.html#GnuLD"><span class="hs-identifier hs-var">GnuLD</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span>
</span><a name="line-826"></a><span>                   </span><span class="hs-special">[</span><span> </span><span class="hs-comment">-- Reduce ld memory usage</span><span>
</span><a name="line-827"></a><span>                     </span><span class="hs-string">&quot;-Wl,--hash-size=31&quot;</span><span>
</span><a name="line-828"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;-Wl,--reduce-memory-overheads&quot;</span><span>
</span><a name="line-829"></a><span>                     </span><span class="hs-comment">-- Emit gcc stack checks</span><span>
</span><a name="line-830"></a><span>                     </span><span class="hs-comment">-- Note [Windows stack usage]</span><span>
</span><a name="line-831"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;-fstack-check&quot;</span><span>
</span><a name="line-832"></a><span>                     </span><span class="hs-comment">-- Force static linking of libGCC</span><span>
</span><a name="line-833"></a><span>                     </span><span class="hs-comment">-- Note [Windows static libGCC]</span><span>
</span><a name="line-834"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;-static-libgcc&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-835"></a><span>               </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-836"></a><span>                 </span><span class="hs-comment">-- In practice, we use the compiler as the linker here. Pass</span><span>
</span><a name="line-837"></a><span>                 </span><span class="hs-comment">-- -Wl,--version to get linker version info.</span><span>
</span><a name="line-838"></a><span>                 </span><span class="hs-special">(</span><a name="local-6989586621679414578"><a href="#local-6989586621679414578"><span class="hs-identifier">exitc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414579"><a href="#local-6989586621679414579"><span class="hs-identifier">stdo</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414580"><a href="#local-6989586621679414580"><span class="hs-identifier">stde</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#readProcessEnvWithExitCode"><span class="hs-identifier hs-var">readProcessEnvWithExitCode</span></a><span> </span><a href="#local-6989586621679414569"><span class="hs-identifier hs-var">pgm</span></a><span>
</span><a name="line-839"></a><span>                                        </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-string">&quot;-Wl,--version&quot;</span><span class="hs-special">]</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414573"><span class="hs-identifier hs-var">args3</span></a><span class="hs-special">)</span><span>
</span><a name="line-840"></a><span>                                        </span><a href="SysTools.html#c_locale_env"><span class="hs-identifier hs-var">c_locale_env</span></a><span>
</span><a name="line-841"></a><span>                 </span><span class="hs-comment">-- Split the output by lines to make certain kinds</span><span>
</span><a name="line-842"></a><span>                 </span><span class="hs-comment">-- of processing easier. In particular, 'clang' and 'gcc'</span><span>
</span><a name="line-843"></a><span>                 </span><span class="hs-comment">-- have slightly different outputs for '-Wl,--version', but</span><span>
</span><a name="line-844"></a><span>                 </span><span class="hs-comment">-- it's still easy to figure out.</span><span>
</span><a name="line-845"></a><span>                 </span><a href="#local-6989586621679414574"><span class="hs-identifier hs-var">parseLinkerInfo</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#lines"><span class="hs-identifier hs-var">lines</span></a><span> </span><a href="#local-6989586621679414579"><span class="hs-identifier hs-var">stdo</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#lines"><span class="hs-identifier hs-var">lines</span></a><span> </span><a href="#local-6989586621679414580"><span class="hs-identifier hs-var">stde</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414578"><span class="hs-identifier hs-var">exitc</span></a><span>
</span><a name="line-846"></a><span>            </span><span class="hs-special">)</span><span>
</span><a name="line-847"></a><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679414581"><a href="#local-6989586621679414581"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-848"></a><span>                </span><a href="ErrUtils.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a><span> </span><a href="#local-6989586621679414566"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">2</span><span>
</span><a name="line-849"></a><span>                    </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Error (figuring out linker information):&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-850"></a><span>                     </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679414581"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-851"></a><span>                </span><a href="ErrUtils.html#errorMsg"><span class="hs-identifier hs-var">errorMsg</span></a><span> </span><a href="#local-6989586621679414566"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Warning:&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">9</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-852"></a><span>                  </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Couldn't figure out linker information!&quot;</span><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span>
</span><a name="line-853"></a><span>                  </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Make sure you're using GNU ld, GNU gold&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-854"></a><span>                  </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;or the built in OS X linker, etc.&quot;</span><span>
</span><a name="line-855"></a><span>                </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="DynFlags.html#UnknownLD"><span class="hs-identifier hs-var">UnknownLD</span></a><span class="hs-special">)</span><span>
</span><a name="line-856"></a><span>  </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679414582"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-857"></a><span>
</span><a name="line-858"></a><span class="hs-comment">-- Grab compiler info and cache it in DynFlags.</span><span>
</span><a name="line-859"></a><span class="hs-identifier">getCompilerInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="DynFlags.html#CompilerInfo"><span class="hs-identifier hs-type">CompilerInfo</span></a><span>
</span><a name="line-860"></a><a name="getCompilerInfo"><a href="SysTools.html#getCompilerInfo"><span class="hs-identifier">getCompilerInfo</span></a></a><span> </span><a name="local-6989586621679414583"><a href="#local-6989586621679414583"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-861"></a><span>  </span><a name="local-6989586621679414584"><a href="#local-6989586621679414584"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">rtccInfo</span><span> </span><a href="#local-6989586621679414583"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-862"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679414584"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-863"></a><span>    </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679414585"><a href="#local-6989586621679414585"><span class="hs-identifier">v</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679414585"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-864"></a><span>    </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-865"></a><span>      </span><a name="local-6989586621679414586"><a href="#local-6989586621679414586"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#getCompilerInfo%27"><span class="hs-identifier hs-var">getCompilerInfo'</span></a><span> </span><a href="#local-6989586621679414583"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-866"></a><span>      </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#writeIORef"><span class="hs-identifier hs-var">writeIORef</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">rtccInfo</span><span> </span><a href="#local-6989586621679414583"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679414586"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-867"></a><span>      </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679414586"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-868"></a><span>
</span><a name="line-869"></a><span class="hs-comment">-- See Note [Run-time linker info].</span><span>
</span><a name="line-870"></a><span class="hs-identifier">getCompilerInfo'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="DynFlags.html#CompilerInfo"><span class="hs-identifier hs-type">CompilerInfo</span></a><span>
</span><a name="line-871"></a><a name="getCompilerInfo%27"><a href="SysTools.html#getCompilerInfo%27"><span class="hs-identifier">getCompilerInfo'</span></a></a><span> </span><a name="local-6989586621679414587"><a href="#local-6989586621679414587"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-872"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679414588"><a href="#local-6989586621679414588"><span class="hs-identifier">pgm</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#pgm_c"><span class="hs-identifier hs-var">pgm_c</span></a><span> </span><a href="#local-6989586621679414587"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-873"></a><span>      </span><span class="hs-comment">-- Try to grab the info from the process output.</span><span>
</span><a name="line-874"></a><span>      </span><a name="local-6989586621679414589"><a href="#local-6989586621679414589"><span class="hs-identifier">parseCompilerInfo</span></a></a><span> </span><a name="local-6989586621679414590"><a href="#local-6989586621679414590"><span class="hs-identifier">_stdo</span></a></a><span> </span><a name="local-6989586621679414591"><a href="#local-6989586621679414591"><span class="hs-identifier">stde</span></a></a><span> </span><a name="local-6989586621679414592"><a href="#local-6989586621679414592"><span class="hs-identifier">_exitc</span></a></a><span>
</span><a name="line-875"></a><span>        </span><span class="hs-comment">-- Regular GCC</span><span>
</span><a name="line-876"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;gcc version&quot;</span><span> </span><span class="hs-special">`</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#isInfixOf"><span class="hs-identifier hs-var">isInfixOf</span></a><span class="hs-special">`</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414591"><span class="hs-identifier hs-var">stde</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-877"></a><span>          </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="DynFlags.html#GCC"><span class="hs-identifier hs-var">GCC</span></a><span>
</span><a name="line-878"></a><span>        </span><span class="hs-comment">-- Regular clang</span><span>
</span><a name="line-879"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;clang version&quot;</span><span> </span><span class="hs-special">`</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#isInfixOf"><span class="hs-identifier hs-var">isInfixOf</span></a><span class="hs-special">`</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414591"><span class="hs-identifier hs-var">stde</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-880"></a><span>          </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="DynFlags.html#Clang"><span class="hs-identifier hs-var">Clang</span></a><span>
</span><a name="line-881"></a><span>        </span><span class="hs-comment">-- XCode 5.1 clang</span><span>
</span><a name="line-882"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Apple LLVM version 5.1&quot;</span><span> </span><span class="hs-special">`</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#isPrefixOf"><span class="hs-identifier hs-var">isPrefixOf</span></a><span class="hs-special">`</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414591"><span class="hs-identifier hs-var">stde</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-883"></a><span>          </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="DynFlags.html#AppleClang51"><span class="hs-identifier hs-var">AppleClang51</span></a><span>
</span><a name="line-884"></a><span>        </span><span class="hs-comment">-- XCode 5 clang</span><span>
</span><a name="line-885"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Apple LLVM version&quot;</span><span> </span><span class="hs-special">`</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#isPrefixOf"><span class="hs-identifier hs-var">isPrefixOf</span></a><span class="hs-special">`</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414591"><span class="hs-identifier hs-var">stde</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-886"></a><span>          </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="DynFlags.html#AppleClang"><span class="hs-identifier hs-var">AppleClang</span></a><span>
</span><a name="line-887"></a><span>        </span><span class="hs-comment">-- XCode 4.1 clang</span><span>
</span><a name="line-888"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Apple clang version&quot;</span><span> </span><span class="hs-special">`</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#isPrefixOf"><span class="hs-identifier hs-var">isPrefixOf</span></a><span class="hs-special">`</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414591"><span class="hs-identifier hs-var">stde</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-889"></a><span>          </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="DynFlags.html#AppleClang"><span class="hs-identifier hs-var">AppleClang</span></a><span>
</span><a name="line-890"></a><span>         </span><span class="hs-comment">-- Unknown linker.</span><span>
</span><a name="line-891"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fail"><span class="hs-identifier hs-var">fail</span></a><span> </span><span class="hs-string">&quot;invalid -v output, or compiler is unsupported&quot;</span><span>
</span><a name="line-892"></a><span>
</span><a name="line-893"></a><span>  </span><span class="hs-comment">-- Process the executable call</span><span>
</span><a name="line-894"></a><span>  </span><a name="local-6989586621679414597"><a href="#local-6989586621679414597"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Exception.html#catchIO"><span class="hs-identifier hs-var">catchIO</span></a><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span>
</span><a name="line-895"></a><span>                </span><span class="hs-special">(</span><a name="local-6989586621679414593"><a href="#local-6989586621679414593"><span class="hs-identifier">exitc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414594"><a href="#local-6989586621679414594"><span class="hs-identifier">stdo</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414595"><a href="#local-6989586621679414595"><span class="hs-identifier">stde</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-896"></a><span>                    </span><a href="SysTools.html#readProcessEnvWithExitCode"><span class="hs-identifier hs-var">readProcessEnvWithExitCode</span></a><span> </span><a href="#local-6989586621679414588"><span class="hs-identifier hs-var">pgm</span></a><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;-v&quot;</span><span class="hs-special">]</span><span> </span><a href="SysTools.html#c_locale_env"><span class="hs-identifier hs-var">c_locale_env</span></a><span>
</span><a name="line-897"></a><span>                </span><span class="hs-comment">-- Split the output by lines to make certain kinds</span><span>
</span><a name="line-898"></a><span>                </span><span class="hs-comment">-- of processing easier.</span><span>
</span><a name="line-899"></a><span>                </span><a href="#local-6989586621679414589"><span class="hs-identifier hs-var">parseCompilerInfo</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#lines"><span class="hs-identifier hs-var">lines</span></a><span> </span><a href="#local-6989586621679414594"><span class="hs-identifier hs-var">stdo</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#lines"><span class="hs-identifier hs-var">lines</span></a><span> </span><a href="#local-6989586621679414595"><span class="hs-identifier hs-var">stde</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414593"><span class="hs-identifier hs-var">exitc</span></a><span>
</span><a name="line-900"></a><span>            </span><span class="hs-special">)</span><span>
</span><a name="line-901"></a><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679414596"><a href="#local-6989586621679414596"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-902"></a><span>                </span><a href="ErrUtils.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a><span> </span><a href="#local-6989586621679414587"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">2</span><span>
</span><a name="line-903"></a><span>                    </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Error (figuring out C compiler information):&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-904"></a><span>                     </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679414596"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-905"></a><span>                </span><a href="ErrUtils.html#errorMsg"><span class="hs-identifier hs-var">errorMsg</span></a><span> </span><a href="#local-6989586621679414587"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Warning:&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">9</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-906"></a><span>                  </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Couldn't figure out C compiler information!&quot;</span><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span>
</span><a name="line-907"></a><span>                  </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Make sure you're using GNU gcc, or clang&quot;</span><span>
</span><a name="line-908"></a><span>                </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="DynFlags.html#UnknownCC"><span class="hs-identifier hs-var">UnknownCC</span></a><span class="hs-special">)</span><span>
</span><a name="line-909"></a><span>  </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679414597"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-910"></a><span>
</span><a name="line-911"></a><span class="hs-identifier">runLink</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-912"></a><a name="runLink"><a href="SysTools.html#runLink"><span class="hs-identifier">runLink</span></a></a><span> </span><a name="local-6989586621679414598"><a href="#local-6989586621679414598"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414599"><a href="#local-6989586621679414599"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-913"></a><span>  </span><span class="hs-comment">-- See Note [Run-time linker info]</span><span>
</span><a name="line-914"></a><span>  </span><a name="local-6989586621679414612"><a href="#local-6989586621679414612"><span class="hs-identifier">linkargs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#neededLinkArgs"><span class="hs-identifier hs-var">neededLinkArgs</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span class="hs-special">`</span><span> </span><a href="SysTools.html#getLinkerInfo"><span class="hs-identifier hs-var">getLinkerInfo</span></a><span> </span><a href="#local-6989586621679414598"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-915"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679414613"><a href="#local-6989586621679414613"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><a name="local-6989586621679414614"><a href="#local-6989586621679414614"><span class="hs-identifier">args0</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#pgm_l"><span class="hs-identifier hs-var">pgm_l</span></a><span> </span><a href="#local-6989586621679414598"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-916"></a><span>      </span><a name="local-6989586621679414615"><a href="#local-6989586621679414615"><span class="hs-identifier">args1</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#getOpts"><span class="hs-identifier hs-var">getOpts</span></a><span> </span><a href="#local-6989586621679414598"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="DynFlags.html#opt_l"><span class="hs-identifier hs-var">opt_l</span></a><span class="hs-special">)</span><span>
</span><a name="line-917"></a><span>      </span><a name="local-6989586621679414616"><a href="#local-6989586621679414616"><span class="hs-identifier">args2</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414614"><span class="hs-identifier hs-var">args0</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414612"><span class="hs-identifier hs-var">linkargs</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414615"><span class="hs-identifier hs-var">args1</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414599"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-918"></a><span>  </span><a name="local-6989586621679414617"><a href="#local-6989586621679414617"><span class="hs-identifier">mb_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#getGccEnv"><span class="hs-identifier hs-var">getGccEnv</span></a><span> </span><a href="#local-6989586621679414616"><span class="hs-identifier hs-var">args2</span></a><span>
</span><a name="line-919"></a><span>  </span><a href="SysTools.html#runSomethingResponseFile"><span class="hs-identifier hs-var">runSomethingResponseFile</span></a><span> </span><a href="#local-6989586621679414598"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679414600"><span class="hs-identifier hs-var">ld_filter</span></a><span> </span><span class="hs-string">&quot;Linker&quot;</span><span> </span><a href="#local-6989586621679414613"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679414616"><span class="hs-identifier hs-var">args2</span></a><span> </span><a href="#local-6989586621679414617"><span class="hs-identifier hs-var">mb_env</span></a><span>
</span><a name="line-920"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-921"></a><span>    </span><a name="local-6989586621679414600"><a href="#local-6989586621679414600"><span class="hs-identifier">ld_filter</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">platformOS</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a><span> </span><a href="#local-6989586621679414598"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-922"></a><span>                  </span><a href="Platform.html#OSSolaris2"><span class="hs-identifier hs-var">OSSolaris2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679414601"><span class="hs-identifier hs-var">sunos_ld_filter</span></a><span>
</span><a name="line-923"></a><span>                  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-924"></a><span class="hs-comment">{-
  SunOS/Solaris ld emits harmless warning messages about unresolved
  symbols in case of compiling into shared library when we do not
  link against all the required libs. That is the case of GHC which
  does not link against RTS library explicitly in order to be able to
  choose the library later based on binary application linking
  parameters. The warnings look like:

Undefined                       first referenced
 symbol                             in file
stg_ap_n_fast                       ./T2386_Lib.o
stg_upd_frame_info                  ./T2386_Lib.o
templatezmhaskell_LanguageziHaskellziTHziLib_litE_closure ./T2386_Lib.o
templatezmhaskell_LanguageziHaskellziTHziLib_appE_closure ./T2386_Lib.o
templatezmhaskell_LanguageziHaskellziTHziLib_conE_closure ./T2386_Lib.o
templatezmhaskell_LanguageziHaskellziTHziSyntax_mkNameGzud_closure ./T2386_Lib.o
newCAF                              ./T2386_Lib.o
stg_bh_upd_frame_info               ./T2386_Lib.o
stg_ap_ppp_fast                     ./T2386_Lib.o
templatezmhaskell_LanguageziHaskellziTHziLib_stringL_closure ./T2386_Lib.o
stg_ap_p_fast                       ./T2386_Lib.o
stg_ap_pp_fast                      ./T2386_Lib.o
ld: warning: symbol referencing errors

  this is actually coming from T2386 testcase. The emitting of those
  warnings is also a reason why so many TH testcases fail on Solaris.

  Following filter code is SunOS/Solaris linker specific and should
  filter out only linker warnings. Please note that the logic is a
  little bit more complex due to the simple reason that we need to preserve
  any other linker emitted messages. If there are any. Simply speaking
  if we see &quot;Undefined&quot; and later &quot;ld: warning:...&quot; then we omit all
  text between (including) the marks. Otherwise we copy the whole output.
-}</span><span>
</span><a name="line-958"></a><span>    </span><span class="hs-identifier">sunos_ld_filter</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span>
</span><a name="line-959"></a><span>    </span><a name="local-6989586621679414601"><a href="#local-6989586621679414601"><span class="hs-identifier">sunos_ld_filter</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#unlines"><span class="hs-identifier hs-var">unlines</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-6989586621679414602"><span class="hs-identifier hs-var">sunos_ld_filter'</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#lines"><span class="hs-identifier hs-var">lines</span></a><span>
</span><a name="line-960"></a><span>    </span><a name="local-6989586621679414602"><a href="#local-6989586621679414602"><span class="hs-identifier">sunos_ld_filter'</span></a></a><span> </span><a name="local-6989586621679414609"><a href="#local-6989586621679414609"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414605"><span class="hs-identifier hs-var">undefined_found</span></a><span> </span><a href="#local-6989586621679414609"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679414608"><span class="hs-identifier hs-var">ld_warning_found</span></a><span> </span><a href="#local-6989586621679414609"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-961"></a><span>                         </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414604"><span class="hs-identifier hs-var">ld_prefix</span></a><span> </span><a href="#local-6989586621679414609"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414607"><span class="hs-identifier hs-var">ld_postfix</span></a><span> </span><a href="#local-6989586621679414609"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-962"></a><span>                         </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679414609"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-963"></a><span>    </span><a name="local-6989586621679414603"><a href="#local-6989586621679414603"><span class="hs-identifier">breakStartsWith</span></a></a><span> </span><a name="local-6989586621679414610"><a href="#local-6989586621679414610"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679414611"><a href="#local-6989586621679414611"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#break"><span class="hs-identifier hs-var">break</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#isPrefixOf"><span class="hs-identifier hs-var">isPrefixOf</span></a><span> </span><a href="#local-6989586621679414610"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414611"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-964"></a><span>    </span><a name="local-6989586621679414604"><a href="#local-6989586621679414604"><span class="hs-identifier">ld_prefix</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-6989586621679414603"><span class="hs-identifier hs-var">breakStartsWith</span></a><span> </span><span class="hs-string">&quot;Undefined&quot;</span><span>
</span><a name="line-965"></a><span>    </span><a name="local-6989586621679414605"><a href="#local-6989586621679414605"><span class="hs-identifier">undefined_found</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-6989586621679414603"><span class="hs-identifier hs-var">breakStartsWith</span></a><span> </span><span class="hs-string">&quot;Undefined&quot;</span><span>
</span><a name="line-966"></a><span>    </span><a name="local-6989586621679414606"><a href="#local-6989586621679414606"><span class="hs-identifier">ld_warn_break</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414603"><span class="hs-identifier hs-var">breakStartsWith</span></a><span> </span><span class="hs-string">&quot;ld: warning: symbol referencing errors&quot;</span><span>
</span><a name="line-967"></a><span>    </span><a name="local-6989586621679414607"><a href="#local-6989586621679414607"><span class="hs-identifier">ld_postfix</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#tail"><span class="hs-identifier hs-var">tail</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-6989586621679414606"><span class="hs-identifier hs-var">ld_warn_break</span></a><span>
</span><a name="line-968"></a><span>    </span><a name="local-6989586621679414608"><a href="#local-6989586621679414608"><span class="hs-identifier">ld_warning_found</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-6989586621679414606"><span class="hs-identifier hs-var">ld_warn_break</span></a><span>
</span><a name="line-969"></a><span>
</span><a name="line-970"></a><span>
</span><a name="line-971"></a><span class="hs-identifier">runLibtool</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-972"></a><a name="runLibtool"><a href="SysTools.html#runLibtool"><span class="hs-identifier">runLibtool</span></a></a><span> </span><a name="local-6989586621679414618"><a href="#local-6989586621679414618"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414619"><a href="#local-6989586621679414619"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-973"></a><span>  </span><a name="local-6989586621679414620"><a href="#local-6989586621679414620"><span class="hs-identifier">linkargs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#neededLinkArgs"><span class="hs-identifier hs-var">neededLinkArgs</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span class="hs-special">`</span><span> </span><a href="SysTools.html#getLinkerInfo"><span class="hs-identifier hs-var">getLinkerInfo</span></a><span> </span><a href="#local-6989586621679414618"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-974"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414621"><a href="#local-6989586621679414621"><span class="hs-identifier">args1</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#getOpts"><span class="hs-identifier hs-var">getOpts</span></a><span> </span><a href="#local-6989586621679414618"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="DynFlags.html#opt_l"><span class="hs-identifier hs-var">opt_l</span></a><span class="hs-special">)</span><span>
</span><a name="line-975"></a><span>      </span><a name="local-6989586621679414622"><a href="#local-6989586621679414622"><span class="hs-identifier">args2</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-string">&quot;-static&quot;</span><span class="hs-special">]</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414621"><span class="hs-identifier hs-var">args1</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414619"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414620"><span class="hs-identifier hs-var">linkargs</span></a><span>
</span><a name="line-976"></a><span>      </span><a name="local-6989586621679414623"><a href="#local-6989586621679414623"><span class="hs-identifier">libtool</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#pgm_libtool"><span class="hs-identifier hs-var">pgm_libtool</span></a><span> </span><a href="#local-6989586621679414618"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-977"></a><span>  </span><a name="local-6989586621679414624"><a href="#local-6989586621679414624"><span class="hs-identifier">mb_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#getGccEnv"><span class="hs-identifier hs-var">getGccEnv</span></a><span> </span><a href="#local-6989586621679414622"><span class="hs-identifier hs-var">args2</span></a><span>
</span><a name="line-978"></a><span>  </span><a href="SysTools.html#runSomethingFiltered"><span class="hs-identifier hs-var">runSomethingFiltered</span></a><span> </span><a href="#local-6989586621679414618"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-string">&quot;Linker&quot;</span><span> </span><a href="#local-6989586621679414623"><span class="hs-identifier hs-var">libtool</span></a><span> </span><a href="#local-6989586621679414622"><span class="hs-identifier hs-var">args2</span></a><span> </span><a href="#local-6989586621679414624"><span class="hs-identifier hs-var">mb_env</span></a><span>
</span><a name="line-979"></a><span>
</span><a name="line-980"></a><span class="hs-identifier">runMkDLL</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-981"></a><a name="runMkDLL"><a href="SysTools.html#runMkDLL"><span class="hs-identifier">runMkDLL</span></a></a><span> </span><a name="local-6989586621679414625"><a href="#local-6989586621679414625"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414626"><a href="#local-6989586621679414626"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-982"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679414627"><a href="#local-6989586621679414627"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><a name="local-6989586621679414628"><a href="#local-6989586621679414628"><span class="hs-identifier">args0</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#pgm_dll"><span class="hs-identifier hs-var">pgm_dll</span></a><span> </span><a href="#local-6989586621679414625"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-983"></a><span>      </span><a name="local-6989586621679414629"><a href="#local-6989586621679414629"><span class="hs-identifier">args1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414628"><span class="hs-identifier hs-var">args0</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414626"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-984"></a><span>  </span><a name="local-6989586621679414630"><a href="#local-6989586621679414630"><span class="hs-identifier">mb_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#getGccEnv"><span class="hs-identifier hs-var">getGccEnv</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414628"><span class="hs-identifier hs-var">args0</span></a><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><a href="#local-6989586621679414626"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-985"></a><span>  </span><a href="SysTools.html#runSomethingFiltered"><span class="hs-identifier hs-var">runSomethingFiltered</span></a><span> </span><a href="#local-6989586621679414625"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-string">&quot;Make DLL&quot;</span><span> </span><a href="#local-6989586621679414627"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679414629"><span class="hs-identifier hs-var">args1</span></a><span> </span><a href="#local-6989586621679414630"><span class="hs-identifier hs-var">mb_env</span></a><span>
</span><a name="line-986"></a><span>
</span><a name="line-987"></a><span class="hs-identifier">runWindres</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-988"></a><a name="runWindres"><a href="SysTools.html#runWindres"><span class="hs-identifier">runWindres</span></a></a><span> </span><a name="local-6989586621679414631"><a href="#local-6989586621679414631"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414632"><a href="#local-6989586621679414632"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-989"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679414633"><a href="#local-6989586621679414633"><span class="hs-identifier">gcc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414634"><a href="#local-6989586621679414634"><span class="hs-identifier">gcc_args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#pgm_c"><span class="hs-identifier hs-var">pgm_c</span></a><span> </span><a href="#local-6989586621679414631"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-990"></a><span>      </span><a name="local-6989586621679414635"><a href="#local-6989586621679414635"><span class="hs-identifier">windres</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#pgm_windres"><span class="hs-identifier hs-var">pgm_windres</span></a><span> </span><a href="#local-6989586621679414631"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-991"></a><span>      </span><a name="local-6989586621679414636"><a href="#local-6989586621679414636"><span class="hs-identifier">opts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#getOpts"><span class="hs-identifier hs-var">getOpts</span></a><span> </span><a href="#local-6989586621679414631"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="DynFlags.html#opt_windres"><span class="hs-identifier hs-var">opt_windres</span></a><span class="hs-special">)</span><span>
</span><a name="line-992"></a><span>      </span><a name="local-6989586621679414637"><a href="#local-6989586621679414637"><span class="hs-identifier">quote</span></a></a><span> </span><a name="local-6989586621679414639"><a href="#local-6989586621679414639"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;\&quot;&quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414639"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot;\&quot;&quot;</span><span>
</span><a name="line-993"></a><span>      </span><a name="local-6989586621679414638"><a href="#local-6989586621679414638"><span class="hs-identifier">args'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- If windres.exe and gcc.exe are in a directory containing</span><span>
</span><a name="line-994"></a><span>              </span><span class="hs-comment">-- spaces then windres fails to run gcc. We therefore need</span><span>
</span><a name="line-995"></a><span>              </span><span class="hs-comment">-- to tell it what command to use...</span><span>
</span><a name="line-996"></a><span>              </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;--preprocessor=&quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span>
</span><a name="line-997"></a><span>                      </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#unwords"><span class="hs-identifier hs-var">unwords</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-6989586621679414637"><span class="hs-identifier hs-var">quote</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414633"><span class="hs-identifier hs-var">gcc</span></a><span> </span><span class="hs-glyph">:</span><span>
</span><a name="line-998"></a><span>                                          </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#showOpt"><span class="hs-identifier hs-var">showOpt</span></a><span> </span><a href="#local-6989586621679414634"><span class="hs-identifier hs-var">gcc_args</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span>
</span><a name="line-999"></a><span>                                          </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#showOpt"><span class="hs-identifier hs-var">showOpt</span></a><span> </span><a href="#local-6989586621679414636"><span class="hs-identifier hs-var">opts</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span>
</span><a name="line-1000"></a><span>                                          </span><span class="hs-special">[</span><span class="hs-string">&quot;-E&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;-xc&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;-DRC_INVOKED&quot;</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1001"></a><span>              </span><span class="hs-comment">-- ...but if we do that then if windres calls popen then</span><span>
</span><a name="line-1002"></a><span>              </span><span class="hs-comment">-- it can't understand the quoting, so we have to use</span><span>
</span><a name="line-1003"></a><span>              </span><span class="hs-comment">-- --use-temp-file so that it interprets it correctly.</span><span>
</span><a name="line-1004"></a><span>              </span><span class="hs-comment">-- See #1828.</span><span>
</span><a name="line-1005"></a><span>            </span><span class="hs-glyph">:</span><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-string">&quot;--use-temp-file&quot;</span><span>
</span><a name="line-1006"></a><span>            </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679414632"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1007"></a><span>  </span><a name="local-6989586621679414640"><a href="#local-6989586621679414640"><span class="hs-identifier">mb_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#getGccEnv"><span class="hs-identifier hs-var">getGccEnv</span></a><span> </span><a href="#local-6989586621679414634"><span class="hs-identifier hs-var">gcc_args</span></a><span>
</span><a name="line-1008"></a><span>  </span><a href="SysTools.html#runSomethingFiltered"><span class="hs-identifier hs-var">runSomethingFiltered</span></a><span> </span><a href="#local-6989586621679414631"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-string">&quot;Windres&quot;</span><span> </span><a href="#local-6989586621679414635"><span class="hs-identifier hs-var">windres</span></a><span> </span><a href="#local-6989586621679414638"><span class="hs-identifier hs-var">args'</span></a><span> </span><a href="#local-6989586621679414640"><span class="hs-identifier hs-var">mb_env</span></a><span>
</span><a name="line-1009"></a><span>
</span><a name="line-1010"></a><span class="hs-identifier">touch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1011"></a><a name="touch"><a href="SysTools.html#touch"><span class="hs-identifier">touch</span></a></a><span> </span><a name="local-6989586621679414641"><a href="#local-6989586621679414641"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414642"><a href="#local-6989586621679414642"><span class="hs-identifier">purpose</span></a></a><span> </span><a name="local-6989586621679414643"><a href="#local-6989586621679414643"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1012"></a><span>  </span><a href="SysTools.html#runSomething"><span class="hs-identifier hs-var">runSomething</span></a><span> </span><a href="#local-6989586621679414641"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679414642"><span class="hs-identifier hs-var">purpose</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#pgm_T"><span class="hs-identifier hs-var">pgm_T</span></a><span> </span><a href="#local-6989586621679414641"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#FileOption"><span class="hs-identifier hs-var">FileOption</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><a href="#local-6989586621679414643"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">]</span><span>
</span><a name="line-1013"></a><span>
</span><a name="line-1014"></a><span class="hs-identifier">copy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1015"></a><a name="copy"><a href="SysTools.html#copy"><span class="hs-identifier">copy</span></a></a><span> </span><a name="local-6989586621679414644"><a href="#local-6989586621679414644"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414645"><a href="#local-6989586621679414645"><span class="hs-identifier">purpose</span></a></a><span> </span><a name="local-6989586621679414646"><a href="#local-6989586621679414646"><span class="hs-identifier">from</span></a></a><span> </span><a name="local-6989586621679414647"><a href="#local-6989586621679414647"><span class="hs-identifier">to</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SysTools.html#copyWithHeader"><span class="hs-identifier hs-var">copyWithHeader</span></a><span> </span><a href="#local-6989586621679414644"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679414645"><span class="hs-identifier hs-var">purpose</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-6989586621679414646"><span class="hs-identifier hs-var">from</span></a><span> </span><a href="#local-6989586621679414647"><span class="hs-identifier hs-var">to</span></a><span>
</span><a name="line-1016"></a><span>
</span><a name="line-1017"></a><span class="hs-identifier">copyWithHeader</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span>
</span><a name="line-1018"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1019"></a><a name="copyWithHeader"><a href="SysTools.html#copyWithHeader"><span class="hs-identifier">copyWithHeader</span></a></a><span> </span><a name="local-6989586621679414648"><a href="#local-6989586621679414648"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414649"><a href="#local-6989586621679414649"><span class="hs-identifier">purpose</span></a></a><span> </span><a name="local-6989586621679414650"><a href="#local-6989586621679414650"><span class="hs-identifier">maybe_header</span></a></a><span> </span><a name="local-6989586621679414651"><a href="#local-6989586621679414651"><span class="hs-identifier">from</span></a></a><span> </span><a name="local-6989586621679414652"><a href="#local-6989586621679414652"><span class="hs-identifier">to</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1020"></a><span>  </span><a href="ErrUtils.html#showPass"><span class="hs-identifier hs-var">showPass</span></a><span> </span><a href="#local-6989586621679414648"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679414649"><span class="hs-identifier hs-var">purpose</span></a><span>
</span><a name="line-1021"></a><span>
</span><a name="line-1022"></a><span>  </span><a name="local-6989586621679414656"><a href="#local-6989586621679414656"><span class="hs-identifier">hout</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.FD.html#openBinaryFile"><span class="hs-identifier hs-var">openBinaryFile</span></a><span> </span><a href="#local-6989586621679414652"><span class="hs-identifier hs-var">to</span></a><span>   </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.IOMode.html#WriteMode"><span class="hs-identifier hs-var">WriteMode</span></a><span>
</span><a name="line-1023"></a><span>  </span><a name="local-6989586621679414657"><a href="#local-6989586621679414657"><span class="hs-identifier">hin</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.FD.html#openBinaryFile"><span class="hs-identifier hs-var">openBinaryFile</span></a><span> </span><a href="#local-6989586621679414651"><span class="hs-identifier hs-var">from</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.IOMode.html#ReadMode"><span class="hs-identifier hs-var">ReadMode</span></a><span>
</span><a name="line-1024"></a><span>  </span><a name="local-6989586621679414658"><a href="#local-6989586621679414658"><span class="hs-identifier">ls</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.Text.html#hGetContents"><span class="hs-identifier hs-var">hGetContents</span></a><span> </span><a href="#local-6989586621679414657"><span class="hs-identifier hs-var">hin</span></a><span> </span><span class="hs-comment">-- inefficient, but it'll do for now. ToDo: speed up</span><span>
</span><a name="line-1025"></a><span>  </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414653"><span class="hs-identifier hs-var">header</span></a><span> </span><a href="#local-6989586621679414656"><span class="hs-identifier hs-var">hout</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414650"><span class="hs-identifier hs-var">maybe_header</span></a><span>
</span><a name="line-1026"></a><span>  </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.Text.html#hPutStr"><span class="hs-identifier hs-var">hPutStr</span></a><span> </span><a href="#local-6989586621679414656"><span class="hs-identifier hs-var">hout</span></a><span> </span><a href="#local-6989586621679414658"><span class="hs-identifier hs-var">ls</span></a><span>
</span><a name="line-1027"></a><span>  </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.html#hClose"><span class="hs-identifier hs-var">hClose</span></a><span> </span><a href="#local-6989586621679414656"><span class="hs-identifier hs-var">hout</span></a><span>
</span><a name="line-1028"></a><span>  </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.html#hClose"><span class="hs-identifier hs-var">hClose</span></a><span> </span><a href="#local-6989586621679414657"><span class="hs-identifier hs-var">hin</span></a><span>
</span><a name="line-1029"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1030"></a><span>  </span><span class="hs-comment">-- write the header string in UTF-8.  The header is something like</span><span>
</span><a name="line-1031"></a><span>  </span><span class="hs-comment">--   {-# LINE &quot;foo.hs&quot; #-}</span><span>
</span><a name="line-1032"></a><span>  </span><span class="hs-comment">-- and we want to make sure a Unicode filename isn't mangled.</span><span>
</span><a name="line-1033"></a><span>  </span><a name="local-6989586621679414653"><a href="#local-6989586621679414653"><span class="hs-identifier">header</span></a></a><span> </span><a name="local-6989586621679414654"><a href="#local-6989586621679414654"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679414655"><a href="#local-6989586621679414655"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1034"></a><span>   </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.html#hSetEncoding"><span class="hs-identifier hs-var">hSetEncoding</span></a><span> </span><a href="#local-6989586621679414654"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Encoding.html#utf8"><span class="hs-identifier hs-var">utf8</span></a><span>
</span><a name="line-1035"></a><span>   </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.Text.html#hPutStr"><span class="hs-identifier hs-var">hPutStr</span></a><span> </span><a href="#local-6989586621679414654"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679414655"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-1036"></a><span>   </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.html#hSetBinaryMode"><span class="hs-identifier hs-var">hSetBinaryMode</span></a><span> </span><a href="#local-6989586621679414654"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1037"></a><span>
</span><a name="line-1038"></a><span>
</span><a name="line-1039"></a><span>
</span><a name="line-1040"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Managing temporary files
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1047"></a><span>
</span><a name="line-1048"></a><span class="hs-identifier">cleanTempDirs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1049"></a><a name="cleanTempDirs"><a href="SysTools.html#cleanTempDirs"><span class="hs-identifier">cleanTempDirs</span></a></a><span> </span><a name="local-6989586621679414659"><a href="#local-6989586621679414659"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-1050"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_KeepTmpFiles"><span class="hs-identifier hs-var">Opt_KeepTmpFiles</span></a><span> </span><a href="#local-6989586621679414659"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-1051"></a><span>   </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#mask_"><span class="hs-identifier hs-var">mask_</span></a><span>
</span><a name="line-1052"></a><span>   </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414660"><a href="#local-6989586621679414660"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">dirsToClean</span><span> </span><a href="#local-6989586621679414659"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1053"></a><span>        </span><a name="local-6989586621679414662"><a href="#local-6989586621679414662"><span class="hs-identifier">ds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a><span> </span><a href="#local-6989586621679414660"><span class="hs-identifier hs-var">ref</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679414661"><a href="#local-6989586621679414661"><span class="hs-identifier">ds</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679414661"><span class="hs-identifier hs-var">ds</span></a><span class="hs-special">)</span><span>
</span><a name="line-1054"></a><span>        </span><a href="SysTools.html#removeTmpDirs"><span class="hs-identifier hs-var">removeTmpDirs</span></a><span> </span><a href="#local-6989586621679414659"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">elems</span></a><span> </span><a href="#local-6989586621679414662"><span class="hs-identifier hs-var">ds</span></a><span class="hs-special">)</span><span>
</span><a name="line-1055"></a><span>
</span><a name="line-1056"></a><span class="hs-identifier">cleanTempFiles</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1057"></a><a name="cleanTempFiles"><a href="SysTools.html#cleanTempFiles"><span class="hs-identifier">cleanTempFiles</span></a></a><span> </span><a name="local-6989586621679414663"><a href="#local-6989586621679414663"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-1058"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_KeepTmpFiles"><span class="hs-identifier hs-var">Opt_KeepTmpFiles</span></a><span> </span><a href="#local-6989586621679414663"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-1059"></a><span>   </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#mask_"><span class="hs-identifier hs-var">mask_</span></a><span>
</span><a name="line-1060"></a><span>   </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414664"><a href="#local-6989586621679414664"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">filesToClean</span><span> </span><a href="#local-6989586621679414663"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1061"></a><span>        </span><a name="local-6989586621679414666"><a href="#local-6989586621679414666"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a><span> </span><a href="#local-6989586621679414664"><span class="hs-identifier hs-var">ref</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679414665"><a href="#local-6989586621679414665"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><a href="#local-6989586621679414665"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1062"></a><span>        </span><a href="SysTools.html#removeTmpFiles"><span class="hs-identifier hs-var">removeTmpFiles</span></a><span> </span><a href="#local-6989586621679414663"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679414666"><span class="hs-identifier hs-var">fs</span></a><span>
</span><a name="line-1063"></a><span>
</span><a name="line-1064"></a><span class="hs-identifier">cleanTempFilesExcept</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1065"></a><a name="cleanTempFilesExcept"><a href="SysTools.html#cleanTempFilesExcept"><span class="hs-identifier">cleanTempFilesExcept</span></a></a><span> </span><a name="local-6989586621679414667"><a href="#local-6989586621679414667"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414668"><a href="#local-6989586621679414668"><span class="hs-identifier">dont_delete</span></a></a><span>
</span><a name="line-1066"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_KeepTmpFiles"><span class="hs-identifier hs-var">Opt_KeepTmpFiles</span></a><span> </span><a href="#local-6989586621679414667"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-1067"></a><span>   </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#mask_"><span class="hs-identifier hs-var">mask_</span></a><span>
</span><a name="line-1068"></a><span>   </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414670"><a href="#local-6989586621679414670"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">filesToClean</span><span> </span><a href="#local-6989586621679414667"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1069"></a><span>        </span><a name="local-6989586621679414675"><a href="#local-6989586621679414675"><span class="hs-identifier">to_delete</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a><span> </span><a href="#local-6989586621679414670"><span class="hs-identifier hs-var">ref</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679414671"><a href="#local-6989586621679414671"><span class="hs-identifier">files</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1070"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414672"><a href="#local-6989586621679414672"><span class="hs-identifier">res</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679414673"><a href="#local-6989586621679414673"><span class="hs-identifier">_to_keep</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414674"><a href="#local-6989586621679414674"><span class="hs-identifier">_to_delete</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1071"></a><span>                    </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">member</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679414669"><span class="hs-identifier hs-var">dont_delete_set</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414671"><span class="hs-identifier hs-var">files</span></a><span>
</span><a name="line-1072"></a><span>            </span><span class="hs-keyword">in</span><span>  </span><a href="#local-6989586621679414672"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-1073"></a><span>        </span><a href="SysTools.html#removeTmpFiles"><span class="hs-identifier hs-var">removeTmpFiles</span></a><span> </span><a href="#local-6989586621679414667"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679414675"><span class="hs-identifier hs-var">to_delete</span></a><span>
</span><a name="line-1074"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679414669"><a href="#local-6989586621679414669"><span class="hs-identifier">dont_delete_set</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span></a><span> </span><a href="#local-6989586621679414668"><span class="hs-identifier hs-var">dont_delete</span></a><span>
</span><a name="line-1075"></a><span>
</span><a name="line-1076"></a><span>
</span><a name="line-1077"></a><span class="hs-comment">-- Return a unique numeric temp file suffix</span><span>
</span><a name="line-1078"></a><span class="hs-identifier">newTempSuffix</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-1079"></a><a name="newTempSuffix"><a href="SysTools.html#newTempSuffix"><span class="hs-identifier">newTempSuffix</span></a></a><span> </span><a name="local-6989586621679414676"><a href="#local-6989586621679414676"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">nextTempSuffix</span><span> </span><a href="#local-6989586621679414676"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679414677"><a href="#local-6989586621679414677"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414677"><span class="hs-identifier hs-var">n</span></a><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span class="hs-number">1</span><span class="hs-special">,</span><a href="#local-6989586621679414677"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-1080"></a><span>
</span><a name="line-1081"></a><span class="hs-comment">-- Find a temporary name that doesn't already exist.</span><span>
</span><a name="line-1082"></a><span class="hs-identifier">newTempName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Util.html#Suffix"><span class="hs-identifier hs-type">Suffix</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span>
</span><a name="line-1083"></a><a name="newTempName"><a href="SysTools.html#newTempName"><span class="hs-identifier">newTempName</span></a></a><span> </span><a name="local-6989586621679414678"><a href="#local-6989586621679414678"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414679"><a href="#local-6989586621679414679"><span class="hs-identifier">extn</span></a></a><span>
</span><a name="line-1084"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679414685"><a href="#local-6989586621679414685"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#getTempDir"><span class="hs-identifier hs-var">getTempDir</span></a><span> </span><a href="#local-6989586621679414678"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1085"></a><span>       </span><a href="#local-6989586621679414680"><span class="hs-identifier hs-var">findTempName</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414685"><span class="hs-identifier hs-var">d</span></a><span> </span><a href="../filepath-1.4.1.1/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a><span> </span><span class="hs-string">&quot;ghc_&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- See Note [Deterministic base name]</span><span>
</span><a name="line-1086"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1087"></a><span>    </span><span class="hs-identifier">findTempName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span>
</span><a name="line-1088"></a><span>    </span><a name="local-6989586621679414680"><a href="#local-6989586621679414680"><span class="hs-identifier">findTempName</span></a></a><span> </span><a name="local-6989586621679414681"><a href="#local-6989586621679414681"><span class="hs-identifier">prefix</span></a></a><span>
</span><a name="line-1089"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679414682"><a href="#local-6989586621679414682"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#newTempSuffix"><span class="hs-identifier hs-var">newTempSuffix</span></a><span> </span><a href="#local-6989586621679414678"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1090"></a><span>           </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414683"><a href="#local-6989586621679414683"><span class="hs-identifier">filename</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414681"><span class="hs-identifier hs-var">prefix</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679414682"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="../filepath-1.4.1.1/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="#local-6989586621679414679"><span class="hs-identifier hs-var">extn</span></a><span>
</span><a name="line-1091"></a><span>           </span><a name="local-6989586621679414684"><a href="#local-6989586621679414684"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../directory-1.3.0.2/src/%{MODULE/./-}.html#%{NAME}/System.Directory.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a><span> </span><a href="#local-6989586621679414683"><span class="hs-identifier hs-var">filename</span></a><span>
</span><a name="line-1092"></a><span>           </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679414684"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679414680"><span class="hs-identifier hs-var">findTempName</span></a><span> </span><a href="#local-6989586621679414681"><span class="hs-identifier hs-var">prefix</span></a><span>
</span><a name="line-1093"></a><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- clean it up later</span><span>
</span><a name="line-1094"></a><span>                        </span><a href="Util.html#consIORef"><span class="hs-identifier hs-var">consIORef</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">filesToClean</span><span> </span><a href="#local-6989586621679414678"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414683"><span class="hs-identifier hs-var">filename</span></a><span>
</span><a name="line-1095"></a><span>                        </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679414683"><span class="hs-identifier hs-var">filename</span></a><span>
</span><a name="line-1096"></a><span>
</span><a name="line-1097"></a><span class="hs-identifier">newTempLibName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Util.html#Suffix"><span class="hs-identifier hs-type">Suffix</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span>
</span><a name="line-1098"></a><a name="newTempLibName"><a href="SysTools.html#newTempLibName"><span class="hs-identifier">newTempLibName</span></a></a><span> </span><a name="local-6989586621679414686"><a href="#local-6989586621679414686"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414687"><a href="#local-6989586621679414687"><span class="hs-identifier">extn</span></a></a><span>
</span><a name="line-1099"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679414695"><a href="#local-6989586621679414695"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#getTempDir"><span class="hs-identifier hs-var">getTempDir</span></a><span> </span><a href="#local-6989586621679414686"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1100"></a><span>       </span><a href="#local-6989586621679414688"><span class="hs-identifier hs-var">findTempName</span></a><span> </span><a href="#local-6989586621679414695"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;ghc_&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1101"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1102"></a><span>    </span><span class="hs-identifier">findTempName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span>
</span><a name="line-1103"></a><span>    </span><a name="local-6989586621679414688"><a href="#local-6989586621679414688"><span class="hs-identifier">findTempName</span></a></a><span> </span><a name="local-6989586621679414689"><a href="#local-6989586621679414689"><span class="hs-identifier">dir</span></a></a><span> </span><a name="local-6989586621679414690"><a href="#local-6989586621679414690"><span class="hs-identifier">prefix</span></a></a><span>
</span><a name="line-1104"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679414691"><a href="#local-6989586621679414691"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#newTempSuffix"><span class="hs-identifier hs-var">newTempSuffix</span></a><span> </span><a href="#local-6989586621679414686"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-comment">-- See Note [Deterministic base name]</span><span>
</span><a name="line-1105"></a><span>           </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414692"><a href="#local-6989586621679414692"><span class="hs-identifier">libname</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414690"><span class="hs-identifier hs-var">prefix</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679414691"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1106"></a><span>               </span><a name="local-6989586621679414693"><a href="#local-6989586621679414693"><span class="hs-identifier">filename</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414689"><span class="hs-identifier hs-var">dir</span></a><span> </span><a href="../filepath-1.4.1.1/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a><span> </span><span class="hs-string">&quot;lib&quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414692"><span class="hs-identifier hs-var">libname</span></a><span> </span><a href="../filepath-1.4.1.1/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="#local-6989586621679414687"><span class="hs-identifier hs-var">extn</span></a><span>
</span><a name="line-1107"></a><span>           </span><a name="local-6989586621679414694"><a href="#local-6989586621679414694"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../directory-1.3.0.2/src/%{MODULE/./-}.html#%{NAME}/System.Directory.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a><span> </span><a href="#local-6989586621679414693"><span class="hs-identifier hs-var">filename</span></a><span>
</span><a name="line-1108"></a><span>           </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679414694"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679414688"><span class="hs-identifier hs-var">findTempName</span></a><span> </span><a href="#local-6989586621679414689"><span class="hs-identifier hs-var">dir</span></a><span> </span><a href="#local-6989586621679414690"><span class="hs-identifier hs-var">prefix</span></a><span>
</span><a name="line-1109"></a><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- clean it up later</span><span>
</span><a name="line-1110"></a><span>                        </span><a href="Util.html#consIORef"><span class="hs-identifier hs-var">consIORef</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">filesToClean</span><span> </span><a href="#local-6989586621679414686"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414693"><span class="hs-identifier hs-var">filename</span></a><span>
</span><a name="line-1111"></a><span>                        </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414693"><span class="hs-identifier hs-var">filename</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679414689"><span class="hs-identifier hs-var">dir</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679414692"><span class="hs-identifier hs-var">libname</span></a><span class="hs-special">)</span><span>
</span><a name="line-1112"></a><span>
</span><a name="line-1113"></a><span>
</span><a name="line-1114"></a><span class="hs-comment">-- Return our temporary directory within tmp_dir, creating one if we</span><span>
</span><a name="line-1115"></a><span class="hs-comment">-- don't have one yet.</span><span>
</span><a name="line-1116"></a><span class="hs-identifier">getTempDir</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span>
</span><a name="line-1117"></a><a name="getTempDir"><a href="SysTools.html#getTempDir"><span class="hs-identifier">getTempDir</span></a></a><span> </span><a name="local-6989586621679414696"><a href="#local-6989586621679414696"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1118"></a><span>    </span><a name="local-6989586621679414708"><a href="#local-6989586621679414708"><span class="hs-identifier">mapping</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><a href="#local-6989586621679414698"><span class="hs-identifier hs-var">dir_ref</span></a><span>
</span><a name="line-1119"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">lookup</span></a><span> </span><a href="#local-6989586621679414697"><span class="hs-identifier hs-var">tmp_dir</span></a><span> </span><a href="#local-6989586621679414708"><span class="hs-identifier hs-var">mapping</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1120"></a><span>        </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1121"></a><span>            </span><a name="local-6989586621679414709"><a href="#local-6989586621679414709"><span class="hs-identifier">pid</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#getProcessID"><span class="hs-identifier hs-var">getProcessID</span></a><span>
</span><a name="line-1122"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414710"><a href="#local-6989586621679414710"><span class="hs-identifier">prefix</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414697"><span class="hs-identifier hs-var">tmp_dir</span></a><span> </span><a href="../filepath-1.4.1.1/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a><span> </span><span class="hs-string">&quot;ghc&quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679414709"><span class="hs-identifier hs-var">pid</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot;_&quot;</span><span>
</span><a name="line-1123"></a><span>            </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#mask_"><span class="hs-identifier hs-var">mask_</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-6989586621679414699"><span class="hs-identifier hs-var">mkTempDir</span></a><span> </span><a href="#local-6989586621679414710"><span class="hs-identifier hs-var">prefix</span></a><span>
</span><a name="line-1124"></a><span>        </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679414711"><a href="#local-6989586621679414711"><span class="hs-identifier">dir</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679414711"><span class="hs-identifier hs-var">dir</span></a><span>
</span><a name="line-1125"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1126"></a><span>    </span><a name="local-6989586621679414697"><a href="#local-6989586621679414697"><span class="hs-identifier">tmp_dir</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#tmpDir"><span class="hs-identifier hs-var">tmpDir</span></a><span> </span><a href="#local-6989586621679414696"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1127"></a><span>    </span><a name="local-6989586621679414698"><a href="#local-6989586621679414698"><span class="hs-identifier">dir_ref</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">dirsToClean</span><span> </span><a href="#local-6989586621679414696"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1128"></a><span>
</span><a name="line-1129"></a><span>    </span><span class="hs-identifier">mkTempDir</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span>
</span><a name="line-1130"></a><span>    </span><a name="local-6989586621679414699"><a href="#local-6989586621679414699"><span class="hs-identifier">mkTempDir</span></a></a><span> </span><a name="local-6989586621679414700"><a href="#local-6989586621679414700"><span class="hs-identifier">prefix</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1131"></a><span>        </span><a name="local-6989586621679414701"><a href="#local-6989586621679414701"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#newTempSuffix"><span class="hs-identifier hs-var">newTempSuffix</span></a><span> </span><a href="#local-6989586621679414696"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1132"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414702"><a href="#local-6989586621679414702"><span class="hs-identifier">our_dir</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414700"><span class="hs-identifier hs-var">prefix</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679414701"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1133"></a><span>
</span><a name="line-1134"></a><span>        </span><span class="hs-comment">-- 1. Speculatively create our new directory.</span><span>
</span><a name="line-1135"></a><span>        </span><a href="../directory-1.3.0.2/src/%{MODULE/./-}.html#%{NAME}/System.Directory.html#createDirectory"><span class="hs-identifier hs-var">createDirectory</span></a><span> </span><a href="#local-6989586621679414702"><span class="hs-identifier hs-var">our_dir</span></a><span>
</span><a name="line-1136"></a><span>
</span><a name="line-1137"></a><span>        </span><span class="hs-comment">-- 2. Update the dirsToClean mapping unless an entry already exists</span><span>
</span><a name="line-1138"></a><span>        </span><span class="hs-comment">-- (i.e. unless another thread beat us to it).</span><span>
</span><a name="line-1139"></a><span>        </span><a name="local-6989586621679414705"><a href="#local-6989586621679414705"><span class="hs-identifier">their_dir</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a><span> </span><a href="#local-6989586621679414698"><span class="hs-identifier hs-var">dir_ref</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679414703"><a href="#local-6989586621679414703"><span class="hs-identifier">mapping</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1140"></a><span>            </span><span class="hs-keyword">case</span><span> </span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">lookup</span></a><span> </span><a href="#local-6989586621679414697"><span class="hs-identifier hs-var">tmp_dir</span></a><span> </span><a href="#local-6989586621679414703"><span class="hs-identifier hs-var">mapping</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1141"></a><span>                </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679414704"><a href="#local-6989586621679414704"><span class="hs-identifier">dir</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414703"><span class="hs-identifier hs-var">mapping</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679414704"><span class="hs-identifier hs-var">dir</span></a><span class="hs-special">)</span><span>
</span><a name="line-1142"></a><span>                </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">insert</span></a><span> </span><a href="#local-6989586621679414697"><span class="hs-identifier hs-var">tmp_dir</span></a><span> </span><a href="#local-6989586621679414702"><span class="hs-identifier hs-var">our_dir</span></a><span> </span><a href="#local-6989586621679414703"><span class="hs-identifier hs-var">mapping</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span>
</span><a name="line-1143"></a><span>
</span><a name="line-1144"></a><span>        </span><span class="hs-comment">-- 3. If there was an existing entry, return it and delete the</span><span>
</span><a name="line-1145"></a><span>        </span><span class="hs-comment">-- directory we created.  Otherwise return the directory we created.</span><span>
</span><a name="line-1146"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679414705"><span class="hs-identifier hs-var">their_dir</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1147"></a><span>            </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1148"></a><span>                </span><a href="ErrUtils.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a><span> </span><a href="#local-6989586621679414696"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">2</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1149"></a><span>                    </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Created temporary directory:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621679414702"><span class="hs-identifier hs-var">our_dir</span></a><span>
</span><a name="line-1150"></a><span>                </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679414702"><span class="hs-identifier hs-var">our_dir</span></a><span>
</span><a name="line-1151"></a><span>            </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679414706"><a href="#local-6989586621679414706"><span class="hs-identifier">dir</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1152"></a><span>                </span><a href="../directory-1.3.0.2/src/%{MODULE/./-}.html#%{NAME}/System.Directory.html#removeDirectory"><span class="hs-identifier hs-var">removeDirectory</span></a><span> </span><a href="#local-6989586621679414702"><span class="hs-identifier hs-var">our_dir</span></a><span>
</span><a name="line-1153"></a><span>                </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679414706"><span class="hs-identifier hs-var">dir</span></a><span>
</span><a name="line-1154"></a><span>      </span><span class="hs-special">`</span><a href="Exception.html#catchIO"><span class="hs-identifier hs-var">catchIO</span></a><span class="hs-special">`</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679414707"><a href="#local-6989586621679414707"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/System.IO.Error.html#isAlreadyExistsError"><span class="hs-identifier hs-var">isAlreadyExistsError</span></a><span> </span><a href="#local-6989586621679414707"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1155"></a><span>                      </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679414699"><span class="hs-identifier hs-var">mkTempDir</span></a><span> </span><a href="#local-6989586621679414700"><span class="hs-identifier hs-var">prefix</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Exception.html#ioError"><span class="hs-identifier hs-var">ioError</span></a><span> </span><a href="#local-6989586621679414707"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1156"></a><span>
</span><a name="line-1157"></a><span class="hs-comment">-- Note [Deterministic base name]</span><span>
</span><a name="line-1158"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-1159"></a><span class="hs-comment">--</span><span>
</span><a name="line-1160"></a><span class="hs-comment">-- The filename of temporary files, especially the basename of C files, can end</span><span>
</span><a name="line-1161"></a><span class="hs-comment">-- up in the output in some form, e.g. as part of linker debug information. In the</span><span>
</span><a name="line-1162"></a><span class="hs-comment">-- interest of bit-wise exactly reproducible compilation (#4012), the basename of</span><span>
</span><a name="line-1163"></a><span class="hs-comment">-- the temporary file no longer contains random information (it used to contain</span><span>
</span><a name="line-1164"></a><span class="hs-comment">-- the process id).</span><span>
</span><a name="line-1165"></a><span class="hs-comment">--</span><span>
</span><a name="line-1166"></a><span class="hs-comment">-- This is ok, as the temporary directory used contains the pid (see getTempDir).</span><span>
</span><a name="line-1167"></a><span>
</span><a name="line-1168"></a><span class="hs-identifier">addFilesToClean</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1169"></a><span class="hs-comment">-- May include wildcards [used by DriverPipeline.run_phase SplitMangle]</span><span>
</span><a name="line-1170"></a><a name="addFilesToClean"><a href="SysTools.html#addFilesToClean"><span class="hs-identifier">addFilesToClean</span></a></a><span> </span><a name="local-6989586621679414712"><a href="#local-6989586621679414712"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414713"><a href="#local-6989586621679414713"><span class="hs-identifier">new_files</span></a></a><span>
</span><a name="line-1171"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">filesToClean</span><span> </span><a href="#local-6989586621679414712"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679414714"><a href="#local-6989586621679414714"><span class="hs-identifier">files</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414713"><span class="hs-identifier hs-var">new_files</span></a><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><a href="#local-6989586621679414714"><span class="hs-identifier hs-var">files</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1172"></a><span>
</span><a name="line-1173"></a><span class="hs-identifier">removeTmpDirs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1174"></a><a name="removeTmpDirs"><a href="SysTools.html#removeTmpDirs"><span class="hs-identifier">removeTmpDirs</span></a></a><span> </span><a name="local-6989586621679414715"><a href="#local-6989586621679414715"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414716"><a href="#local-6989586621679414716"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-1175"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="SysTools.html#traceCmd"><span class="hs-identifier hs-var">traceCmd</span></a><span> </span><a href="#local-6989586621679414715"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-string">&quot;Deleting temp dirs&quot;</span><span>
</span><a name="line-1176"></a><span>             </span><span class="hs-special">(</span><span class="hs-string">&quot;Deleting: &quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#unwords"><span class="hs-identifier hs-var">unwords</span></a><span> </span><a href="#local-6989586621679414716"><span class="hs-identifier hs-var">ds</span></a><span class="hs-special">)</span><span>
</span><a name="line-1177"></a><span>             </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><span class="hs-special">(</span><a href="SysTools.html#removeWith"><span class="hs-identifier hs-var">removeWith</span></a><span> </span><a href="#local-6989586621679414715"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="../directory-1.3.0.2/src/%{MODULE/./-}.html#%{NAME}/System.Directory.html#removeDirectory"><span class="hs-identifier hs-var">removeDirectory</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414716"><span class="hs-identifier hs-var">ds</span></a><span class="hs-special">)</span><span>
</span><a name="line-1178"></a><span>
</span><a name="line-1179"></a><span class="hs-identifier">removeTmpFiles</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1180"></a><a name="removeTmpFiles"><a href="SysTools.html#removeTmpFiles"><span class="hs-identifier">removeTmpFiles</span></a></a><span> </span><a name="local-6989586621679414717"><a href="#local-6989586621679414717"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414718"><a href="#local-6989586621679414718"><span class="hs-identifier">fs</span></a></a><span>
</span><a name="line-1181"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414719"><span class="hs-identifier hs-var">warnNon</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1182"></a><span>    </span><a href="SysTools.html#traceCmd"><span class="hs-identifier hs-var">traceCmd</span></a><span> </span><a href="#local-6989586621679414717"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-string">&quot;Deleting temp files&quot;</span><span>
</span><a name="line-1183"></a><span>             </span><span class="hs-special">(</span><span class="hs-string">&quot;Deleting: &quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#unwords"><span class="hs-identifier hs-var">unwords</span></a><span> </span><a href="#local-6989586621679414721"><span class="hs-identifier hs-var">deletees</span></a><span class="hs-special">)</span><span>
</span><a name="line-1184"></a><span>             </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><span class="hs-special">(</span><a href="SysTools.html#removeWith"><span class="hs-identifier hs-var">removeWith</span></a><span> </span><a href="#local-6989586621679414717"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="../directory-1.3.0.2/src/%{MODULE/./-}.html#%{NAME}/System.Directory.html#removeFile"><span class="hs-identifier hs-var">removeFile</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414721"><span class="hs-identifier hs-var">deletees</span></a><span class="hs-special">)</span><span>
</span><a name="line-1185"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1186"></a><span>     </span><span class="hs-comment">-- Flat out refuse to delete files that are likely to be source input</span><span>
</span><a name="line-1187"></a><span>     </span><span class="hs-comment">-- files (is there a worse bug than having a compiler delete your source</span><span>
</span><a name="line-1188"></a><span>     </span><span class="hs-comment">-- files?)</span><span>
</span><a name="line-1189"></a><span>     </span><span class="hs-comment">--</span><span>
</span><a name="line-1190"></a><span>     </span><span class="hs-comment">-- Deleting source files is a sign of a bug elsewhere, so prominently flag</span><span>
</span><a name="line-1191"></a><span>     </span><span class="hs-comment">-- the condition.</span><span>
</span><a name="line-1192"></a><span>    </span><a name="local-6989586621679414719"><a href="#local-6989586621679414719"><span class="hs-identifier">warnNon</span></a></a><span> </span><a name="local-6989586621679414722"><a href="#local-6989586621679414722"><span class="hs-identifier">act</span></a></a><span>
</span><a name="line-1193"></a><span>     </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621679414720"><span class="hs-identifier hs-var">non_deletees</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414722"><span class="hs-identifier hs-var">act</span></a><span>
</span><a name="line-1194"></a><span>     </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1195"></a><span>        </span><a href="ErrUtils.html#putMsg"><span class="hs-identifier hs-var">putMsg</span></a><span> </span><a href="#local-6989586621679414717"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;WARNING - NOT deleting source files:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621679414720"><span class="hs-identifier hs-var">non_deletees</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1196"></a><span>        </span><a href="#local-6989586621679414722"><span class="hs-identifier hs-var">act</span></a><span>
</span><a name="line-1197"></a><span>
</span><a name="line-1198"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679414720"><a href="#local-6989586621679414720"><span class="hs-identifier">non_deletees</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414721"><a href="#local-6989586621679414721"><span class="hs-identifier">deletees</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a><span> </span><a href="DriverPhases.html#isHaskellUserSrcFilename"><span class="hs-identifier hs-var">isHaskellUserSrcFilename</span></a><span> </span><a href="#local-6989586621679414718"><span class="hs-identifier hs-var">fs</span></a><span>
</span><a name="line-1199"></a><span>
</span><a name="line-1200"></a><span class="hs-identifier">removeWith</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1201"></a><a name="removeWith"><a href="SysTools.html#removeWith"><span class="hs-identifier">removeWith</span></a></a><span> </span><a name="local-6989586621679414723"><a href="#local-6989586621679414723"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414724"><a href="#local-6989586621679414724"><span class="hs-identifier">remover</span></a></a><span> </span><a name="local-6989586621679414725"><a href="#local-6989586621679414725"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414724"><span class="hs-identifier hs-var">remover</span></a><span> </span><a href="#local-6989586621679414725"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">`</span><a href="Exception.html#catchIO"><span class="hs-identifier hs-var">catchIO</span></a><span class="hs-special">`</span><span>
</span><a name="line-1202"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679414726"><a href="#local-6989586621679414726"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1203"></a><span>   </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414727"><a href="#local-6989586621679414727"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/System.IO.Error.html#isDoesNotExistError"><span class="hs-identifier hs-var">isDoesNotExistError</span></a><span> </span><a href="#local-6989586621679414726"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1204"></a><span>             </span><span class="hs-keyword">then</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Warning: deleting non-existent&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621679414725"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-1205"></a><span>             </span><span class="hs-keyword">else</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Warning: exception raised when deleting&quot;</span><span>
</span><a name="line-1206"></a><span>                                            </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621679414725"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a><span>
</span><a name="line-1207"></a><span>               </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679414726"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-1208"></a><span>   </span><span class="hs-keyword">in</span><span> </span><a href="ErrUtils.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a><span> </span><a href="#local-6989586621679414723"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">2</span><span> </span><a href="#local-6989586621679414727"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-1209"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-1210"></a><span>
</span><a name="line-1211"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-1212"></a><span class="hs-comment">-- Running an external program</span><span>
</span><a name="line-1213"></a><span>
</span><a name="line-1214"></a><span class="hs-identifier">runSomething</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span>
</span><a name="line-1215"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span>          </span><span class="hs-comment">-- For -v message</span><span>
</span><a name="line-1216"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span>          </span><span class="hs-comment">-- Command name (possibly a full path)</span><span>
</span><a name="line-1217"></a><span>                                </span><span class="hs-comment">--      assumed already dos-ified</span><span>
</span><a name="line-1218"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- Arguments</span><span>
</span><a name="line-1219"></a><span>                                </span><span class="hs-comment">--      runSomething will dos-ify them</span><span>
</span><a name="line-1220"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1221"></a><span>
</span><a name="line-1222"></a><a name="runSomething"><a href="SysTools.html#runSomething"><span class="hs-identifier">runSomething</span></a></a><span> </span><a name="local-6989586621679414728"><a href="#local-6989586621679414728"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414729"><a href="#local-6989586621679414729"><span class="hs-identifier">phase_name</span></a></a><span> </span><a name="local-6989586621679414730"><a href="#local-6989586621679414730"><span class="hs-identifier">pgm</span></a></a><span> </span><a name="local-6989586621679414731"><a href="#local-6989586621679414731"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1223"></a><span>  </span><a href="SysTools.html#runSomethingFiltered"><span class="hs-identifier hs-var">runSomethingFiltered</span></a><span> </span><a href="#local-6989586621679414728"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-6989586621679414729"><span class="hs-identifier hs-var">phase_name</span></a><span> </span><a href="#local-6989586621679414730"><span class="hs-identifier hs-var">pgm</span></a><span> </span><a href="#local-6989586621679414731"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1224"></a><span>
</span><a name="line-1225"></a><span class="hs-comment">-- | Run a command, placing the arguments in an external response file.</span><span>
</span><a name="line-1226"></a><span class="hs-comment">--</span><span>
</span><a name="line-1227"></a><span class="hs-comment">-- This command is used in order to avoid overlong command line arguments on</span><span>
</span><a name="line-1228"></a><span class="hs-comment">-- Windows. The command line arguments are first written to an external,</span><span>
</span><a name="line-1229"></a><span class="hs-comment">-- temporary response file, and then passed to the linker via @filepath.</span><span>
</span><a name="line-1230"></a><span class="hs-comment">-- response files for passing them in. See:</span><span>
</span><a name="line-1231"></a><span class="hs-comment">--</span><span>
</span><a name="line-1232"></a><span class="hs-comment">--     https://gcc.gnu.org/wiki/Response_Files</span><span>
</span><a name="line-1233"></a><span class="hs-comment">--     https://ghc.haskell.org/trac/ghc/ticket/10777</span><span>
</span><a name="line-1234"></a><span class="hs-identifier">runSomethingResponseFile</span><span>
</span><a name="line-1235"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-glyph">-&gt;</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span>
</span><a name="line-1236"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">,</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1237"></a><span>
</span><a name="line-1238"></a><a name="runSomethingResponseFile"><a href="SysTools.html#runSomethingResponseFile"><span class="hs-identifier">runSomethingResponseFile</span></a></a><span> </span><a name="local-6989586621679414732"><a href="#local-6989586621679414732"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414733"><a href="#local-6989586621679414733"><span class="hs-identifier">filter_fn</span></a></a><span> </span><a name="local-6989586621679414734"><a href="#local-6989586621679414734"><span class="hs-identifier">phase_name</span></a></a><span> </span><a name="local-6989586621679414735"><a href="#local-6989586621679414735"><span class="hs-identifier">pgm</span></a></a><span> </span><a name="local-6989586621679414736"><a href="#local-6989586621679414736"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621679414737"><a href="#local-6989586621679414737"><span class="hs-identifier">mb_env</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1239"></a><span>    </span><a href="SysTools.html#runSomethingWith"><span class="hs-identifier hs-var">runSomethingWith</span></a><span> </span><a href="#local-6989586621679414732"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679414734"><span class="hs-identifier hs-var">phase_name</span></a><span> </span><a href="#local-6989586621679414735"><span class="hs-identifier hs-var">pgm</span></a><span> </span><a href="#local-6989586621679414736"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679414745"><a href="#local-6989586621679414745"><span class="hs-identifier">real_args</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1240"></a><span>        </span><a name="local-6989586621679414746"><a href="#local-6989586621679414746"><span class="hs-identifier">fp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414738"><span class="hs-identifier hs-var">getResponseFile</span></a><span> </span><a href="#local-6989586621679414745"><span class="hs-identifier hs-var">real_args</span></a><span>
</span><a name="line-1241"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414747"><a href="#local-6989586621679414747"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-char">'@'</span><span class="hs-glyph">:</span><a href="#local-6989586621679414746"><span class="hs-identifier hs-var">fp</span></a><span class="hs-special">]</span><span>
</span><a name="line-1242"></a><span>        </span><a name="local-6989586621679414748"><a href="#local-6989586621679414748"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#builderMainLoop"><span class="hs-identifier hs-var">builderMainLoop</span></a><span> </span><a href="#local-6989586621679414732"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679414733"><span class="hs-identifier hs-var">filter_fn</span></a><span> </span><a href="#local-6989586621679414735"><span class="hs-identifier hs-var">pgm</span></a><span> </span><a href="#local-6989586621679414747"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621679414737"><span class="hs-identifier hs-var">mb_env</span></a><span>
</span><a name="line-1243"></a><span>        </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414748"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1244"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1245"></a><span>    </span><a name="local-6989586621679414738"><a href="#local-6989586621679414738"><span class="hs-identifier">getResponseFile</span></a></a><span> </span><a name="local-6989586621679414740"><a href="#local-6989586621679414740"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1246"></a><span>      </span><a name="local-6989586621679414741"><a href="#local-6989586621679414741"><span class="hs-identifier">fp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a><span> </span><a href="#local-6989586621679414732"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-string">&quot;rsp&quot;</span><span>
</span><a name="line-1247"></a><span>      </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/System.IO.html#withFile"><span class="hs-identifier hs-var">withFile</span></a><span> </span><a href="#local-6989586621679414741"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.IOMode.html#WriteMode"><span class="hs-identifier hs-var">WriteMode</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679414742"><a href="#local-6989586621679414742"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1248"></a><span class="hs-cpp">#if defined(mingw32_HOST_OS)</span><span>
</span><a name="line-1249"></a><span>          </span><span class="hs-identifier">hSetEncoding</span><span> </span><span class="hs-identifier">h</span><span> </span><span class="hs-identifier">latin1</span><span>
</span><a name="line-1250"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-1251"></a><span>          </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.html#hSetEncoding"><span class="hs-identifier hs-var">hSetEncoding</span></a><span> </span><a href="#local-6989586621679414742"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Encoding.html#utf8"><span class="hs-identifier hs-var">utf8</span></a><span>
</span><a name="line-1252"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-1253"></a><span>          </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.Text.html#hPutStr"><span class="hs-identifier hs-var">hPutStr</span></a><span> </span><a href="#local-6989586621679414742"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#unlines"><span class="hs-identifier hs-var">unlines</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-6989586621679414739"><span class="hs-identifier hs-var">escape</span></a><span> </span><a href="#local-6989586621679414740"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1254"></a><span>      </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679414741"><span class="hs-identifier hs-var">fp</span></a><span>
</span><a name="line-1255"></a><span>
</span><a name="line-1256"></a><span>    </span><span class="hs-comment">-- Note: Response files have backslash-escaping, double quoting, and are</span><span>
</span><a name="line-1257"></a><span>    </span><span class="hs-comment">-- whitespace separated (some implementations use newline, others any</span><span>
</span><a name="line-1258"></a><span>    </span><span class="hs-comment">-- whitespace character). Therefore, escape any backslashes, newlines, and</span><span>
</span><a name="line-1259"></a><span>    </span><span class="hs-comment">-- double quotes in the argument, and surround the content with double</span><span>
</span><a name="line-1260"></a><span>    </span><span class="hs-comment">-- quotes.</span><span>
</span><a name="line-1261"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-1262"></a><span>    </span><span class="hs-comment">-- Another possibility that could be considered would be to convert</span><span>
</span><a name="line-1263"></a><span>    </span><span class="hs-comment">-- backslashes in the argument to forward slashes. This would generally do</span><span>
</span><a name="line-1264"></a><span>    </span><span class="hs-comment">-- the right thing, since backslashes in general only appear in arguments</span><span>
</span><a name="line-1265"></a><span>    </span><span class="hs-comment">-- as part of file paths on Windows, and the forward slash is accepted for</span><span>
</span><a name="line-1266"></a><span>    </span><span class="hs-comment">-- those. However, escaping is more reliable, in case somehow a backslash</span><span>
</span><a name="line-1267"></a><span>    </span><span class="hs-comment">-- appears in a non-file.</span><span>
</span><a name="line-1268"></a><span>    </span><a name="local-6989586621679414739"><a href="#local-6989586621679414739"><span class="hs-identifier">escape</span></a></a><span> </span><a name="local-6989586621679414743"><a href="#local-6989586621679414743"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a><span>
</span><a name="line-1269"></a><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-string">&quot;\&quot;&quot;</span><span>
</span><a name="line-1270"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span>
</span><a name="line-1271"></a><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679414744"><a href="#local-6989586621679414744"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1272"></a><span>                </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679414744"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1273"></a><span>                    </span><span class="hs-char">'\\'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;\\\\&quot;</span><span>
</span><a name="line-1274"></a><span>                    </span><span class="hs-char">'\n'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;\\n&quot;</span><span>
</span><a name="line-1275"></a><span>                    </span><span class="hs-char">'\&quot;'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;\\\&quot;&quot;</span><span>
</span><a name="line-1276"></a><span>                    </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679414744"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1277"></a><span>            </span><a href="#local-6989586621679414743"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1278"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;\&quot;&quot;</span><span>
</span><a name="line-1279"></a><span>        </span><span class="hs-special">]</span><span>
</span><a name="line-1280"></a><span>
</span><a name="line-1281"></a><span class="hs-identifier">runSomethingFiltered</span><span>
</span><a name="line-1282"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-glyph">-&gt;</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span>
</span><a name="line-1283"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">,</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1284"></a><span>
</span><a name="line-1285"></a><a name="runSomethingFiltered"><a href="SysTools.html#runSomethingFiltered"><span class="hs-identifier">runSomethingFiltered</span></a></a><span> </span><a name="local-6989586621679414749"><a href="#local-6989586621679414749"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414750"><a href="#local-6989586621679414750"><span class="hs-identifier">filter_fn</span></a></a><span> </span><a name="local-6989586621679414751"><a href="#local-6989586621679414751"><span class="hs-identifier">phase_name</span></a></a><span> </span><a name="local-6989586621679414752"><a href="#local-6989586621679414752"><span class="hs-identifier">pgm</span></a></a><span> </span><a name="local-6989586621679414753"><a href="#local-6989586621679414753"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621679414754"><a href="#local-6989586621679414754"><span class="hs-identifier">mb_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1286"></a><span>    </span><a href="SysTools.html#runSomethingWith"><span class="hs-identifier hs-var">runSomethingWith</span></a><span> </span><a href="#local-6989586621679414749"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679414751"><span class="hs-identifier hs-var">phase_name</span></a><span> </span><a href="#local-6989586621679414752"><span class="hs-identifier hs-var">pgm</span></a><span> </span><a href="#local-6989586621679414753"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679414755"><a href="#local-6989586621679414755"><span class="hs-identifier">real_args</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1287"></a><span>        </span><a name="local-6989586621679414756"><a href="#local-6989586621679414756"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#builderMainLoop"><span class="hs-identifier hs-var">builderMainLoop</span></a><span> </span><a href="#local-6989586621679414749"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679414750"><span class="hs-identifier hs-var">filter_fn</span></a><span> </span><a href="#local-6989586621679414752"><span class="hs-identifier hs-var">pgm</span></a><span> </span><a href="#local-6989586621679414755"><span class="hs-identifier hs-var">real_args</span></a><span> </span><a href="#local-6989586621679414754"><span class="hs-identifier hs-var">mb_env</span></a><span>
</span><a name="line-1288"></a><span>        </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414756"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1289"></a><span>
</span><a name="line-1290"></a><span class="hs-identifier">runSomethingWith</span><span>
</span><a name="line-1291"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span>
</span><a name="line-1292"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Exception.html#ExitCode"><span class="hs-identifier hs-type">ExitCode</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679414072"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1293"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679414072"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1294"></a><span>
</span><a name="line-1295"></a><a name="runSomethingWith"><a href="SysTools.html#runSomethingWith"><span class="hs-identifier">runSomethingWith</span></a></a><span> </span><a name="local-6989586621679414757"><a href="#local-6989586621679414757"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414758"><a href="#local-6989586621679414758"><span class="hs-identifier">phase_name</span></a></a><span> </span><a name="local-6989586621679414759"><a href="#local-6989586621679414759"><span class="hs-identifier">pgm</span></a></a><span> </span><a name="local-6989586621679414760"><a href="#local-6989586621679414760"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621679414761"><a href="#local-6989586621679414761"><span class="hs-identifier">io</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1296"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414762"><a href="#local-6989586621679414762"><span class="hs-identifier">real_args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="Util.html#notNull"><span class="hs-identifier hs-var">notNull</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#showOpt"><span class="hs-identifier hs-var">showOpt</span></a><span> </span><a href="#local-6989586621679414760"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-1297"></a><span>      </span><a name="local-6989586621679414763"><a href="#local-6989586621679414763"><span class="hs-identifier">cmdLine</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../process-1.4.3.0/src/%{MODULE/./-}.html#%{NAME}/System.Process.html#showCommandForUser"><span class="hs-identifier hs-var">showCommandForUser</span></a><span> </span><a href="#local-6989586621679414759"><span class="hs-identifier hs-var">pgm</span></a><span> </span><a href="#local-6989586621679414762"><span class="hs-identifier hs-var">real_args</span></a><span>
</span><a name="line-1298"></a><span>  </span><a href="SysTools.html#traceCmd"><span class="hs-identifier hs-var">traceCmd</span></a><span> </span><a href="#local-6989586621679414757"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679414758"><span class="hs-identifier hs-var">phase_name</span></a><span> </span><a href="#local-6989586621679414763"><span class="hs-identifier hs-var">cmdLine</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="SysTools.html#handleProc"><span class="hs-identifier hs-var">handleProc</span></a><span> </span><a href="#local-6989586621679414759"><span class="hs-identifier hs-var">pgm</span></a><span> </span><a href="#local-6989586621679414758"><span class="hs-identifier hs-var">phase_name</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-6989586621679414761"><span class="hs-identifier hs-var">io</span></a><span> </span><a href="#local-6989586621679414762"><span class="hs-identifier hs-var">real_args</span></a><span>
</span><a name="line-1299"></a><span>
</span><a name="line-1300"></a><span class="hs-identifier">handleProc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Exception.html#ExitCode"><span class="hs-identifier hs-type">ExitCode</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679414071"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679414071"><span class="hs-identifier hs-type">r</span></a><span>
</span><a name="line-1301"></a><a name="handleProc"><a href="SysTools.html#handleProc"><span class="hs-identifier">handleProc</span></a></a><span> </span><a name="local-6989586621679414764"><a href="#local-6989586621679414764"><span class="hs-identifier">pgm</span></a></a><span> </span><a name="local-6989586621679414765"><a href="#local-6989586621679414765"><span class="hs-identifier">phase_name</span></a></a><span> </span><a name="local-6989586621679414766"><a href="#local-6989586621679414766"><span class="hs-identifier">proc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1302"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679414770"><a href="#local-6989586621679414770"><span class="hs-identifier">rc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414771"><a href="#local-6989586621679414771"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414766"><span class="hs-identifier hs-var">proc</span></a><span> </span><span class="hs-special">`</span><a href="Exception.html#catchIO"><span class="hs-identifier hs-var">catchIO</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679414767"><span class="hs-identifier hs-var">handler</span></a><span>
</span><a name="line-1303"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679414770"><span class="hs-identifier hs-var">rc</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1304"></a><span>      </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Exception.html#ExitSuccess"><span class="hs-identifier hs-var">ExitSuccess</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679414771"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-1305"></a><span>      </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Exception.html#ExitFailure"><span class="hs-identifier hs-var">ExitFailure</span></a><span> </span><a name="local-6989586621679414772"><a href="#local-6989586621679414772"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a><span> </span><span class="hs-special">(</span><span>
</span><a name="line-1306"></a><span>            </span><a href="Panic.html#ProgramError"><span class="hs-identifier hs-var">ProgramError</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;`&quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../filepath-1.4.1.1/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#takeFileName"><span class="hs-identifier hs-var">takeFileName</span></a><span> </span><a href="#local-6989586621679414764"><span class="hs-identifier hs-var">pgm</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot;'&quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span>
</span><a name="line-1307"></a><span>                          </span><span class="hs-string">&quot; failed in phase `&quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414765"><span class="hs-identifier hs-var">phase_name</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot;'.&quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span>
</span><a name="line-1308"></a><span>                          </span><span class="hs-string">&quot; (Exit code: &quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679414772"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot;)&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1309"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1310"></a><span>    </span><a name="local-6989586621679414767"><a href="#local-6989586621679414767"><span class="hs-identifier">handler</span></a></a><span> </span><a name="local-6989586621679414769"><a href="#local-6989586621679414769"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1311"></a><span>       </span><span class="hs-keyword">if</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/System.IO.Error.html#isDoesNotExistError"><span class="hs-identifier hs-var">IO</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">isDoesNotExistError</span></a><span> </span><a href="#local-6989586621679414769"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-1312"></a><span>          </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679414768"><span class="hs-identifier hs-var">does_not_exist</span></a><span>
</span><a name="line-1313"></a><span>          </span><span class="hs-keyword">else</span><span> </span><a href="Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a><span> </span><span class="hs-special">(</span><a href="Panic.html#ProgramError"><span class="hs-identifier hs-var">ProgramError</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679414769"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">)</span><span>
</span><a name="line-1314"></a><span>
</span><a name="line-1315"></a><span>    </span><a name="local-6989586621679414768"><a href="#local-6989586621679414768"><span class="hs-identifier">does_not_exist</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a><span> </span><span class="hs-special">(</span><a href="Panic.html#InstallationError"><span class="hs-identifier hs-var">InstallationError</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;could not execute: &quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414764"><span class="hs-identifier hs-var">pgm</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1316"></a><span>
</span><a name="line-1317"></a><span>
</span><a name="line-1318"></a><span class="hs-identifier">builderMainLoop</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span>
</span><a name="line-1319"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1320"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Exception.html#ExitCode"><span class="hs-identifier hs-type">ExitCode</span></a><span>
</span><a name="line-1321"></a><a name="builderMainLoop"><a href="SysTools.html#builderMainLoop"><span class="hs-identifier">builderMainLoop</span></a></a><span> </span><a name="local-6989586621679414773"><a href="#local-6989586621679414773"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414774"><a href="#local-6989586621679414774"><span class="hs-identifier">filter_fn</span></a></a><span> </span><a name="local-6989586621679414775"><a href="#local-6989586621679414775"><span class="hs-identifier">pgm</span></a></a><span> </span><a name="local-6989586621679414776"><a href="#local-6989586621679414776"><span class="hs-identifier">real_args</span></a></a><span> </span><a name="local-6989586621679414777"><a href="#local-6989586621679414777"><span class="hs-identifier">mb_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1322"></a><span>  </span><a name="local-6989586621679414791"><a href="#local-6989586621679414791"><span class="hs-identifier">chan</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Concurrent.Chan.html#newChan"><span class="hs-identifier hs-var">newChan</span></a><span>
</span><a name="line-1323"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679414792"><a href="#local-6989586621679414792"><span class="hs-identifier">hStdIn</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414793"><a href="#local-6989586621679414793"><span class="hs-identifier">hStdOut</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414794"><a href="#local-6989586621679414794"><span class="hs-identifier">hStdErr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414795"><a href="#local-6989586621679414795"><span class="hs-identifier">hProcess</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../process-1.4.3.0/src/%{MODULE/./-}.html#%{NAME}/System.Process.html#runInteractiveProcess"><span class="hs-identifier hs-var">runInteractiveProcess</span></a><span> </span><a href="#local-6989586621679414775"><span class="hs-identifier hs-var">pgm</span></a><span> </span><a href="#local-6989586621679414776"><span class="hs-identifier hs-var">real_args</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-6989586621679414777"><span class="hs-identifier hs-var">mb_env</span></a><span>
</span><a name="line-1324"></a><span>
</span><a name="line-1325"></a><span>  </span><span class="hs-comment">-- and run a loop piping the output from the compiler to the log_action in DynFlags</span><span>
</span><a name="line-1326"></a><span>  </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.html#hSetBuffering"><span class="hs-identifier hs-var">hSetBuffering</span></a><span> </span><a href="#local-6989586621679414793"><span class="hs-identifier hs-var">hStdOut</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.Types.html#LineBuffering"><span class="hs-identifier hs-var">LineBuffering</span></a><span>
</span><a name="line-1327"></a><span>  </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.html#hSetBuffering"><span class="hs-identifier hs-var">hSetBuffering</span></a><span> </span><a href="#local-6989586621679414794"><span class="hs-identifier hs-var">hStdErr</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.Types.html#LineBuffering"><span class="hs-identifier hs-var">LineBuffering</span></a><span>
</span><a name="line-1328"></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Conc.Sync.html#forkIO"><span class="hs-identifier hs-var">forkIO</span></a><span> </span><span class="hs-special">(</span><a href="SysTools.html#readerProc"><span class="hs-identifier hs-var">readerProc</span></a><span> </span><a href="#local-6989586621679414791"><span class="hs-identifier hs-var">chan</span></a><span> </span><a href="#local-6989586621679414793"><span class="hs-identifier hs-var">hStdOut</span></a><span> </span><a href="#local-6989586621679414774"><span class="hs-identifier hs-var">filter_fn</span></a><span class="hs-special">)</span><span>
</span><a name="line-1329"></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Conc.Sync.html#forkIO"><span class="hs-identifier hs-var">forkIO</span></a><span> </span><span class="hs-special">(</span><a href="SysTools.html#readerProc"><span class="hs-identifier hs-var">readerProc</span></a><span> </span><a href="#local-6989586621679414791"><span class="hs-identifier hs-var">chan</span></a><span> </span><a href="#local-6989586621679414794"><span class="hs-identifier hs-var">hStdErr</span></a><span> </span><a href="#local-6989586621679414774"><span class="hs-identifier hs-var">filter_fn</span></a><span class="hs-special">)</span><span>
</span><a name="line-1330"></a><span>  </span><span class="hs-comment">-- we don't want to finish until 2 streams have been completed</span><span>
</span><a name="line-1331"></a><span>  </span><span class="hs-comment">-- (stdout and stderr)</span><span>
</span><a name="line-1332"></a><span>  </span><span class="hs-comment">-- nor until 1 exit code has been retrieved.</span><span>
</span><a name="line-1333"></a><span>  </span><a name="local-6989586621679414796"><a href="#local-6989586621679414796"><span class="hs-identifier">rc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414778"><span class="hs-identifier hs-var">loop</span></a><span> </span><a href="#local-6989586621679414791"><span class="hs-identifier hs-var">chan</span></a><span> </span><a href="#local-6989586621679414795"><span class="hs-identifier hs-var">hProcess</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-glyph">::</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-glyph">::</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Exception.html#ExitSuccess"><span class="hs-identifier hs-var">ExitSuccess</span></a><span>
</span><a name="line-1334"></a><span>  </span><span class="hs-comment">-- after that, we're done here.</span><span>
</span><a name="line-1335"></a><span>  </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.html#hClose"><span class="hs-identifier hs-var">hClose</span></a><span> </span><a href="#local-6989586621679414792"><span class="hs-identifier hs-var">hStdIn</span></a><span>
</span><a name="line-1336"></a><span>  </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.html#hClose"><span class="hs-identifier hs-var">hClose</span></a><span> </span><a href="#local-6989586621679414793"><span class="hs-identifier hs-var">hStdOut</span></a><span>
</span><a name="line-1337"></a><span>  </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.html#hClose"><span class="hs-identifier hs-var">hClose</span></a><span> </span><a href="#local-6989586621679414794"><span class="hs-identifier hs-var">hStdErr</span></a><span>
</span><a name="line-1338"></a><span>  </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679414796"><span class="hs-identifier hs-var">rc</span></a><span>
</span><a name="line-1339"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1340"></a><span>    </span><span class="hs-comment">-- status starts at zero, and increments each time either</span><span>
</span><a name="line-1341"></a><span>    </span><span class="hs-comment">-- a reader process gets EOF, or the build proc exits.  We wait</span><span>
</span><a name="line-1342"></a><span>    </span><span class="hs-comment">-- for all of these to happen (status==3).</span><span>
</span><a name="line-1343"></a><span>    </span><span class="hs-comment">-- ToDo: we should really have a contingency plan in case any of</span><span>
</span><a name="line-1344"></a><span>    </span><span class="hs-comment">-- the threads dies, such as a timeout.</span><span>
</span><a name="line-1345"></a><span>    </span><a name="local-6989586621679414778"><a href="#local-6989586621679414778"><span class="hs-identifier">loop</span></a></a><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-identifier">_</span><span>        </span><span class="hs-number">0</span><span> </span><span class="hs-number">0</span><span> </span><a name="local-6989586621679414779"><a href="#local-6989586621679414779"><span class="hs-identifier">exitcode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679414779"><span class="hs-identifier hs-var">exitcode</span></a><span>
</span><a name="line-1346"></a><span>    </span><span class="hs-identifier">loop</span><span> </span><a name="local-6989586621679414780"><a href="#local-6989586621679414780"><span class="hs-identifier">chan</span></a></a><span> </span><a name="local-6989586621679414781"><a href="#local-6989586621679414781"><span class="hs-identifier">hProcess</span></a></a><span> </span><a name="local-6989586621679414782"><a href="#local-6989586621679414782"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621679414783"><a href="#local-6989586621679414783"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679414784"><a href="#local-6989586621679414784"><span class="hs-identifier">exitcode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1347"></a><span>      </span><a name="local-6989586621679414785"><a href="#local-6989586621679414785"><span class="hs-identifier">mb_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679414783"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1348"></a><span>                   </span><span class="hs-keyword">then</span><span> </span><a href="../process-1.4.3.0/src/%{MODULE/./-}.html#%{NAME}/System.Process.html#getProcessExitCode"><span class="hs-identifier hs-var">getProcessExitCode</span></a><span> </span><a href="#local-6989586621679414781"><span class="hs-identifier hs-var">hProcess</span></a><span>
</span><a name="line-1349"></a><span>                   </span><span class="hs-keyword">else</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1350"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679414785"><span class="hs-identifier hs-var">mb_code</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1351"></a><span>        </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679414786"><a href="#local-6989586621679414786"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679414778"><span class="hs-identifier hs-var">loop</span></a><span> </span><a href="#local-6989586621679414780"><span class="hs-identifier hs-var">chan</span></a><span> </span><a href="#local-6989586621679414781"><span class="hs-identifier hs-var">hProcess</span></a><span> </span><a href="#local-6989586621679414782"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414783"><span class="hs-identifier hs-var">p</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414786"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-1352"></a><span>        </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1353"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679414782"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1354"></a><span>              </span><a name="local-6989586621679414787"><a href="#local-6989586621679414787"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Concurrent.Chan.html#readChan"><span class="hs-identifier hs-var">readChan</span></a><span> </span><a href="#local-6989586621679414780"><span class="hs-identifier hs-var">chan</span></a><span>
</span><a name="line-1355"></a><span>              </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679414787"><span class="hs-identifier hs-var">msg</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1356"></a><span>                </span><a href="SysTools.html#BuildMsg"><span class="hs-identifier hs-var">BuildMsg</span></a><span> </span><a name="local-6989586621679414788"><a href="#local-6989586621679414788"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1357"></a><span>                  </span><a href="DynFlags.html#putLogMsg"><span class="hs-identifier hs-var">putLogMsg</span></a><span> </span><a href="#local-6989586621679414773"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="DynFlags.html#NoReason"><span class="hs-identifier hs-var">NoReason</span></a><span> </span><a href="ErrUtils.html#SevInfo"><span class="hs-identifier hs-var">SevInfo</span></a><span> </span><a href="SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a><span>
</span><a name="line-1358"></a><span>                     </span><span class="hs-special">(</span><a href="Outputable.html#defaultUserStyle"><span class="hs-identifier hs-var">defaultUserStyle</span></a><span> </span><a href="#local-6989586621679414773"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414788"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-1359"></a><span>                  </span><a href="#local-6989586621679414778"><span class="hs-identifier hs-var">loop</span></a><span> </span><a href="#local-6989586621679414780"><span class="hs-identifier hs-var">chan</span></a><span> </span><a href="#local-6989586621679414781"><span class="hs-identifier hs-var">hProcess</span></a><span> </span><a href="#local-6989586621679414782"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621679414783"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679414784"><span class="hs-identifier hs-var">exitcode</span></a><span>
</span><a name="line-1360"></a><span>                </span><a href="SysTools.html#BuildError"><span class="hs-identifier hs-var">BuildError</span></a><span> </span><a name="local-6989586621679414789"><a href="#local-6989586621679414789"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621679414790"><a href="#local-6989586621679414790"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1361"></a><span>                  </span><a href="DynFlags.html#putLogMsg"><span class="hs-identifier hs-var">putLogMsg</span></a><span> </span><a href="#local-6989586621679414773"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="DynFlags.html#NoReason"><span class="hs-identifier hs-var">NoReason</span></a><span> </span><a href="ErrUtils.html#SevError"><span class="hs-identifier hs-var">SevError</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#mkSrcSpan"><span class="hs-identifier hs-var">mkSrcSpan</span></a><span> </span><a href="#local-6989586621679414789"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621679414789"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1362"></a><span>                     </span><span class="hs-special">(</span><a href="Outputable.html#defaultUserStyle"><span class="hs-identifier hs-var">defaultUserStyle</span></a><span> </span><a href="#local-6989586621679414773"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414790"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-1363"></a><span>                  </span><a href="#local-6989586621679414778"><span class="hs-identifier hs-var">loop</span></a><span> </span><a href="#local-6989586621679414780"><span class="hs-identifier hs-var">chan</span></a><span> </span><a href="#local-6989586621679414781"><span class="hs-identifier hs-var">hProcess</span></a><span> </span><a href="#local-6989586621679414782"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621679414783"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679414784"><span class="hs-identifier hs-var">exitcode</span></a><span>
</span><a name="line-1364"></a><span>                </span><a href="SysTools.html#EOF"><span class="hs-identifier hs-var">EOF</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1365"></a><span>                  </span><a href="#local-6989586621679414778"><span class="hs-identifier hs-var">loop</span></a><span> </span><a href="#local-6989586621679414780"><span class="hs-identifier hs-var">chan</span></a><span> </span><a href="#local-6989586621679414781"><span class="hs-identifier hs-var">hProcess</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414782"><span class="hs-identifier hs-var">t</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414783"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679414784"><span class="hs-identifier hs-var">exitcode</span></a><span>
</span><a name="line-1366"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679414778"><span class="hs-identifier hs-var">loop</span></a><span> </span><a href="#local-6989586621679414780"><span class="hs-identifier hs-var">chan</span></a><span> </span><a href="#local-6989586621679414781"><span class="hs-identifier hs-var">hProcess</span></a><span> </span><a href="#local-6989586621679414782"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621679414783"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679414784"><span class="hs-identifier hs-var">exitcode</span></a><span>
</span><a name="line-1367"></a><span>
</span><a name="line-1368"></a><span class="hs-identifier">readerProc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Concurrent.Chan.html#Chan"><span class="hs-identifier hs-type">Chan</span></a><span> </span><a href="SysTools.html#BuildMessage"><span class="hs-identifier hs-type">BuildMessage</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1369"></a><a name="readerProc"><a href="SysTools.html#readerProc"><span class="hs-identifier">readerProc</span></a></a><span> </span><a name="local-6989586621679414797"><a href="#local-6989586621679414797"><span class="hs-identifier">chan</span></a></a><span> </span><a name="local-6989586621679414798"><a href="#local-6989586621679414798"><span class="hs-identifier">hdl</span></a></a><span> </span><a name="local-6989586621679414799"><a href="#local-6989586621679414799"><span class="hs-identifier">filter_fn</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1370"></a><span>    </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679414818"><a href="#local-6989586621679414818"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.Text.html#hGetContents"><span class="hs-identifier hs-var">hGetContents</span></a><span> </span><a href="#local-6989586621679414798"><span class="hs-identifier hs-var">hdl</span></a><span>
</span><a name="line-1371"></a><span>        </span><a href="#local-6989586621679414800"><span class="hs-identifier hs-var">loop</span></a><span> </span><span class="hs-special">(</span><a href="SysTools.html#linesPlatform"><span class="hs-identifier hs-var">linesPlatform</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414799"><span class="hs-identifier hs-var">filter_fn</span></a><span> </span><a href="#local-6989586621679414818"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span>
</span><a name="line-1372"></a><span>    </span><span class="hs-special">`</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Exception.Base.html#finally"><span class="hs-identifier hs-var">finally</span></a><span class="hs-special">`</span><span>
</span><a name="line-1373"></a><span>       </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Concurrent.Chan.html#writeChan"><span class="hs-identifier hs-var">writeChan</span></a><span> </span><a href="#local-6989586621679414797"><span class="hs-identifier hs-var">chan</span></a><span> </span><a href="SysTools.html#EOF"><span class="hs-identifier hs-var">EOF</span></a><span>
</span><a name="line-1374"></a><span>        </span><span class="hs-comment">-- ToDo: check errors more carefully</span><span>
</span><a name="line-1375"></a><span>        </span><span class="hs-comment">-- ToDo: in the future, the filter should be implemented as</span><span>
</span><a name="line-1376"></a><span>        </span><span class="hs-comment">-- a stream transformer.</span><span>
</span><a name="line-1377"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-1378"></a><span>        </span><a name="local-6989586621679414800"><a href="#local-6989586621679414800"><span class="hs-identifier">loop</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1379"></a><span>        </span><span class="hs-identifier">loop</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679414803"><a href="#local-6989586621679414803"><span class="hs-identifier">err</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Concurrent.Chan.html#writeChan"><span class="hs-identifier hs-var">writeChan</span></a><span> </span><a href="#local-6989586621679414797"><span class="hs-identifier hs-var">chan</span></a><span> </span><a href="#local-6989586621679414803"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-1380"></a><span>        </span><span class="hs-identifier">loop</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679414804"><a href="#local-6989586621679414804"><span class="hs-identifier">l</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679414805"><a href="#local-6989586621679414805"><span class="hs-identifier">ls</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679414806"><a href="#local-6989586621679414806"><span class="hs-identifier">in_err</span></a></a><span>     </span><span class="hs-glyph">=</span><span>
</span><a name="line-1381"></a><span>                </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679414806"><span class="hs-identifier hs-var">in_err</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1382"></a><span>                  </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679414807"><a href="#local-6989586621679414807"><span class="hs-identifier">err</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="SysTools.html#BuildError"><span class="hs-identifier hs-var">BuildError</span></a><span> </span><a name="local-6989586621679414808"><a href="#local-6989586621679414808"><span class="hs-identifier">srcLoc</span></a></a><span> </span><a name="local-6989586621679414809"><a href="#local-6989586621679414809"><span class="hs-identifier">msg</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1383"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679414802"><span class="hs-identifier hs-var">leading_whitespace</span></a><span> </span><a href="#local-6989586621679414804"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1384"></a><span>                        </span><a href="#local-6989586621679414800"><span class="hs-identifier hs-var">loop</span></a><span> </span><a href="#local-6989586621679414805"><span class="hs-identifier hs-var">ls</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="SysTools.html#BuildError"><span class="hs-identifier hs-var">BuildError</span></a><span> </span><a href="#local-6989586621679414808"><span class="hs-identifier hs-var">srcLoc</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414809"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621679414804"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1385"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1386"></a><span>                        </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Concurrent.Chan.html#writeChan"><span class="hs-identifier hs-var">writeChan</span></a><span> </span><a href="#local-6989586621679414797"><span class="hs-identifier hs-var">chan</span></a><span> </span><a href="#local-6989586621679414807"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-1387"></a><span>                        </span><a href="#local-6989586621679414801"><span class="hs-identifier hs-var">checkError</span></a><span> </span><a href="#local-6989586621679414804"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679414805"><span class="hs-identifier hs-var">ls</span></a><span>
</span><a name="line-1388"></a><span>                  </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1389"></a><span>                        </span><a href="#local-6989586621679414801"><span class="hs-identifier hs-var">checkError</span></a><span> </span><a href="#local-6989586621679414804"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679414805"><span class="hs-identifier hs-var">ls</span></a><span>
</span><a name="line-1390"></a><span>                  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;readerProc/loop&quot;</span><span>
</span><a name="line-1391"></a><span>
</span><a name="line-1392"></a><span>        </span><a name="local-6989586621679414801"><a href="#local-6989586621679414801"><span class="hs-identifier">checkError</span></a></a><span> </span><a name="local-6989586621679414810"><a href="#local-6989586621679414810"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679414811"><a href="#local-6989586621679414811"><span class="hs-identifier">ls</span></a></a><span>
</span><a name="line-1393"></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="SysTools.html#parseError"><span class="hs-identifier hs-var">parseError</span></a><span> </span><a href="#local-6989586621679414810"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1394"></a><span>                </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1395"></a><span>                    </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Concurrent.Chan.html#writeChan"><span class="hs-identifier hs-var">writeChan</span></a><span> </span><a href="#local-6989586621679414797"><span class="hs-identifier hs-var">chan</span></a><span> </span><span class="hs-special">(</span><a href="SysTools.html#BuildMsg"><span class="hs-identifier hs-var">BuildMsg</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621679414810"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1396"></a><span>                    </span><a href="#local-6989586621679414800"><span class="hs-identifier hs-var">loop</span></a><span> </span><a href="#local-6989586621679414811"><span class="hs-identifier hs-var">ls</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1397"></a><span>                </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679414812"><a href="#local-6989586621679414812"><span class="hs-identifier">file</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414813"><a href="#local-6989586621679414813"><span class="hs-identifier">lineNum</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414814"><a href="#local-6989586621679414814"><span class="hs-identifier">colNum</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414815"><a href="#local-6989586621679414815"><span class="hs-identifier">msg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1398"></a><span>                    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414816"><a href="#local-6989586621679414816"><span class="hs-identifier">srcLoc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#mkSrcLoc"><span class="hs-identifier hs-var">mkSrcLoc</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a><span> </span><a href="#local-6989586621679414812"><span class="hs-identifier hs-var">file</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414813"><span class="hs-identifier hs-var">lineNum</span></a><span> </span><a href="#local-6989586621679414814"><span class="hs-identifier hs-var">colNum</span></a><span>
</span><a name="line-1399"></a><span>                    </span><a href="#local-6989586621679414800"><span class="hs-identifier hs-var">loop</span></a><span> </span><a href="#local-6989586621679414811"><span class="hs-identifier hs-var">ls</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="SysTools.html#BuildError"><span class="hs-identifier hs-var">BuildError</span></a><span> </span><a href="#local-6989586621679414816"><span class="hs-identifier hs-var">srcLoc</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621679414815"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1400"></a><span>
</span><a name="line-1401"></a><span>        </span><a name="local-6989586621679414802"><a href="#local-6989586621679414802"><span class="hs-identifier">leading_whitespace</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1402"></a><span>        </span><span class="hs-identifier">leading_whitespace</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679414817"><a href="#local-6989586621679414817"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Unicode.html#isSpace"><span class="hs-identifier hs-var">isSpace</span></a><span> </span><a href="#local-6989586621679414817"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1403"></a><span>
</span><a name="line-1404"></a><span class="hs-identifier">parseError</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span>
</span><a name="line-1405"></a><a name="parseError"><a href="SysTools.html#parseError"><span class="hs-identifier">parseError</span></a></a><span> </span><a name="local-6989586621679414819"><a href="#local-6989586621679414819"><span class="hs-identifier">s0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="SysTools.html#breakColon"><span class="hs-identifier hs-var">breakColon</span></a><span> </span><a href="#local-6989586621679414819"><span class="hs-identifier hs-var">s0</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1406"></a><span>                </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679414820"><a href="#local-6989586621679414820"><span class="hs-identifier">filename</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414821"><a href="#local-6989586621679414821"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1407"></a><span>                    </span><span class="hs-keyword">case</span><span> </span><a href="SysTools.html#breakIntColon"><span class="hs-identifier hs-var">breakIntColon</span></a><span> </span><a href="#local-6989586621679414821"><span class="hs-identifier hs-var">s1</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1408"></a><span>                    </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679414822"><a href="#local-6989586621679414822"><span class="hs-identifier">lineNum</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414823"><a href="#local-6989586621679414823"><span class="hs-identifier">s2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1409"></a><span>                        </span><span class="hs-keyword">case</span><span> </span><a href="SysTools.html#breakIntColon"><span class="hs-identifier hs-var">breakIntColon</span></a><span> </span><a href="#local-6989586621679414823"><span class="hs-identifier hs-var">s2</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1410"></a><span>                        </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679414824"><a href="#local-6989586621679414824"><span class="hs-identifier">columnNum</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414825"><a href="#local-6989586621679414825"><span class="hs-identifier">s3</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1411"></a><span>                            </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414820"><span class="hs-identifier hs-var">filename</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679414822"><span class="hs-identifier hs-var">lineNum</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679414824"><span class="hs-identifier hs-var">columnNum</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679414825"><span class="hs-identifier hs-var">s3</span></a><span class="hs-special">)</span><span>
</span><a name="line-1412"></a><span>                        </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1413"></a><span>                            </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414820"><span class="hs-identifier hs-var">filename</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679414822"><span class="hs-identifier hs-var">lineNum</span></a><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679414823"><span class="hs-identifier hs-var">s2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1414"></a><span>                    </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1415"></a><span>                </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1416"></a><span>
</span><a name="line-1417"></a><span class="hs-identifier">breakColon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span>
</span><a name="line-1418"></a><a name="breakColon"><a href="SysTools.html#breakColon"><span class="hs-identifier">breakColon</span></a></a><span> </span><a name="local-6989586621679414826"><a href="#local-6989586621679414826"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#break"><span class="hs-identifier hs-var">break</span></a><span> </span><span class="hs-special">(</span><span class="hs-char">':'</span><span> </span><span class="hs-operator hs-var">==</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414826"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1419"></a><span>                    </span><span class="hs-special">(</span><a name="local-6989586621679414827"><a href="#local-6989586621679414827"><span class="hs-identifier">ys</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621679414828"><a href="#local-6989586621679414828"><span class="hs-identifier">zs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414827"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679414828"><span class="hs-identifier hs-var">zs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1420"></a><span>                    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1421"></a><span>
</span><a name="line-1422"></a><span class="hs-identifier">breakIntColon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span>
</span><a name="line-1423"></a><a name="breakIntColon"><a href="SysTools.html#breakIntColon"><span class="hs-identifier">breakIntColon</span></a></a><span> </span><a name="local-6989586621679414829"><a href="#local-6989586621679414829"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#break"><span class="hs-identifier hs-var">break</span></a><span> </span><span class="hs-special">(</span><span class="hs-char">':'</span><span> </span><span class="hs-operator hs-var">==</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414829"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1424"></a><span>                       </span><span class="hs-special">(</span><a name="local-6989586621679414830"><a href="#local-6989586621679414830"><span class="hs-identifier">ys</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621679414831"><a href="#local-6989586621679414831"><span class="hs-identifier">zs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1425"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621679414830"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Unicode.html#isAscii"><span class="hs-identifier hs-var">isAscii</span></a><span> </span><a href="#local-6989586621679414830"><span class="hs-identifier hs-var">ys</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Unicode.html#isDigit"><span class="hs-identifier hs-var">isDigit</span></a><span> </span><a href="#local-6989586621679414830"><span class="hs-identifier hs-var">ys</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1426"></a><span>                           </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Text.Read.html#read"><span class="hs-identifier hs-var">read</span></a><span> </span><a href="#local-6989586621679414830"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679414831"><span class="hs-identifier hs-var">zs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1427"></a><span>                       </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1428"></a><span>
</span><a name="line-1429"></a><span class="hs-keyword">data</span><span> </span><a name="BuildMessage"><a href="SysTools.html#BuildMessage"><span class="hs-identifier">BuildMessage</span></a></a><span>
</span><a name="line-1430"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="BuildMsg"><a href="SysTools.html#BuildMsg"><span class="hs-identifier">BuildMsg</span></a></a><span>   </span><span class="hs-glyph">!</span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1431"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="BuildError"><a href="SysTools.html#BuildError"><span class="hs-identifier">BuildError</span></a></a><span> </span><span class="hs-glyph">!</span><a href="SrcLoc.html#SrcLoc"><span class="hs-identifier hs-type">SrcLoc</span></a><span> </span><span class="hs-glyph">!</span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1432"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="EOF"><a href="SysTools.html#EOF"><span class="hs-identifier">EOF</span></a></a><span>
</span><a name="line-1433"></a><span>
</span><a name="line-1434"></a><span class="hs-identifier">traceCmd</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679413987"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679413987"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1435"></a><span class="hs-comment">-- trace the command (at two levels of verbosity)</span><span>
</span><a name="line-1436"></a><a name="traceCmd"><a href="SysTools.html#traceCmd"><span class="hs-identifier">traceCmd</span></a></a><span> </span><a name="local-6989586621679414832"><a href="#local-6989586621679414832"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414833"><a href="#local-6989586621679414833"><span class="hs-identifier">phase_name</span></a></a><span> </span><a name="local-6989586621679414834"><a href="#local-6989586621679414834"><span class="hs-identifier">cmd_line</span></a></a><span> </span><a name="local-6989586621679414835"><a href="#local-6989586621679414835"><span class="hs-identifier">action</span></a></a><span>
</span><a name="line-1437"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>   </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414839"><a href="#local-6989586621679414839"><span class="hs-identifier">verb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">verbosity</span><span> </span><a href="#local-6989586621679414832"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1438"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="ErrUtils.html#showPass"><span class="hs-identifier hs-var">showPass</span></a><span> </span><a href="#local-6989586621679414832"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679414833"><span class="hs-identifier hs-var">phase_name</span></a><span>
</span><a name="line-1439"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="ErrUtils.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a><span> </span><a href="#local-6989586621679414832"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">3</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621679414834"><span class="hs-identifier hs-var">cmd_line</span></a><span class="hs-special">)</span><span>
</span><a name="line-1440"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">flushErr</span><span> </span><a href="#local-6989586621679414832"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1441"></a><span>              </span><a href="DynFlags.html#FlushErr"><span class="hs-identifier hs-var">FlushErr</span></a><span> </span><a name="local-6989586621679414840"><a href="#local-6989586621679414840"><span class="hs-identifier">io</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679414840"><span class="hs-identifier hs-var">io</span></a><span>
</span><a name="line-1442"></a><span>
</span><a name="line-1443"></a><span>           </span><span class="hs-comment">-- And run it!</span><span>
</span><a name="line-1444"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621679414835"><span class="hs-identifier hs-var">action</span></a><span> </span><span class="hs-special">`</span><a href="Exception.html#catchIO"><span class="hs-identifier hs-var">catchIO</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679414836"><span class="hs-identifier hs-var">handle_exn</span></a><span> </span><a href="#local-6989586621679414839"><span class="hs-identifier hs-var">verb</span></a><span>
</span><a name="line-1445"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-1446"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1447"></a><span>    </span><a name="local-6989586621679414836"><a href="#local-6989586621679414836"><span class="hs-identifier">handle_exn</span></a></a><span> </span><a name="local-6989586621679414837"><a href="#local-6989586621679414837"><span class="hs-identifier">_verb</span></a></a><span> </span><a name="local-6989586621679414838"><a href="#local-6989586621679414838"><span class="hs-identifier">exn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="ErrUtils.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a><span> </span><a href="#local-6989586621679414832"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'\n'</span><span class="hs-special">)</span><span>
</span><a name="line-1448"></a><span>                              </span><span class="hs-special">;</span><span> </span><a href="ErrUtils.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a><span> </span><a href="#local-6989586621679414832"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Failed:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621679414834"><span class="hs-identifier hs-var">cmd_line</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679414838"><span class="hs-identifier hs-var">exn</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1449"></a><span>                              </span><span class="hs-special">;</span><span> </span><a href="Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a><span> </span><span class="hs-special">(</span><a href="Panic.html#ProgramError"><span class="hs-identifier hs-var">ProgramError</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679414838"><span class="hs-identifier hs-var">exn</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><a name="line-1450"></a><span>
</span><a name="line-1451"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Support code}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1458"></a><span>
</span><a name="line-1459"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-1460"></a><span class="hs-comment">-- Define       getBaseDir     :: IO (Maybe String)</span><span>
</span><a name="line-1461"></a><span>
</span><a name="line-1462"></a><span class="hs-identifier">getBaseDir</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span>
</span><a name="line-1463"></a><span class="hs-cpp">#if defined(mingw32_HOST_OS)</span><span>
</span><a name="line-1464"></a><span class="hs-comment">-- Assuming we are running ghc, accessed by path  $(stuff)/&lt;foo&gt;/ghc.exe,</span><span>
</span><a name="line-1465"></a><span class="hs-comment">-- return the path $(stuff)/lib.</span><span>
</span><a name="line-1466"></a><span class="hs-identifier">getBaseDir</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">try_size</span><span> </span><span class="hs-number">2048</span><span> </span><span class="hs-comment">-- plenty, PATH_MAX is 512 under Win32.</span><span>
</span><a name="line-1467"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1468"></a><span>    </span><span class="hs-identifier">try_size</span><span> </span><span class="hs-identifier">size</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">allocaArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">size</span><span class="hs-special">)</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">buf</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1469"></a><span>        </span><span class="hs-identifier">ret</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_GetModuleFileName</span><span> </span><span class="hs-identifier">nullPtr</span><span> </span><span class="hs-identifier">buf</span><span> </span><span class="hs-identifier">size</span><span>
</span><a name="line-1470"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">ret</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1471"></a><span>          </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-1472"></a><span>          </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">ret</span><span> </span><span class="hs-operator">&lt;</span><span> </span><span class="hs-identifier">size</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1473"></a><span>                </span><span class="hs-identifier">path</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">peekCWString</span><span> </span><span class="hs-identifier">buf</span><span>
</span><a name="line-1474"></a><span>                </span><span class="hs-identifier">real</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getFinalPath</span><span> </span><span class="hs-identifier">path</span><span> </span><span class="hs-comment">-- try to resolve symlinks paths</span><span>
</span><a name="line-1475"></a><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">libdir</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">rootDir</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">sanitize</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">maybe</span><span> </span><span class="hs-identifier">path</span><span> </span><span class="hs-identifier">id</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">real</span><span>
</span><a name="line-1476"></a><span>                </span><span class="hs-identifier">exists</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">doesDirectoryExist</span><span> </span><span class="hs-identifier">libdir</span><span>
</span><a name="line-1477"></a><span>                </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">exists</span><span>
</span><a name="line-1478"></a><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">libdir</span><span>
</span><a name="line-1479"></a><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">fail</span><span> </span><span class="hs-identifier">path</span><span>
</span><a name="line-1480"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">try_size</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">size</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span>
</span><a name="line-1481"></a><span>
</span><a name="line-1482"></a><span>    </span><span class="hs-comment">-- getFinalPath returns paths in full raw form.</span><span>
</span><a name="line-1483"></a><span>    </span><span class="hs-comment">-- Unfortunately GHC isn't set up to handle these</span><span>
</span><a name="line-1484"></a><span>    </span><span class="hs-comment">-- So if the call succeeded, we need to drop the</span><span>
</span><a name="line-1485"></a><span>    </span><span class="hs-comment">-- \\?\ prefix.</span><span>
</span><a name="line-1486"></a><span>    </span><span class="hs-identifier">sanitize</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-string">&quot;\\\\?\\&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">isPrefixOf</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">s</span><span>
</span><a name="line-1487"></a><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">drop</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-identifier">s</span><span>
</span><a name="line-1488"></a><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">s</span><span>
</span><a name="line-1489"></a><span>
</span><a name="line-1490"></a><span>    </span><span class="hs-identifier">rootDir</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">splitFileName</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">normalise</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1491"></a><span>                </span><span class="hs-special">(</span><span class="hs-identifier">d</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ghc_exe</span><span class="hs-special">)</span><span>
</span><a name="line-1492"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">lower</span><span> </span><span class="hs-identifier">ghc_exe</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">elem</span><span class="hs-special">`</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;ghc.exe&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-1493"></a><span>                                         </span><span class="hs-string">&quot;ghc-stage1.exe&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-1494"></a><span>                                         </span><span class="hs-string">&quot;ghc-stage2.exe&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-1495"></a><span>                                         </span><span class="hs-string">&quot;ghc-stage3.exe&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1496"></a><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">splitFileName</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">takeDirectory</span><span> </span><span class="hs-identifier">d</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1497"></a><span>                    </span><span class="hs-comment">-- ghc is in $topdir/bin/ghc.exe</span><span>
</span><a name="line-1498"></a><span>                    </span><span class="hs-special">(</span><span class="hs-identifier">d'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">takeDirectory</span><span> </span><span class="hs-identifier">d'</span><span> </span><span class="hs-operator">&lt;/&gt;</span><span> </span><span class="hs-string">&quot;lib&quot;</span><span>
</span><a name="line-1499"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">fail</span><span> </span><span class="hs-identifier">s</span><span>
</span><a name="line-1500"></a><span>
</span><a name="line-1501"></a><span>    </span><span class="hs-identifier">fail</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">panic</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;can't decompose ghc.exe path: &quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">show</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span>
</span><a name="line-1502"></a><span>    </span><span class="hs-identifier">lower</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">toLower</span><span>
</span><a name="line-1503"></a><span>
</span><a name="line-1504"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">WINDOWS_CCONV</span><span> </span><span class="hs-identifier">unsafe</span><span> </span><span class="hs-string">&quot;windows.h GetModuleFileNameW&quot;</span><span>
</span><a name="line-1505"></a><span>  </span><span class="hs-identifier">c_GetModuleFileName</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CWString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Word32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Word32</span><span>
</span><a name="line-1506"></a><span>
</span><a name="line-1507"></a><span class="hs-comment">-- Attempt to resolve symlinks in order to find the actual location GHC</span><span>
</span><a name="line-1508"></a><span class="hs-comment">-- is located at. See Trac #11759.</span><span>
</span><a name="line-1509"></a><span class="hs-identifier">getFinalPath</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">FilePath</span><span class="hs-special">)</span><span>
</span><a name="line-1510"></a><span class="hs-identifier">getFinalPath</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1511"></a><span>    </span><span class="hs-identifier">dllHwnd</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">failIfNull</span><span> </span><span class="hs-string">&quot;LoadLibray&quot;</span><span>     </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">loadLibrary</span><span> </span><span class="hs-string">&quot;kernel32.dll&quot;</span><span>
</span><a name="line-1512"></a><span>    </span><span class="hs-comment">-- Note: The API GetFinalPathNameByHandleW is only available starting from Windows Vista.</span><span>
</span><a name="line-1513"></a><span>    </span><span class="hs-comment">-- This means that we can't bind directly to it since it may be missing.</span><span>
</span><a name="line-1514"></a><span>    </span><span class="hs-comment">-- Instead try to find it's address at runtime and if we don't succeed consider the</span><span>
</span><a name="line-1515"></a><span>    </span><span class="hs-comment">-- function failed.</span><span>
</span><a name="line-1516"></a><span>    </span><span class="hs-identifier">addr_m</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fmap</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">failIfNull</span><span> </span><span class="hs-string">&quot;getProcAddress&quot;</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">getProcAddress</span><span> </span><span class="hs-identifier">dllHwnd</span><span> </span><span class="hs-string">&quot;GetFinalPathNameByHandleW&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1517"></a><span>                  </span><span class="hs-special">`</span><span class="hs-identifier">catch</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">SomeException</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-1518"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">addr_m</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1519"></a><span>      </span><span class="hs-identifier">Nothing</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-1520"></a><span>      </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">addr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">handle</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">failIf</span><span> </span><span class="hs-special">(</span><span class="hs-operator">==</span><span class="hs-identifier">iNVALID_HANDLE_VALUE</span><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;CreateFile&quot;</span><span>
</span><a name="line-1521"></a><span>                                        </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">createFile</span><span> </span><span class="hs-identifier">name</span><span>
</span><a name="line-1522"></a><span>                                                     </span><span class="hs-identifier">gENERIC_READ</span><span>
</span><a name="line-1523"></a><span>                                                     </span><span class="hs-identifier">fILE_SHARE_READ</span><span>
</span><a name="line-1524"></a><span>                                                     </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-1525"></a><span>                                                     </span><span class="hs-identifier">oPEN_EXISTING</span><span>
</span><a name="line-1526"></a><span>                                                     </span><span class="hs-special">(</span><span class="hs-identifier">fILE_ATTRIBUTE_NORMAL</span><span> </span><span class="hs-operator">.|.</span><span> </span><span class="hs-identifier">fILE_FLAG_BACKUP_SEMANTICS</span><span class="hs-special">)</span><span>
</span><a name="line-1527"></a><span>                                                     </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-1528"></a><span>                      </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">fnPtr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">makeGetFinalPathNameByHandle</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">castPtrToFunPtr</span><span> </span><span class="hs-identifier">addr</span><span>
</span><a name="line-1529"></a><span>                      </span><span class="hs-identifier">path</span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">Win32</span><span class="hs-operator">.</span><span class="hs-identifier">try</span><span> </span><span class="hs-string">&quot;GetFinalPathName&quot;</span><span>
</span><a name="line-1530"></a><span>                                    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">buf</span><span> </span><span class="hs-identifier">len</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">fnPtr</span><span> </span><span class="hs-identifier">handle</span><span> </span><span class="hs-identifier">buf</span><span> </span><span class="hs-identifier">len</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-number">512</span><span>
</span><a name="line-1531"></a><span>                                    </span><span class="hs-special">`</span><span class="hs-identifier">finally</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">closeHandle</span><span> </span><span class="hs-identifier">handle</span><span>
</span><a name="line-1532"></a><span>                      </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">path</span><span>
</span><a name="line-1533"></a><span>
</span><a name="line-1534"></a><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">GetFinalPath</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">HANDLE</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">LPTSTR</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">DWORD</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">DWORD</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">DWORD</span><span>
</span><a name="line-1535"></a><span>
</span><a name="line-1536"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">WINDOWS_CCONV</span><span> </span><span class="hs-identifier">unsafe</span><span> </span><span class="hs-string">&quot;dynamic&quot;</span><span>
</span><a name="line-1537"></a><span>  </span><span class="hs-identifier">makeGetFinalPathNameByHandle</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">FunPtr</span><span> </span><span class="hs-identifier">GetFinalPath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">GetFinalPath</span><span>
</span><a name="line-1538"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-1539"></a><a name="getBaseDir"><a href="SysTools.html#getBaseDir"><span class="hs-identifier">getBaseDir</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1540"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-1541"></a><span>
</span><a name="line-1542"></a><span class="hs-cpp">#ifdef mingw32_HOST_OS</span><span>
</span><a name="line-1543"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">unsafe</span><span> </span><span class="hs-string">&quot;_getpid&quot;</span><span> </span><span class="hs-identifier">getProcessID</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-comment">-- relies on Int == Int32 on Windows</span><span>
</span><a name="line-1544"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-1545"></a><span class="hs-identifier">getProcessID</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-1546"></a><a name="getProcessID"><a href="SysTools.html#getProcessID"><span class="hs-identifier">getProcessID</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/System.Posix.Internals.html#c_getpid"><span class="hs-identifier hs-var">System</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Posix</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Internals</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">c_getpid</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a><span>
</span><a name="line-1547"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-1548"></a><span>
</span><a name="line-1549"></a><span class="hs-comment">-- Divvy up text stream into lines, taking platform dependent</span><span>
</span><a name="line-1550"></a><span class="hs-comment">-- line termination into account.</span><span>
</span><a name="line-1551"></a><span class="hs-identifier">linesPlatform</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span>
</span><a name="line-1552"></a><span class="hs-cpp">#if !defined(mingw32_HOST_OS)</span><span>
</span><a name="line-1553"></a><a name="linesPlatform"><a href="SysTools.html#linesPlatform"><span class="hs-identifier">linesPlatform</span></a></a><span> </span><a name="local-6989586621679414841"><a href="#local-6989586621679414841"><span class="hs-identifier">ls</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#lines"><span class="hs-identifier hs-var">lines</span></a><span> </span><a href="#local-6989586621679414841"><span class="hs-identifier hs-var">ls</span></a><span>
</span><a name="line-1554"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-1555"></a><span class="hs-identifier">linesPlatform</span><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1556"></a><span class="hs-identifier">linesPlatform</span><span> </span><span class="hs-identifier">xs</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1557"></a><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">lineBreak</span><span> </span><span class="hs-identifier">xs</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1558"></a><span>    </span><span class="hs-special">(</span><span class="hs-keyword">as</span><span class="hs-special">,</span><span class="hs-identifier">xs1</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">linesPlatform</span><span> </span><span class="hs-identifier">xs1</span><span>
</span><a name="line-1559"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1560"></a><span>   </span><span class="hs-identifier">lineBreak</span><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1561"></a><span>   </span><span class="hs-identifier">lineBreak</span><span> </span><span class="hs-special">(</span><span class="hs-char">'\r'</span><span class="hs-glyph">:</span><span class="hs-char">'\n'</span><span class="hs-glyph">:</span><span class="hs-identifier">xs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-identifier">xs</span><span class="hs-special">)</span><span>
</span><a name="line-1562"></a><span>   </span><span class="hs-identifier">lineBreak</span><span> </span><span class="hs-special">(</span><span class="hs-char">'\n'</span><span class="hs-glyph">:</span><span class="hs-identifier">xs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-identifier">xs</span><span class="hs-special">)</span><span>
</span><a name="line-1563"></a><span>   </span><span class="hs-identifier">lineBreak</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">x</span><span class="hs-glyph">:</span><span class="hs-identifier">xs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">as</span><span class="hs-special">,</span><span class="hs-identifier">bs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">lineBreak</span><span> </span><span class="hs-identifier">xs</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">x</span><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">,</span><span class="hs-identifier">bs</span><span class="hs-special">)</span><span>
</span><a name="line-1564"></a><span>
</span><a name="line-1565"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-1566"></a><span>
</span><a name="line-1567"></a><span class="hs-comment">{-
Note [No PIE eating while linking]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
As of 2016 some Linux distributions (e.g. Debian) have started enabling -pie by
default in their gcc builds. This is incompatible with -r as it implies that we
are producing an executable. Consequently, we must manually pass -no-pie to gcc
when joining object files or linking dynamic libraries. See #12759.
-}</span><span>
</span><a name="line-1575"></a><span>
</span><a name="line-1576"></a><span class="hs-identifier">linkDynLib</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1577"></a><a name="linkDynLib"><a href="SysTools.html#linkDynLib"><span class="hs-identifier">linkDynLib</span></a></a><span> </span><a name="local-6989586621679414842"><a href="#local-6989586621679414842"><span class="hs-identifier">dflags0</span></a></a><span> </span><a name="local-6989586621679414843"><a href="#local-6989586621679414843"><span class="hs-identifier">o_files</span></a></a><span> </span><a name="local-6989586621679414844"><a href="#local-6989586621679414844"><span class="hs-identifier">dep_packages</span></a></a><span>
</span><a name="line-1578"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1579"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- This is a rather ugly hack to fix dynamically linked</span><span>
</span><a name="line-1580"></a><span>        </span><span class="hs-comment">-- GHC on Windows. If GHC is linked with -threaded, then</span><span>
</span><a name="line-1581"></a><span>        </span><span class="hs-comment">-- it links against libHSrts_thr. But if base is linked</span><span>
</span><a name="line-1582"></a><span>        </span><span class="hs-comment">-- against libHSrts, then both end up getting loaded,</span><span>
</span><a name="line-1583"></a><span>        </span><span class="hs-comment">-- and things go wrong. We therefore link the libraries</span><span>
</span><a name="line-1584"></a><span>        </span><span class="hs-comment">-- with the same RTS flags that we link GHC with.</span><span>
</span><a name="line-1585"></a><span>        </span><a name="local-6989586621679414845"><a href="#local-6989586621679414845"><span class="hs-identifier">dflags1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Config.html#cGhcThreaded"><span class="hs-identifier hs-var">cGhcThreaded</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="DynFlags.html#addWay%27"><span class="hs-identifier hs-var">addWay'</span></a><span> </span><a href="DynFlags.html#WayThreaded"><span class="hs-identifier hs-var">WayThreaded</span></a><span> </span><a href="#local-6989586621679414842"><span class="hs-identifier hs-var">dflags0</span></a><span>
</span><a name="line-1586"></a><span>                                  </span><span class="hs-keyword">else</span><span>                     </span><a href="#local-6989586621679414842"><span class="hs-identifier hs-var">dflags0</span></a><span>
</span><a name="line-1587"></a><span>        </span><a name="local-6989586621679414846"><a href="#local-6989586621679414846"><span class="hs-identifier">dflags2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Config.html#cGhcDebugged"><span class="hs-identifier hs-var">cGhcDebugged</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="DynFlags.html#addWay%27"><span class="hs-identifier hs-var">addWay'</span></a><span> </span><a href="DynFlags.html#WayDebug"><span class="hs-identifier hs-var">WayDebug</span></a><span> </span><a href="#local-6989586621679414845"><span class="hs-identifier hs-var">dflags1</span></a><span>
</span><a name="line-1588"></a><span>                                  </span><span class="hs-keyword">else</span><span>                  </span><a href="#local-6989586621679414845"><span class="hs-identifier hs-var">dflags1</span></a><span>
</span><a name="line-1589"></a><span>        </span><a name="local-6989586621679414847"><a href="#local-6989586621679414847"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#updateWays"><span class="hs-identifier hs-var">updateWays</span></a><span> </span><a href="#local-6989586621679414846"><span class="hs-identifier hs-var">dflags2</span></a><span>
</span><a name="line-1590"></a><span>
</span><a name="line-1591"></a><span>        </span><a name="local-6989586621679414848"><a href="#local-6989586621679414848"><span class="hs-identifier">verbFlags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#getVerbFlags"><span class="hs-identifier hs-var">getVerbFlags</span></a><span> </span><a href="#local-6989586621679414847"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1592"></a><span>        </span><a name="local-6989586621679414849"><a href="#local-6989586621679414849"><span class="hs-identifier">o_file</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">outputFile</span><span> </span><a href="#local-6989586621679414847"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1593"></a><span>
</span><a name="line-1594"></a><span>    </span><a name="local-6989586621679414850"><a href="#local-6989586621679414850"><span class="hs-identifier">pkgs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Packages.html#getPreloadPackagesAnd"><span class="hs-identifier hs-var">getPreloadPackagesAnd</span></a><span> </span><a href="#local-6989586621679414847"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679414844"><span class="hs-identifier hs-var">dep_packages</span></a><span>
</span><a name="line-1595"></a><span>
</span><a name="line-1596"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414851"><a href="#local-6989586621679414851"><span class="hs-identifier">pkg_lib_paths</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#collectLibraryPaths"><span class="hs-identifier hs-var">collectLibraryPaths</span></a><span> </span><a href="#local-6989586621679414847"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679414850"><span class="hs-identifier hs-var">pkgs</span></a><span>
</span><a name="line-1597"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414852"><a href="#local-6989586621679414852"><span class="hs-identifier">pkg_lib_path_opts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><a href="#local-6989586621679414853"><span class="hs-identifier hs-var">get_pkg_lib_path_opts</span></a><span> </span><a href="#local-6989586621679414851"><span class="hs-identifier hs-var">pkg_lib_paths</span></a><span>
</span><a name="line-1598"></a><span>        </span><a name="local-6989586621679414853"><a href="#local-6989586621679414853"><span class="hs-identifier">get_pkg_lib_path_opts</span></a></a><span> </span><a name="local-6989586621679414854"><a href="#local-6989586621679414854"><span class="hs-identifier">l</span></a></a><span>
</span><a name="line-1599"></a><span>         </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span> </span><a href="Platform.html#osElfTarget"><span class="hs-identifier hs-var">osElfTarget</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">platformOS</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a><span> </span><a href="#local-6989586621679414847"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span>
</span><a name="line-1600"></a><span>             </span><a href="Platform.html#osMachOTarget"><span class="hs-identifier hs-var">osMachOTarget</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">platformOS</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a><span> </span><a href="#local-6989586621679414847"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-1601"></a><span>           </span><span class="hs-identifier">dynLibLoader</span><span> </span><a href="#local-6989586621679414847"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="DynFlags.html#SystemDependent"><span class="hs-identifier hs-var">SystemDependent</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-1602"></a><span>           </span><a href="DynFlags.html#WayDyn"><span class="hs-identifier hs-var">WayDyn</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#elem"><span class="hs-identifier hs-var">elem</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">ways</span><span> </span><a href="#local-6989586621679414847"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1603"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;-L&quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414854"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;-Xlinker&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;-rpath&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;-Xlinker&quot;</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679414854"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">]</span><span>
</span><a name="line-1604"></a><span>              </span><span class="hs-comment">-- See Note [-Xlinker -rpath vs -Wl,-rpath]</span><span>
</span><a name="line-1605"></a><span>         </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;-L&quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414854"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">]</span><span>
</span><a name="line-1606"></a><span>
</span><a name="line-1607"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414855"><a href="#local-6989586621679414855"><span class="hs-identifier">lib_paths</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">libraryPaths</span><span> </span><a href="#local-6989586621679414847"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1608"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414856"><a href="#local-6989586621679414856"><span class="hs-identifier">lib_path_opts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;-L&quot;</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414855"><span class="hs-identifier hs-var">lib_paths</span></a><span>
</span><a name="line-1609"></a><span>
</span><a name="line-1610"></a><span>    </span><span class="hs-comment">-- We don't want to link our dynamic libs against the RTS package,</span><span>
</span><a name="line-1611"></a><span>    </span><span class="hs-comment">-- because the RTS lib comes in several flavours and we want to be</span><span>
</span><a name="line-1612"></a><span>    </span><span class="hs-comment">-- able to pick the flavour when a binary is linked.</span><span>
</span><a name="line-1613"></a><span>    </span><span class="hs-comment">-- On Windows we need to link the RTS import lib as Windows does</span><span>
</span><a name="line-1614"></a><span>    </span><span class="hs-comment">-- not allow undefined symbols.</span><span>
</span><a name="line-1615"></a><span>    </span><span class="hs-comment">-- The RTS library path is still added to the library search path</span><span>
</span><a name="line-1616"></a><span>    </span><span class="hs-comment">-- above in case the RTS is being explicitly linked in (see #3807).</span><span>
</span><a name="line-1617"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414857"><a href="#local-6989586621679414857"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a><span> </span><a href="#local-6989586621679414847"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1618"></a><span>        </span><a name="local-6989586621679414858"><a href="#local-6989586621679414858"><span class="hs-identifier">os</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><a href="#local-6989586621679414857"><span class="hs-identifier hs-var">platform</span></a><span>
</span><a name="line-1619"></a><span>        </span><a name="local-6989586621679414859"><a href="#local-6989586621679414859"><span class="hs-identifier">pkgs_no_rts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679414858"><span class="hs-identifier hs-var">os</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1620"></a><span>                      </span><a href="Platform.html#OSMinGW32"><span class="hs-identifier hs-var">OSMinGW32</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1621"></a><span>                          </span><a href="#local-6989586621679414850"><span class="hs-identifier hs-var">pkgs</span></a><span>
</span><a name="line-1622"></a><span>                      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1623"></a><span>                          </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span> </span><a href="Module.html#rtsUnitId"><span class="hs-identifier hs-var">rtsUnitId</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="PackageConfig.html#packageConfigId"><span class="hs-identifier hs-var">packageConfigId</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414850"><span class="hs-identifier hs-var">pkgs</span></a><span>
</span><a name="line-1624"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414860"><a href="#local-6989586621679414860"><span class="hs-identifier">pkg_link_opts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679414861"><a href="#local-6989586621679414861"><span class="hs-identifier">package_hs_libs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414862"><a href="#local-6989586621679414862"><span class="hs-identifier">extra_libs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679414863"><a href="#local-6989586621679414863"><span class="hs-identifier">other_flags</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#collectLinkOpts"><span class="hs-identifier hs-var">collectLinkOpts</span></a><span> </span><a href="#local-6989586621679414847"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679414859"><span class="hs-identifier hs-var">pkgs_no_rts</span></a><span>
</span><a name="line-1625"></a><span>                        </span><span class="hs-keyword">in</span><span>  </span><a href="#local-6989586621679414861"><span class="hs-identifier hs-var">package_hs_libs</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414862"><span class="hs-identifier hs-var">extra_libs</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414863"><span class="hs-identifier hs-var">other_flags</span></a><span>
</span><a name="line-1626"></a><span>
</span><a name="line-1627"></a><span>        </span><span class="hs-comment">-- probably _stub.o files</span><span>
</span><a name="line-1628"></a><span>        </span><span class="hs-comment">-- and last temporary shared object file</span><span>
</span><a name="line-1629"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414864"><a href="#local-6989586621679414864"><span class="hs-identifier">extra_ld_inputs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ldInputs</span><span> </span><a href="#local-6989586621679414847"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1630"></a><span>
</span><a name="line-1631"></a><span>    </span><span class="hs-comment">-- frameworks</span><span>
</span><a name="line-1632"></a><span>    </span><a name="local-6989586621679414865"><a href="#local-6989586621679414865"><span class="hs-identifier">pkg_framework_opts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#getPkgFrameworkOpts"><span class="hs-identifier hs-var">getPkgFrameworkOpts</span></a><span> </span><a href="#local-6989586621679414847"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679414857"><span class="hs-identifier hs-var">platform</span></a><span>
</span><a name="line-1633"></a><span>                                              </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-identifier">unitId</span><span> </span><a href="#local-6989586621679414850"><span class="hs-identifier hs-var">pkgs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1634"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414866"><a href="#local-6989586621679414866"><span class="hs-identifier">framework_opts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SysTools.html#getFrameworkOpts"><span class="hs-identifier hs-var">getFrameworkOpts</span></a><span> </span><a href="#local-6989586621679414847"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679414857"><span class="hs-identifier hs-var">platform</span></a><span>
</span><a name="line-1635"></a><span>
</span><a name="line-1636"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679414858"><span class="hs-identifier hs-var">os</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1637"></a><span>        </span><a href="Platform.html#OSMinGW32"><span class="hs-identifier hs-var">OSMinGW32</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1638"></a><span>            </span><span class="hs-comment">-------------------------------------------------------------</span><span>
</span><a name="line-1639"></a><span>            </span><span class="hs-comment">-- Making a DLL</span><span>
</span><a name="line-1640"></a><span>            </span><span class="hs-comment">-------------------------------------------------------------</span><span>
</span><a name="line-1641"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414867"><a href="#local-6989586621679414867"><span class="hs-identifier">output_fn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679414849"><span class="hs-identifier hs-var">o_file</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1642"></a><span>                            </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679414868"><a href="#local-6989586621679414868"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679414868"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1643"></a><span>                            </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;HSdll.dll&quot;</span><span>
</span><a name="line-1644"></a><span>
</span><a name="line-1645"></a><span>            </span><a href="SysTools.html#runLink"><span class="hs-identifier hs-var">runLink</span></a><span> </span><a href="#local-6989586621679414847"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span>
</span><a name="line-1646"></a><span>                    </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="#local-6989586621679414848"><span class="hs-identifier hs-var">verbFlags</span></a><span>
</span><a name="line-1647"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-string">&quot;-o&quot;</span><span>
</span><a name="line-1648"></a><span>                    </span><span class="hs-special">,</span><span> </span><a href="DynFlags.html#FileOption"><span class="hs-identifier hs-var">FileOption</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><a href="#local-6989586621679414867"><span class="hs-identifier hs-var">output_fn</span></a><span>
</span><a name="line-1649"></a><span>                    </span><span class="hs-special">,</span><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-string">&quot;-shared&quot;</span><span>
</span><a name="line-1650"></a><span>                    </span><span class="hs-special">]</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span>
</span><a name="line-1651"></a><span>                    </span><span class="hs-special">[</span><span> </span><a href="DynFlags.html#FileOption"><span class="hs-identifier hs-var">FileOption</span></a><span> </span><span class="hs-string">&quot;-Wl,--out-implib=&quot;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414867"><span class="hs-identifier hs-var">output_fn</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot;.a&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1652"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_SharedImplib"><span class="hs-identifier hs-var">Opt_SharedImplib</span></a><span> </span><a href="#local-6989586621679414847"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1653"></a><span>                    </span><span class="hs-special">]</span><span>
</span><a name="line-1654"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#FileOption"><span class="hs-identifier hs-var">FileOption</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414843"><span class="hs-identifier hs-var">o_files</span></a><span>
</span><a name="line-1655"></a><span>
</span><a name="line-1656"></a><span>                 </span><span class="hs-comment">-- Permit the linker to auto link _symbol to _imp_symbol</span><span>
</span><a name="line-1657"></a><span>                 </span><span class="hs-comment">-- This lets us link against DLLs without needing an &quot;import library&quot;</span><span>
</span><a name="line-1658"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-string">&quot;-Wl,--enable-auto-import&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-1659"></a><span>
</span><a name="line-1660"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414864"><span class="hs-identifier hs-var">extra_ld_inputs</span></a><span>
</span><a name="line-1661"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-special">(</span><span>
</span><a name="line-1662"></a><span>                    </span><a href="#local-6989586621679414856"><span class="hs-identifier hs-var">lib_path_opts</span></a><span>
</span><a name="line-1663"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414852"><span class="hs-identifier hs-var">pkg_lib_path_opts</span></a><span>
</span><a name="line-1664"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414860"><span class="hs-identifier hs-var">pkg_link_opts</span></a><span>
</span><a name="line-1665"></a><span>                </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1666"></a><span>        </span><a href="Platform.html#OSDarwin"><span class="hs-identifier hs-var">OSDarwin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1667"></a><span>            </span><span class="hs-comment">-------------------------------------------------------------------</span><span>
</span><a name="line-1668"></a><span>            </span><span class="hs-comment">-- Making a darwin dylib</span><span>
</span><a name="line-1669"></a><span>            </span><span class="hs-comment">-------------------------------------------------------------------</span><span>
</span><a name="line-1670"></a><span>            </span><span class="hs-comment">-- About the options used for Darwin:</span><span>
</span><a name="line-1671"></a><span>            </span><span class="hs-comment">-- -dynamiclib</span><span>
</span><a name="line-1672"></a><span>            </span><span class="hs-comment">--   Apple's way of saying -shared</span><span>
</span><a name="line-1673"></a><span>            </span><span class="hs-comment">-- -undefined dynamic_lookup:</span><span>
</span><a name="line-1674"></a><span>            </span><span class="hs-comment">--   Without these options, we'd have to specify the correct</span><span>
</span><a name="line-1675"></a><span>            </span><span class="hs-comment">--   dependencies for each of the dylibs. Note that we could</span><span>
</span><a name="line-1676"></a><span>            </span><span class="hs-comment">--   (and should) do without this for all libraries except</span><span>
</span><a name="line-1677"></a><span>            </span><span class="hs-comment">--   the RTS; all we need to do is to pass the correct</span><span>
</span><a name="line-1678"></a><span>            </span><span class="hs-comment">--   HSfoo_dyn.dylib files to the link command.</span><span>
</span><a name="line-1679"></a><span>            </span><span class="hs-comment">--   This feature requires Mac OS X 10.3 or later; there is</span><span>
</span><a name="line-1680"></a><span>            </span><span class="hs-comment">--   a similar feature, -flat_namespace -undefined suppress,</span><span>
</span><a name="line-1681"></a><span>            </span><span class="hs-comment">--   which works on earlier versions, but it has other</span><span>
</span><a name="line-1682"></a><span>            </span><span class="hs-comment">--   disadvantages.</span><span>
</span><a name="line-1683"></a><span>            </span><span class="hs-comment">-- -single_module</span><span>
</span><a name="line-1684"></a><span>            </span><span class="hs-comment">--   Build the dynamic library as a single &quot;module&quot;, i.e. no</span><span>
</span><a name="line-1685"></a><span>            </span><span class="hs-comment">--   dynamic binding nonsense when referring to symbols from</span><span>
</span><a name="line-1686"></a><span>            </span><span class="hs-comment">--   within the library. The NCG assumes that this option is</span><span>
</span><a name="line-1687"></a><span>            </span><span class="hs-comment">--   specified (on i386, at least).</span><span>
</span><a name="line-1688"></a><span>            </span><span class="hs-comment">-- -install_name</span><span>
</span><a name="line-1689"></a><span>            </span><span class="hs-comment">--   Mac OS/X stores the path where a dynamic library is (to</span><span>
</span><a name="line-1690"></a><span>            </span><span class="hs-comment">--   be) installed in the library itself.  It's called the</span><span>
</span><a name="line-1691"></a><span>            </span><span class="hs-comment">--   &quot;install name&quot; of the library. Then any library or</span><span>
</span><a name="line-1692"></a><span>            </span><span class="hs-comment">--   executable that links against it before it's installed</span><span>
</span><a name="line-1693"></a><span>            </span><span class="hs-comment">--   will search for it in its ultimate install location.</span><span>
</span><a name="line-1694"></a><span>            </span><span class="hs-comment">--   By default we set the install name to the absolute path</span><span>
</span><a name="line-1695"></a><span>            </span><span class="hs-comment">--   at build time, but it can be overridden by the</span><span>
</span><a name="line-1696"></a><span>            </span><span class="hs-comment">--   -dylib-install-name option passed to ghc. Cabal does</span><span>
</span><a name="line-1697"></a><span>            </span><span class="hs-comment">--   this.</span><span>
</span><a name="line-1698"></a><span>            </span><span class="hs-comment">-------------------------------------------------------------------</span><span>
</span><a name="line-1699"></a><span>
</span><a name="line-1700"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414869"><a href="#local-6989586621679414869"><span class="hs-identifier">output_fn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679414849"><span class="hs-identifier hs-var">o_file</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679414870"><a href="#local-6989586621679414870"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679414870"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;a.out&quot;</span><span class="hs-special">;</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1701"></a><span>
</span><a name="line-1702"></a><span>            </span><a name="local-6989586621679414872"><a href="#local-6989586621679414872"><span class="hs-identifier">instName</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">dylibInstallName</span><span> </span><a href="#local-6989586621679414847"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1703"></a><span>                </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679414871"><a href="#local-6989586621679414871"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679414871"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1704"></a><span>                </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-string">&quot;@rpath&quot;</span><span> </span><span class="hs-special">`</span><a href="../filepath-1.4.1.1/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#combine"><span class="hs-identifier hs-var">combine</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="../filepath-1.4.1.1/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#takeFileName"><span class="hs-identifier hs-var">takeFileName</span></a><span> </span><a href="#local-6989586621679414869"><span class="hs-identifier hs-var">output_fn</span></a><span class="hs-special">)</span><span>
</span><a name="line-1705"></a><span>            </span><a href="SysTools.html#runLink"><span class="hs-identifier hs-var">runLink</span></a><span> </span><a href="#local-6989586621679414847"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span>
</span><a name="line-1706"></a><span>                    </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="#local-6989586621679414848"><span class="hs-identifier hs-var">verbFlags</span></a><span>
</span><a name="line-1707"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-string">&quot;-dynamiclib&quot;</span><span>
</span><a name="line-1708"></a><span>                    </span><span class="hs-special">,</span><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-string">&quot;-o&quot;</span><span>
</span><a name="line-1709"></a><span>                    </span><span class="hs-special">,</span><span> </span><a href="DynFlags.html#FileOption"><span class="hs-identifier hs-var">FileOption</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><a href="#local-6989586621679414869"><span class="hs-identifier hs-var">output_fn</span></a><span>
</span><a name="line-1710"></a><span>                    </span><span class="hs-special">]</span><span>
</span><a name="line-1711"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="#local-6989586621679414843"><span class="hs-identifier hs-var">o_files</span></a><span>
</span><a name="line-1712"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-string">&quot;-undefined&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-1713"></a><span>                      </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-string">&quot;dynamic_lookup&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-1714"></a><span>                      </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-string">&quot;-single_module&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1715"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">platformArch</span><span> </span><a href="#local-6989586621679414857"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Platform.html#ArchX86_64"><span class="hs-identifier hs-var">ArchX86_64</span></a><span>
</span><a name="line-1716"></a><span>                     </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1717"></a><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-string">&quot;-Wl,-read_only_relocs,suppress&quot;</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1718"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-string">&quot;-install_name&quot;</span><span class="hs-special">,</span><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="#local-6989586621679414872"><span class="hs-identifier hs-var">instName</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1719"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="#local-6989586621679414856"><span class="hs-identifier hs-var">lib_path_opts</span></a><span>
</span><a name="line-1720"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414864"><span class="hs-identifier hs-var">extra_ld_inputs</span></a><span>
</span><a name="line-1721"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="#local-6989586621679414866"><span class="hs-identifier hs-var">framework_opts</span></a><span>
</span><a name="line-1722"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="#local-6989586621679414852"><span class="hs-identifier hs-var">pkg_lib_path_opts</span></a><span>
</span><a name="line-1723"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="#local-6989586621679414860"><span class="hs-identifier hs-var">pkg_link_opts</span></a><span>
</span><a name="line-1724"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="#local-6989586621679414865"><span class="hs-identifier hs-var">pkg_framework_opts</span></a><span>
</span><a name="line-1725"></a><span>              </span><span class="hs-special">)</span><span>
</span><a name="line-1726"></a><span>        </span><a href="Platform.html#OSiOS"><span class="hs-identifier hs-var">OSiOS</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a><span> </span><span class="hs-special">(</span><a href="Panic.html#ProgramError"><span class="hs-identifier hs-var">ProgramError</span></a><span> </span><span class="hs-string">&quot;dynamic libraries are not supported on iOS target&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1727"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1728"></a><span>            </span><span class="hs-comment">-------------------------------------------------------------------</span><span>
</span><a name="line-1729"></a><span>            </span><span class="hs-comment">-- Making a DSO</span><span>
</span><a name="line-1730"></a><span>            </span><span class="hs-comment">-------------------------------------------------------------------</span><span>
</span><a name="line-1731"></a><span>
</span><a name="line-1732"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414873"><a href="#local-6989586621679414873"><span class="hs-identifier">output_fn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679414849"><span class="hs-identifier hs-var">o_file</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679414874"><a href="#local-6989586621679414874"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679414874"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;a.out&quot;</span><span class="hs-special">;</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1733"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679414875"><a href="#local-6989586621679414875"><span class="hs-identifier">bsymbolicFlag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- we need symbolic linking to resolve</span><span>
</span><a name="line-1734"></a><span>                                </span><span class="hs-comment">-- non-PIC intra-package-relocations</span><span>
</span><a name="line-1735"></a><span>                                </span><span class="hs-special">[</span><span class="hs-string">&quot;-Wl,-Bsymbolic&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-1736"></a><span>
</span><a name="line-1737"></a><span>            </span><a href="SysTools.html#runLink"><span class="hs-identifier hs-var">runLink</span></a><span> </span><a href="#local-6989586621679414847"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span>
</span><a name="line-1738"></a><span>                    </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="#local-6989586621679414848"><span class="hs-identifier hs-var">verbFlags</span></a><span>
</span><a name="line-1739"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-string">&quot;-o&quot;</span><span>
</span><a name="line-1740"></a><span>                    </span><span class="hs-special">,</span><span> </span><a href="DynFlags.html#FileOption"><span class="hs-identifier hs-var">FileOption</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><a href="#local-6989586621679414873"><span class="hs-identifier hs-var">output_fn</span></a><span>
</span><a name="line-1741"></a><span>                    </span><span class="hs-special">]</span><span>
</span><a name="line-1742"></a><span>                    </span><span class="hs-comment">-- See Note [No PIE eating when linking]</span><span>
</span><a name="line-1743"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">sGccSupportsNoPie</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">settings</span><span> </span><a href="#local-6989586621679414847"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-1744"></a><span>                     </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-string">&quot;-no-pie&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-1745"></a><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1746"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="#local-6989586621679414843"><span class="hs-identifier hs-var">o_files</span></a><span>
</span><a name="line-1747"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-string">&quot;-shared&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1748"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="#local-6989586621679414875"><span class="hs-identifier hs-var">bsymbolicFlag</span></a><span>
</span><a name="line-1749"></a><span>                    </span><span class="hs-comment">-- Set the library soname. We use -h rather than -soname as</span><span>
</span><a name="line-1750"></a><span>                    </span><span class="hs-comment">-- Solaris 10 doesn't support the latter:</span><span>
</span><a name="line-1751"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;-Wl,-h,&quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../filepath-1.4.1.1/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#takeFileName"><span class="hs-identifier hs-var">takeFileName</span></a><span> </span><a href="#local-6989586621679414873"><span class="hs-identifier hs-var">output_fn</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1752"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414864"><span class="hs-identifier hs-var">extra_ld_inputs</span></a><span>
</span><a name="line-1753"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="#local-6989586621679414856"><span class="hs-identifier hs-var">lib_path_opts</span></a><span>
</span><a name="line-1754"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="#local-6989586621679414852"><span class="hs-identifier hs-var">pkg_lib_path_opts</span></a><span>
</span><a name="line-1755"></a><span>                 </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="#local-6989586621679414860"><span class="hs-identifier hs-var">pkg_link_opts</span></a><span>
</span><a name="line-1756"></a><span>              </span><span class="hs-special">)</span><span>
</span><a name="line-1757"></a><span>
</span><a name="line-1758"></a><span class="hs-identifier">getPkgFrameworkOpts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span>
</span><a name="line-1759"></a><a name="getPkgFrameworkOpts"><a href="SysTools.html#getPkgFrameworkOpts"><span class="hs-identifier">getPkgFrameworkOpts</span></a></a><span> </span><a name="local-6989586621679414876"><a href="#local-6989586621679414876"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414877"><a href="#local-6989586621679414877"><span class="hs-identifier">platform</span></a></a><span> </span><a name="local-6989586621679414878"><a href="#local-6989586621679414878"><span class="hs-identifier">dep_packages</span></a></a><span>
</span><a name="line-1760"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Platform.html#platformUsesFrameworks"><span class="hs-identifier hs-var">platformUsesFrameworks</span></a><span> </span><a href="#local-6989586621679414877"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1761"></a><span>    </span><a name="local-6989586621679414880"><a href="#local-6989586621679414880"><span class="hs-identifier">pkg_framework_path_opts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1762"></a><span>        </span><a name="local-6989586621679414879"><a href="#local-6989586621679414879"><span class="hs-identifier">pkg_framework_paths</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Packages.html#getPackageFrameworkPath"><span class="hs-identifier hs-var">getPackageFrameworkPath</span></a><span> </span><a href="#local-6989586621679414876"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679414878"><span class="hs-identifier hs-var">dep_packages</span></a><span>
</span><a name="line-1763"></a><span>        </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;-F&quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414879"><span class="hs-identifier hs-var">pkg_framework_paths</span></a><span>
</span><a name="line-1764"></a><span>
</span><a name="line-1765"></a><span>    </span><a name="local-6989586621679414883"><a href="#local-6989586621679414883"><span class="hs-identifier">pkg_framework_opts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1766"></a><span>        </span><a name="local-6989586621679414881"><a href="#local-6989586621679414881"><span class="hs-identifier">pkg_frameworks</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Packages.html#getPackageFrameworks"><span class="hs-identifier hs-var">getPackageFrameworks</span></a><span> </span><a href="#local-6989586621679414876"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679414878"><span class="hs-identifier hs-var">dep_packages</span></a><span>
</span><a name="line-1767"></a><span>        </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;-framework&quot;</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679414882"><span class="hs-identifier hs-var">fw</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679414882"><a href="#local-6989586621679414882"><span class="hs-identifier">fw</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679414881"><span class="hs-identifier hs-var">pkg_frameworks</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1768"></a><span>
</span><a name="line-1769"></a><span>    </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679414880"><span class="hs-identifier hs-var">pkg_framework_path_opts</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414883"><span class="hs-identifier hs-var">pkg_framework_opts</span></a><span class="hs-special">)</span><span>
</span><a name="line-1770"></a><span>
</span><a name="line-1771"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1772"></a><span>
</span><a name="line-1773"></a><span class="hs-identifier">getFrameworkOpts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span>
</span><a name="line-1774"></a><a name="getFrameworkOpts"><a href="SysTools.html#getFrameworkOpts"><span class="hs-identifier">getFrameworkOpts</span></a></a><span> </span><a name="local-6989586621679414884"><a href="#local-6989586621679414884"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679414885"><a href="#local-6989586621679414885"><span class="hs-identifier">platform</span></a></a><span>
</span><a name="line-1775"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Platform.html#platformUsesFrameworks"><span class="hs-identifier hs-var">platformUsesFrameworks</span></a><span> </span><a href="#local-6989586621679414885"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679414887"><span class="hs-identifier hs-var">framework_path_opts</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679414889"><span class="hs-identifier hs-var">framework_opts</span></a><span>
</span><a name="line-1776"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1777"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1778"></a><span>    </span><a name="local-6989586621679414886"><a href="#local-6989586621679414886"><span class="hs-identifier">framework_paths</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">frameworkPaths</span><span> </span><a href="#local-6989586621679414884"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1779"></a><span>    </span><a name="local-6989586621679414887"><a href="#local-6989586621679414887"><span class="hs-identifier">framework_path_opts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;-F&quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679414886"><span class="hs-identifier hs-var">framework_paths</span></a><span>
</span><a name="line-1780"></a><span>
</span><a name="line-1781"></a><span>    </span><a name="local-6989586621679414888"><a href="#local-6989586621679414888"><span class="hs-identifier">frameworks</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">cmdlineFrameworks</span><span> </span><a href="#local-6989586621679414884"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1782"></a><span>    </span><span class="hs-comment">-- reverse because they're added in reverse order from the cmd line:</span><span>
</span><a name="line-1783"></a><span>    </span><a name="local-6989586621679414889"><a href="#local-6989586621679414889"><span class="hs-identifier">framework_opts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;-framework&quot;</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679414890"><span class="hs-identifier hs-var">fw</span></a><span class="hs-special">]</span><span>
</span><a name="line-1784"></a><span>                            </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679414890"><a href="#local-6989586621679414890"><span class="hs-identifier">fw</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-6989586621679414888"><span class="hs-identifier hs-var">frameworks</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1785"></a></pre></body></html>