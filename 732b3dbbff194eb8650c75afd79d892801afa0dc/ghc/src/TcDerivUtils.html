<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998


Error-checking and other utilities for @deriving@ clauses or declarations.
-}</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE ImplicitParams #-}</span><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">TcDerivUtils</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-12"></a><span>        </span><a href="TcDerivUtils.html#DerivSpec"><span class="hs-identifier hs-type">DerivSpec</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcDerivUtils.html#pprDerivSpec"><span class="hs-identifier hs-var">pprDerivSpec</span></a><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>        </span><a href="TcDerivUtils.html#DerivSpecMechanism"><span class="hs-identifier hs-type">DerivSpecMechanism</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcDerivUtils.html#isDerivSpecStock"><span class="hs-identifier hs-var">isDerivSpecStock</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>        </span><a href="TcDerivUtils.html#isDerivSpecNewtype"><span class="hs-identifier hs-var">isDerivSpecNewtype</span></a><span class="hs-special">,</span><span> </span><a href="TcDerivUtils.html#isDerivSpecAnyClass"><span class="hs-identifier hs-var">isDerivSpecAnyClass</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>        </span><a href="TcDerivUtils.html#DerivContext"><span class="hs-identifier hs-type">DerivContext</span></a><span class="hs-special">,</span><span> </span><a href="TcDerivUtils.html#DerivStatus"><span class="hs-identifier hs-type">DerivStatus</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>        </span><a href="TcDerivUtils.html#PredOrigin"><span class="hs-identifier hs-type">PredOrigin</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcDerivUtils.html#ThetaOrigin"><span class="hs-identifier hs-type">ThetaOrigin</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcDerivUtils.html#mkPredOrigin"><span class="hs-identifier hs-var">mkPredOrigin</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>        </span><a href="TcDerivUtils.html#mkThetaOrigin"><span class="hs-identifier hs-var">mkThetaOrigin</span></a><span class="hs-special">,</span><span> </span><a href="TcDerivUtils.html#mkThetaOriginFromPreds"><span class="hs-identifier hs-var">mkThetaOriginFromPreds</span></a><span class="hs-special">,</span><span> </span><a href="TcDerivUtils.html#substPredOrigin"><span class="hs-identifier hs-var">substPredOrigin</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>        </span><a href="TcDerivUtils.html#checkSideConditions"><span class="hs-identifier hs-var">checkSideConditions</span></a><span class="hs-special">,</span><span> </span><a href="TcDerivUtils.html#hasStockDeriving"><span class="hs-identifier hs-var">hasStockDeriving</span></a><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>        </span><a href="TcDerivUtils.html#canDeriveAnyClass"><span class="hs-identifier hs-var">canDeriveAnyClass</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>        </span><a href="TcDerivUtils.html#std_class_via_coercible"><span class="hs-identifier hs-var">std_class_via_coercible</span></a><span class="hs-special">,</span><span> </span><a href="TcDerivUtils.html#non_coercible_class"><span class="hs-identifier hs-var">non_coercible_class</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>        </span><a href="TcDerivUtils.html#newDerivClsInst"><span class="hs-identifier hs-var">newDerivClsInst</span></a><span class="hs-special">,</span><span> </span><a href="TcDerivUtils.html#extendLocalInstEnv"><span class="hs-identifier hs-var">extendLocalInstEnv</span></a><span>
</span><a name="line-22"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><a href="Bag.html"><span class="hs-identifier">Bag</span></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><a href="Class.html"><span class="hs-identifier">Class</span></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><a href="DataCon.html"><span class="hs-identifier">DataCon</span></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><a href="ErrUtils.html"><span class="hs-identifier">ErrUtils</span></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><a href="HscTypes.html"><span class="hs-identifier">HscTypes</span></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#lookupFixity"><span class="hs-identifier hs-var">lookupFixity</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#mi_fix"><span class="hs-identifier hs-var">mi_fix</span></a><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><a href="HsSyn.html"><span class="hs-identifier">HsSyn</span></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><a href="Inst.html"><span class="hs-identifier">Inst</span></a><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><a href="InstEnv.html"><span class="hs-identifier">InstEnv</span></a><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><a href="LoadIface.html"><span class="hs-identifier">LoadIface</span></a><span> </span><span class="hs-special">(</span><a href="LoadIface.html#loadInterfaceForName"><span class="hs-identifier hs-var">loadInterfaceForName</span></a><span class="hs-special">)</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><a href="Module.html"><span class="hs-identifier">Module</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a><span class="hs-special">)</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="PrelNames.html"><span class="hs-identifier">PrelNames</span></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><a href="RdrName.html"><span class="hs-identifier">RdrName</span></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><a href="TcGenDeriv.html"><span class="hs-identifier">TcGenDeriv</span></a><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><a href="TcGenFunctor.html"><span class="hs-identifier">TcGenFunctor</span></a><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><a href="TcGenGenerics.html"><span class="hs-identifier">TcGenGenerics</span></a><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnMonad.html"><span class="hs-identifier">TcRnMonad</span></a><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><a href="TcType.html"><span class="hs-identifier">TcType</span></a><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><a href="THNames.html"><span class="hs-identifier">THNames</span></a><span> </span><span class="hs-special">(</span><a href="THNames.html#liftClassKey"><span class="hs-identifier hs-var">liftClassKey</span></a><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><a href="TyCon.html"><span class="hs-identifier">TyCon</span></a><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><a href="VarSet.html"><span class="hs-identifier">VarSet</span></a><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../ghc-boot-8.3/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">LanguageExtensions</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LangExt</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><a href="ListSetOps.html"><span class="hs-identifier">ListSetOps</span></a><span> </span><span class="hs-special">(</span><a href="ListSetOps.html#assocMaybe"><span class="hs-identifier hs-var">assocMaybe</span></a><span class="hs-special">)</span><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span class="hs-keyword">data</span><span> </span><a name="DerivSpec"><a href="TcDerivUtils.html#DerivSpec"><span class="hs-identifier">DerivSpec</span></a></a><span> </span><a name="local-6989586621679896361"><a href="#local-6989586621679896361"><span class="hs-identifier">theta</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="DS"><a href="TcDerivUtils.html#DS"><span class="hs-identifier">DS</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="ds_loc"><a href="TcDerivUtils.html#ds_loc"><span class="hs-identifier">ds_loc</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span>
</span><a name="line-56"></a><span>                          </span><span class="hs-special">,</span><span> </span><a name="ds_name"><a href="TcDerivUtils.html#ds_name"><span class="hs-identifier">ds_name</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>         </span><span class="hs-comment">-- DFun name</span><span>
</span><a name="line-57"></a><span>                          </span><span class="hs-special">,</span><span> </span><a name="ds_tvs"><a href="TcDerivUtils.html#ds_tvs"><span class="hs-identifier">ds_tvs</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-58"></a><span>                          </span><span class="hs-special">,</span><span> </span><a name="ds_theta"><a href="TcDerivUtils.html#ds_theta"><span class="hs-identifier">ds_theta</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679896361"><span class="hs-identifier hs-type">theta</span></a><span>
</span><a name="line-59"></a><span>                          </span><span class="hs-special">,</span><span> </span><a name="ds_cls"><a href="TcDerivUtils.html#ds_cls"><span class="hs-identifier">ds_cls</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span>
</span><a name="line-60"></a><span>                          </span><span class="hs-special">,</span><span> </span><a name="ds_tys"><a href="TcDerivUtils.html#ds_tys"><span class="hs-identifier">ds_tys</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>
</span><a name="line-61"></a><span>                          </span><span class="hs-special">,</span><span> </span><a name="ds_tc"><a href="TcDerivUtils.html#ds_tc"><span class="hs-identifier">ds_tc</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>
</span><a name="line-62"></a><span>                          </span><span class="hs-special">,</span><span> </span><a name="ds_overlap"><a href="TcDerivUtils.html#ds_overlap"><span class="hs-identifier">ds_overlap</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="BasicTypes.html#OverlapMode"><span class="hs-identifier hs-type">OverlapMode</span></a><span>
</span><a name="line-63"></a><span>                          </span><span class="hs-special">,</span><span> </span><a name="ds_mechanism"><a href="TcDerivUtils.html#ds_mechanism"><span class="hs-identifier">ds_mechanism</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcDerivUtils.html#DerivSpecMechanism"><span class="hs-identifier hs-type">DerivSpecMechanism</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-64"></a><span>        </span><span class="hs-comment">-- This spec implies a dfun declaration of the form</span><span>
</span><a name="line-65"></a><span>        </span><span class="hs-comment">--       df :: forall tvs. theta =&gt; C tys</span><span>
</span><a name="line-66"></a><span>        </span><span class="hs-comment">-- The Name is the name for the DFun we'll build</span><span>
</span><a name="line-67"></a><span>        </span><span class="hs-comment">-- The tyvars bind all the variables in the theta</span><span>
</span><a name="line-68"></a><span>        </span><span class="hs-comment">-- For type families, the tycon in</span><span>
</span><a name="line-69"></a><span>        </span><span class="hs-comment">--       in ds_tys is the *family* tycon</span><span>
</span><a name="line-70"></a><span>        </span><span class="hs-comment">--       in ds_tc is the *representation* type</span><span>
</span><a name="line-71"></a><span>        </span><span class="hs-comment">-- For non-family tycons, both are the same</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span>        </span><span class="hs-comment">-- the theta is either the given and final theta, in standalone deriving,</span><span>
</span><a name="line-74"></a><span>        </span><span class="hs-comment">-- or the not-yet-simplified list of constraints together with their origin</span><span>
</span><a name="line-75"></a><span>
</span><a name="line-76"></a><span>        </span><span class="hs-comment">-- ds_mechanism specifies the means by which GHC derives the instance.</span><span>
</span><a name="line-77"></a><span>        </span><span class="hs-comment">-- See Note [Deriving strategies] in TcDeriv</span><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span class="hs-comment">{-
Example:

     newtype instance T [a] = MkT (Tree a) deriving( C s )
==&gt;
     axiom T [a] = :RTList a
     axiom :RTList a = Tree a

     DS { ds_tvs = [a,s], ds_cls = C, ds_tys = [s, T [a]]
        , ds_tc = :RTList, ds_mechanism = DerivSpecNewtype (Tree a) }
-}</span><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span class="hs-identifier">pprDerivSpec</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="#local-6989586621679896369"><span class="hs-identifier hs-type">theta</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TcDerivUtils.html#DerivSpec"><span class="hs-identifier hs-type">DerivSpec</span></a><span> </span><a href="#local-6989586621679896369"><span class="hs-identifier hs-type">theta</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-92"></a><a name="pprDerivSpec"><a href="TcDerivUtils.html#pprDerivSpec"><span class="hs-identifier">pprDerivSpec</span></a></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#DS"><span class="hs-identifier hs-var">DS</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ds_loc</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679896370"><a href="#local-6989586621679896370"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ds_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679896371"><a href="#local-6989586621679896371"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ds_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679896372"><a href="#local-6989586621679896372"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ds_cls</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679896373"><a href="#local-6989586621679896373"><span class="hs-identifier">c</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-93"></a><span>                   </span><span class="hs-identifier">ds_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679896374"><a href="#local-6989586621679896374"><span class="hs-identifier">tys</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ds_theta</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679896375"><a href="#local-6989586621679896375"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ds_mechanism</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679896376"><a href="#local-6989586621679896376"><span class="hs-identifier">mech</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;DerivSpec&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-95"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;ds_loc       =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679896370"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-96"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;ds_name      =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679896371"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-97"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;ds_tvs       =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679896372"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-98"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;ds_cls       =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679896373"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-99"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;ds_tys       =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679896374"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-100"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;ds_theta     =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679896375"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-101"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;ds_mechanism =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679896376"><span class="hs-identifier hs-var">mech</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="#local-6989586621679896366"><span class="hs-identifier hs-type">theta</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#DerivSpec"><span class="hs-identifier hs-type">DerivSpec</span></a><span> </span><a href="#local-6989586621679896366"><span class="hs-identifier hs-type">theta</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-104"></a><span>  </span><a name="local-8214565720323871022"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcDerivUtils.html#pprDerivSpec"><span class="hs-identifier hs-var">pprDerivSpec</span></a><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-comment">-- What action to take in order to derive a class instance.</span><span>
</span><a name="line-107"></a><span class="hs-comment">-- See Note [Deriving strategies] in TcDeriv</span><span>
</span><a name="line-108"></a><span class="hs-comment">-- NB: DerivSpecMechanism is purely local to this module</span><span>
</span><a name="line-109"></a><span class="hs-keyword">data</span><span> </span><a name="DerivSpecMechanism"><a href="TcDerivUtils.html#DerivSpecMechanism"><span class="hs-identifier">DerivSpecMechanism</span></a></a><span>
</span><a name="line-110"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="DerivSpecStock"><a href="TcDerivUtils.html#DerivSpecStock"><span class="hs-identifier">DerivSpecStock</span></a></a><span>   </span><span class="hs-comment">-- &quot;Standard&quot; classes</span><span>
</span><a name="line-111"></a><span>      </span><span class="hs-special">(</span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#BagDerivStuff"><span class="hs-identifier hs-type">BagDerivStuff</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-112"></a><span>
</span><a name="line-113"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DerivSpecNewtype"><a href="TcDerivUtils.html#DerivSpecNewtype"><span class="hs-identifier">DerivSpecNewtype</span></a></a><span> </span><span class="hs-comment">-- -XGeneralizedNewtypeDeriving</span><span>
</span><a name="line-114"></a><span>      </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-comment">-- ^ The newtype rep type</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DerivSpecAnyClass"><a href="TcDerivUtils.html#DerivSpecAnyClass"><span class="hs-identifier">DerivSpecAnyClass</span></a></a><span> </span><span class="hs-comment">-- -XDeriveAnyClass</span><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span class="hs-identifier">isDerivSpecStock</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isDerivSpecNewtype</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isDerivSpecAnyClass</span><span>
</span><a name="line-119"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="TcDerivUtils.html#DerivSpecMechanism"><span class="hs-identifier hs-type">DerivSpecMechanism</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-120"></a><a name="isDerivSpecStock"><a href="TcDerivUtils.html#isDerivSpecStock"><span class="hs-identifier">isDerivSpecStock</span></a></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#DerivSpecStock"><span class="hs-identifier hs-var">DerivSpecStock</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-121"></a><span class="hs-identifier">isDerivSpecStock</span><span> </span><span class="hs-identifier">_</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><a name="isDerivSpecNewtype"><a href="TcDerivUtils.html#isDerivSpecNewtype"><span class="hs-identifier">isDerivSpecNewtype</span></a></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#DerivSpecNewtype"><span class="hs-identifier hs-var">DerivSpecNewtype</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-124"></a><span class="hs-identifier">isDerivSpecNewtype</span><span> </span><span class="hs-identifier">_</span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-125"></a><span>
</span><a name="line-126"></a><a name="isDerivSpecAnyClass"><a href="TcDerivUtils.html#isDerivSpecAnyClass"><span class="hs-identifier">isDerivSpecAnyClass</span></a></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#DerivSpecAnyClass"><span class="hs-identifier hs-var">DerivSpecAnyClass</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-127"></a><span class="hs-identifier">isDerivSpecAnyClass</span><span> </span><span class="hs-identifier">_</span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-128"></a><span>
</span><a name="line-129"></a><span class="hs-comment">-- A DerivSpecMechanism can be losslessly converted to a DerivStrategy.</span><span>
</span><a name="line-130"></a><span class="hs-identifier">mechanismToStrategy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcDerivUtils.html#DerivSpecMechanism"><span class="hs-identifier hs-type">DerivSpecMechanism</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#DerivStrategy"><span class="hs-identifier hs-type">DerivStrategy</span></a><span>
</span><a name="line-131"></a><a name="mechanismToStrategy"><a href="TcDerivUtils.html#mechanismToStrategy"><span class="hs-identifier">mechanismToStrategy</span></a></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#DerivSpecStock"><span class="hs-identifier hs-var">DerivSpecStock</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#StockStrategy"><span class="hs-identifier hs-var">StockStrategy</span></a><span>
</span><a name="line-132"></a><span class="hs-identifier">mechanismToStrategy</span><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#DerivSpecNewtype"><span class="hs-identifier hs-var">DerivSpecNewtype</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#NewtypeStrategy"><span class="hs-identifier hs-var">NewtypeStrategy</span></a><span>
</span><a name="line-133"></a><span class="hs-identifier">mechanismToStrategy</span><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#DerivSpecAnyClass"><span class="hs-identifier hs-var">DerivSpecAnyClass</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#AnyclassStrategy"><span class="hs-identifier hs-var">AnyclassStrategy</span></a><span>
</span><a name="line-134"></a><span>
</span><a name="line-135"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcDerivUtils.html#DerivSpecMechanism"><span class="hs-identifier hs-type">DerivSpecMechanism</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-136"></a><span>  </span><a name="local-8214565720323871022"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="TcDerivUtils.html#mechanismToStrategy"><span class="hs-identifier hs-var">mechanismToStrategy</span></a><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span class="hs-keyword">type</span><span> </span><a name="DerivContext"><a href="TcDerivUtils.html#DerivContext"><span class="hs-identifier">DerivContext</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span>
</span><a name="line-139"></a><span>   </span><span class="hs-comment">-- Nothing    &lt;=&gt; Vanilla deriving; infer the context of the instance decl</span><span>
</span><a name="line-140"></a><span>   </span><span class="hs-comment">-- Just theta &lt;=&gt; Standalone deriving: context supplied by programmer</span><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span class="hs-keyword">data</span><span> </span><a name="DerivStatus"><a href="TcDerivUtils.html#DerivStatus"><span class="hs-identifier">DerivStatus</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="CanDerive"><a href="TcDerivUtils.html#CanDerive"><span class="hs-identifier">CanDerive</span></a></a><span>                 </span><span class="hs-comment">-- Stock class, can derive</span><span>
</span><a name="line-143"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><a name="DerivableClassError"><a href="TcDerivUtils.html#DerivableClassError"><span class="hs-identifier">DerivableClassError</span></a></a><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>  </span><span class="hs-comment">-- Stock class, but can't do it</span><span>
</span><a name="line-144"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><a name="DerivableViaInstance"><a href="TcDerivUtils.html#DerivableViaInstance"><span class="hs-identifier">DerivableViaInstance</span></a></a><span>      </span><span class="hs-comment">-- See Note [Deriving any class]</span><span>
</span><a name="line-145"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><a name="NonDerivableClass"><a href="TcDerivUtils.html#NonDerivableClass"><span class="hs-identifier">NonDerivableClass</span></a></a><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>    </span><span class="hs-comment">-- Non-stock class</span><span>
</span><a name="line-146"></a><span>
</span><a name="line-147"></a><span class="hs-comment">-- A stock class is one either defined in the Haskell report or for which GHC</span><span>
</span><a name="line-148"></a><span class="hs-comment">-- otherwise knows how to generate code for (possibly requiring the use of a</span><span>
</span><a name="line-149"></a><span class="hs-comment">-- language extension), such as Eq, Ord, Ix, Data, Generic, etc.</span><span>
</span><a name="line-150"></a><span>
</span><a name="line-151"></a><span class="hs-comment">-- | A 'PredType' annotated with the origin of the constraint 'CtOrigin',</span><span>
</span><a name="line-152"></a><span class="hs-comment">-- and whether or the constraint deals in types or kinds.</span><span>
</span><a name="line-153"></a><span class="hs-keyword">data</span><span> </span><a name="PredOrigin"><a href="TcDerivUtils.html#PredOrigin"><span class="hs-identifier">PredOrigin</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="PredOrigin"><a href="TcDerivUtils.html#PredOrigin"><span class="hs-identifier">PredOrigin</span></a></a><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><a href="TcRnTypes.html#TypeOrKind"><span class="hs-identifier hs-type">TypeOrKind</span></a><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span class="hs-comment">-- | A list of wanted 'PredOrigin' constraints ('to_wanted_origins') alongside</span><span>
</span><a name="line-156"></a><span class="hs-comment">-- any corresponding given constraints ('to_givens') and locally quantified</span><span>
</span><a name="line-157"></a><span class="hs-comment">-- type variables ('to_tvs').</span><span>
</span><a name="line-158"></a><span class="hs-comment">--</span><span>
</span><a name="line-159"></a><span class="hs-comment">-- In most cases, 'to_givens' will be empty, as most deriving mechanisms (e.g.,</span><span>
</span><a name="line-160"></a><span class="hs-comment">-- stock and newtype deriving) do not require given constraints. The exception</span><span>
</span><a name="line-161"></a><span class="hs-comment">-- is @DeriveAnyClass@, which can involve given constraints. For example,</span><span>
</span><a name="line-162"></a><span class="hs-comment">-- if you tried to derive an instance for the following class using</span><span>
</span><a name="line-163"></a><span class="hs-comment">-- @DeriveAnyClass@:</span><span>
</span><a name="line-164"></a><span class="hs-comment">--</span><span>
</span><a name="line-165"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-166"></a><span class="hs-comment">-- class Foo a where</span><span>
</span><a name="line-167"></a><span class="hs-comment">--   bar :: a -&gt; b -&gt; String</span><span>
</span><a name="line-168"></a><span class="hs-comment">--   default bar :: (Show a, Ix b) =&gt; a -&gt; b -&gt; String</span><span>
</span><a name="line-169"></a><span class="hs-comment">--   bar = show</span><span>
</span><a name="line-170"></a><span class="hs-comment">--</span><span>
</span><a name="line-171"></a><span class="hs-comment">--   baz :: Eq a =&gt; a -&gt; a -&gt; Bool</span><span>
</span><a name="line-172"></a><span class="hs-comment">--   default baz :: Ord a =&gt; a -&gt; a -&gt; Bool</span><span>
</span><a name="line-173"></a><span class="hs-comment">--   baz x y = compare x y == EQ</span><span>
</span><a name="line-174"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-175"></a><span class="hs-comment">--</span><span>
</span><a name="line-176"></a><span class="hs-comment">-- Then it would generate two 'ThetaOrigin's, one for each method:</span><span>
</span><a name="line-177"></a><span class="hs-comment">--</span><span>
</span><a name="line-178"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-179"></a><span class="hs-comment">-- [ ThetaOrigin { to_tvs            = [b]</span><span>
</span><a name="line-180"></a><span class="hs-comment">--               , to_givens         = []</span><span>
</span><a name="line-181"></a><span class="hs-comment">--               , to_wanted_origins = [Show a, Ix b] }</span><span>
</span><a name="line-182"></a><span class="hs-comment">-- , ThetaOrigin { to_tvs            = []</span><span>
</span><a name="line-183"></a><span class="hs-comment">--               , to_givens         = [Eq a]</span><span>
</span><a name="line-184"></a><span class="hs-comment">--               , to_wanted_origins = [Ord a] }</span><span>
</span><a name="line-185"></a><span class="hs-comment">-- ]</span><span>
</span><a name="line-186"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-187"></a><span class="hs-keyword">data</span><span> </span><a name="ThetaOrigin"><a href="TcDerivUtils.html#ThetaOrigin"><span class="hs-identifier">ThetaOrigin</span></a></a><span>
</span><a name="line-188"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="ThetaOrigin"><a href="TcDerivUtils.html#ThetaOrigin"><span class="hs-identifier">ThetaOrigin</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="to_tvs"><a href="TcDerivUtils.html#to_tvs"><span class="hs-identifier">to_tvs</span></a></a><span>            </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-189"></a><span>                </span><span class="hs-special">,</span><span> </span><a name="to_givens"><a href="TcDerivUtils.html#to_givens"><span class="hs-identifier">to_givens</span></a></a><span>         </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span>
</span><a name="line-190"></a><span>                </span><span class="hs-special">,</span><span> </span><a name="to_wanted_origins"><a href="TcDerivUtils.html#to_wanted_origins"><span class="hs-identifier">to_wanted_origins</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcDerivUtils.html#PredOrigin"><span class="hs-identifier hs-type">PredOrigin</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcDerivUtils.html#PredOrigin"><span class="hs-identifier hs-type">PredOrigin</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-193"></a><span>  </span><a name="local-8214565720323871022"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#PredOrigin"><span class="hs-identifier hs-var">PredOrigin</span></a><span> </span><a name="local-6989586621679896365"><a href="#local-6989586621679896365"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679896365"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-comment">-- The origin is not so interesting when debugging</span><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcDerivUtils.html#ThetaOrigin"><span class="hs-identifier hs-type">ThetaOrigin</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-196"></a><span>  </span><a name="local-8214565720323871022"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#ThetaOrigin"><span class="hs-identifier hs-var">ThetaOrigin</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">to_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679896362"><a href="#local-6989586621679896362"><span class="hs-identifier">tvs</span></a></a><span>
</span><a name="line-197"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">to_givens</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679896363"><a href="#local-6989586621679896363"><span class="hs-identifier">givens</span></a></a><span>
</span><a name="line-198"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">to_wanted_origins</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679896364"><a href="#local-6989586621679896364"><span class="hs-identifier">wanted_origins</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-199"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;ThetaOrigin&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-200"></a><span>         </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;to_tvs            =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679896362"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-201"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;to_givens         =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679896363"><span class="hs-identifier hs-var">givens</span></a><span>
</span><a name="line-202"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;to_wanted_origins =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679896364"><span class="hs-identifier hs-var">wanted_origins</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-203"></a><span>
</span><a name="line-204"></a><span class="hs-identifier">mkPredOrigin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TypeOrKind"><span class="hs-identifier hs-type">TypeOrKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcDerivUtils.html#PredOrigin"><span class="hs-identifier hs-type">PredOrigin</span></a><span>
</span><a name="line-205"></a><a name="mkPredOrigin"><a href="TcDerivUtils.html#mkPredOrigin"><span class="hs-identifier">mkPredOrigin</span></a></a><span> </span><a name="local-6989586621679896377"><a href="#local-6989586621679896377"><span class="hs-identifier">origin</span></a></a><span> </span><a name="local-6989586621679896378"><a href="#local-6989586621679896378"><span class="hs-identifier">t_or_k</span></a></a><span> </span><a name="local-6989586621679896379"><a href="#local-6989586621679896379"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcDerivUtils.html#PredOrigin"><span class="hs-identifier hs-var">PredOrigin</span></a><span> </span><a href="#local-6989586621679896379"><span class="hs-identifier hs-var">pred</span></a><span> </span><a href="#local-6989586621679896377"><span class="hs-identifier hs-var">origin</span></a><span> </span><a href="#local-6989586621679896378"><span class="hs-identifier hs-var">t_or_k</span></a><span>
</span><a name="line-206"></a><span>
</span><a name="line-207"></a><span class="hs-identifier">mkThetaOrigin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TypeOrKind"><span class="hs-identifier hs-type">TypeOrKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span>
</span><a name="line-208"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcDerivUtils.html#ThetaOrigin"><span class="hs-identifier hs-type">ThetaOrigin</span></a><span>
</span><a name="line-209"></a><a name="mkThetaOrigin"><a href="TcDerivUtils.html#mkThetaOrigin"><span class="hs-identifier">mkThetaOrigin</span></a></a><span> </span><a name="local-6989586621679896380"><a href="#local-6989586621679896380"><span class="hs-identifier">origin</span></a></a><span> </span><a name="local-6989586621679896381"><a href="#local-6989586621679896381"><span class="hs-identifier">t_or_k</span></a></a><span> </span><a name="local-6989586621679896382"><a href="#local-6989586621679896382"><span class="hs-identifier">tvs</span></a></a><span> </span><a name="local-6989586621679896383"><a href="#local-6989586621679896383"><span class="hs-identifier">givens</span></a></a><span>
</span><a name="line-210"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcDerivUtils.html#ThetaOrigin"><span class="hs-identifier hs-var">ThetaOrigin</span></a><span> </span><a href="#local-6989586621679896382"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-6989586621679896383"><span class="hs-identifier hs-var">givens</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#mkPredOrigin"><span class="hs-identifier hs-var">mkPredOrigin</span></a><span> </span><a href="#local-6989586621679896380"><span class="hs-identifier hs-var">origin</span></a><span> </span><a href="#local-6989586621679896381"><span class="hs-identifier hs-var">t_or_k</span></a><span class="hs-special">)</span><span>
</span><a name="line-211"></a><span>
</span><a name="line-212"></a><span class="hs-comment">-- A common case where the ThetaOrigin only contains wanted constraints, with</span><span>
</span><a name="line-213"></a><span class="hs-comment">-- no givens or locally scoped type variables.</span><span>
</span><a name="line-214"></a><span class="hs-identifier">mkThetaOriginFromPreds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcDerivUtils.html#PredOrigin"><span class="hs-identifier hs-type">PredOrigin</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcDerivUtils.html#ThetaOrigin"><span class="hs-identifier hs-type">ThetaOrigin</span></a><span>
</span><a name="line-215"></a><a name="mkThetaOriginFromPreds"><a href="TcDerivUtils.html#mkThetaOriginFromPreds"><span class="hs-identifier">mkThetaOriginFromPreds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcDerivUtils.html#ThetaOrigin"><span class="hs-identifier hs-var">ThetaOrigin</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-216"></a><span>
</span><a name="line-217"></a><span class="hs-identifier">substPredOrigin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcDerivUtils.html#PredOrigin"><span class="hs-identifier hs-type">PredOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcDerivUtils.html#PredOrigin"><span class="hs-identifier hs-type">PredOrigin</span></a><span>
</span><a name="line-218"></a><a name="substPredOrigin"><a href="TcDerivUtils.html#substPredOrigin"><span class="hs-identifier">substPredOrigin</span></a></a><span> </span><a name="local-6989586621679896384"><a href="#local-6989586621679896384"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#PredOrigin"><span class="hs-identifier hs-var">PredOrigin</span></a><span> </span><a name="local-6989586621679896385"><a href="#local-6989586621679896385"><span class="hs-identifier">pred</span></a></a><span> </span><a name="local-6989586621679896386"><a href="#local-6989586621679896386"><span class="hs-identifier">origin</span></a></a><span> </span><a name="local-6989586621679896387"><a href="#local-6989586621679896387"><span class="hs-identifier">t_or_k</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-219"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcDerivUtils.html#PredOrigin"><span class="hs-identifier hs-var">PredOrigin</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><a href="#local-6989586621679896384"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679896385"><span class="hs-identifier hs-var">pred</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679896386"><span class="hs-identifier hs-var">origin</span></a><span> </span><a href="#local-6989586621679896387"><span class="hs-identifier hs-var">t_or_k</span></a><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Class deriving diagnostics
*                                                                      *
************************************************************************

Only certain blessed classes can be used in a deriving clause (without the
assistance of GeneralizedNewtypeDeriving or DeriveAnyClass). These classes
are listed below in the definition of hasStockDeriving. The sideConditions
function determines the criteria that needs to be met in order for a particular
class to be able to be derived successfully.

A class might be able to be used in a deriving clause if -XDeriveAnyClass
is willing to support it. The canDeriveAnyClass function checks if this is the
case.
-}</span><span>
</span><a name="line-238"></a><span>
</span><a name="line-239"></a><span class="hs-identifier">hasStockDeriving</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span>
</span><a name="line-240"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span>
</span><a name="line-241"></a><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>
</span><a name="line-242"></a><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>
</span><a name="line-243"></a><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#BagDerivStuff"><span class="hs-identifier hs-type">BagDerivStuff</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-244"></a><a name="hasStockDeriving"><a href="TcDerivUtils.html#hasStockDeriving"><span class="hs-identifier">hasStockDeriving</span></a></a><span> </span><a name="local-6989586621679896388"><a href="#local-6989586621679896388"><span class="hs-identifier">clas</span></a></a><span>
</span><a name="line-245"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="ListSetOps.html#assocMaybe"><span class="hs-identifier hs-var">assocMaybe</span></a><span> </span><a href="#local-6989586621679896389"><span class="hs-identifier hs-var">gen_list</span></a><span> </span><span class="hs-special">(</span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-6989586621679896388"><span class="hs-identifier hs-var">clas</span></a><span class="hs-special">)</span><span>
</span><a name="line-246"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-247"></a><span>    </span><span class="hs-identifier">gen_list</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span>
</span><a name="line-248"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>
</span><a name="line-249"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>
</span><a name="line-250"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#BagDerivStuff"><span class="hs-identifier hs-type">BagDerivStuff</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-251"></a><span>    </span><a name="local-6989586621679896389"><a href="#local-6989586621679896389"><span class="hs-identifier">gen_list</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="PrelNames.html#eqClassKey"><span class="hs-identifier hs-var">eqClassKey</span></a><span class="hs-special">,</span><span>          </span><a href="#local-6989586621679896391"><span class="hs-identifier hs-var">simpleM</span></a><span> </span><a href="TcGenDeriv.html#gen_Eq_binds"><span class="hs-identifier hs-var">gen_Eq_binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-252"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="PrelNames.html#ordClassKey"><span class="hs-identifier hs-var">ordClassKey</span></a><span class="hs-special">,</span><span>         </span><a href="#local-6989586621679896391"><span class="hs-identifier hs-var">simpleM</span></a><span> </span><a href="TcGenDeriv.html#gen_Ord_binds"><span class="hs-identifier hs-var">gen_Ord_binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-253"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="PrelNames.html#enumClassKey"><span class="hs-identifier hs-var">enumClassKey</span></a><span class="hs-special">,</span><span>        </span><a href="#local-6989586621679896391"><span class="hs-identifier hs-var">simpleM</span></a><span> </span><a href="TcGenDeriv.html#gen_Enum_binds"><span class="hs-identifier hs-var">gen_Enum_binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-254"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="PrelNames.html#boundedClassKey"><span class="hs-identifier hs-var">boundedClassKey</span></a><span class="hs-special">,</span><span>     </span><a href="#local-6989586621679896390"><span class="hs-identifier hs-var">simple</span></a><span> </span><a href="TcGenDeriv.html#gen_Bounded_binds"><span class="hs-identifier hs-var">gen_Bounded_binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-255"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="PrelNames.html#ixClassKey"><span class="hs-identifier hs-var">ixClassKey</span></a><span class="hs-special">,</span><span>          </span><a href="#local-6989586621679896391"><span class="hs-identifier hs-var">simpleM</span></a><span> </span><a href="TcGenDeriv.html#gen_Ix_binds"><span class="hs-identifier hs-var">gen_Ix_binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-256"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="PrelNames.html#showClassKey"><span class="hs-identifier hs-var">showClassKey</span></a><span class="hs-special">,</span><span>        </span><a href="#local-6989586621679896392"><span class="hs-identifier hs-var">with_fix_env</span></a><span> </span><a href="TcGenDeriv.html#gen_Show_binds"><span class="hs-identifier hs-var">gen_Show_binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-257"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="PrelNames.html#readClassKey"><span class="hs-identifier hs-var">readClassKey</span></a><span class="hs-special">,</span><span>        </span><a href="#local-6989586621679896392"><span class="hs-identifier hs-var">with_fix_env</span></a><span> </span><a href="TcGenDeriv.html#gen_Read_binds"><span class="hs-identifier hs-var">gen_Read_binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-258"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="PrelNames.html#dataClassKey"><span class="hs-identifier hs-var">dataClassKey</span></a><span class="hs-special">,</span><span>        </span><a href="#local-6989586621679896391"><span class="hs-identifier hs-var">simpleM</span></a><span> </span><a href="TcGenDeriv.html#gen_Data_binds"><span class="hs-identifier hs-var">gen_Data_binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-259"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="PrelNames.html#functorClassKey"><span class="hs-identifier hs-var">functorClassKey</span></a><span class="hs-special">,</span><span>     </span><a href="#local-6989586621679896390"><span class="hs-identifier hs-var">simple</span></a><span> </span><a href="TcGenFunctor.html#gen_Functor_binds"><span class="hs-identifier hs-var">gen_Functor_binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-260"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="PrelNames.html#foldableClassKey"><span class="hs-identifier hs-var">foldableClassKey</span></a><span class="hs-special">,</span><span>    </span><a href="#local-6989586621679896390"><span class="hs-identifier hs-var">simple</span></a><span> </span><a href="TcGenFunctor.html#gen_Foldable_binds"><span class="hs-identifier hs-var">gen_Foldable_binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-261"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="PrelNames.html#traversableClassKey"><span class="hs-identifier hs-var">traversableClassKey</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679896390"><span class="hs-identifier hs-var">simple</span></a><span> </span><a href="TcGenFunctor.html#gen_Traversable_binds"><span class="hs-identifier hs-var">gen_Traversable_binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-262"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="THNames.html#liftClassKey"><span class="hs-identifier hs-var">liftClassKey</span></a><span class="hs-special">,</span><span>        </span><a href="#local-6989586621679896390"><span class="hs-identifier hs-var">simple</span></a><span> </span><a href="TcGenDeriv.html#gen_Lift_binds"><span class="hs-identifier hs-var">gen_Lift_binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-263"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="PrelNames.html#genClassKey"><span class="hs-identifier hs-var">genClassKey</span></a><span class="hs-special">,</span><span>         </span><a href="#local-6989586621679896393"><span class="hs-identifier hs-var">generic</span></a><span> </span><span class="hs-special">(</span><a href="TcGenGenerics.html#gen_Generic_binds"><span class="hs-identifier hs-var">gen_Generic_binds</span></a><span> </span><a href="TcGenGenerics.html#Gen0"><span class="hs-identifier hs-var">Gen0</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-264"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="PrelNames.html#gen1ClassKey"><span class="hs-identifier hs-var">gen1ClassKey</span></a><span class="hs-special">,</span><span>        </span><a href="#local-6989586621679896393"><span class="hs-identifier hs-var">generic</span></a><span> </span><span class="hs-special">(</span><a href="TcGenGenerics.html#gen_Generic_binds"><span class="hs-identifier hs-var">gen_Generic_binds</span></a><span> </span><a href="TcGenGenerics.html#Gen1"><span class="hs-identifier hs-var">Gen1</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-265"></a><span>
</span><a name="line-266"></a><span>    </span><a name="local-6989586621679896390"><a href="#local-6989586621679896390"><span class="hs-identifier">simple</span></a></a><span> </span><a name="local-6989586621679896394"><a href="#local-6989586621679896394"><span class="hs-identifier">gen_fn</span></a></a><span> </span><a name="local-6989586621679896395"><a href="#local-6989586621679896395"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621679896396"><a href="#local-6989586621679896396"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-267"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679896394"><span class="hs-identifier hs-var">gen_fn</span></a><span> </span><a href="#local-6989586621679896395"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621679896396"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-268"></a><span>
</span><a name="line-269"></a><span>    </span><a name="local-6989586621679896391"><a href="#local-6989586621679896391"><span class="hs-identifier">simpleM</span></a></a><span> </span><a name="local-6989586621679896397"><a href="#local-6989586621679896397"><span class="hs-identifier">gen_fn</span></a></a><span> </span><a name="local-6989586621679896398"><a href="#local-6989586621679896398"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621679896399"><a href="#local-6989586621679896399"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-270"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679896397"><span class="hs-identifier hs-var">gen_fn</span></a><span> </span><a href="#local-6989586621679896398"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621679896399"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-271"></a><span>
</span><a name="line-272"></a><span>    </span><a name="local-6989586621679896392"><a href="#local-6989586621679896392"><span class="hs-identifier">with_fix_env</span></a></a><span> </span><a name="local-6989586621679896400"><a href="#local-6989586621679896400"><span class="hs-identifier">gen_fn</span></a></a><span> </span><a name="local-6989586621679896401"><a href="#local-6989586621679896401"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621679896402"><a href="#local-6989586621679896402"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-273"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679896403"><a href="#local-6989586621679896403"><span class="hs-identifier">fix_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcDerivUtils.html#getDataConFixityFun"><span class="hs-identifier hs-var">getDataConFixityFun</span></a><span> </span><a href="#local-6989586621679896402"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-274"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679896400"><span class="hs-identifier hs-var">gen_fn</span></a><span> </span><a href="#local-6989586621679896403"><span class="hs-identifier hs-var">fix_env</span></a><span> </span><a href="#local-6989586621679896401"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621679896402"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-275"></a><span>
</span><a name="line-276"></a><span>    </span><a name="local-6989586621679896393"><a href="#local-6989586621679896393"><span class="hs-identifier">generic</span></a></a><span> </span><a name="local-6989586621679896404"><a href="#local-6989586621679896404"><span class="hs-identifier">gen_fn</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679896405"><a href="#local-6989586621679896405"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679896406"><a href="#local-6989586621679896406"><span class="hs-identifier">inst_tys</span></a></a><span>
</span><a name="line-277"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679896407"><a href="#local-6989586621679896407"><span class="hs-identifier">binds</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679896408"><a href="#local-6989586621679896408"><span class="hs-identifier">faminst</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679896404"><span class="hs-identifier hs-var">gen_fn</span></a><span> </span><a href="#local-6989586621679896405"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621679896406"><span class="hs-identifier hs-var">inst_tys</span></a><span>
</span><a name="line-278"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679896407"><span class="hs-identifier hs-var">binds</span></a><span class="hs-special">,</span><span> </span><a href="Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#DerivFamInst"><span class="hs-identifier hs-var">DerivFamInst</span></a><span> </span><a href="#local-6989586621679896408"><span class="hs-identifier hs-var">faminst</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-279"></a><span>
</span><a name="line-280"></a><span class="hs-identifier">getDataConFixityFun</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#Fixity"><span class="hs-identifier hs-type">Fixity</span></a><span class="hs-special">)</span><span>
</span><a name="line-281"></a><span class="hs-comment">-- If the TyCon is locally defined, we want the local fixity env;</span><span>
</span><a name="line-282"></a><span class="hs-comment">-- but if it is imported (which happens for standalone deriving)</span><span>
</span><a name="line-283"></a><span class="hs-comment">-- we need to get the fixity env from the interface file</span><span>
</span><a name="line-284"></a><span class="hs-comment">-- c.f. RnEnv.lookupFixity, and Trac #9830</span><span>
</span><a name="line-285"></a><a name="getDataConFixityFun"><a href="TcDerivUtils.html#getDataConFixityFun"><span class="hs-identifier">getDataConFixityFun</span></a></a><span> </span><a name="local-6989586621679896409"><a href="#local-6989586621679896409"><span class="hs-identifier">tc</span></a></a><span>
</span><a name="line-286"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679896412"><a href="#local-6989586621679896412"><span class="hs-identifier">this_mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a><span>
</span><a name="line-287"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Name.html#nameIsLocalOrFrom"><span class="hs-identifier hs-var">nameIsLocalOrFrom</span></a><span> </span><a href="#local-6989586621679896412"><span class="hs-identifier hs-var">this_mod</span></a><span> </span><a href="#local-6989586621679896410"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-288"></a><span>         </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679896413"><a href="#local-6989586621679896413"><span class="hs-identifier">fix_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getFixityEnv"><span class="hs-identifier hs-var">getFixityEnv</span></a><span>
</span><a name="line-289"></a><span>                 </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#lookupFixity"><span class="hs-identifier hs-var">lookupFixity</span></a><span> </span><a href="#local-6989586621679896413"><span class="hs-identifier hs-var">fix_env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-290"></a><span>         </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679896414"><a href="#local-6989586621679896414"><span class="hs-identifier">iface</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LoadIface.html#loadInterfaceForName"><span class="hs-identifier hs-var">loadInterfaceForName</span></a><span> </span><a href="#local-6989586621679896411"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621679896410"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-291"></a><span>                            </span><span class="hs-comment">-- Should already be loaded!</span><span>
</span><a name="line-292"></a><span>                 </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#mi_fix"><span class="hs-identifier hs-var">mi_fix</span></a><span> </span><a href="#local-6989586621679896414"><span class="hs-identifier hs-var">iface</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-293"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-294"></a><span>    </span><a name="local-6989586621679896410"><a href="#local-6989586621679896410"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyConName</span><span> </span><a href="#local-6989586621679896409"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-295"></a><span>    </span><a name="local-6989586621679896411"><a href="#local-6989586621679896411"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Data con fixities for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679896410"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-296"></a><span>
</span><a name="line-297"></a><span class="hs-comment">------------------------------------------------------------------</span><span>
</span><a name="line-298"></a><span class="hs-comment">-- Check side conditions that dis-allow derivability for particular classes</span><span>
</span><a name="line-299"></a><span class="hs-comment">-- This is *apart* from the newtype-deriving mechanism</span><span>
</span><a name="line-300"></a><span class="hs-comment">--</span><span>
</span><a name="line-301"></a><span class="hs-comment">-- Here we get the representation tycon in case of family instances as it has</span><span>
</span><a name="line-302"></a><span class="hs-comment">-- the data constructors - but we need to be careful to fall back to the</span><span>
</span><a name="line-303"></a><span class="hs-comment">-- family tycon (with indexes) in error messages.</span><span>
</span><a name="line-304"></a><span>
</span><a name="line-305"></a><span class="hs-identifier">checkSideConditions</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcDerivUtils.html#DerivContext"><span class="hs-identifier hs-type">DerivContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span>
</span><a name="line-306"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-comment">-- tycon</span><span>
</span><a name="line-307"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcDerivUtils.html#DerivStatus"><span class="hs-identifier hs-type">DerivStatus</span></a><span>
</span><a name="line-308"></a><a name="checkSideConditions"><a href="TcDerivUtils.html#checkSideConditions"><span class="hs-identifier">checkSideConditions</span></a></a><span> </span><a name="local-6989586621679896415"><a href="#local-6989586621679896415"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679896416"><a href="#local-6989586621679896416"><span class="hs-identifier">mtheta</span></a></a><span> </span><a name="local-6989586621679896417"><a href="#local-6989586621679896417"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-6989586621679896418"><a href="#local-6989586621679896418"><span class="hs-identifier">cls_tys</span></a></a><span> </span><a name="local-6989586621679896419"><a href="#local-6989586621679896419"><span class="hs-identifier">rep_tc</span></a></a><span>
</span><a name="line-309"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679896420"><a href="#local-6989586621679896420"><span class="hs-identifier">cond</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcDerivUtils.html#sideConditions"><span class="hs-identifier hs-var">sideConditions</span></a><span> </span><a href="#local-6989586621679896416"><span class="hs-identifier hs-var">mtheta</span></a><span> </span><a href="#local-6989586621679896417"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-310"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679896420"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621679896415"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679896419"><span class="hs-identifier hs-var">rep_tc</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-311"></a><span>        </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><a name="local-6989586621679896421"><a href="#local-6989586621679896421"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcDerivUtils.html#DerivableClassError"><span class="hs-identifier hs-var">DerivableClassError</span></a><span> </span><a href="#local-6989586621679896421"><span class="hs-identifier hs-var">err</span></a><span>  </span><span class="hs-comment">-- Class-specific error</span><span>
</span><a name="line-312"></a><span>        </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#filterOutInvisibleTypes"><span class="hs-identifier hs-var">filterOutInvisibleTypes</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">classTyCon</span><span> </span><a href="#local-6989586621679896417"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679896418"><span class="hs-identifier hs-var">cls_tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-313"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcDerivUtils.html#CanDerive"><span class="hs-identifier hs-var">CanDerive</span></a><span>
</span><a name="line-314"></a><span>                   </span><span class="hs-comment">-- All stock derivable classes are unary in the sense that</span><span>
</span><a name="line-315"></a><span>                   </span><span class="hs-comment">-- there should be not types in cls_tys (i.e., no type args</span><span>
</span><a name="line-316"></a><span>                   </span><span class="hs-comment">-- other than last). Note that cls_types can contain</span><span>
</span><a name="line-317"></a><span>                   </span><span class="hs-comment">-- invisible types as well (e.g., for Generic1, which is</span><span>
</span><a name="line-318"></a><span>                   </span><span class="hs-comment">-- poly-kinded), so make sure those are not counted.</span><span>
</span><a name="line-319"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcDerivUtils.html#DerivableClassError"><span class="hs-identifier hs-var">DerivableClassError</span></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#classArgsErr"><span class="hs-identifier hs-var">classArgsErr</span></a><span> </span><a href="#local-6989586621679896417"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-6989586621679896418"><span class="hs-identifier hs-var">cls_tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-320"></a><span>                   </span><span class="hs-comment">-- e.g. deriving( Eq s )</span><span>
</span><a name="line-321"></a><span>
</span><a name="line-322"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><a name="local-6989586621679896422"><a href="#local-6989586621679896422"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcDerivUtils.html#canDeriveAnyClass"><span class="hs-identifier hs-var">canDeriveAnyClass</span></a><span> </span><a href="#local-6989586621679896415"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-323"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcDerivUtils.html#NonDerivableClass"><span class="hs-identifier hs-var">NonDerivableClass</span></a><span> </span><a href="#local-6989586621679896422"><span class="hs-identifier hs-var">err</span></a><span>  </span><span class="hs-comment">-- DeriveAnyClass does not work</span><span>
</span><a name="line-324"></a><span>
</span><a name="line-325"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-326"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcDerivUtils.html#DerivableViaInstance"><span class="hs-identifier hs-var">DerivableViaInstance</span></a><span>   </span><span class="hs-comment">-- DeriveAnyClass should work</span><span>
</span><a name="line-327"></a><span>
</span><a name="line-328"></a><span class="hs-identifier">classArgsErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-329"></a><a name="classArgsErr"><a href="TcDerivUtils.html#classArgsErr"><span class="hs-identifier">classArgsErr</span></a></a><span> </span><a name="local-6989586621679896423"><a href="#local-6989586621679896423"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-6989586621679896424"><a href="#local-6989586621679896424"><span class="hs-identifier">cls_tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a><span> </span><a href="#local-6989586621679896423"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-6989586621679896424"><span class="hs-identifier hs-var">cls_tys</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;is not a class&quot;</span><span>
</span><a name="line-330"></a><span>
</span><a name="line-331"></a><span class="hs-comment">-- Side conditions (whether the datatype must have at least one constructor,</span><span>
</span><a name="line-332"></a><span class="hs-comment">-- required language extensions, etc.) for using GHC's stock deriving</span><span>
</span><a name="line-333"></a><span class="hs-comment">-- mechanism on certain classes (as opposed to classes that require</span><span>
</span><a name="line-334"></a><span class="hs-comment">-- GeneralizedNewtypeDeriving or DeriveAnyClass). Returns Nothing for a</span><span>
</span><a name="line-335"></a><span class="hs-comment">-- class for which stock deriving isn't possible.</span><span>
</span><a name="line-336"></a><span class="hs-identifier">sideConditions</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcDerivUtils.html#DerivContext"><span class="hs-identifier hs-type">DerivContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcDerivUtils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a><span>
</span><a name="line-337"></a><a name="sideConditions"><a href="TcDerivUtils.html#sideConditions"><span class="hs-identifier">sideConditions</span></a></a><span> </span><a name="local-6989586621679896425"><a href="#local-6989586621679896425"><span class="hs-identifier">mtheta</span></a></a><span> </span><a name="local-6989586621679896426"><a href="#local-6989586621679896426"><span class="hs-identifier">cls</span></a></a><span>
</span><a name="line-338"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679896427"><span class="hs-identifier hs-var">cls_key</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#eqClassKey"><span class="hs-identifier hs-var">eqClassKey</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679896428"><span class="hs-identifier hs-var">cond_std</span></a><span> </span><span class="hs-special">`</span><a href="TcDerivUtils.html#andCond"><span class="hs-identifier hs-var">andCond</span></a><span class="hs-special">`</span><span> </span><a href="TcDerivUtils.html#cond_args"><span class="hs-identifier hs-var">cond_args</span></a><span> </span><a href="#local-6989586621679896426"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span>
</span><a name="line-339"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679896427"><span class="hs-identifier hs-var">cls_key</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#ordClassKey"><span class="hs-identifier hs-var">ordClassKey</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679896428"><span class="hs-identifier hs-var">cond_std</span></a><span> </span><span class="hs-special">`</span><a href="TcDerivUtils.html#andCond"><span class="hs-identifier hs-var">andCond</span></a><span class="hs-special">`</span><span> </span><a href="TcDerivUtils.html#cond_args"><span class="hs-identifier hs-var">cond_args</span></a><span> </span><a href="#local-6989586621679896426"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span>
</span><a name="line-340"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679896427"><span class="hs-identifier hs-var">cls_key</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#showClassKey"><span class="hs-identifier hs-var">showClassKey</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679896428"><span class="hs-identifier hs-var">cond_std</span></a><span> </span><span class="hs-special">`</span><a href="TcDerivUtils.html#andCond"><span class="hs-identifier hs-var">andCond</span></a><span class="hs-special">`</span><span> </span><a href="TcDerivUtils.html#cond_args"><span class="hs-identifier hs-var">cond_args</span></a><span> </span><a href="#local-6989586621679896426"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span>
</span><a name="line-341"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679896427"><span class="hs-identifier hs-var">cls_key</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#readClassKey"><span class="hs-identifier hs-var">readClassKey</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679896428"><span class="hs-identifier hs-var">cond_std</span></a><span> </span><span class="hs-special">`</span><a href="TcDerivUtils.html#andCond"><span class="hs-identifier hs-var">andCond</span></a><span class="hs-special">`</span><span> </span><a href="TcDerivUtils.html#cond_args"><span class="hs-identifier hs-var">cond_args</span></a><span> </span><a href="#local-6989586621679896426"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span>
</span><a name="line-342"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679896427"><span class="hs-identifier hs-var">cls_key</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#enumClassKey"><span class="hs-identifier hs-var">enumClassKey</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679896428"><span class="hs-identifier hs-var">cond_std</span></a><span> </span><span class="hs-special">`</span><a href="TcDerivUtils.html#andCond"><span class="hs-identifier hs-var">andCond</span></a><span class="hs-special">`</span><span> </span><a href="TcDerivUtils.html#cond_isEnumeration"><span class="hs-identifier hs-var">cond_isEnumeration</span></a><span class="hs-special">)</span><span>
</span><a name="line-343"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679896427"><span class="hs-identifier hs-var">cls_key</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#ixClassKey"><span class="hs-identifier hs-var">ixClassKey</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679896428"><span class="hs-identifier hs-var">cond_std</span></a><span> </span><span class="hs-special">`</span><a href="TcDerivUtils.html#andCond"><span class="hs-identifier hs-var">andCond</span></a><span class="hs-special">`</span><span> </span><a href="TcDerivUtils.html#cond_enumOrProduct"><span class="hs-identifier hs-var">cond_enumOrProduct</span></a><span> </span><a href="#local-6989586621679896426"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span>
</span><a name="line-344"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679896427"><span class="hs-identifier hs-var">cls_key</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#boundedClassKey"><span class="hs-identifier hs-var">boundedClassKey</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679896428"><span class="hs-identifier hs-var">cond_std</span></a><span> </span><span class="hs-special">`</span><a href="TcDerivUtils.html#andCond"><span class="hs-identifier hs-var">andCond</span></a><span class="hs-special">`</span><span> </span><a href="TcDerivUtils.html#cond_enumOrProduct"><span class="hs-identifier hs-var">cond_enumOrProduct</span></a><span> </span><a href="#local-6989586621679896426"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span>
</span><a name="line-345"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679896427"><span class="hs-identifier hs-var">cls_key</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#dataClassKey"><span class="hs-identifier hs-var">dataClassKey</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#checkFlag"><span class="hs-identifier hs-var">checkFlag</span></a><span> </span><a href="../ghc-boot-th-8.3/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#DeriveDataTypeable"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">DeriveDataTypeable</span></a><span> </span><span class="hs-special">`</span><a href="TcDerivUtils.html#andCond"><span class="hs-identifier hs-var">andCond</span></a><span class="hs-special">`</span><span>
</span><a name="line-346"></a><span>                                           </span><a href="#local-6989586621679896428"><span class="hs-identifier hs-var">cond_std</span></a><span> </span><span class="hs-special">`</span><a href="TcDerivUtils.html#andCond"><span class="hs-identifier hs-var">andCond</span></a><span class="hs-special">`</span><span>
</span><a name="line-347"></a><span>                                           </span><a href="TcDerivUtils.html#cond_args"><span class="hs-identifier hs-var">cond_args</span></a><span> </span><a href="#local-6989586621679896426"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span>
</span><a name="line-348"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679896427"><span class="hs-identifier hs-var">cls_key</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#functorClassKey"><span class="hs-identifier hs-var">functorClassKey</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#checkFlag"><span class="hs-identifier hs-var">checkFlag</span></a><span> </span><a href="../ghc-boot-th-8.3/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#DeriveFunctor"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">DeriveFunctor</span></a><span> </span><span class="hs-special">`</span><a href="TcDerivUtils.html#andCond"><span class="hs-identifier hs-var">andCond</span></a><span class="hs-special">`</span><span>
</span><a name="line-349"></a><span>                                           </span><a href="#local-6989586621679896429"><span class="hs-identifier hs-var">cond_vanilla</span></a><span> </span><span class="hs-special">`</span><a href="TcDerivUtils.html#andCond"><span class="hs-identifier hs-var">andCond</span></a><span class="hs-special">`</span><span>
</span><a name="line-350"></a><span>                                           </span><a href="TcDerivUtils.html#cond_functorOK"><span class="hs-identifier hs-var">cond_functorOK</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-351"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679896427"><span class="hs-identifier hs-var">cls_key</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#foldableClassKey"><span class="hs-identifier hs-var">foldableClassKey</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#checkFlag"><span class="hs-identifier hs-var">checkFlag</span></a><span> </span><a href="../ghc-boot-th-8.3/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#DeriveFoldable"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">DeriveFoldable</span></a><span> </span><span class="hs-special">`</span><a href="TcDerivUtils.html#andCond"><span class="hs-identifier hs-var">andCond</span></a><span class="hs-special">`</span><span>
</span><a name="line-352"></a><span>                                           </span><a href="#local-6989586621679896429"><span class="hs-identifier hs-var">cond_vanilla</span></a><span> </span><span class="hs-special">`</span><a href="TcDerivUtils.html#andCond"><span class="hs-identifier hs-var">andCond</span></a><span class="hs-special">`</span><span>
</span><a name="line-353"></a><span>                                           </span><a href="TcDerivUtils.html#cond_functorOK"><span class="hs-identifier hs-var">cond_functorOK</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-354"></a><span>                                           </span><span class="hs-comment">-- Functor/Fold/Trav works ok</span><span>
</span><a name="line-355"></a><span>                                           </span><span class="hs-comment">-- for rank-n types</span><span>
</span><a name="line-356"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679896427"><span class="hs-identifier hs-var">cls_key</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#traversableClassKey"><span class="hs-identifier hs-var">traversableClassKey</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#checkFlag"><span class="hs-identifier hs-var">checkFlag</span></a><span> </span><a href="../ghc-boot-th-8.3/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#DeriveTraversable"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">DeriveTraversable</span></a><span> </span><span class="hs-special">`</span><a href="TcDerivUtils.html#andCond"><span class="hs-identifier hs-var">andCond</span></a><span class="hs-special">`</span><span>
</span><a name="line-357"></a><span>                                           </span><a href="#local-6989586621679896429"><span class="hs-identifier hs-var">cond_vanilla</span></a><span> </span><span class="hs-special">`</span><a href="TcDerivUtils.html#andCond"><span class="hs-identifier hs-var">andCond</span></a><span class="hs-special">`</span><span>
</span><a name="line-358"></a><span>                                           </span><a href="TcDerivUtils.html#cond_functorOK"><span class="hs-identifier hs-var">cond_functorOK</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-359"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679896427"><span class="hs-identifier hs-var">cls_key</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#genClassKey"><span class="hs-identifier hs-var">genClassKey</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#checkFlag"><span class="hs-identifier hs-var">checkFlag</span></a><span> </span><a href="../ghc-boot-th-8.3/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#DeriveGeneric"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">DeriveGeneric</span></a><span> </span><span class="hs-special">`</span><a href="TcDerivUtils.html#andCond"><span class="hs-identifier hs-var">andCond</span></a><span class="hs-special">`</span><span>
</span><a name="line-360"></a><span>                                           </span><a href="#local-6989586621679896429"><span class="hs-identifier hs-var">cond_vanilla</span></a><span> </span><span class="hs-special">`</span><a href="TcDerivUtils.html#andCond"><span class="hs-identifier hs-var">andCond</span></a><span class="hs-special">`</span><span>
</span><a name="line-361"></a><span>                                           </span><a href="TcDerivUtils.html#cond_RepresentableOk"><span class="hs-identifier hs-var">cond_RepresentableOk</span></a><span class="hs-special">)</span><span>
</span><a name="line-362"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679896427"><span class="hs-identifier hs-var">cls_key</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#gen1ClassKey"><span class="hs-identifier hs-var">gen1ClassKey</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#checkFlag"><span class="hs-identifier hs-var">checkFlag</span></a><span> </span><a href="../ghc-boot-th-8.3/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#DeriveGeneric"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">DeriveGeneric</span></a><span> </span><span class="hs-special">`</span><a href="TcDerivUtils.html#andCond"><span class="hs-identifier hs-var">andCond</span></a><span class="hs-special">`</span><span>
</span><a name="line-363"></a><span>                                           </span><a href="#local-6989586621679896429"><span class="hs-identifier hs-var">cond_vanilla</span></a><span> </span><span class="hs-special">`</span><a href="TcDerivUtils.html#andCond"><span class="hs-identifier hs-var">andCond</span></a><span class="hs-special">`</span><span>
</span><a name="line-364"></a><span>                                           </span><a href="TcDerivUtils.html#cond_Representable1Ok"><span class="hs-identifier hs-var">cond_Representable1Ok</span></a><span class="hs-special">)</span><span>
</span><a name="line-365"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679896427"><span class="hs-identifier hs-var">cls_key</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="THNames.html#liftClassKey"><span class="hs-identifier hs-var">liftClassKey</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#checkFlag"><span class="hs-identifier hs-var">checkFlag</span></a><span> </span><a href="../ghc-boot-th-8.3/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#DeriveLift"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">DeriveLift</span></a><span> </span><span class="hs-special">`</span><a href="TcDerivUtils.html#andCond"><span class="hs-identifier hs-var">andCond</span></a><span class="hs-special">`</span><span>
</span><a name="line-366"></a><span>                                           </span><a href="#local-6989586621679896429"><span class="hs-identifier hs-var">cond_vanilla</span></a><span> </span><span class="hs-special">`</span><a href="TcDerivUtils.html#andCond"><span class="hs-identifier hs-var">andCond</span></a><span class="hs-special">`</span><span>
</span><a name="line-367"></a><span>                                           </span><a href="TcDerivUtils.html#cond_args"><span class="hs-identifier hs-var">cond_args</span></a><span> </span><a href="#local-6989586621679896426"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span>
</span><a name="line-368"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-369"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-370"></a><span>    </span><a name="local-6989586621679896427"><a href="#local-6989586621679896427"><span class="hs-identifier">cls_key</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-6989586621679896426"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-371"></a><span>    </span><a name="local-6989586621679896428"><a href="#local-6989586621679896428"><span class="hs-identifier">cond_std</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TcDerivUtils.html#cond_stdOK"><span class="hs-identifier hs-var">cond_stdOK</span></a><span> </span><a href="#local-6989586621679896425"><span class="hs-identifier hs-var">mtheta</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>  </span><span class="hs-comment">-- Vanilla data constructors, at least one,</span><span>
</span><a name="line-372"></a><span>                                            </span><span class="hs-comment">--    and monotype arguments</span><span>
</span><a name="line-373"></a><span>    </span><a name="local-6989586621679896429"><a href="#local-6989586621679896429"><span class="hs-identifier">cond_vanilla</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcDerivUtils.html#cond_stdOK"><span class="hs-identifier hs-var">cond_stdOK</span></a><span> </span><a href="#local-6989586621679896425"><span class="hs-identifier hs-var">mtheta</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>   </span><span class="hs-comment">-- Vanilla data constructors but</span><span>
</span><a name="line-374"></a><span>                                            </span><span class="hs-comment">--   allow no data cons or polytype arguments</span><span>
</span><a name="line-375"></a><span>
</span><a name="line-376"></a><span class="hs-identifier">canDeriveAnyClass</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span>
</span><a name="line-377"></a><span class="hs-comment">-- IsValid: we can (try to) derive it via an empty instance declaration</span><span>
</span><a name="line-378"></a><span class="hs-comment">-- NotValid s:  we can't, reason s</span><span>
</span><a name="line-379"></a><a name="canDeriveAnyClass"><a href="TcDerivUtils.html#canDeriveAnyClass"><span class="hs-identifier">canDeriveAnyClass</span></a></a><span> </span><a name="local-6989586621679896430"><a href="#local-6989586621679896430"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-380"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a><span> </span><a href="../ghc-boot-th-8.3/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#DeriveAnyClass"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">DeriveAnyClass</span></a><span> </span><a href="#local-6989586621679896430"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-381"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Try enabling DeriveAnyClass&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-382"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-383"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>   </span><span class="hs-comment">-- OK!</span><span>
</span><a name="line-384"></a><span>
</span><a name="line-385"></a><span class="hs-keyword">type</span><span> </span><a name="Condition"><a href="TcDerivUtils.html#Condition"><span class="hs-identifier">Condition</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span>
</span><a name="line-386"></a><span>        </span><span class="hs-comment">-- TyCon is the *representation* tycon if the data type is an indexed one</span><span>
</span><a name="line-387"></a><span>        </span><span class="hs-comment">-- Nothing =&gt; OK</span><span>
</span><a name="line-388"></a><span>
</span><a name="line-389"></a><span class="hs-identifier">orCond</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcDerivUtils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcDerivUtils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcDerivUtils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a><span>
</span><a name="line-390"></a><a name="orCond"><a href="TcDerivUtils.html#orCond"><span class="hs-identifier">orCond</span></a></a><span> </span><a name="local-6989586621679896431"><a href="#local-6989586621679896431"><span class="hs-identifier">c1</span></a></a><span> </span><a name="local-6989586621679896432"><a href="#local-6989586621679896432"><span class="hs-identifier">c2</span></a></a><span> </span><a name="local-6989586621679896433"><a href="#local-6989586621679896433"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679896434"><a href="#local-6989586621679896434"><span class="hs-identifier">tc</span></a></a><span>
</span><a name="line-391"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679896431"><span class="hs-identifier hs-var">c1</span></a><span> </span><a href="#local-6989586621679896433"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679896434"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679896432"><span class="hs-identifier hs-var">c2</span></a><span> </span><a href="#local-6989586621679896433"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679896434"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-392"></a><span>     </span><span class="hs-special">(</span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span class="hs-special">,</span><span>    </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>    </span><span class="hs-comment">-- c1 succeeds</span><span>
</span><a name="line-393"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span>          </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>    </span><span class="hs-comment">-- c21 succeeds</span><span>
</span><a name="line-394"></a><span>     </span><span class="hs-special">(</span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><a name="local-6989586621679896435"><a href="#local-6989586621679896435"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><a name="local-6989586621679896436"><a href="#local-6989586621679896436"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679896435"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;  or&quot;</span><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="#local-6989586621679896436"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-395"></a><span>                                            </span><span class="hs-comment">-- Both fail</span><span>
</span><a name="line-396"></a><span>
</span><a name="line-397"></a><span class="hs-identifier">andCond</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcDerivUtils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcDerivUtils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcDerivUtils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a><span>
</span><a name="line-398"></a><a name="andCond"><a href="TcDerivUtils.html#andCond"><span class="hs-identifier">andCond</span></a></a><span> </span><a name="local-6989586621679896437"><a href="#local-6989586621679896437"><span class="hs-identifier">c1</span></a></a><span> </span><a name="local-6989586621679896438"><a href="#local-6989586621679896438"><span class="hs-identifier">c2</span></a></a><span> </span><a name="local-6989586621679896439"><a href="#local-6989586621679896439"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679896440"><a href="#local-6989586621679896440"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679896437"><span class="hs-identifier hs-var">c1</span></a><span> </span><a href="#local-6989586621679896439"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679896440"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="ErrUtils.html#andValid"><span class="hs-identifier hs-var">andValid</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679896438"><span class="hs-identifier hs-var">c2</span></a><span> </span><a href="#local-6989586621679896439"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679896440"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-399"></a><span>
</span><a name="line-400"></a><span class="hs-identifier">cond_stdOK</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcDerivUtils.html#DerivContext"><span class="hs-identifier hs-type">DerivContext</span></a><span> </span><span class="hs-comment">-- Says whether this is standalone deriving or not;</span><span>
</span><a name="line-401"></a><span>                           </span><span class="hs-comment">--     if standalone, we just say &quot;yes, go for it&quot;</span><span>
</span><a name="line-402"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>         </span><span class="hs-comment">-- True &lt;=&gt; permissive: allow higher rank</span><span>
</span><a name="line-403"></a><span>                           </span><span class="hs-comment">--          args and no data constructors</span><span>
</span><a name="line-404"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcDerivUtils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a><span>
</span><a name="line-405"></a><a name="cond_stdOK"><a href="TcDerivUtils.html#cond_stdOK"><span class="hs-identifier">cond_stdOK</span></a></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-406"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>     </span><span class="hs-comment">-- Don't check these conservative conditions for</span><span>
</span><a name="line-407"></a><span>                </span><span class="hs-comment">-- standalone deriving; just generate the code</span><span>
</span><a name="line-408"></a><span>                </span><span class="hs-comment">-- and let the typechecker handle the result</span><span>
</span><a name="line-409"></a><span class="hs-identifier">cond_stdOK</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a name="local-6989586621679896441"><a href="#local-6989586621679896441"><span class="hs-identifier">permissive</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679896442"><a href="#local-6989586621679896442"><span class="hs-identifier">rep_tc</span></a></a><span>
</span><a name="line-410"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621679896444"><span class="hs-identifier hs-var">data_cons</span></a><span>
</span><a name="line-411"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679896441"><span class="hs-identifier hs-var">permissive</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#no_cons_why"><span class="hs-identifier hs-var">no_cons_why</span></a><span> </span><a href="#local-6989586621679896442"><span class="hs-identifier hs-var">rep_tc</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="#local-6989586621679896443"><span class="hs-identifier hs-var">suggestion</span></a><span class="hs-special">)</span><span>
</span><a name="line-412"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621679896445"><span class="hs-identifier hs-var">con_whys</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><a href="#local-6989586621679896445"><span class="hs-identifier hs-var">con_whys</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="#local-6989586621679896443"><span class="hs-identifier hs-var">suggestion</span></a><span class="hs-special">)</span><span>
</span><a name="line-413"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>
</span><a name="line-414"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-415"></a><span>    </span><a name="local-6989586621679896443"><a href="#local-6989586621679896443"><span class="hs-identifier">suggestion</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Possible fix: use a standalone deriving declaration instead&quot;</span><span>
</span><a name="line-416"></a><span>    </span><a name="local-6989586621679896444"><a href="#local-6989586621679896444"><span class="hs-identifier">data_cons</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><a href="#local-6989586621679896442"><span class="hs-identifier hs-var">rep_tc</span></a><span>
</span><a name="line-417"></a><span>    </span><a name="local-6989586621679896445"><a href="#local-6989586621679896445"><span class="hs-identifier">con_whys</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#getInvalids"><span class="hs-identifier hs-var">getInvalids</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-6989586621679896446"><span class="hs-identifier hs-var">check_con</span></a><span> </span><a href="#local-6989586621679896444"><span class="hs-identifier hs-var">data_cons</span></a><span class="hs-special">)</span><span>
</span><a name="line-418"></a><span>
</span><a name="line-419"></a><span>    </span><span class="hs-identifier">check_con</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span>
</span><a name="line-420"></a><span>    </span><a name="local-6989586621679896446"><a href="#local-6989586621679896446"><span class="hs-identifier">check_con</span></a></a><span> </span><a name="local-6989586621679896447"><a href="#local-6989586621679896447"><span class="hs-identifier">con</span></a></a><span>
</span><a name="line-421"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621679896449"><span class="hs-identifier hs-var">eq_spec</span></a><span class="hs-special">)</span><span>
</span><a name="line-422"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679896451"><span class="hs-identifier hs-var">bad</span></a><span> </span><span class="hs-string">&quot;is a GADT&quot;</span><span>
</span><a name="line-423"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621679896448"><span class="hs-identifier hs-var">ex_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-424"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679896451"><span class="hs-identifier hs-var">bad</span></a><span> </span><span class="hs-string">&quot;has existential type variables in its type&quot;</span><span>
</span><a name="line-425"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621679896450"><span class="hs-identifier hs-var">theta</span></a><span class="hs-special">)</span><span>
</span><a name="line-426"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679896451"><span class="hs-identifier hs-var">bad</span></a><span> </span><span class="hs-string">&quot;has constraints in its type&quot;</span><span>
</span><a name="line-427"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679896441"><span class="hs-identifier hs-var">permissive</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a><span> </span><a href="Type.html#isTauTy"><span class="hs-identifier hs-var">isTauTy</span></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#dataConOrigArgTys"><span class="hs-identifier hs-var">dataConOrigArgTys</span></a><span> </span><a href="#local-6989586621679896447"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-428"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679896451"><span class="hs-identifier hs-var">bad</span></a><span> </span><span class="hs-string">&quot;has a higher-rank type&quot;</span><span>
</span><a name="line-429"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-430"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>
</span><a name="line-431"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-432"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679896448"><a href="#local-6989586621679896448"><span class="hs-identifier">ex_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679896449"><a href="#local-6989586621679896449"><span class="hs-identifier">eq_spec</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679896450"><a href="#local-6989586621679896450"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="DataCon.html#dataConFullSig"><span class="hs-identifier hs-var">dataConFullSig</span></a><span> </span><a href="#local-6989586621679896447"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-433"></a><span>        </span><a name="local-6989586621679896451"><a href="#local-6989586621679896451"><span class="hs-identifier">bad</span></a></a><span> </span><a name="local-6989586621679896452"><a href="#local-6989586621679896452"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#badCon"><span class="hs-identifier hs-var">badCon</span></a><span> </span><a href="#local-6989586621679896447"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621679896452"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-434"></a><span>
</span><a name="line-435"></a><span class="hs-identifier">no_cons_why</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-436"></a><a name="no_cons_why"><a href="TcDerivUtils.html#no_cons_why"><span class="hs-identifier">no_cons_why</span></a></a><span> </span><a name="local-6989586621679896453"><a href="#local-6989586621679896453"><span class="hs-identifier">rep_tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#pprSourceTyCon"><span class="hs-identifier hs-var">pprSourceTyCon</span></a><span> </span><a href="#local-6989586621679896453"><span class="hs-identifier hs-var">rep_tc</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-437"></a><span>                     </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;must have at least one data constructor&quot;</span><span>
</span><a name="line-438"></a><span>
</span><a name="line-439"></a><span class="hs-identifier">cond_RepresentableOk</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcDerivUtils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a><span>
</span><a name="line-440"></a><a name="cond_RepresentableOk"><a href="TcDerivUtils.html#cond_RepresentableOk"><span class="hs-identifier">cond_RepresentableOk</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679896454"><a href="#local-6989586621679896454"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenGenerics.html#canDoGenerics"><span class="hs-identifier hs-var">canDoGenerics</span></a><span> </span><a href="#local-6989586621679896454"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-441"></a><span>
</span><a name="line-442"></a><span class="hs-identifier">cond_Representable1Ok</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcDerivUtils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a><span>
</span><a name="line-443"></a><a name="cond_Representable1Ok"><a href="TcDerivUtils.html#cond_Representable1Ok"><span class="hs-identifier">cond_Representable1Ok</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679896455"><a href="#local-6989586621679896455"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenGenerics.html#canDoGenerics1"><span class="hs-identifier hs-var">canDoGenerics1</span></a><span> </span><a href="#local-6989586621679896455"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-444"></a><span>
</span><a name="line-445"></a><span class="hs-identifier">cond_enumOrProduct</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcDerivUtils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a><span>
</span><a name="line-446"></a><a name="cond_enumOrProduct"><a href="TcDerivUtils.html#cond_enumOrProduct"><span class="hs-identifier">cond_enumOrProduct</span></a></a><span> </span><a name="local-6989586621679896456"><a href="#local-6989586621679896456"><span class="hs-identifier">cls</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcDerivUtils.html#cond_isEnumeration"><span class="hs-identifier hs-var">cond_isEnumeration</span></a><span> </span><span class="hs-special">`</span><a href="TcDerivUtils.html#orCond"><span class="hs-identifier hs-var">orCond</span></a><span class="hs-special">`</span><span>
</span><a name="line-447"></a><span>                         </span><span class="hs-special">(</span><a href="TcDerivUtils.html#cond_isProduct"><span class="hs-identifier hs-var">cond_isProduct</span></a><span> </span><span class="hs-special">`</span><a href="TcDerivUtils.html#andCond"><span class="hs-identifier hs-var">andCond</span></a><span class="hs-special">`</span><span> </span><a href="TcDerivUtils.html#cond_args"><span class="hs-identifier hs-var">cond_args</span></a><span> </span><a href="#local-6989586621679896456"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span>
</span><a name="line-448"></a><span>
</span><a name="line-449"></a><span class="hs-identifier">cond_args</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcDerivUtils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a><span>
</span><a name="line-450"></a><span class="hs-comment">-- For some classes (eg Eq, Ord) we allow unlifted arg types</span><span>
</span><a name="line-451"></a><span class="hs-comment">-- by generating specialised code.  For others (eg Data) we don't.</span><span>
</span><a name="line-452"></a><a name="cond_args"><a href="TcDerivUtils.html#cond_args"><span class="hs-identifier">cond_args</span></a></a><span> </span><a name="local-6989586621679896457"><a href="#local-6989586621679896457"><span class="hs-identifier">cls</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679896458"><a href="#local-6989586621679896458"><span class="hs-identifier">tc</span></a></a><span>
</span><a name="line-453"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679896459"><span class="hs-identifier hs-var">bad_args</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-454"></a><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>
</span><a name="line-455"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621679896469"><a href="#local-6989586621679896469"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Don't know how to derive&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679896457"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-456"></a><span>                             </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;for type&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679896469"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-457"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-458"></a><span>    </span><a name="local-6989586621679896459"><a href="#local-6989586621679896459"><span class="hs-identifier">bad_args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679896465"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679896464"><a href="#local-6989586621679896464"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><a href="#local-6989586621679896458"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-459"></a><span>                        </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679896465"><a href="#local-6989586621679896465"><span class="hs-identifier">arg_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DataCon.html#dataConOrigArgTys"><span class="hs-identifier hs-var">dataConOrigArgTys</span></a><span> </span><a href="#local-6989586621679896464"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-460"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="Type.html#isUnliftedType"><span class="hs-identifier hs-var">isUnliftedType</span></a><span> </span><a href="#local-6989586621679896465"><span class="hs-identifier hs-var">arg_ty</span></a><span>
</span><a name="line-461"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679896461"><span class="hs-identifier hs-var">ok_ty</span></a><span> </span><a href="#local-6989586621679896465"><span class="hs-identifier hs-var">arg_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-462"></a><span>
</span><a name="line-463"></a><span>    </span><a name="local-6989586621679896460"><a href="#local-6989586621679896460"><span class="hs-identifier">cls_key</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">classKey</span><span> </span><a href="#local-6989586621679896457"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-464"></a><span>    </span><a name="local-6989586621679896461"><a href="#local-6989586621679896461"><span class="hs-identifier">ok_ty</span></a></a><span> </span><a name="local-6989586621679896466"><a href="#local-6989586621679896466"><span class="hs-identifier">arg_ty</span></a></a><span>
</span><a name="line-465"></a><span>     </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679896460"><span class="hs-identifier hs-var">cls_key</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#eqClassKey"><span class="hs-identifier hs-var">eqClassKey</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679896462"><span class="hs-identifier hs-var">check_in</span></a><span> </span><a href="#local-6989586621679896466"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><a href="TcGenDeriv.html#ordOpTbl"><span class="hs-identifier hs-var">ordOpTbl</span></a><span>
</span><a name="line-466"></a><span>     </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679896460"><span class="hs-identifier hs-var">cls_key</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#ordClassKey"><span class="hs-identifier hs-var">ordClassKey</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679896462"><span class="hs-identifier hs-var">check_in</span></a><span> </span><a href="#local-6989586621679896466"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><a href="TcGenDeriv.html#ordOpTbl"><span class="hs-identifier hs-var">ordOpTbl</span></a><span>
</span><a name="line-467"></a><span>     </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679896460"><span class="hs-identifier hs-var">cls_key</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#showClassKey"><span class="hs-identifier hs-var">showClassKey</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679896462"><span class="hs-identifier hs-var">check_in</span></a><span> </span><a href="#local-6989586621679896466"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><a href="TcGenDeriv.html#boxConTbl"><span class="hs-identifier hs-var">boxConTbl</span></a><span>
</span><a name="line-468"></a><span>     </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679896460"><span class="hs-identifier hs-var">cls_key</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="THNames.html#liftClassKey"><span class="hs-identifier hs-var">liftClassKey</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679896462"><span class="hs-identifier hs-var">check_in</span></a><span> </span><a href="#local-6989586621679896466"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><a href="TcGenDeriv.html#litConTbl"><span class="hs-identifier hs-var">litConTbl</span></a><span>
</span><a name="line-469"></a><span>     </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>    </span><span class="hs-comment">-- Read, Ix etc</span><span>
</span><a name="line-470"></a><span>
</span><a name="line-471"></a><span>    </span><span class="hs-identifier">check_in</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><a href="#local-6989586621679896463"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-472"></a><span>    </span><a name="local-6989586621679896462"><a href="#local-6989586621679896462"><span class="hs-identifier">check_in</span></a></a><span> </span><a name="local-6989586621679896467"><a href="#local-6989586621679896467"><span class="hs-identifier">arg_ty</span></a></a><span> </span><a name="local-6989586621679896468"><a href="#local-6989586621679896468"><span class="hs-identifier">tbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span> </span><a href="#local-6989586621679896467"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679896468"><span class="hs-identifier hs-var">tbl</span></a><span>
</span><a name="line-473"></a><span>
</span><a name="line-474"></a><span>
</span><a name="line-475"></a><span class="hs-identifier">cond_isEnumeration</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcDerivUtils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a><span>
</span><a name="line-476"></a><a name="cond_isEnumeration"><a href="TcDerivUtils.html#cond_isEnumeration"><span class="hs-identifier">cond_isEnumeration</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679896470"><a href="#local-6989586621679896470"><span class="hs-identifier">rep_tc</span></a></a><span>
</span><a name="line-477"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#isEnumerationTyCon"><span class="hs-identifier hs-var">isEnumerationTyCon</span></a><span> </span><a href="#local-6989586621679896470"><span class="hs-identifier hs-var">rep_tc</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>
</span><a name="line-478"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><a href="#local-6989586621679896471"><span class="hs-identifier hs-var">why</span></a><span>
</span><a name="line-479"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-480"></a><span>    </span><a name="local-6989586621679896471"><a href="#local-6989586621679896471"><span class="hs-identifier">why</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#pprSourceTyCon"><span class="hs-identifier hs-var">pprSourceTyCon</span></a><span> </span><a href="#local-6989586621679896470"><span class="hs-identifier hs-var">rep_tc</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-481"></a><span>                  </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;must be an enumeration type&quot;</span><span>
</span><a name="line-482"></a><span>              </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;(an enumeration consists of one or more nullary, non-GADT constructors)&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-483"></a><span>                  </span><span class="hs-comment">-- See Note [Enumeration types] in TyCon</span><span>
</span><a name="line-484"></a><span>
</span><a name="line-485"></a><span class="hs-identifier">cond_isProduct</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcDerivUtils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a><span>
</span><a name="line-486"></a><a name="cond_isProduct"><a href="TcDerivUtils.html#cond_isProduct"><span class="hs-identifier">cond_isProduct</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679896472"><a href="#local-6989586621679896472"><span class="hs-identifier">rep_tc</span></a></a><span>
</span><a name="line-487"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#isProductTyCon"><span class="hs-identifier hs-var">isProductTyCon</span></a><span> </span><a href="#local-6989586621679896472"><span class="hs-identifier hs-var">rep_tc</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>
</span><a name="line-488"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>             </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><a href="#local-6989586621679896473"><span class="hs-identifier hs-var">why</span></a><span>
</span><a name="line-489"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-490"></a><span>    </span><a name="local-6989586621679896473"><a href="#local-6989586621679896473"><span class="hs-identifier">why</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#pprSourceTyCon"><span class="hs-identifier hs-var">pprSourceTyCon</span></a><span> </span><a href="#local-6989586621679896472"><span class="hs-identifier hs-var">rep_tc</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-491"></a><span>          </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;must have precisely one constructor&quot;</span><span>
</span><a name="line-492"></a><span>
</span><a name="line-493"></a><span class="hs-identifier">cond_functorOK</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcDerivUtils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a><span>
</span><a name="line-494"></a><span class="hs-comment">-- OK for Functor/Foldable/Traversable class</span><span>
</span><a name="line-495"></a><span class="hs-comment">-- Currently: (a) at least one argument</span><span>
</span><a name="line-496"></a><span class="hs-comment">--            (b) don't use argument contravariantly</span><span>
</span><a name="line-497"></a><span class="hs-comment">--            (c) don't use argument in the wrong place, e.g. data T a = T (X a a)</span><span>
</span><a name="line-498"></a><span class="hs-comment">--            (d) optionally: don't use function types</span><span>
</span><a name="line-499"></a><span class="hs-comment">--            (e) no &quot;stupid context&quot; on data type</span><span>
</span><a name="line-500"></a><a name="cond_functorOK"><a href="TcDerivUtils.html#cond_functorOK"><span class="hs-identifier">cond_functorOK</span></a></a><span> </span><a name="local-6989586621679896474"><a href="#local-6989586621679896474"><span class="hs-identifier">allowFunctions</span></a></a><span> </span><a name="local-6989586621679896475"><a href="#local-6989586621679896475"><span class="hs-identifier">allowExQuantifiedLastTyVar</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679896476"><a href="#local-6989586621679896476"><span class="hs-identifier">rep_tc</span></a></a><span>
</span><a name="line-501"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621679896477"><span class="hs-identifier hs-var">tc_tvs</span></a><span>
</span><a name="line-502"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Data type&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679896476"><span class="hs-identifier hs-var">rep_tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-503"></a><span>              </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;must have some type parameters&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-504"></a><span>
</span><a name="line-505"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621679896479"><span class="hs-identifier hs-var">bad_stupid_theta</span></a><span class="hs-special">)</span><span>
</span><a name="line-506"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Data type&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679896476"><span class="hs-identifier hs-var">rep_tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-507"></a><span>              </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;must not have a class context:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TyCoRep.html#pprTheta"><span class="hs-identifier hs-var">pprTheta</span></a><span> </span><a href="#local-6989586621679896479"><span class="hs-identifier hs-var">bad_stupid_theta</span></a><span class="hs-special">)</span><span>
</span><a name="line-508"></a><span>
</span><a name="line-509"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-510"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#allValid"><span class="hs-identifier hs-var">allValid</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-6989586621679896482"><span class="hs-identifier hs-var">check_con</span></a><span> </span><a href="#local-6989586621679896481"><span class="hs-identifier hs-var">data_cons</span></a><span class="hs-special">)</span><span>
</span><a name="line-511"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-512"></a><span>    </span><a name="local-6989586621679896477"><a href="#local-6989586621679896477"><span class="hs-identifier">tc_tvs</span></a></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-6989586621679896476"><span class="hs-identifier hs-var">rep_tc</span></a><span>
</span><a name="line-513"></a><span>    </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679896478"><a href="#local-6989586621679896478"><span class="hs-identifier">last_tv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#snocView"><span class="hs-identifier hs-var">snocView</span></a><span> </span><a href="#local-6989586621679896477"><span class="hs-identifier hs-var">tc_tvs</span></a><span>
</span><a name="line-514"></a><span>    </span><a name="local-6989586621679896479"><a href="#local-6989586621679896479"><span class="hs-identifier">bad_stupid_theta</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="#local-6989586621679896480"><span class="hs-identifier hs-var">is_bad</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#tyConStupidTheta"><span class="hs-identifier hs-var">tyConStupidTheta</span></a><span> </span><a href="#local-6989586621679896476"><span class="hs-identifier hs-var">rep_tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-515"></a><span>    </span><a name="local-6989586621679896480"><a href="#local-6989586621679896480"><span class="hs-identifier">is_bad</span></a></a><span> </span><a name="local-6989586621679896489"><a href="#local-6989586621679896489"><span class="hs-identifier">pred</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679896478"><span class="hs-identifier hs-var">last_tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-6989586621679896489"><span class="hs-identifier hs-var">pred</span></a><span>
</span><a name="line-516"></a><span>
</span><a name="line-517"></a><span>    </span><a name="local-6989586621679896481"><a href="#local-6989586621679896481"><span class="hs-identifier">data_cons</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><a href="#local-6989586621679896476"><span class="hs-identifier hs-var">rep_tc</span></a><span>
</span><a name="line-518"></a><span>    </span><a name="local-6989586621679896482"><a href="#local-6989586621679896482"><span class="hs-identifier">check_con</span></a></a><span> </span><a name="local-6989586621679896490"><a href="#local-6989586621679896490"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#allValid"><span class="hs-identifier hs-var">allValid</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679896483"><span class="hs-identifier hs-var">check_universal</span></a><span> </span><a href="#local-6989586621679896490"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="TcGenFunctor.html#foldDataConArgs"><span class="hs-identifier hs-var">foldDataConArgs</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679896484"><span class="hs-identifier hs-var">ft_check</span></a><span> </span><a href="#local-6989586621679896490"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679896490"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span>
</span><a name="line-519"></a><span>
</span><a name="line-520"></a><span>    </span><span class="hs-identifier">check_universal</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span>
</span><a name="line-521"></a><span>    </span><a name="local-6989586621679896483"><a href="#local-6989586621679896483"><span class="hs-identifier">check_universal</span></a></a><span> </span><a name="local-6989586621679896491"><a href="#local-6989586621679896491"><span class="hs-identifier">con</span></a></a><span>
</span><a name="line-522"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679896475"><span class="hs-identifier hs-var">allowExQuantifiedLastTyVar</span></a><span>
</span><a name="line-523"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span> </span><span class="hs-comment">-- See Note [DeriveFoldable with ExistentialQuantification]</span><span>
</span><a name="line-524"></a><span>                </span><span class="hs-comment">-- in TcGenFunctor</span><span>
</span><a name="line-525"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679896492"><a href="#local-6989586621679896492"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#getTyVar_maybe"><span class="hs-identifier hs-var">getTyVar_maybe</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#last"><span class="hs-identifier hs-var">last</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#tyConAppArgs"><span class="hs-identifier hs-var">tyConAppArgs</span></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#dataConOrigResTy"><span class="hs-identifier hs-var">dataConOrigResTy</span></a><span> </span><a href="#local-6989586621679896491"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-526"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679896492"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#elem"><span class="hs-identifier hs-var">elem</span></a><span class="hs-special">`</span><span> </span><a href="DataCon.html#dataConUnivTyVars"><span class="hs-identifier hs-var">dataConUnivTyVars</span></a><span> </span><a href="#local-6989586621679896491"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-527"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679896492"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#dataConTheta"><span class="hs-identifier hs-var">dataConTheta</span></a><span> </span><a href="#local-6989586621679896491"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-528"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>   </span><span class="hs-comment">-- See Note [Check that the type variable is truly universal]</span><span>
</span><a name="line-529"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-530"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#badCon"><span class="hs-identifier hs-var">badCon</span></a><span> </span><a href="#local-6989586621679896491"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621679896485"><span class="hs-identifier hs-var">existential</span></a><span class="hs-special">)</span><span>
</span><a name="line-531"></a><span>
</span><a name="line-532"></a><span>    </span><span class="hs-identifier">ft_check</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcGenFunctor.html#FFoldType"><span class="hs-identifier hs-type">FFoldType</span></a><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span>
</span><a name="line-533"></a><span>    </span><a name="local-6989586621679896484"><a href="#local-6989586621679896484"><span class="hs-identifier">ft_check</span></a></a><span> </span><a name="local-6989586621679896493"><a href="#local-6989586621679896493"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenFunctor.html#FT"><span class="hs-identifier hs-var">FT</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ft_triv</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ft_var</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>
</span><a name="line-534"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ft_co_var</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#badCon"><span class="hs-identifier hs-var">badCon</span></a><span> </span><a href="#local-6989586621679896493"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621679896486"><span class="hs-identifier hs-var">covariant</span></a><span class="hs-special">)</span><span>
</span><a name="line-535"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ft_fun</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679896494"><a href="#local-6989586621679896494"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679896495"><a href="#local-6989586621679896495"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679896474"><span class="hs-identifier hs-var">allowFunctions</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679896494"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><a href="ErrUtils.html#andValid"><span class="hs-identifier hs-var">andValid</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679896495"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-536"></a><span>                                                           </span><span class="hs-keyword">else</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#badCon"><span class="hs-identifier hs-var">badCon</span></a><span> </span><a href="#local-6989586621679896493"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621679896487"><span class="hs-identifier hs-var">functions</span></a><span class="hs-special">)</span><span>
</span><a name="line-537"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ft_tup</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679896496"><a href="#local-6989586621679896496"><span class="hs-identifier">xs</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#allValid"><span class="hs-identifier hs-var">allValid</span></a><span> </span><a href="#local-6989586621679896496"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-538"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ft_ty_app</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679896497"><a href="#local-6989586621679896497"><span class="hs-identifier">x</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679896497"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-539"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ft_bad_app</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#badCon"><span class="hs-identifier hs-var">badCon</span></a><span> </span><a href="#local-6989586621679896493"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621679896488"><span class="hs-identifier hs-var">wrong_arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-540"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ft_forall</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679896498"><a href="#local-6989586621679896498"><span class="hs-identifier">x</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679896498"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-541"></a><span>
</span><a name="line-542"></a><span>    </span><a name="local-6989586621679896485"><a href="#local-6989586621679896485"><span class="hs-identifier">existential</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;must be truly polymorphic in the last argument of the data type&quot;</span><span>
</span><a name="line-543"></a><span>    </span><a name="local-6989586621679896486"><a href="#local-6989586621679896486"><span class="hs-identifier">covariant</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;must not use the type variable in a function argument&quot;</span><span>
</span><a name="line-544"></a><span>    </span><a name="local-6989586621679896487"><a href="#local-6989586621679896487"><span class="hs-identifier">functions</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;must not contain function types&quot;</span><span>
</span><a name="line-545"></a><span>    </span><a name="local-6989586621679896488"><a href="#local-6989586621679896488"><span class="hs-identifier">wrong_arg</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;must use the type variable only as the last argument of a data type&quot;</span><span>
</span><a name="line-546"></a><span>
</span><a name="line-547"></a><span class="hs-identifier">checkFlag</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../ghc-boot-th-8.3/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#Extension"><span class="hs-identifier hs-type">LangExt</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Extension</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcDerivUtils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a><span>
</span><a name="line-548"></a><a name="checkFlag"><a href="TcDerivUtils.html#checkFlag"><span class="hs-identifier">checkFlag</span></a></a><span> </span><a name="local-6989586621679896499"><a href="#local-6989586621679896499"><span class="hs-identifier">flag</span></a></a><span> </span><a name="local-6989586621679896500"><a href="#local-6989586621679896500"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-549"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a><span> </span><a href="#local-6989586621679896499"><span class="hs-identifier hs-var">flag</span></a><span> </span><a href="#local-6989586621679896500"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>
</span><a name="line-550"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><a href="#local-6989586621679896501"><span class="hs-identifier hs-var">why</span></a><span>
</span><a name="line-551"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-552"></a><span>    </span><a name="local-6989586621679896501"><a href="#local-6989586621679896501"><span class="hs-identifier">why</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;You need &quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621679896502"><span class="hs-identifier hs-var">flag_str</span></a><span>
</span><a name="line-553"></a><span>          </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;to derive an instance for this class&quot;</span><span>
</span><a name="line-554"></a><span>    </span><a name="local-6989586621679896502"><a href="#local-6989586621679896502"><span class="hs-identifier">flag_str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">flagSpecName</span><span> </span><a href="#local-6989586621679896503"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679896503"><a href="#local-6989586621679896503"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#xFlags"><span class="hs-identifier hs-var">xFlags</span></a><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">flagSpecFlag</span><span> </span><a href="#local-6989586621679896503"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679896499"><span class="hs-identifier hs-var">flag</span></a><span> </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-555"></a><span>                 </span><span class="hs-special">[</span><a name="local-6989586621679896504"><a href="#local-6989586621679896504"><span class="hs-identifier">s</span></a></a><span class="hs-special">]</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679896504"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-556"></a><span>                 </span><a name="local-6989586621679896505"><a href="#local-6989586621679896505"><span class="hs-identifier">other</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;checkFlag&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679896505"><span class="hs-identifier hs-var">other</span></a><span class="hs-special">)</span><span>
</span><a name="line-557"></a><span>
</span><a name="line-558"></a><span class="hs-identifier">std_class_via_coercible</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-559"></a><span class="hs-comment">-- These standard classes can be derived for a newtype</span><span>
</span><a name="line-560"></a><span class="hs-comment">-- using the coercible trick *even if no -XGeneralizedNewtypeDeriving</span><span>
</span><a name="line-561"></a><span class="hs-comment">-- because giving so gives the same results as generating the boilerplate</span><span>
</span><a name="line-562"></a><a name="std_class_via_coercible"><a href="TcDerivUtils.html#std_class_via_coercible"><span class="hs-identifier">std_class_via_coercible</span></a></a><span> </span><a name="local-6989586621679896506"><a href="#local-6989586621679896506"><span class="hs-identifier">clas</span></a></a><span>
</span><a name="line-563"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">classKey</span><span> </span><a href="#local-6989586621679896506"><span class="hs-identifier hs-var">clas</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#elem"><span class="hs-identifier hs-var">elem</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">[</span><a href="PrelNames.html#eqClassKey"><span class="hs-identifier hs-var">eqClassKey</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#ordClassKey"><span class="hs-identifier hs-var">ordClassKey</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#ixClassKey"><span class="hs-identifier hs-var">ixClassKey</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#boundedClassKey"><span class="hs-identifier hs-var">boundedClassKey</span></a><span class="hs-special">]</span><span>
</span><a name="line-564"></a><span>        </span><span class="hs-comment">-- Not Read/Show because they respect the type</span><span>
</span><a name="line-565"></a><span>        </span><span class="hs-comment">-- Not Enum, because newtypes are never in Enum</span><span>
</span><a name="line-566"></a><span>
</span><a name="line-567"></a><span>
</span><a name="line-568"></a><span class="hs-identifier">non_coercible_class</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-569"></a><span class="hs-comment">-- *Never* derive Read, Show, Typeable, Data, Generic, Generic1, Lift</span><span>
</span><a name="line-570"></a><span class="hs-comment">-- by Coercible, even with -XGeneralizedNewtypeDeriving</span><span>
</span><a name="line-571"></a><span class="hs-comment">-- Also, avoid Traversable, as the Coercible-derived instance and the &quot;normal&quot;-derived</span><span>
</span><a name="line-572"></a><span class="hs-comment">-- instance behave differently if there's a non-lawful Applicative out there.</span><span>
</span><a name="line-573"></a><span class="hs-comment">-- Besides, with roles, Coercible-deriving Traversable is ill-roled.</span><span>
</span><a name="line-574"></a><a name="non_coercible_class"><a href="TcDerivUtils.html#non_coercible_class"><span class="hs-identifier">non_coercible_class</span></a></a><span> </span><a name="local-6989586621679896507"><a href="#local-6989586621679896507"><span class="hs-identifier">cls</span></a></a><span>
</span><a name="line-575"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">classKey</span><span> </span><a href="#local-6989586621679896507"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#elem"><span class="hs-identifier hs-var">elem</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span> </span><a href="PrelNames.html#readClassKey"><span class="hs-identifier hs-var">readClassKey</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#showClassKey"><span class="hs-identifier hs-var">showClassKey</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#dataClassKey"><span class="hs-identifier hs-var">dataClassKey</span></a><span>
</span><a name="line-576"></a><span>                         </span><span class="hs-special">,</span><span> </span><a href="PrelNames.html#genClassKey"><span class="hs-identifier hs-var">genClassKey</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#gen1ClassKey"><span class="hs-identifier hs-var">gen1ClassKey</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#typeableClassKey"><span class="hs-identifier hs-var">typeableClassKey</span></a><span>
</span><a name="line-577"></a><span>                         </span><span class="hs-special">,</span><span> </span><a href="PrelNames.html#traversableClassKey"><span class="hs-identifier hs-var">traversableClassKey</span></a><span class="hs-special">,</span><span> </span><a href="THNames.html#liftClassKey"><span class="hs-identifier hs-var">liftClassKey</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-578"></a><span>
</span><a name="line-579"></a><span class="hs-identifier">badCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-580"></a><a name="badCon"><a href="TcDerivUtils.html#badCon"><span class="hs-identifier">badCon</span></a></a><span> </span><a name="local-6989586621679896508"><a href="#local-6989586621679896508"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621679896509"><a href="#local-6989586621679896509"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Constructor&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679896508"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-6989586621679896509"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-581"></a><span>
</span><a name="line-582"></a><span class="hs-comment">------------------------------------------------------------------</span><span>
</span><a name="line-583"></a><span>
</span><a name="line-584"></a><span class="hs-identifier">newDerivClsInst</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcDerivUtils.html#DerivSpec"><span class="hs-identifier hs-type">DerivSpec</span></a><span> </span><a href="#local-6989586621679896368"><span class="hs-identifier hs-type">theta</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span>
</span><a name="line-585"></a><a name="newDerivClsInst"><a href="TcDerivUtils.html#newDerivClsInst"><span class="hs-identifier">newDerivClsInst</span></a></a><span> </span><a name="local-6989586621679896510"><a href="#local-6989586621679896510"><span class="hs-identifier">theta</span></a></a><span> </span><span class="hs-special">(</span><a href="TcDerivUtils.html#DS"><span class="hs-identifier hs-var">DS</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ds_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679896511"><a href="#local-6989586621679896511"><span class="hs-identifier">dfun_name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ds_overlap</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679896512"><a href="#local-6989586621679896512"><span class="hs-identifier">overlap_mode</span></a></a><span>
</span><a name="line-586"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ds_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679896513"><a href="#local-6989586621679896513"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ds_cls</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679896514"><a href="#local-6989586621679896514"><span class="hs-identifier">clas</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ds_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679896515"><a href="#local-6989586621679896515"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-587"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Inst.html#newClsInst"><span class="hs-identifier hs-var">newClsInst</span></a><span> </span><a href="#local-6989586621679896512"><span class="hs-identifier hs-var">overlap_mode</span></a><span> </span><a href="#local-6989586621679896511"><span class="hs-identifier hs-var">dfun_name</span></a><span> </span><a href="#local-6989586621679896513"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-6989586621679896510"><span class="hs-identifier hs-var">theta</span></a><span> </span><a href="#local-6989586621679896514"><span class="hs-identifier hs-var">clas</span></a><span> </span><a href="#local-6989586621679896515"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-588"></a><span>
</span><a name="line-589"></a><span class="hs-identifier">extendLocalInstEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621679896367"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621679896367"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-590"></a><span class="hs-comment">-- Add new locally-defined instances; don't bother to check</span><span>
</span><a name="line-591"></a><span class="hs-comment">-- for functional dependency errors -- that'll happen in TcInstDcls</span><span>
</span><a name="line-592"></a><a name="extendLocalInstEnv"><a href="TcDerivUtils.html#extendLocalInstEnv"><span class="hs-identifier">extendLocalInstEnv</span></a></a><span> </span><a name="local-6989586621679896516"><a href="#local-6989586621679896516"><span class="hs-identifier">dfuns</span></a></a><span> </span><a name="local-6989586621679896517"><a href="#local-6989586621679896517"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-593"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679896518"><a href="#local-6989586621679896518"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-594"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>  </span><a name="local-6989586621679896519"><a href="#local-6989586621679896519"><span class="hs-identifier">inst_env'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="InstEnv.html#extendInstEnvList"><span class="hs-identifier hs-var">extendInstEnvList</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcg_inst_env</span><span> </span><a href="#local-6989586621679896518"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679896516"><span class="hs-identifier hs-var">dfuns</span></a><span>
</span><a name="line-595"></a><span>             </span><a name="local-6989586621679896520"><a href="#local-6989586621679896520"><span class="hs-identifier">env'</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679896518"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_inst_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679896519"><span class="hs-identifier hs-var">inst_env'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-596"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#setGblEnv"><span class="hs-identifier hs-var">setGblEnv</span></a><span> </span><a href="#local-6989586621679896520"><span class="hs-identifier hs-var">env'</span></a><span> </span><a href="#local-6989586621679896517"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-597"></a><span>
</span><a name="line-598"></a><span class="hs-comment">{-
Note [Deriving any class]
~~~~~~~~~~~~~~~~~~~~~~~~~
Classic uses of a deriving clause, or a standalone-deriving declaration, are
for:
  * a stock class like Eq or Show, for which GHC knows how to generate
    the instance code
  * a newtype, via the mechanism enabled by GeneralizedNewtypeDeriving

The DeriveAnyClass extension adds a third way to derive instances, based on
empty instance declarations.

The canonical use case is in combination with GHC.Generics and default method
signatures. These allow us to have instance declarations being empty, but still
useful, e.g.

  data T a = ...blah..blah... deriving( Generic )
  instance C a =&gt; C (T a)  -- No 'where' clause

where C is some &quot;random&quot; user-defined class.

This boilerplate code can be replaced by the more compact

  data T a = ...blah..blah... deriving( Generic, C )

if DeriveAnyClass is enabled.

This is not restricted to Generics; any class can be derived, simply giving
rise to an empty instance.

Unfortunately, it is not clear how to determine the context (when using a
deriving clause; in standalone deriving, the user provides the context).
GHC uses the same heuristic for figuring out the class context that it uses for
Eq in the case of *-kinded classes, and for Functor in the case of
* -&gt; *-kinded classes. That may not be optimal or even wrong. But in such
cases, standalone deriving can still be used.

Note [Check that the type variable is truly universal]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
For Functor and Traversable instances, we must check that the *last argument*
of the type constructor is used truly universally quantified.  Example

   data T a b where
     T1 :: a -&gt; b -&gt; T a b      -- Fine! Vanilla H-98
     T2 :: b -&gt; c -&gt; T a b      -- Fine! Existential c, but we can still map over 'b'
     T3 :: b -&gt; T Int b         -- Fine! Constraint 'a', but 'b' is still polymorphic
     T4 :: Ord b =&gt; b -&gt; T a b  -- No!  'b' is constrained
     T5 :: b -&gt; T b b           -- No!  'b' is constrained
     T6 :: T a (b,b)            -- No!  'b' is constrained

Notice that only the first of these constructors is vanilla H-98. We only
need to take care about the last argument (b in this case).  See Trac #8678.
Eg. for T1-T3 we can write

     fmap f (T1 a b) = T1 a (f b)
     fmap f (T2 b c) = T2 (f b) c
     fmap f (T3 x)   = T3 (f x)

We need not perform these checks for Foldable instances, however, since
functions in Foldable can only consume existentially quantified type variables,
rather than produce them (as is the case in Functor and Traversable functions.)
As a result, T can have a derived Foldable instance:

    foldr f z (T1 a b) = f b z
    foldr f z (T2 b c) = f b z
    foldr f z (T3 x)   = f x z
    foldr f z (T4 x)   = f x z
    foldr f z (T5 x)   = f x z
    foldr _ z T6       = z

See Note [DeriveFoldable with ExistentialQuantification] in TcGenFunctor.
-}</span><span>
</span><a name="line-670"></a></pre></body></html>