<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The AQUA Project, Glasgow University, 1993-1998

\section[CoreMonad]{The core pipeline monad}
-}</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">CoreMonad</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-10"></a><span>    </span><span class="hs-comment">-- * Configuration of the core-to-core passes</span><span>
</span><a name="line-11"></a><span>    </span><a href="CoreMonad.html#CoreToDo"><span class="hs-identifier hs-type">CoreToDo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#runWhen"><span class="hs-identifier hs-var">runWhen</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#runMaybe"><span class="hs-identifier hs-var">runMaybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-12"></a><span>    </span><a href="CoreMonad.html#SimplifierMode"><span class="hs-identifier hs-type">SimplifierMode</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>    </span><a href="CoreMonad.html#FloatOutSwitches"><span class="hs-identifier hs-type">FloatOutSwitches</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>    </span><a href="CoreMonad.html#pprPassDetails"><span class="hs-identifier hs-var">pprPassDetails</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span>    </span><span class="hs-comment">-- * Plugins</span><span>
</span><a name="line-17"></a><span>    </span><a href="CoreMonad.html#PluginPass"><span class="hs-identifier hs-type">PluginPass</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#bindsOnlyPass"><span class="hs-identifier hs-var">bindsOnlyPass</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span>    </span><span class="hs-comment">-- * Counting</span><span>
</span><a name="line-20"></a><span>    </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#doSimplTick"><span class="hs-identifier hs-var">doSimplTick</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#doFreeSimplTick"><span class="hs-identifier hs-var">doFreeSimplTick</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#simplCountN"><span class="hs-identifier hs-var">simplCountN</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>    </span><a href="CoreMonad.html#pprSimplCount"><span class="hs-identifier hs-var">pprSimplCount</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#plusSimplCount"><span class="hs-identifier hs-var">plusSimplCount</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#zeroSimplCount"><span class="hs-identifier hs-var">zeroSimplCount</span></a><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>    </span><a href="CoreMonad.html#isZeroSimplCount"><span class="hs-identifier hs-var">isZeroSimplCount</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#hasDetailedCounts"><span class="hs-identifier hs-var">hasDetailedCounts</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span>    </span><span class="hs-comment">-- * The monad</span><span>
</span><a name="line-25"></a><span>    </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#runCoreM"><span class="hs-identifier hs-var">runCoreM</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span>    </span><span class="hs-comment">-- ** Reading from the monad</span><span>
</span><a name="line-28"></a><span>    </span><a href="CoreMonad.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#getRuleBase"><span class="hs-identifier hs-var">getRuleBase</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>    </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#getOrigNameCache"><span class="hs-identifier hs-var">getOrigNameCache</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#getPackageFamInstEnv"><span class="hs-identifier hs-var">getPackageFamInstEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>    </span><a href="CoreMonad.html#getVisibleOrphanMods"><span class="hs-identifier hs-var">getVisibleOrphanMods</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>    </span><a href="CoreMonad.html#getPrintUnqualified"><span class="hs-identifier hs-var">getPrintUnqualified</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span>    </span><span class="hs-comment">-- ** Writing to the monad</span><span>
</span><a name="line-34"></a><span>    </span><a href="CoreMonad.html#addSimplCount"><span class="hs-identifier hs-var">addSimplCount</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span>    </span><span class="hs-comment">-- ** Lifting into the monad</span><span>
</span><a name="line-37"></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#liftIOWithCount"><span class="hs-identifier hs-var">liftIOWithCount</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>    </span><a href="MonadUtils.html#liftIO1"><span class="hs-identifier hs-var">liftIO1</span></a><span class="hs-special">,</span><span> </span><a href="MonadUtils.html#liftIO2"><span class="hs-identifier hs-var">liftIO2</span></a><span class="hs-special">,</span><span> </span><a href="MonadUtils.html#liftIO3"><span class="hs-identifier hs-var">liftIO3</span></a><span class="hs-special">,</span><span> </span><a href="MonadUtils.html#liftIO4"><span class="hs-identifier hs-var">liftIO4</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span>    </span><span class="hs-comment">-- ** Global initialization</span><span>
</span><a name="line-41"></a><span>    </span><a href="CoreMonad.html#reinitializeGlobals"><span class="hs-identifier hs-var">reinitializeGlobals</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span>    </span><span class="hs-comment">-- ** Dealing with annotations</span><span>
</span><a name="line-44"></a><span>    </span><a href="CoreMonad.html#getAnnotations"><span class="hs-identifier hs-var">getAnnotations</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#getFirstAnnotations"><span class="hs-identifier hs-var">getFirstAnnotations</span></a><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span>    </span><span class="hs-comment">-- ** Screen output</span><span>
</span><a name="line-47"></a><span>    </span><a href="CoreMonad.html#putMsg"><span class="hs-identifier hs-var">putMsg</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#putMsgS"><span class="hs-identifier hs-var">putMsgS</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#errorMsg"><span class="hs-identifier hs-var">errorMsg</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#errorMsgS"><span class="hs-identifier hs-var">errorMsgS</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#warnMsg"><span class="hs-identifier hs-var">warnMsg</span></a><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>    </span><a href="CoreMonad.html#fatalErrorMsg"><span class="hs-identifier hs-var">fatalErrorMsg</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#fatalErrorMsgS"><span class="hs-identifier hs-var">fatalErrorMsgS</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>    </span><a href="CoreMonad.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#debugTraceMsgS"><span class="hs-identifier hs-var">debugTraceMsgS</span></a><span class="hs-special">,</span><span>
</span><a name="line-50"></a><span>    </span><a href="CoreMonad.html#dumpIfSet_dyn"><span class="hs-identifier hs-var">dumpIfSet_dyn</span></a><span class="hs-special">,</span><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span class="hs-cpp">#ifdef GHCI</span><span>
</span><a name="line-53"></a><span>    </span><span class="hs-comment">-- * Getting 'Name's</span><span>
</span><a name="line-54"></a><span>    </span><a href="CoreMonad.html#thNameToGhcName"><span class="hs-identifier hs-var">thNameToGhcName</span></a><span>
</span><a name="line-55"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-56"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span class="hs-cpp">#ifdef GHCI</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span class="hs-special">(</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnMonad.html"><span class="hs-identifier">TcRnMonad</span></a><span>        </span><span class="hs-special">(</span><span> </span><a href="TcRnMonad.html#initTcForLookup"><span class="hs-identifier hs-var">initTcForLookup</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><a href="CoreSyn.html"><span class="hs-identifier">CoreSyn</span></a><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><a href="HscTypes.html"><span class="hs-identifier">HscTypes</span></a><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><a href="Module.html"><span class="hs-identifier">Module</span></a><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><a href="StaticFlags.html"><span class="hs-identifier">StaticFlags</span></a><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span>       </span><span class="hs-special">(</span><span> </span><a href="BasicTypes.html#CompilerPhase"><span class="hs-identifier hs-type">CompilerPhase</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><a href="Annotations.html"><span class="hs-identifier">Annotations</span></a><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><a href="IOEnv.html"><span class="hs-identifier">IOEnv</span></a><span> </span><span class="hs-keyword">hiding</span><span>     </span><span class="hs-special">(</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span class="hs-special">,</span><span> </span><a href="IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a><span class="hs-special">,</span><span> </span><a href="IOEnv.html#failWithM"><span class="hs-identifier hs-var">failWithM</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="IOEnv.html"><span class="hs-identifier">IOEnv</span></a><span>  </span><span class="hs-special">(</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><a href="TcEnv.html"><span class="hs-identifier">TcEnv</span></a><span>            </span><span class="hs-special">(</span><span> </span><a href="TcEnv.html#lookupGlobal"><span class="hs-identifier hs-var">lookupGlobal</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><a href="Var.html"><span class="hs-identifier">Var</span></a><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="ErrUtils.html"><span class="hs-identifier">ErrUtils</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Err</span><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><a href="ErrUtils.html"><span class="hs-identifier">ErrUtils</span></a><span class="hs-special">(</span><span> </span><a href="ErrUtils.html#Severity"><span class="hs-identifier hs-type">Severity</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><a href="Maybes.html"><span class="hs-identifier">Maybes</span></a><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span> </span><a href="UniqSupply.html"><span class="hs-identifier">UniqSupply</span></a><span>
</span><a name="line-80"></a><span class="hs-keyword">import</span><span> </span><a href="UniqFM.html"><span class="hs-identifier">UniqFM</span></a><span>       </span><span class="hs-special">(</span><span> </span><a href="UniqFM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a><span class="hs-special">,</span><span> </span><a href="UniqFM.html#mapUFM"><span class="hs-identifier hs-var">mapUFM</span></a><span class="hs-special">,</span><span> </span><a href="UniqFM.html#filterUFM"><span class="hs-identifier hs-var">filterUFM</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-81"></a><span class="hs-keyword">import</span><span> </span><a href="MonadUtils.html"><span class="hs-identifier">MonadUtils</span></a><span>
</span><a name="line-82"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span>
</span><a name="line-83"></a><span class="hs-keyword">import</span><span> </span><a href="ListSetOps.html"><span class="hs-identifier">ListSetOps</span></a><span>       </span><span class="hs-special">(</span><span> </span><a href="ListSetOps.html#runs"><span class="hs-identifier hs-var">runs</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.List.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span></a><span>
</span><a name="line-85"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Ord.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Ord</span></a><span>
</span><a name="line-86"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Dynamic.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Dynamic</span></a><span>
</span><a name="line-87"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.IORef.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IORef</span></a><span>
</span><a name="line-88"></a><span class="hs-keyword">import</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Map</span></a><span> </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#Map"><span class="hs-identifier hs-type">Map</span></a><span class="hs-special">)</span><span>
</span><a name="line-89"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Map</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-90"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Word.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Word</span></a><span>
</span><a name="line-91"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span></a><span>
</span><a name="line-92"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Applicative.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Alternative"><span class="hs-identifier hs-type">Alternative</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-93"></a><span>
</span><a name="line-94"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Prelude.html"><span class="hs-identifier">Prelude</span></a><span> </span><span class="hs-keyword">hiding</span><span>   </span><span class="hs-special">(</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Text.Read.html#read"><span class="hs-identifier hs-var">read</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span class="hs-cpp">#ifdef GHCI</span><span>
</span><a name="line-97"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Concurrent.MVar.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Concurrent</span><span class="hs-operator">.</span><span class="hs-identifier">MVar</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.MVar.html#MVar"><span class="hs-identifier hs-type">MVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-98"></a><span class="hs-keyword">import</span><span> </span><a href="Linker.html"><span class="hs-identifier">Linker</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="Linker.html#PersistentLinkerState"><span class="hs-identifier hs-type">PersistentLinkerState</span></a><span class="hs-special">,</span><span> </span><a href="Linker.html#saveLinkerGlobals"><span class="hs-identifier hs-var">saveLinkerGlobals</span></a><span class="hs-special">,</span><span> </span><a href="Linker.html#restoreLinkerGlobals"><span class="hs-identifier hs-var">restoreLinkerGlobals</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-99"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE #-}</span><span> </span><a href="TcSplice.html"><span class="hs-identifier">TcSplice</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="TcSplice.html#lookupThName_maybe"><span class="hs-identifier hs-var">lookupThName_maybe</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-100"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../template-haskell-2.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Language.Haskell.TH.html"><span class="hs-identifier">Language</span><span class="hs-operator">.</span><span class="hs-identifier">Haskell</span><span class="hs-operator">.</span><span class="hs-identifier">TH</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TH</span><span>
</span><a name="line-101"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-102"></a><span class="hs-identifier">saveLinkerGlobals</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-103"></a><span class="hs-identifier">saveLinkerGlobals</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span class="hs-identifier">restoreLinkerGlobals</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-106"></a><span class="hs-identifier">restoreLinkerGlobals</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-107"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-108"></a><span>
</span><a name="line-109"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
              The CoreToDo type and related types
          Abstraction of core-to-core passes to run.
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span class="hs-keyword">data</span><span> </span><a name="CoreToDo"><a href="CoreMonad.html#CoreToDo"><span class="hs-identifier">CoreToDo</span></a></a><span>           </span><span class="hs-comment">-- These are diff core-to-core passes,</span><span>
</span><a name="line-119"></a><span>                        </span><span class="hs-comment">-- which may be invoked in any order,</span><span>
</span><a name="line-120"></a><span>                        </span><span class="hs-comment">-- as many times as you like.</span><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="CoreDoSimplify"><a href="CoreMonad.html#CoreDoSimplify"><span class="hs-identifier">CoreDoSimplify</span></a></a><span>      </span><span class="hs-comment">-- The core-to-core simplifier.</span><span>
</span><a name="line-123"></a><span>        </span><span class="hs-identifier hs-type">Int</span><span>                    </span><span class="hs-comment">-- Max iterations</span><span>
</span><a name="line-124"></a><span>        </span><a href="CoreMonad.html#SimplifierMode"><span class="hs-identifier hs-type">SimplifierMode</span></a><span>
</span><a name="line-125"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoPluginPass"><a href="CoreMonad.html#CoreDoPluginPass"><span class="hs-identifier">CoreDoPluginPass</span></a></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><a href="CoreMonad.html#PluginPass"><span class="hs-identifier hs-type">PluginPass</span></a><span>
</span><a name="line-126"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoFloatInwards"><a href="CoreMonad.html#CoreDoFloatInwards"><span class="hs-identifier">CoreDoFloatInwards</span></a></a><span>
</span><a name="line-127"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoFloatOutwards"><a href="CoreMonad.html#CoreDoFloatOutwards"><span class="hs-identifier">CoreDoFloatOutwards</span></a></a><span> </span><a href="CoreMonad.html#FloatOutSwitches"><span class="hs-identifier hs-type">FloatOutSwitches</span></a><span>
</span><a name="line-128"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreLiberateCase"><a href="CoreMonad.html#CoreLiberateCase"><span class="hs-identifier">CoreLiberateCase</span></a></a><span>
</span><a name="line-129"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoPrintCore"><a href="CoreMonad.html#CoreDoPrintCore"><span class="hs-identifier">CoreDoPrintCore</span></a></a><span>
</span><a name="line-130"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoStaticArgs"><a href="CoreMonad.html#CoreDoStaticArgs"><span class="hs-identifier">CoreDoStaticArgs</span></a></a><span>
</span><a name="line-131"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoCallArity"><a href="CoreMonad.html#CoreDoCallArity"><span class="hs-identifier">CoreDoCallArity</span></a></a><span>
</span><a name="line-132"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoStrictness"><a href="CoreMonad.html#CoreDoStrictness"><span class="hs-identifier">CoreDoStrictness</span></a></a><span>
</span><a name="line-133"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoWorkerWrapper"><a href="CoreMonad.html#CoreDoWorkerWrapper"><span class="hs-identifier">CoreDoWorkerWrapper</span></a></a><span>
</span><a name="line-134"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoSpecialising"><a href="CoreMonad.html#CoreDoSpecialising"><span class="hs-identifier">CoreDoSpecialising</span></a></a><span>
</span><a name="line-135"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoSpecConstr"><a href="CoreMonad.html#CoreDoSpecConstr"><span class="hs-identifier">CoreDoSpecConstr</span></a></a><span>
</span><a name="line-136"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreCSE"><a href="CoreMonad.html#CoreCSE"><span class="hs-identifier">CoreCSE</span></a></a><span>
</span><a name="line-137"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoRuleCheck"><a href="CoreMonad.html#CoreDoRuleCheck"><span class="hs-identifier">CoreDoRuleCheck</span></a></a><span> </span><a href="BasicTypes.html#CompilerPhase"><span class="hs-identifier hs-type">CompilerPhase</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span>   </span><span class="hs-comment">-- Check for non-application of rules</span><span>
</span><a name="line-138"></a><span>                                           </span><span class="hs-comment">-- matching this string</span><span>
</span><a name="line-139"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoVectorisation"><a href="CoreMonad.html#CoreDoVectorisation"><span class="hs-identifier">CoreDoVectorisation</span></a></a><span>
</span><a name="line-140"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoNothing"><a href="CoreMonad.html#CoreDoNothing"><span class="hs-identifier">CoreDoNothing</span></a></a><span>                </span><span class="hs-comment">-- Useful when building up</span><span>
</span><a name="line-141"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoPasses"><a href="CoreMonad.html#CoreDoPasses"><span class="hs-identifier">CoreDoPasses</span></a></a><span> </span><span class="hs-special">[</span><a href="CoreMonad.html#CoreToDo"><span class="hs-identifier hs-type">CoreToDo</span></a><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- lists of these things</span><span>
</span><a name="line-142"></a><span>
</span><a name="line-143"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDesugar"><a href="CoreMonad.html#CoreDesugar"><span class="hs-identifier">CoreDesugar</span></a></a><span>    </span><span class="hs-comment">-- Right after desugaring, no simple optimisation yet!</span><span>
</span><a name="line-144"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDesugarOpt"><a href="CoreMonad.html#CoreDesugarOpt"><span class="hs-identifier">CoreDesugarOpt</span></a></a><span> </span><span class="hs-comment">-- CoreDesugarXXX: Not strictly a core-to-core pass, but produces</span><span>
</span><a name="line-145"></a><span>                       </span><span class="hs-comment">--                 Core output, and hence useful to pass to endPass</span><span>
</span><a name="line-146"></a><span>
</span><a name="line-147"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreTidy"><a href="CoreMonad.html#CoreTidy"><span class="hs-identifier">CoreTidy</span></a></a><span>
</span><a name="line-148"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CorePrep"><a href="CoreMonad.html#CorePrep"><span class="hs-identifier">CorePrep</span></a></a><span>
</span><a name="line-149"></a><span>
</span><a name="line-150"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="CoreMonad.html#CoreToDo"><span class="hs-identifier hs-type">CoreToDo</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-151"></a><span>  </span><a name="local-1912652361"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CoreDoSimplify"><span class="hs-identifier hs-var">CoreDoSimplify</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Simplifier&quot;</span><span>
</span><a name="line-152"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CoreDoPluginPass"><span class="hs-identifier hs-var">CoreDoPluginPass</span></a><span> </span><a name="local-1628078187"><a href="#local-1628078187"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Core plugin: &quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-1628078187"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-153"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreDoFloatInwards"><span class="hs-identifier hs-var">CoreDoFloatInwards</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Float inwards&quot;</span><span>
</span><a name="line-154"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CoreDoFloatOutwards"><span class="hs-identifier hs-var">CoreDoFloatOutwards</span></a><span> </span><a name="local-1628078188"><a href="#local-1628078188"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Float out&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628078188"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-155"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreLiberateCase"><span class="hs-identifier hs-var">CoreLiberateCase</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Liberate case&quot;</span><span>
</span><a name="line-156"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreDoStaticArgs"><span class="hs-identifier hs-var">CoreDoStaticArgs</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Static argument&quot;</span><span>
</span><a name="line-157"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreDoCallArity"><span class="hs-identifier hs-var">CoreDoCallArity</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Called arity analysis&quot;</span><span>
</span><a name="line-158"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreDoStrictness"><span class="hs-identifier hs-var">CoreDoStrictness</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Demand analysis&quot;</span><span>
</span><a name="line-159"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreDoWorkerWrapper"><span class="hs-identifier hs-var">CoreDoWorkerWrapper</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Worker Wrapper binds&quot;</span><span>
</span><a name="line-160"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreDoSpecialising"><span class="hs-identifier hs-var">CoreDoSpecialising</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Specialise&quot;</span><span>
</span><a name="line-161"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreDoSpecConstr"><span class="hs-identifier hs-var">CoreDoSpecConstr</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;SpecConstr&quot;</span><span>
</span><a name="line-162"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreCSE"><span class="hs-identifier hs-var">CoreCSE</span></a><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Common sub-expression&quot;</span><span>
</span><a name="line-163"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreDoVectorisation"><span class="hs-identifier hs-var">CoreDoVectorisation</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Vectorisation&quot;</span><span>
</span><a name="line-164"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreDesugar"><span class="hs-identifier hs-var">CoreDesugar</span></a><span>              </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Desugar (before optimization)&quot;</span><span>
</span><a name="line-165"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreDesugarOpt"><span class="hs-identifier hs-var">CoreDesugarOpt</span></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Desugar (after optimization)&quot;</span><span>
</span><a name="line-166"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreTidy"><span class="hs-identifier hs-var">CoreTidy</span></a><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Tidy Core&quot;</span><span>
</span><a name="line-167"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CorePrep"><span class="hs-identifier hs-var">CorePrep</span></a><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;CorePrep&quot;</span><span>
</span><a name="line-168"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreDoPrintCore"><span class="hs-identifier hs-var">CoreDoPrintCore</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Print core&quot;</span><span>
</span><a name="line-169"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CoreDoRuleCheck"><span class="hs-identifier hs-var">CoreDoRuleCheck</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Rule check&quot;</span><span>
</span><a name="line-170"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreDoNothing"><span class="hs-identifier hs-var">CoreDoNothing</span></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;CoreDoNothing&quot;</span><span>
</span><a name="line-171"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CoreDoPasses"><span class="hs-identifier hs-var">CoreDoPasses</span></a><span> </span><a name="local-1628078189"><a href="#local-1628078189"><span class="hs-identifier">passes</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;CoreDoPasses&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628078189"><span class="hs-identifier hs-var">passes</span></a><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-identifier">pprPassDetails</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreToDo"><span class="hs-identifier hs-type">CoreToDo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-174"></a><a name="pprPassDetails"><a href="CoreMonad.html#pprPassDetails"><span class="hs-identifier">pprPassDetails</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CoreDoSimplify"><span class="hs-identifier hs-var">CoreDoSimplify</span></a><span> </span><a name="local-1628077983"><a href="#local-1628077983"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-1628077984"><a href="#local-1628077984"><span class="hs-identifier">md</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Max iterations =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#int"><span class="hs-identifier hs-var">int</span></a><span> </span><a href="#local-1628077983"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-175"></a><span>                                            </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628077984"><span class="hs-identifier hs-var">md</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-176"></a><span class="hs-identifier">pprPassDetails</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">Outputable</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-177"></a><span>
</span><a name="line-178"></a><span class="hs-keyword">data</span><span> </span><a name="SimplifierMode"><a href="CoreMonad.html#SimplifierMode"><span class="hs-identifier">SimplifierMode</span></a></a><span>             </span><span class="hs-comment">-- See comments in SimplMonad</span><span>
</span><a name="line-179"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="SimplMode"><a href="CoreMonad.html#SimplMode"><span class="hs-identifier">SimplMode</span></a></a><span>
</span><a name="line-180"></a><span>        </span><span class="hs-special">{</span><span> </span><a name="sm_names"><a href="CoreMonad.html#sm_names"><span class="hs-identifier">sm_names</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Name(s) of the phase</span><span>
</span><a name="line-181"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="sm_phase"><a href="CoreMonad.html#sm_phase"><span class="hs-identifier">sm_phase</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#CompilerPhase"><span class="hs-identifier hs-type">CompilerPhase</span></a><span>
</span><a name="line-182"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="sm_rules"><a href="CoreMonad.html#sm_rules"><span class="hs-identifier">sm_rules</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>     </span><span class="hs-comment">-- Whether RULES are enabled</span><span>
</span><a name="line-183"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="sm_inline"><a href="CoreMonad.html#sm_inline"><span class="hs-identifier">sm_inline</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>     </span><span class="hs-comment">-- Whether inlining is enabled</span><span>
</span><a name="line-184"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="sm_case_case"><a href="CoreMonad.html#sm_case_case"><span class="hs-identifier">sm_case_case</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>     </span><span class="hs-comment">-- Whether case-of-case is enabled</span><span>
</span><a name="line-185"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="sm_eta_expand"><a href="CoreMonad.html#sm_eta_expand"><span class="hs-identifier">sm_eta_expand</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>     </span><span class="hs-comment">-- Whether eta-expansion is enabled</span><span>
</span><a name="line-186"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="CoreMonad.html#SimplifierMode"><span class="hs-identifier hs-type">SimplifierMode</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-189"></a><span>    </span><a name="local-1912652361"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#SimplMode"><span class="hs-identifier hs-var">SimplMode</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sm_phase</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628078178"><a href="#local-1628078178"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">sm_names</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628078179"><a href="#local-1628078179"><span class="hs-identifier">ss</span></a></a><span>
</span><a name="line-190"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sm_rules</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628078180"><a href="#local-1628078180"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">sm_inline</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628078181"><a href="#local-1628078181"><span class="hs-identifier">i</span></a></a><span>
</span><a name="line-191"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sm_eta_expand</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628078182"><a href="#local-1628078182"><span class="hs-identifier">eta</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">sm_case_case</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628078183"><a href="#local-1628078183"><span class="hs-identifier">cc</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-192"></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;SimplMode&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a><span> </span><span class="hs-special">(</span><span>
</span><a name="line-193"></a><span>         </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Phase =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628078178"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-194"></a><span>               </span><a href="Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#intersperse"><span class="hs-identifier hs-var">intersperse</span></a><span> </span><span class="hs-string">&quot;,&quot;</span><span> </span><a href="#local-1628078179"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span>
</span><a name="line-195"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="#local-1628078184"><span class="hs-identifier hs-var">pp_flag</span></a><span> </span><a href="#local-1628078181"><span class="hs-identifier hs-var">i</span></a><span>   </span><span class="hs-special">(</span><a href="FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a><span> </span><span class="hs-string">&quot;inline&quot;</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span>
</span><a name="line-196"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="#local-1628078184"><span class="hs-identifier hs-var">pp_flag</span></a><span> </span><a href="#local-1628078180"><span class="hs-identifier hs-var">r</span></a><span>   </span><span class="hs-special">(</span><a href="FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a><span> </span><span class="hs-string">&quot;rules&quot;</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span>
</span><a name="line-197"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="#local-1628078184"><span class="hs-identifier hs-var">pp_flag</span></a><span> </span><a href="#local-1628078182"><span class="hs-identifier hs-var">eta</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a><span> </span><span class="hs-string">&quot;eta-expand&quot;</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span>
</span><a name="line-198"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="#local-1628078184"><span class="hs-identifier hs-var">pp_flag</span></a><span> </span><a href="#local-1628078183"><span class="hs-identifier hs-var">cc</span></a><span>  </span><span class="hs-special">(</span><a href="FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a><span> </span><span class="hs-string">&quot;case-of-case&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-199"></a><span>         </span><span class="hs-keyword">where</span><span>
</span><a name="line-200"></a><span>           </span><a name="local-1628078184"><a href="#local-1628078184"><span class="hs-identifier">pp_flag</span></a></a><span> </span><a name="local-1628078185"><a href="#local-1628078185"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1628078186"><a href="#local-1628078186"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a><span> </span><a href="#local-1628078185"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;no&quot;</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ptext"><span class="hs-identifier hs-var">ptext</span></a><span> </span><a href="#local-1628078186"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-201"></a><span>
</span><a name="line-202"></a><span class="hs-keyword">data</span><span> </span><a name="FloatOutSwitches"><a href="CoreMonad.html#FloatOutSwitches"><span class="hs-identifier">FloatOutSwitches</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="FloatOutSwitches"><a href="CoreMonad.html#FloatOutSwitches"><span class="hs-identifier">FloatOutSwitches</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-203"></a><span>  </span><a name="floatOutLambdas"><a href="CoreMonad.html#floatOutLambdas"><span class="hs-identifier">floatOutLambdas</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- ^ Just n &lt;=&gt; float lambdas to top level, if</span><span>
</span><a name="line-204"></a><span>                                   </span><span class="hs-comment">-- doing so will abstract over n or fewer</span><span>
</span><a name="line-205"></a><span>                                   </span><span class="hs-comment">-- value variables</span><span>
</span><a name="line-206"></a><span>                                   </span><span class="hs-comment">-- Nothing &lt;=&gt; float all lambdas to top level,</span><span>
</span><a name="line-207"></a><span>                                   </span><span class="hs-comment">--             regardless of how many free variables</span><span>
</span><a name="line-208"></a><span>                                   </span><span class="hs-comment">-- Just 0 is the vanilla case: float a lambda</span><span>
</span><a name="line-209"></a><span>                                   </span><span class="hs-comment">--    iff it has no free vars</span><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span>  </span><a name="floatOutConstants"><a href="CoreMonad.html#floatOutConstants"><span class="hs-identifier">floatOutConstants</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- ^ True &lt;=&gt; float constants to top level,</span><span>
</span><a name="line-212"></a><span>                                   </span><span class="hs-comment">--            even if they do not escape a lambda</span><span>
</span><a name="line-213"></a><span>  </span><a name="floatOutOverSatApps"><a href="CoreMonad.html#floatOutOverSatApps"><span class="hs-identifier">floatOutOverSatApps</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>      </span><span class="hs-comment">-- ^ True &lt;=&gt; float out over-saturated applications</span><span>
</span><a name="line-214"></a><span>                                   </span><span class="hs-comment">--            based on arity information.</span><span>
</span><a name="line-215"></a><span>                                   </span><span class="hs-comment">-- See Note [Floating over-saturated applications]</span><span>
</span><a name="line-216"></a><span>                                   </span><span class="hs-comment">-- in SetLevels</span><span>
</span><a name="line-217"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-218"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="CoreMonad.html#FloatOutSwitches"><span class="hs-identifier hs-type">FloatOutSwitches</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-219"></a><span>    </span><a name="local-1912652361"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#pprFloatOutSwitches"><span class="hs-identifier hs-var">pprFloatOutSwitches</span></a><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span class="hs-identifier">pprFloatOutSwitches</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#FloatOutSwitches"><span class="hs-identifier hs-type">FloatOutSwitches</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-222"></a><a name="pprFloatOutSwitches"><a href="CoreMonad.html#pprFloatOutSwitches"><span class="hs-identifier">pprFloatOutSwitches</span></a></a><span> </span><a name="local-1628077985"><a href="#local-1628077985"><span class="hs-identifier">sw</span></a></a><span>
</span><a name="line-223"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;FOS&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-224"></a><span>     </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-225"></a><span>     </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Lam =&quot;</span><span>    </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">floatOutLambdas</span><span> </span><a href="#local-1628077985"><span class="hs-identifier hs-var">sw</span></a><span class="hs-special">)</span><span>
</span><a name="line-226"></a><span>     </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Consts =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">floatOutConstants</span><span> </span><a href="#local-1628077985"><span class="hs-identifier hs-var">sw</span></a><span class="hs-special">)</span><span>
</span><a name="line-227"></a><span>     </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;OverSatApps =&quot;</span><span>   </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">floatOutOverSatApps</span><span> </span><a href="#local-1628077985"><span class="hs-identifier hs-var">sw</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-228"></a><span>
</span><a name="line-229"></a><span class="hs-comment">-- The core-to-core pass ordering is derived from the DynFlags:</span><span>
</span><a name="line-230"></a><span class="hs-identifier">runWhen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreToDo"><span class="hs-identifier hs-type">CoreToDo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreToDo"><span class="hs-identifier hs-type">CoreToDo</span></a><span>
</span><a name="line-231"></a><a name="runWhen"><a href="CoreMonad.html#runWhen"><span class="hs-identifier">runWhen</span></a></a><span> </span><span class="hs-identifier hs-var">True</span><span>  </span><a name="local-1628077986"><a href="#local-1628077986"><span class="hs-identifier">do_this</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628077986"><span class="hs-identifier hs-var">do_this</span></a><span>
</span><a name="line-232"></a><span class="hs-identifier">runWhen</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreDoNothing"><span class="hs-identifier hs-var">CoreDoNothing</span></a><span>
</span><a name="line-233"></a><span>
</span><a name="line-234"></a><span class="hs-identifier">runMaybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="#local-1628077982"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1628077982"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreToDo"><span class="hs-identifier hs-type">CoreToDo</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreToDo"><span class="hs-identifier hs-type">CoreToDo</span></a><span>
</span><a name="line-235"></a><a name="runMaybe"><a href="CoreMonad.html#runMaybe"><span class="hs-identifier">runMaybe</span></a></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628077987"><a href="#local-1628077987"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628077988"><a href="#local-1628077988"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628077988"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1628077987"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-236"></a><span class="hs-identifier">runMaybe</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreDoNothing"><span class="hs-identifier hs-var">CoreDoNothing</span></a><span>
</span><a name="line-237"></a><span>
</span><a name="line-238"></a><span class="hs-comment">{-
Note [RULEs enabled in SimplGently]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
RULES are enabled when doing &quot;gentle&quot; simplification.  Two reasons:

  * We really want the class-op cancellation to happen:
        op (df d1 d2) --&gt; $cop3 d1 d2
    because this breaks the mutual recursion between 'op' and 'df'

  * I wanted the RULE
        lift String ===&gt; ...
    to work in Template Haskell when simplifying
    splices, so we get simpler code for literal strings

But watch out: list fusion can prevent floating.  So use phase control
to switch off those rules until after floating.


************************************************************************
*                                                                      *
             Types for Plugins
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-262"></a><span>
</span><a name="line-263"></a><span class="hs-comment">-- | A description of the plugin pass itself</span><span>
</span><a name="line-264"></a><span class="hs-keyword">type</span><span> </span><a name="PluginPass"><a href="CoreMonad.html#PluginPass"><span class="hs-identifier">PluginPass</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="HscTypes.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a><span>
</span><a name="line-265"></a><span>
</span><a name="line-266"></a><span class="hs-identifier">bindsOnlyPass</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#CoreProgram"><span class="hs-identifier hs-type">CoreProgram</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="CoreSyn.html#CoreProgram"><span class="hs-identifier hs-type">CoreProgram</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="HscTypes.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a><span>
</span><a name="line-267"></a><a name="bindsOnlyPass"><a href="CoreMonad.html#bindsOnlyPass"><span class="hs-identifier">bindsOnlyPass</span></a></a><span> </span><a name="local-1628077989"><a href="#local-1628077989"><span class="hs-identifier">pass</span></a></a><span> </span><a name="local-1628077990"><a href="#local-1628077990"><span class="hs-identifier">guts</span></a></a><span>
</span><a name="line-268"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628077991"><a href="#local-1628077991"><span class="hs-identifier">binds'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628077989"><span class="hs-identifier hs-var">pass</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mg_binds</span><span> </span><a href="#local-1628077990"><span class="hs-identifier hs-var">guts</span></a><span class="hs-special">)</span><span>
</span><a name="line-269"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628077990"><span class="hs-identifier hs-var">guts</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mg_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628077991"><span class="hs-identifier hs-var">binds'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-270"></a><span>
</span><a name="line-271"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
             Counting and logging
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-278"></a><span>
</span><a name="line-279"></a><span class="hs-identifier">verboseSimplStats</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-280"></a><a name="verboseSimplStats"><a href="CoreMonad.html#verboseSimplStats"><span class="hs-identifier">verboseSimplStats</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StaticFlags.html#opt_PprStyle_Debug"><span class="hs-identifier hs-var">opt_PprStyle_Debug</span></a><span>          </span><span class="hs-comment">-- For now, anyway</span><span>
</span><a name="line-281"></a><span>
</span><a name="line-282"></a><span class="hs-identifier">zeroSimplCount</span><span>     </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span>
</span><a name="line-283"></a><span class="hs-identifier">isZeroSimplCount</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-284"></a><span class="hs-identifier">hasDetailedCounts</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-285"></a><span class="hs-identifier">pprSimplCount</span><span>      </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-286"></a><span class="hs-identifier">doSimplTick</span><span>        </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span>
</span><a name="line-287"></a><span class="hs-identifier">doFreeSimplTick</span><span>    </span><span class="hs-glyph">::</span><span>             </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span>
</span><a name="line-288"></a><span class="hs-identifier">plusSimplCount</span><span>     </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span>
</span><a name="line-289"></a><span>
</span><a name="line-290"></a><span class="hs-keyword">data</span><span> </span><a name="SimplCount"><a href="CoreMonad.html#SimplCount"><span class="hs-identifier">SimplCount</span></a></a><span>
</span><a name="line-291"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a name="VerySimplCount"><a href="CoreMonad.html#VerySimplCount"><span class="hs-identifier">VerySimplCount</span></a></a><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int</span><span>        </span><span class="hs-comment">-- Used when don't want detailed stats</span><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a name="SimplCount"><a href="CoreMonad.html#SimplCount"><span class="hs-identifier">SimplCount</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-294"></a><span>        </span><a name="ticks"><a href="CoreMonad.html#ticks"><span class="hs-identifier">ticks</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span>        </span><span class="hs-comment">-- Total ticks</span><span>
</span><a name="line-295"></a><span>        </span><a name="details"><a href="CoreMonad.html#details"><span class="hs-identifier">details</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="CoreMonad.html#TickCounts"><span class="hs-identifier hs-type">TickCounts</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- How many of each type</span><span>
</span><a name="line-296"></a><span>
</span><a name="line-297"></a><span>        </span><a name="n_log"><a href="CoreMonad.html#n_log"><span class="hs-identifier">n_log</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span>        </span><span class="hs-comment">-- N</span><span>
</span><a name="line-298"></a><span>        </span><a name="log1"><a href="CoreMonad.html#log1"><span class="hs-identifier">log1</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>      </span><span class="hs-comment">-- Last N events; &lt;= opt_HistorySize,</span><span>
</span><a name="line-299"></a><span>                                </span><span class="hs-comment">--   most recent first</span><span>
</span><a name="line-300"></a><span>        </span><a name="log2"><a href="CoreMonad.html#log2"><span class="hs-identifier">log2</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- Last opt_HistorySize events before that</span><span>
</span><a name="line-301"></a><span>                                </span><span class="hs-comment">-- Having log1, log2 lets us accumulate the</span><span>
</span><a name="line-302"></a><span>                                </span><span class="hs-comment">-- recent history reasonably efficiently</span><span>
</span><a name="line-303"></a><span>     </span><span class="hs-special">}</span><span>
</span><a name="line-304"></a><span>
</span><a name="line-305"></a><span class="hs-keyword">type</span><span> </span><a name="TickCounts"><a href="CoreMonad.html#TickCounts"><span class="hs-identifier">TickCounts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#Map"><span class="hs-identifier hs-type">Map</span></a><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-306"></a><span>
</span><a name="line-307"></a><span class="hs-identifier">simplCountN</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-308"></a><a name="simplCountN"><a href="CoreMonad.html#simplCountN"><span class="hs-identifier">simplCountN</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#VerySimplCount"><span class="hs-identifier hs-var">VerySimplCount</span></a><span> </span><a name="local-1628077992"><a href="#local-1628077992"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628077992"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-309"></a><span class="hs-identifier">simplCountN</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-var">SimplCount</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ticks</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628077993"><a href="#local-1628077993"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628077993"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-310"></a><span>
</span><a name="line-311"></a><a name="zeroSimplCount"><a href="CoreMonad.html#zeroSimplCount"><span class="hs-identifier">zeroSimplCount</span></a></a><span> </span><a name="local-1628077994"><a href="#local-1628077994"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-312"></a><span>                </span><span class="hs-comment">-- This is where we decide whether to do</span><span>
</span><a name="line-313"></a><span>                </span><span class="hs-comment">-- the VerySimpl version or the full-stats version</span><span>
</span><a name="line-314"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#dopt"><span class="hs-identifier hs-var">dopt</span></a><span> </span><a href="DynFlags.html#Opt_D_dump_simpl_stats"><span class="hs-identifier hs-var">Opt_D_dump_simpl_stats</span></a><span> </span><a href="#local-1628077994"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-315"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-var">SimplCount</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">ticks</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">details</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#empty"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span></a><span class="hs-special">,</span><span>
</span><a name="line-316"></a><span>                </span><span class="hs-identifier">n_log</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">log1</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">log2</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">}</span><span>
</span><a name="line-317"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-318"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#VerySimplCount"><span class="hs-identifier hs-var">VerySimplCount</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-319"></a><span>
</span><a name="line-320"></a><a name="isZeroSimplCount"><a href="CoreMonad.html#isZeroSimplCount"><span class="hs-identifier">isZeroSimplCount</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#VerySimplCount"><span class="hs-identifier hs-var">VerySimplCount</span></a><span> </span><a name="local-1628077995"><a href="#local-1628077995"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628077995"><span class="hs-identifier hs-var">n</span></a><span class="hs-operator hs-var">==</span><span class="hs-number">0</span><span>
</span><a name="line-321"></a><span class="hs-identifier">isZeroSimplCount</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-var">SimplCount</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ticks</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628077996"><a href="#local-1628077996"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628077996"><span class="hs-identifier hs-var">n</span></a><span class="hs-operator hs-var">==</span><span class="hs-number">0</span><span>
</span><a name="line-322"></a><span>
</span><a name="line-323"></a><a name="hasDetailedCounts"><a href="CoreMonad.html#hasDetailedCounts"><span class="hs-identifier">hasDetailedCounts</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#VerySimplCount"><span class="hs-identifier hs-var">VerySimplCount</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-324"></a><span class="hs-identifier">hasDetailedCounts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-var">SimplCount</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-325"></a><span>
</span><a name="line-326"></a><a name="doFreeSimplTick"><a href="CoreMonad.html#doFreeSimplTick"><span class="hs-identifier">doFreeSimplTick</span></a></a><span> </span><a name="local-1628077997"><a href="#local-1628077997"><span class="hs-identifier">tick</span></a></a><span> </span><a name="local-1628077998"><a href="#local-1628077998"><span class="hs-identifier">sc</span></a></a><span class="hs-glyph">@</span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-var">SimplCount</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">details</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628077999"><a href="#local-1628077999"><span class="hs-identifier">dts</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-327"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628077998"><span class="hs-identifier hs-var">sc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">details</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628077999"><span class="hs-identifier hs-var">dts</span></a><span> </span><span class="hs-special">`</span><a href="CoreMonad.html#addTick"><span class="hs-identifier hs-var">addTick</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628077997"><span class="hs-identifier hs-var">tick</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-328"></a><span class="hs-identifier">doFreeSimplTick</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628078000"><a href="#local-1628078000"><span class="hs-identifier">sc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078000"><span class="hs-identifier hs-var">sc</span></a><span>
</span><a name="line-329"></a><span>
</span><a name="line-330"></a><a name="doSimplTick"><a href="CoreMonad.html#doSimplTick"><span class="hs-identifier">doSimplTick</span></a></a><span> </span><a name="local-1628078001"><a href="#local-1628078001"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1628078002"><a href="#local-1628078002"><span class="hs-identifier">tick</span></a></a><span>
</span><a name="line-331"></a><span>    </span><a name="local-1628078003"><a href="#local-1628078003"><span class="hs-identifier">sc</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-var">SimplCount</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ticks</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628078004"><a href="#local-1628078004"><span class="hs-identifier">tks</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">details</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628078005"><a href="#local-1628078005"><span class="hs-identifier">dts</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">n_log</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628078006"><a href="#local-1628078006"><span class="hs-identifier">nl</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">log1</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628078007"><a href="#local-1628078007"><span class="hs-identifier">l1</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-332"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628078006"><span class="hs-identifier hs-var">nl</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-identifier">historySize</span><span> </span><a href="#local-1628078001"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078008"><span class="hs-identifier hs-var">sc1</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">n_log</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">log1</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-1628078002"><span class="hs-identifier hs-var">tick</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">log2</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078007"><span class="hs-identifier hs-var">l1</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-333"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078008"><span class="hs-identifier hs-var">sc1</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">n_log</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078006"><span class="hs-identifier hs-var">nl</span></a><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">log1</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078002"><span class="hs-identifier hs-var">tick</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628078007"><span class="hs-identifier hs-var">l1</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-334"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-335"></a><span>    </span><a name="local-1628078008"><a href="#local-1628078008"><span class="hs-identifier">sc1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078003"><span class="hs-identifier hs-var">sc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ticks</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078004"><span class="hs-identifier hs-var">tks</span></a><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">details</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078005"><span class="hs-identifier hs-var">dts</span></a><span> </span><span class="hs-special">`</span><a href="CoreMonad.html#addTick"><span class="hs-identifier hs-var">addTick</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628078002"><span class="hs-identifier hs-var">tick</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-336"></a><span>
</span><a name="line-337"></a><span class="hs-identifier">doSimplTick</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#VerySimplCount"><span class="hs-identifier hs-var">VerySimplCount</span></a><span> </span><a name="local-1628078009"><a href="#local-1628078009"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#VerySimplCount"><span class="hs-identifier hs-var">VerySimplCount</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628078009"><span class="hs-identifier hs-var">n</span></a><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-338"></a><span>
</span><a name="line-339"></a><span>
</span><a name="line-340"></a><span class="hs-comment">-- Don't use Map.unionWith because that's lazy, and we want to</span><span>
</span><a name="line-341"></a><span class="hs-comment">-- be pretty strict here!</span><span>
</span><a name="line-342"></a><span class="hs-identifier">addTick</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#TickCounts"><span class="hs-identifier hs-type">TickCounts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#TickCounts"><span class="hs-identifier hs-type">TickCounts</span></a><span>
</span><a name="line-343"></a><a name="addTick"><a href="CoreMonad.html#addTick"><span class="hs-identifier">addTick</span></a></a><span> </span><a name="local-1628078010"><a href="#local-1628078010"><span class="hs-identifier">fm</span></a></a><span> </span><a name="local-1628078011"><a href="#local-1628078011"><span class="hs-identifier">tick</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#lookup"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">lookup</span></a><span> </span><a href="#local-1628078011"><span class="hs-identifier hs-var">tick</span></a><span> </span><a href="#local-1628078010"><span class="hs-identifier hs-var">fm</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-344"></a><span>                        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#insert"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">insert</span></a><span> </span><a href="#local-1628078011"><span class="hs-identifier hs-var">tick</span></a><span> </span><span class="hs-number">1</span><span> </span><a href="#local-1628078010"><span class="hs-identifier hs-var">fm</span></a><span>
</span><a name="line-345"></a><span>                        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628078012"><a href="#local-1628078012"><span class="hs-identifier">n</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628078013"><span class="hs-identifier hs-var">n1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#insert"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">insert</span></a><span> </span><a href="#local-1628078011"><span class="hs-identifier hs-var">tick</span></a><span> </span><a href="#local-1628078013"><span class="hs-identifier hs-var">n1</span></a><span> </span><a href="#local-1628078010"><span class="hs-identifier hs-var">fm</span></a><span>
</span><a name="line-346"></a><span>                                </span><span class="hs-keyword">where</span><span>
</span><a name="line-347"></a><span>                                   </span><a name="local-1628078013"><a href="#local-1628078013"><span class="hs-identifier">n1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078012"><span class="hs-identifier hs-var">n</span></a><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span class="hs-number">1</span><span>
</span><a name="line-348"></a><span>
</span><a name="line-349"></a><span>
</span><a name="line-350"></a><a name="plusSimplCount"><a href="CoreMonad.html#plusSimplCount"><span class="hs-identifier">plusSimplCount</span></a></a><span> </span><a name="local-1628078014"><a href="#local-1628078014"><span class="hs-identifier">sc1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-var">SimplCount</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ticks</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628078015"><a href="#local-1628078015"><span class="hs-identifier">tks1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">details</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628078016"><a href="#local-1628078016"><span class="hs-identifier">dts1</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-351"></a><span>               </span><a name="local-1628078017"><a href="#local-1628078017"><span class="hs-identifier">sc2</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-var">SimplCount</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ticks</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628078018"><a href="#local-1628078018"><span class="hs-identifier">tks2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">details</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628078019"><a href="#local-1628078019"><span class="hs-identifier">dts2</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-352"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078020"><span class="hs-identifier hs-var">log_base</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ticks</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078015"><span class="hs-identifier hs-var">tks1</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span> </span><a href="#local-1628078018"><span class="hs-identifier hs-var">tks2</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">details</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#unionWith"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">unionWith</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628078016"><span class="hs-identifier hs-var">dts1</span></a><span> </span><a href="#local-1628078019"><span class="hs-identifier hs-var">dts2</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-353"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-354"></a><span>        </span><span class="hs-comment">-- A hackish way of getting recent log info</span><span>
</span><a name="line-355"></a><span>    </span><a name="local-1628078020"><a href="#local-1628078020"><span class="hs-identifier">log_base</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">log1</span><span> </span><a href="#local-1628078017"><span class="hs-identifier hs-var">sc2</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078014"><span class="hs-identifier hs-var">sc1</span></a><span>    </span><span class="hs-comment">-- Nothing at all in sc2</span><span>
</span><a name="line-356"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">log2</span><span> </span><a href="#local-1628078017"><span class="hs-identifier hs-var">sc2</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078017"><span class="hs-identifier hs-var">sc2</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">log2</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">log1</span><span> </span><a href="#local-1628078014"><span class="hs-identifier hs-var">sc1</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-357"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078017"><span class="hs-identifier hs-var">sc2</span></a><span>
</span><a name="line-358"></a><span>
</span><a name="line-359"></a><span class="hs-identifier">plusSimplCount</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#VerySimplCount"><span class="hs-identifier hs-var">VerySimplCount</span></a><span> </span><a name="local-1628078021"><a href="#local-1628078021"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#VerySimplCount"><span class="hs-identifier hs-var">VerySimplCount</span></a><span> </span><a name="local-1628078022"><a href="#local-1628078022"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#VerySimplCount"><span class="hs-identifier hs-var">VerySimplCount</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628078021"><span class="hs-identifier hs-var">n</span></a><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><a href="#local-1628078022"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-360"></a><span class="hs-identifier">plusSimplCount</span><span> </span><span class="hs-identifier">_</span><span>                  </span><span class="hs-identifier">_</span><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;plusSimplCount&quot;</span><span>
</span><a name="line-361"></a><span>       </span><span class="hs-comment">-- We use one or the other consistently</span><span>
</span><a name="line-362"></a><span>
</span><a name="line-363"></a><a name="pprSimplCount"><a href="CoreMonad.html#pprSimplCount"><span class="hs-identifier">pprSimplCount</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#VerySimplCount"><span class="hs-identifier hs-var">VerySimplCount</span></a><span> </span><a name="local-1628078023"><a href="#local-1628078023"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Total ticks:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#int"><span class="hs-identifier hs-var">int</span></a><span> </span><a href="#local-1628078023"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-364"></a><span class="hs-identifier">pprSimplCount</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-var">SimplCount</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ticks</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628078024"><a href="#local-1628078024"><span class="hs-identifier">tks</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">details</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628078025"><a href="#local-1628078025"><span class="hs-identifier">dts</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">log1</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628078026"><a href="#local-1628078026"><span class="hs-identifier">l1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">log2</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628078027"><a href="#local-1628078027"><span class="hs-identifier">l2</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-365"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Total ticks:    &quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#int"><span class="hs-identifier hs-var">int</span></a><span> </span><a href="#local-1628078024"><span class="hs-identifier hs-var">tks</span></a><span class="hs-special">,</span><span>
</span><a name="line-366"></a><span>          </span><a href="Outputable.html#blankLine"><span class="hs-identifier hs-var">blankLine</span></a><span class="hs-special">,</span><span>
</span><a name="line-367"></a><span>          </span><a href="CoreMonad.html#pprTickCounts"><span class="hs-identifier hs-var">pprTickCounts</span></a><span> </span><a href="#local-1628078025"><span class="hs-identifier hs-var">dts</span></a><span class="hs-special">,</span><span>
</span><a name="line-368"></a><span>          </span><span class="hs-keyword">if</span><span> </span><a href="CoreMonad.html#verboseSimplStats"><span class="hs-identifier hs-var">verboseSimplStats</span></a><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-369"></a><span>                </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#blankLine"><span class="hs-identifier hs-var">blankLine</span></a><span class="hs-special">,</span><span>
</span><a name="line-370"></a><span>                      </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Log (most recent first)&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-371"></a><span>                      </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628078026"><span class="hs-identifier hs-var">l1</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628078027"><span class="hs-identifier hs-var">l2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-372"></a><span>          </span><span class="hs-keyword">else</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">Outputable</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-373"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-374"></a><span>
</span><a name="line-375"></a><span class="hs-identifier">pprTickCounts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#Map"><span class="hs-identifier hs-type">Map</span></a><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-376"></a><a name="pprTickCounts"><a href="CoreMonad.html#pprTickCounts"><span class="hs-identifier">pprTickCounts</span></a></a><span> </span><a name="local-1628078028"><a href="#local-1628078028"><span class="hs-identifier">counts</span></a></a><span>
</span><a name="line-377"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="CoreMonad.html#pprTickGroup"><span class="hs-identifier hs-var">pprTickGroup</span></a><span> </span><a href="#local-1628078029"><span class="hs-identifier hs-var">groups</span></a><span class="hs-special">)</span><span>
</span><a name="line-378"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-379"></a><span>    </span><span class="hs-identifier">groups</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- Each group shares a comon tag</span><span>
</span><a name="line-380"></a><span>                                </span><span class="hs-comment">-- toList returns common tags adjacent</span><span>
</span><a name="line-381"></a><span>    </span><a name="local-1628078029"><a href="#local-1628078029"><span class="hs-identifier">groups</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ListSetOps.html#runs"><span class="hs-identifier hs-var">runs</span></a><span> </span><a href="#local-1628078030"><span class="hs-identifier hs-var">same_tag</span></a><span> </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#toList"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toList</span></a><span> </span><a href="#local-1628078028"><span class="hs-identifier hs-var">counts</span></a><span class="hs-special">)</span><span>
</span><a name="line-382"></a><span>    </span><a name="local-1628078030"><a href="#local-1628078030"><span class="hs-identifier">same_tag</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628078031"><a href="#local-1628078031"><span class="hs-identifier">tick1</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1628078032"><a href="#local-1628078032"><span class="hs-identifier">tick2</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#tickToTag"><span class="hs-identifier hs-var">tickToTag</span></a><span> </span><a href="#local-1628078031"><span class="hs-identifier hs-var">tick1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="CoreMonad.html#tickToTag"><span class="hs-identifier hs-var">tickToTag</span></a><span> </span><a href="#local-1628078032"><span class="hs-identifier hs-var">tick2</span></a><span>
</span><a name="line-383"></a><span>
</span><a name="line-384"></a><span class="hs-identifier">pprTickGroup</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-385"></a><a name="pprTickGroup"><a href="CoreMonad.html#pprTickGroup"><span class="hs-identifier">pprTickGroup</span></a></a><span> </span><a name="local-1628078033"><a href="#local-1628078033"><span class="hs-identifier">group</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-1628078034"><a href="#local-1628078034"><span class="hs-identifier">tick1</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-386"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#int"><span class="hs-identifier hs-var">int</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#sum"><span class="hs-identifier hs-var">sum</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628078035"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-1628078035"><a href="#local-1628078035"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628078033"><span class="hs-identifier hs-var">group</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#tickString"><span class="hs-identifier hs-var">tickString</span></a><span> </span><a href="#local-1628078034"><span class="hs-identifier hs-var">tick1</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-387"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#int"><span class="hs-identifier hs-var">int</span></a><span> </span><a href="#local-1628078037"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="CoreMonad.html#pprTickCts"><span class="hs-identifier hs-var">pprTickCts</span></a><span> </span><a href="#local-1628078036"><span class="hs-identifier hs-var">tick</span></a><span>
</span><a name="line-388"></a><span>                                    </span><span class="hs-comment">-- flip as we want largest first</span><span>
</span><a name="line-389"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-1628078036"><a href="#local-1628078036"><span class="hs-identifier">tick</span></a></a><span class="hs-special">,</span><a name="local-1628078037"><a href="#local-1628078037"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Ord.html#comparing"><span class="hs-identifier hs-var">comparing</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1628078033"><span class="hs-identifier hs-var">group</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-390"></a><span class="hs-identifier">pprTickGroup</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;pprTickGroup&quot;</span><span>
</span><a name="line-391"></a><span>
</span><a name="line-392"></a><span class="hs-keyword">data</span><span> </span><a name="Tick"><a href="CoreMonad.html#Tick"><span class="hs-identifier">Tick</span></a></a><span>
</span><a name="line-393"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="PreInlineUnconditionally"><a href="CoreMonad.html#PreInlineUnconditionally"><span class="hs-identifier">PreInlineUnconditionally</span></a></a><span>    </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-394"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="PostInlineUnconditionally"><a href="CoreMonad.html#PostInlineUnconditionally"><span class="hs-identifier">PostInlineUnconditionally</span></a></a><span>   </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-395"></a><span>
</span><a name="line-396"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="UnfoldingDone"><a href="CoreMonad.html#UnfoldingDone"><span class="hs-identifier">UnfoldingDone</span></a></a><span>               </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-397"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="RuleFired"><a href="CoreMonad.html#RuleFired"><span class="hs-identifier">RuleFired</span></a></a><span>                   </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span>      </span><span class="hs-comment">-- Rule name</span><span>
</span><a name="line-398"></a><span>
</span><a name="line-399"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="LetFloatFromLet"><a href="CoreMonad.html#LetFloatFromLet"><span class="hs-identifier">LetFloatFromLet</span></a></a><span>
</span><a name="line-400"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="EtaExpansion"><a href="CoreMonad.html#EtaExpansion"><span class="hs-identifier">EtaExpansion</span></a></a><span>                </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>      </span><span class="hs-comment">-- LHS binder</span><span>
</span><a name="line-401"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="EtaReduction"><a href="CoreMonad.html#EtaReduction"><span class="hs-identifier">EtaReduction</span></a></a><span>                </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>      </span><span class="hs-comment">-- Binder on outer lambda</span><span>
</span><a name="line-402"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="BetaReduction"><a href="CoreMonad.html#BetaReduction"><span class="hs-identifier">BetaReduction</span></a></a><span>               </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>      </span><span class="hs-comment">-- Lambda binder</span><span>
</span><a name="line-403"></a><span>
</span><a name="line-404"></a><span>
</span><a name="line-405"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CaseOfCase"><a href="CoreMonad.html#CaseOfCase"><span class="hs-identifier">CaseOfCase</span></a></a><span>                  </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>      </span><span class="hs-comment">-- Bndr on *inner* case</span><span>
</span><a name="line-406"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="KnownBranch"><a href="CoreMonad.html#KnownBranch"><span class="hs-identifier">KnownBranch</span></a></a><span>                 </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>      </span><span class="hs-comment">-- Case binder</span><span>
</span><a name="line-407"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CaseMerge"><a href="CoreMonad.html#CaseMerge"><span class="hs-identifier">CaseMerge</span></a></a><span>                   </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>      </span><span class="hs-comment">-- Binder on outer case</span><span>
</span><a name="line-408"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="AltMerge"><a href="CoreMonad.html#AltMerge"><span class="hs-identifier">AltMerge</span></a></a><span>                    </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>      </span><span class="hs-comment">-- Case binder</span><span>
</span><a name="line-409"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CaseElim"><a href="CoreMonad.html#CaseElim"><span class="hs-identifier">CaseElim</span></a></a><span>                    </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>      </span><span class="hs-comment">-- Case binder</span><span>
</span><a name="line-410"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CaseIdentity"><a href="CoreMonad.html#CaseIdentity"><span class="hs-identifier">CaseIdentity</span></a></a><span>                </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>      </span><span class="hs-comment">-- Case binder</span><span>
</span><a name="line-411"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="FillInCaseDefault"><a href="CoreMonad.html#FillInCaseDefault"><span class="hs-identifier">FillInCaseDefault</span></a></a><span>           </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>      </span><span class="hs-comment">-- Case binder</span><span>
</span><a name="line-412"></a><span>
</span><a name="line-413"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="BottomFound"><a href="CoreMonad.html#BottomFound"><span class="hs-identifier">BottomFound</span></a></a><span>
</span><a name="line-414"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SimplifierDone"><a href="CoreMonad.html#SimplifierDone"><span class="hs-identifier">SimplifierDone</span></a></a><span>              </span><span class="hs-comment">-- Ticked at each iteration of the simplifier</span><span>
</span><a name="line-415"></a><span>
</span><a name="line-416"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-417"></a><span>  </span><a name="local-1912652361"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a name="local-1628078177"><a href="#local-1628078177"><span class="hs-identifier">tick</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#tickString"><span class="hs-identifier hs-var">tickString</span></a><span> </span><a href="#local-1628078177"><span class="hs-identifier hs-var">tick</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="CoreMonad.html#pprTickCts"><span class="hs-identifier hs-var">pprTickCts</span></a><span> </span><a href="#local-1628078177"><span class="hs-identifier hs-var">tick</span></a><span>
</span><a name="line-418"></a><span>
</span><a name="line-419"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-420"></a><span>  </span><a name="local-1628078175"><a href="#local-1628078175"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-805306535"><span class="hs-operator">==</span></a><span> </span><a name="local-1628078176"><a href="#local-1628078176"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628078175"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><a href="CoreMonad.html#cmpTick"><span class="hs-identifier hs-var">cmpTick</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628078176"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-421"></a><span>           </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-422"></a><span>           </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-423"></a><span>
</span><a name="line-424"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-425"></a><span>  </span><a name="local-1912608788"><span class="hs-identifier">compare</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#cmpTick"><span class="hs-identifier hs-var">cmpTick</span></a><span>
</span><a name="line-426"></a><span>
</span><a name="line-427"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-428"></a><a name="tickToTag"><a href="CoreMonad.html#tickToTag"><span class="hs-identifier">tickToTag</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#PreInlineUnconditionally"><span class="hs-identifier hs-var">PreInlineUnconditionally</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-429"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#PostInlineUnconditionally"><span class="hs-identifier hs-var">PostInlineUnconditionally</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-430"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#UnfoldingDone"><span class="hs-identifier hs-var">UnfoldingDone</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-431"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#RuleFired"><span class="hs-identifier hs-var">RuleFired</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">3</span><span>
</span><a name="line-432"></a><span class="hs-identifier">tickToTag</span><span> </span><a href="CoreMonad.html#LetFloatFromLet"><span class="hs-identifier hs-var">LetFloatFromLet</span></a><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">4</span><span>
</span><a name="line-433"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#EtaExpansion"><span class="hs-identifier hs-var">EtaExpansion</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">5</span><span>
</span><a name="line-434"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#EtaReduction"><span class="hs-identifier hs-var">EtaReduction</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">6</span><span>
</span><a name="line-435"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#BetaReduction"><span class="hs-identifier hs-var">BetaReduction</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">7</span><span>
</span><a name="line-436"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseOfCase"><span class="hs-identifier hs-var">CaseOfCase</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">8</span><span>
</span><a name="line-437"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#KnownBranch"><span class="hs-identifier hs-var">KnownBranch</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">9</span><span>
</span><a name="line-438"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseMerge"><span class="hs-identifier hs-var">CaseMerge</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">10</span><span>
</span><a name="line-439"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseElim"><span class="hs-identifier hs-var">CaseElim</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">11</span><span>
</span><a name="line-440"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseIdentity"><span class="hs-identifier hs-var">CaseIdentity</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">12</span><span>
</span><a name="line-441"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#FillInCaseDefault"><span class="hs-identifier hs-var">FillInCaseDefault</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">13</span><span>
</span><a name="line-442"></a><span class="hs-identifier">tickToTag</span><span> </span><a href="CoreMonad.html#BottomFound"><span class="hs-identifier hs-var">BottomFound</span></a><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">14</span><span>
</span><a name="line-443"></a><span class="hs-identifier">tickToTag</span><span> </span><a href="CoreMonad.html#SimplifierDone"><span class="hs-identifier hs-var">SimplifierDone</span></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">16</span><span>
</span><a name="line-444"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#AltMerge"><span class="hs-identifier hs-var">AltMerge</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">17</span><span>
</span><a name="line-445"></a><span>
</span><a name="line-446"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span>
</span><a name="line-447"></a><a name="tickString"><a href="CoreMonad.html#tickString"><span class="hs-identifier">tickString</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#PreInlineUnconditionally"><span class="hs-identifier hs-var">PreInlineUnconditionally</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;PreInlineUnconditionally&quot;</span><span>
</span><a name="line-448"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#PostInlineUnconditionally"><span class="hs-identifier hs-var">PostInlineUnconditionally</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;PostInlineUnconditionally&quot;</span><span>
</span><a name="line-449"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#UnfoldingDone"><span class="hs-identifier hs-var">UnfoldingDone</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;UnfoldingDone&quot;</span><span>
</span><a name="line-450"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#RuleFired"><span class="hs-identifier hs-var">RuleFired</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;RuleFired&quot;</span><span>
</span><a name="line-451"></a><span class="hs-identifier">tickString</span><span> </span><a href="CoreMonad.html#LetFloatFromLet"><span class="hs-identifier hs-var">LetFloatFromLet</span></a><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;LetFloatFromLet&quot;</span><span>
</span><a name="line-452"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#EtaExpansion"><span class="hs-identifier hs-var">EtaExpansion</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;EtaExpansion&quot;</span><span>
</span><a name="line-453"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#EtaReduction"><span class="hs-identifier hs-var">EtaReduction</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;EtaReduction&quot;</span><span>
</span><a name="line-454"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#BetaReduction"><span class="hs-identifier hs-var">BetaReduction</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;BetaReduction&quot;</span><span>
</span><a name="line-455"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseOfCase"><span class="hs-identifier hs-var">CaseOfCase</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;CaseOfCase&quot;</span><span>
</span><a name="line-456"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#KnownBranch"><span class="hs-identifier hs-var">KnownBranch</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;KnownBranch&quot;</span><span>
</span><a name="line-457"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseMerge"><span class="hs-identifier hs-var">CaseMerge</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;CaseMerge&quot;</span><span>
</span><a name="line-458"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#AltMerge"><span class="hs-identifier hs-var">AltMerge</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;AltMerge&quot;</span><span>
</span><a name="line-459"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseElim"><span class="hs-identifier hs-var">CaseElim</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;CaseElim&quot;</span><span>
</span><a name="line-460"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseIdentity"><span class="hs-identifier hs-var">CaseIdentity</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;CaseIdentity&quot;</span><span>
</span><a name="line-461"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#FillInCaseDefault"><span class="hs-identifier hs-var">FillInCaseDefault</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;FillInCaseDefault&quot;</span><span>
</span><a name="line-462"></a><span class="hs-identifier">tickString</span><span> </span><a href="CoreMonad.html#BottomFound"><span class="hs-identifier hs-var">BottomFound</span></a><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;BottomFound&quot;</span><span>
</span><a name="line-463"></a><span class="hs-identifier">tickString</span><span> </span><a href="CoreMonad.html#SimplifierDone"><span class="hs-identifier hs-var">SimplifierDone</span></a><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;SimplifierDone&quot;</span><span>
</span><a name="line-464"></a><span>
</span><a name="line-465"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-466"></a><a name="pprTickCts"><a href="CoreMonad.html#pprTickCts"><span class="hs-identifier">pprTickCts</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#PreInlineUnconditionally"><span class="hs-identifier hs-var">PreInlineUnconditionally</span></a><span> </span><a name="local-1628078038"><a href="#local-1628078038"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628078038"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-467"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#PostInlineUnconditionally"><span class="hs-identifier hs-var">PostInlineUnconditionally</span></a><span> </span><a name="local-1628078039"><a href="#local-1628078039"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628078039"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-468"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#UnfoldingDone"><span class="hs-identifier hs-var">UnfoldingDone</span></a><span> </span><a name="local-1628078040"><a href="#local-1628078040"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628078040"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-469"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#RuleFired"><span class="hs-identifier hs-var">RuleFired</span></a><span> </span><a name="local-1628078041"><a href="#local-1628078041"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628078041"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-470"></a><span class="hs-identifier">pprTickCts</span><span> </span><a href="CoreMonad.html#LetFloatFromLet"><span class="hs-identifier hs-var">LetFloatFromLet</span></a><span>              </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">Outputable</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-471"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#EtaExpansion"><span class="hs-identifier hs-var">EtaExpansion</span></a><span> </span><a name="local-1628078042"><a href="#local-1628078042"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628078042"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-472"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#EtaReduction"><span class="hs-identifier hs-var">EtaReduction</span></a><span> </span><a name="local-1628078043"><a href="#local-1628078043"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628078043"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-473"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#BetaReduction"><span class="hs-identifier hs-var">BetaReduction</span></a><span> </span><a name="local-1628078044"><a href="#local-1628078044"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628078044"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-474"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseOfCase"><span class="hs-identifier hs-var">CaseOfCase</span></a><span> </span><a name="local-1628078045"><a href="#local-1628078045"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628078045"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-475"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#KnownBranch"><span class="hs-identifier hs-var">KnownBranch</span></a><span> </span><a name="local-1628078046"><a href="#local-1628078046"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628078046"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-476"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseMerge"><span class="hs-identifier hs-var">CaseMerge</span></a><span> </span><a name="local-1628078047"><a href="#local-1628078047"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628078047"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-477"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#AltMerge"><span class="hs-identifier hs-var">AltMerge</span></a><span> </span><a name="local-1628078048"><a href="#local-1628078048"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628078048"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-478"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseElim"><span class="hs-identifier hs-var">CaseElim</span></a><span> </span><a name="local-1628078049"><a href="#local-1628078049"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628078049"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-479"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseIdentity"><span class="hs-identifier hs-var">CaseIdentity</span></a><span> </span><a name="local-1628078050"><a href="#local-1628078050"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628078050"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-480"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#FillInCaseDefault"><span class="hs-identifier hs-var">FillInCaseDefault</span></a><span> </span><a name="local-1628078051"><a href="#local-1628078051"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628078051"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-481"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-identifier">_</span><span>                            </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">Outputable</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-482"></a><span>
</span><a name="line-483"></a><span class="hs-identifier">cmpTick</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span>
</span><a name="line-484"></a><a name="cmpTick"><a href="CoreMonad.html#cmpTick"><span class="hs-identifier">cmpTick</span></a></a><span> </span><a name="local-1628078052"><a href="#local-1628078052"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1628078053"><a href="#local-1628078053"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#tickToTag"><span class="hs-identifier hs-var">tickToTag</span></a><span> </span><a href="#local-1628078052"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="CoreMonad.html#tickToTag"><span class="hs-identifier hs-var">tickToTag</span></a><span> </span><a href="#local-1628078053"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-485"></a><span>                </span><span class="hs-identifier hs-var">GT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">GT</span><span>
</span><a name="line-486"></a><span>                </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#cmpEqTick"><span class="hs-identifier hs-var">cmpEqTick</span></a><span> </span><a href="#local-1628078052"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-1628078053"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-487"></a><span>                </span><span class="hs-identifier hs-var">LT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">LT</span><span>
</span><a name="line-488"></a><span>
</span><a name="line-489"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span>
</span><a name="line-490"></a><a name="cmpEqTick"><a href="CoreMonad.html#cmpEqTick"><span class="hs-identifier">cmpEqTick</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#PreInlineUnconditionally"><span class="hs-identifier hs-var">PreInlineUnconditionally</span></a><span> </span><a name="local-1628078054"><a href="#local-1628078054"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><a href="CoreMonad.html#PreInlineUnconditionally"><span class="hs-identifier hs-var">PreInlineUnconditionally</span></a><span> </span><a name="local-1628078055"><a href="#local-1628078055"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078054"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-1628078055"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-491"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#PostInlineUnconditionally"><span class="hs-identifier hs-var">PostInlineUnconditionally</span></a><span> </span><a name="local-1628078056"><a href="#local-1628078056"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#PostInlineUnconditionally"><span class="hs-identifier hs-var">PostInlineUnconditionally</span></a><span> </span><a name="local-1628078057"><a href="#local-1628078057"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078056"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-1628078057"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-492"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#UnfoldingDone"><span class="hs-identifier hs-var">UnfoldingDone</span></a><span> </span><a name="local-1628078058"><a href="#local-1628078058"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-special">(</span><a href="CoreMonad.html#UnfoldingDone"><span class="hs-identifier hs-var">UnfoldingDone</span></a><span> </span><a name="local-1628078059"><a href="#local-1628078059"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078058"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-1628078059"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-493"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#RuleFired"><span class="hs-identifier hs-var">RuleFired</span></a><span> </span><a name="local-1628078060"><a href="#local-1628078060"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>                 </span><span class="hs-special">(</span><a href="CoreMonad.html#RuleFired"><span class="hs-identifier hs-var">RuleFired</span></a><span> </span><a name="local-1628078061"><a href="#local-1628078061"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>                   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078060"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-1628078061"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-494"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#EtaExpansion"><span class="hs-identifier hs-var">EtaExpansion</span></a><span> </span><a name="local-1628078062"><a href="#local-1628078062"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>              </span><span class="hs-special">(</span><a href="CoreMonad.html#EtaExpansion"><span class="hs-identifier hs-var">EtaExpansion</span></a><span> </span><a name="local-1628078063"><a href="#local-1628078063"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078062"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-1628078063"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-495"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#EtaReduction"><span class="hs-identifier hs-var">EtaReduction</span></a><span> </span><a name="local-1628078064"><a href="#local-1628078064"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>              </span><span class="hs-special">(</span><a href="CoreMonad.html#EtaReduction"><span class="hs-identifier hs-var">EtaReduction</span></a><span> </span><a name="local-1628078065"><a href="#local-1628078065"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078064"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-1628078065"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-496"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#BetaReduction"><span class="hs-identifier hs-var">BetaReduction</span></a><span> </span><a name="local-1628078066"><a href="#local-1628078066"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-special">(</span><a href="CoreMonad.html#BetaReduction"><span class="hs-identifier hs-var">BetaReduction</span></a><span> </span><a name="local-1628078067"><a href="#local-1628078067"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078066"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-1628078067"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-497"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseOfCase"><span class="hs-identifier hs-var">CaseOfCase</span></a><span> </span><a name="local-1628078068"><a href="#local-1628078068"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>                </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseOfCase"><span class="hs-identifier hs-var">CaseOfCase</span></a><span> </span><a name="local-1628078069"><a href="#local-1628078069"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078068"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-1628078069"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-498"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#KnownBranch"><span class="hs-identifier hs-var">KnownBranch</span></a><span> </span><a name="local-1628078070"><a href="#local-1628078070"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>               </span><span class="hs-special">(</span><a href="CoreMonad.html#KnownBranch"><span class="hs-identifier hs-var">KnownBranch</span></a><span> </span><a name="local-1628078071"><a href="#local-1628078071"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078070"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-1628078071"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-499"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseMerge"><span class="hs-identifier hs-var">CaseMerge</span></a><span> </span><a name="local-1628078072"><a href="#local-1628078072"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>                 </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseMerge"><span class="hs-identifier hs-var">CaseMerge</span></a><span> </span><a name="local-1628078073"><a href="#local-1628078073"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>                   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078072"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-1628078073"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-500"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#AltMerge"><span class="hs-identifier hs-var">AltMerge</span></a><span> </span><a name="local-1628078074"><a href="#local-1628078074"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>                  </span><span class="hs-special">(</span><a href="CoreMonad.html#AltMerge"><span class="hs-identifier hs-var">AltMerge</span></a><span> </span><a name="local-1628078075"><a href="#local-1628078075"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>                    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078074"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-1628078075"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-501"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseElim"><span class="hs-identifier hs-var">CaseElim</span></a><span> </span><a name="local-1628078076"><a href="#local-1628078076"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>                  </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseElim"><span class="hs-identifier hs-var">CaseElim</span></a><span> </span><a name="local-1628078077"><a href="#local-1628078077"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>                    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078076"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-1628078077"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-502"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseIdentity"><span class="hs-identifier hs-var">CaseIdentity</span></a><span> </span><a name="local-1628078078"><a href="#local-1628078078"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>              </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseIdentity"><span class="hs-identifier hs-var">CaseIdentity</span></a><span> </span><a name="local-1628078079"><a href="#local-1628078079"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078078"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-1628078079"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-503"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#FillInCaseDefault"><span class="hs-identifier hs-var">FillInCaseDefault</span></a><span> </span><a name="local-1628078080"><a href="#local-1628078080"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-special">(</span><a href="CoreMonad.html#FillInCaseDefault"><span class="hs-identifier hs-var">FillInCaseDefault</span></a><span> </span><a name="local-1628078081"><a href="#local-1628078081"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078080"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-1628078081"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-504"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-identifier">_</span><span>                             </span><span class="hs-identifier">_</span><span>                               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">EQ</span><span>
</span><a name="line-505"></a><span>
</span><a name="line-506"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
             Monad and carried data structure definitions
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-513"></a><span>
</span><a name="line-514"></a><span class="hs-keyword">newtype</span><span> </span><a name="CoreState"><a href="CoreMonad.html#CoreState"><span class="hs-identifier">CoreState</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="CoreState"><a href="CoreMonad.html#CoreState"><span class="hs-identifier">CoreState</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-515"></a><span>        </span><a name="cs_uniq_supply"><a href="CoreMonad.html#cs_uniq_supply"><span class="hs-identifier">cs_uniq_supply</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="UniqSupply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a><span>
</span><a name="line-516"></a><span class="hs-special">}</span><span>
</span><a name="line-517"></a><span>
</span><a name="line-518"></a><span class="hs-keyword">data</span><span> </span><a name="CoreReader"><a href="CoreMonad.html#CoreReader"><span class="hs-identifier">CoreReader</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="CoreReader"><a href="CoreMonad.html#CoreReader"><span class="hs-identifier">CoreReader</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-519"></a><span>        </span><a name="cr_hsc_env"><a href="CoreMonad.html#cr_hsc_env"><span class="hs-identifier">cr_hsc_env</span></a></a><span>             </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-520"></a><span>        </span><a name="cr_rule_base"><a href="CoreMonad.html#cr_rule_base"><span class="hs-identifier">cr_rule_base</span></a></a><span>           </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#RuleBase"><span class="hs-identifier hs-type">RuleBase</span></a><span class="hs-special">,</span><span>
</span><a name="line-521"></a><span>        </span><a name="cr_module"><a href="CoreMonad.html#cr_module"><span class="hs-identifier">cr_module</span></a></a><span>              </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span>
</span><a name="line-522"></a><span>        </span><a name="cr_print_unqual"><a href="CoreMonad.html#cr_print_unqual"><span class="hs-identifier">cr_print_unqual</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#PrintUnqualified"><span class="hs-identifier hs-type">PrintUnqualified</span></a><span class="hs-special">,</span><span>
</span><a name="line-523"></a><span>        </span><a name="cr_loc"><a href="CoreMonad.html#cr_loc"><span class="hs-identifier">cr_loc</span></a></a><span>                 </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- Use this for log/error messages so they</span><span>
</span><a name="line-524"></a><span>                                             </span><span class="hs-comment">-- are at least tagged with the right source file</span><span>
</span><a name="line-525"></a><span>        </span><a name="cr_visible_orphan_mods"><a href="CoreMonad.html#cr_visible_orphan_mods"><span class="hs-identifier">cr_visible_orphan_mods</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-526"></a><span class="hs-cpp">#ifdef GHCI</span><span>
</span><a name="line-527"></a><span>        </span><a name="cr_globals"><a href="CoreMonad.html#cr_globals"><span class="hs-identifier">cr_globals</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.MVar.html#MVar"><span class="hs-identifier hs-type">MVar</span></a><span> </span><a href="Linker.html#PersistentLinkerState"><span class="hs-identifier hs-type">PersistentLinkerState</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>
</span><a name="line-528"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-529"></a><span>        </span><span class="hs-identifier">cr_globals</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-530"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-531"></a><span class="hs-special">}</span><span>
</span><a name="line-532"></a><span>
</span><a name="line-533"></a><span class="hs-comment">-- Note: CoreWriter used to be defined with data, rather than newtype.  If it</span><span>
</span><a name="line-534"></a><span class="hs-comment">-- is defined that way again, the cw_simpl_count field, at least, must be</span><span>
</span><a name="line-535"></a><span class="hs-comment">-- strict to avoid a space leak (Trac #7702).</span><span>
</span><a name="line-536"></a><span class="hs-keyword">newtype</span><span> </span><a name="CoreWriter"><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier">CoreWriter</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="CoreWriter"><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier">CoreWriter</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-537"></a><span>        </span><a name="cw_simpl_count"><a href="CoreMonad.html#cw_simpl_count"><span class="hs-identifier">cw_simpl_count</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span>
</span><a name="line-538"></a><span class="hs-special">}</span><span>
</span><a name="line-539"></a><span>
</span><a name="line-540"></a><span class="hs-identifier">emptyWriter</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier hs-type">CoreWriter</span></a><span>
</span><a name="line-541"></a><a name="emptyWriter"><a href="CoreMonad.html#emptyWriter"><span class="hs-identifier">emptyWriter</span></a></a><span> </span><a name="local-1628078082"><a href="#local-1628078082"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier hs-var">CoreWriter</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-542"></a><span>        </span><span class="hs-identifier">cw_simpl_count</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#zeroSimplCount"><span class="hs-identifier hs-var">zeroSimplCount</span></a><span> </span><a href="#local-1628078082"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-543"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-544"></a><span>
</span><a name="line-545"></a><span class="hs-identifier">plusWriter</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier hs-type">CoreWriter</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier hs-type">CoreWriter</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier hs-type">CoreWriter</span></a><span>
</span><a name="line-546"></a><a name="plusWriter"><a href="CoreMonad.html#plusWriter"><span class="hs-identifier">plusWriter</span></a></a><span> </span><a name="local-1628078083"><a href="#local-1628078083"><span class="hs-identifier">w1</span></a></a><span> </span><a name="local-1628078084"><a href="#local-1628078084"><span class="hs-identifier">w2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier hs-var">CoreWriter</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-547"></a><span>        </span><span class="hs-identifier">cw_simpl_count</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">cw_simpl_count</span><span> </span><a href="#local-1628078083"><span class="hs-identifier hs-var">w1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="CoreMonad.html#plusSimplCount"><span class="hs-identifier hs-var">plusSimplCount</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">cw_simpl_count</span><span> </span><a href="#local-1628078084"><span class="hs-identifier hs-var">w2</span></a><span class="hs-special">)</span><span>
</span><a name="line-548"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-549"></a><span>
</span><a name="line-550"></a><span class="hs-keyword">type</span><span> </span><a name="CoreIOEnv"><a href="CoreMonad.html#CoreIOEnv"><span class="hs-identifier">CoreIOEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IOEnv.html#IOEnv"><span class="hs-identifier hs-type">IOEnv</span></a><span> </span><a href="CoreMonad.html#CoreReader"><span class="hs-identifier hs-type">CoreReader</span></a><span>
</span><a name="line-551"></a><span>
</span><a name="line-552"></a><span class="hs-comment">-- | The monad used by Core-to-Core passes to access common state, register simplification</span><span>
</span><a name="line-553"></a><span class="hs-comment">-- statistics and so on</span><span>
</span><a name="line-554"></a><span class="hs-keyword">newtype</span><span> </span><a name="CoreM"><a href="CoreMonad.html#CoreM"><span class="hs-identifier">CoreM</span></a></a><span> </span><a name="local-1628077973"><a href="#local-1628077973"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="CoreM"><a href="CoreMonad.html#CoreM"><span class="hs-identifier">CoreM</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="unCoreM"><a href="CoreMonad.html#unCoreM"><span class="hs-identifier">unCoreM</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreState"><span class="hs-identifier hs-type">CoreState</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreIOEnv"><span class="hs-identifier hs-type">CoreIOEnv</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628077973"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#CoreState"><span class="hs-identifier hs-type">CoreState</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier hs-type">CoreWriter</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-555"></a><span>
</span><a name="line-556"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Functor"><span class="hs-identifier hs-type">Functor</span></a><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-557"></a><span>    </span><a name="local-805306541"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier">fmap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#liftM"><span class="hs-identifier hs-var">liftM</span></a><span>
</span><a name="line-558"></a><span>
</span><a name="line-559"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-560"></a><span>    </span><a name="local-1628078165"><a href="#local-1628078165"><span class="hs-identifier">mx</span></a></a><span> </span><a name="local-805306539"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E%3D"><span class="hs-operator">&gt;&gt;=</span></a></a><span> </span><a name="local-1628078166"><a href="#local-1628078166"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-var">CoreM</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1628078167"><a href="#local-1628078167"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-561"></a><span>            </span><span class="hs-special">(</span><a name="local-1628078168"><a href="#local-1628078168"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628078169"><a href="#local-1628078169"><span class="hs-identifier">s'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628078170"><a href="#local-1628078170"><span class="hs-identifier">w1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">unCoreM</span><span> </span><a href="#local-1628078165"><span class="hs-identifier hs-var">mx</span></a><span> </span><a href="#local-1628078167"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-562"></a><span>            </span><span class="hs-special">(</span><a name="local-1628078171"><a href="#local-1628078171"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628078172"><a href="#local-1628078172"><span class="hs-identifier">s''</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628078173"><a href="#local-1628078173"><span class="hs-identifier">w2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">unCoreM</span><span> </span><span class="hs-special">(</span><a href="#local-1628078166"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1628078168"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628078169"><span class="hs-identifier hs-var">s'</span></a><span>
</span><a name="line-563"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-1628078174"><a href="#local-1628078174"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078170"><span class="hs-identifier hs-var">w1</span></a><span> </span><span class="hs-special">`</span><a href="CoreMonad.html#plusWriter"><span class="hs-identifier hs-var">plusWriter</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628078173"><span class="hs-identifier hs-var">w2</span></a><span>
</span><a name="line-564"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier hs-var">seq</span><span> </span><a href="#local-1628078174"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628078171"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628078172"><span class="hs-identifier hs-var">s''</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628078174"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-565"></a><span>            </span><span class="hs-comment">-- forcing w before building the tuple avoids a space leak</span><span>
</span><a name="line-566"></a><span>            </span><span class="hs-comment">-- (Trac #7702)</span><span>
</span><a name="line-567"></a><span>
</span><a name="line-568"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Applicative"><span class="hs-identifier hs-type">Applicative</span></a><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-569"></a><span>    </span><a name="local-805307120"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#pure"><span class="hs-identifier">pure</span></a></a><span> </span><a name="local-1628078161"><a href="#local-1628078161"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-var">CoreM</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1628078162"><a href="#local-1628078162"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#nop"><span class="hs-identifier hs-var">nop</span></a><span> </span><a href="#local-1628078162"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-1628078161"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-570"></a><span>    </span><span class="hs-special">(</span><a name="local-805307119"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%2A%3E"><span class="hs-operator">&lt;*&gt;</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#ap"><span class="hs-identifier hs-var">ap</span></a><span>
</span><a name="line-571"></a><span>    </span><a name="local-1628078163"><a href="#local-1628078163"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-805307121"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2A%3E"><span class="hs-operator">*&gt;</span></a></a><span> </span><a name="local-1628078164"><a href="#local-1628078164"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078163"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628078164"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-572"></a><span>
</span><a name="line-573"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Alternative"><span class="hs-identifier hs-type">Alternative</span></a><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-574"></a><span>    </span><a name="local-1912608763"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#empty"><span class="hs-identifier">empty</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-var">CoreM</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#empty"><span class="hs-identifier hs-var">Control</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Applicative</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span></a><span class="hs-special">)</span><span>
</span><a name="line-575"></a><span>    </span><a name="local-1628078158"><a href="#local-1628078158"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1912608762"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%7C%3E"><span class="hs-operator">&lt;|&gt;</span></a></a><span> </span><a name="local-1628078159"><a href="#local-1628078159"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-var">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628078160"><a href="#local-1628078160"><span class="hs-identifier">rs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unCoreM</span><span> </span><a href="#local-1628078158"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-1628078160"><span class="hs-identifier hs-var">rs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a><span> </span><span class="hs-identifier">unCoreM</span><span> </span><a href="#local-1628078159"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-1628078160"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span>
</span><a name="line-576"></a><span>
</span><a name="line-577"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#MonadPlus"><span class="hs-identifier hs-type">MonadPlus</span></a><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span>
</span><a name="line-578"></a><span>
</span><a name="line-579"></a><span class="hs-keyword">instance</span><span> </span><a href="UniqSupply.html#MonadUnique"><span class="hs-identifier hs-type">MonadUnique</span></a><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-580"></a><span>    </span><a name="local-1912671375"><a href="UniqSupply.html#getUniqueSupplyM"><span class="hs-identifier">getUniqueSupplyM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-581"></a><span>        </span><a name="local-1628078150"><a href="#local-1628078150"><span class="hs-identifier">us</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreMonad.html#getS"><span class="hs-identifier hs-var">getS</span></a><span> </span><span class="hs-identifier">cs_uniq_supply</span><span>
</span><a name="line-582"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628078151"><a href="#local-1628078151"><span class="hs-identifier">us1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628078152"><a href="#local-1628078152"><span class="hs-identifier">us2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqSupply.html#splitUniqSupply"><span class="hs-identifier hs-var">splitUniqSupply</span></a><span> </span><a href="#local-1628078150"><span class="hs-identifier hs-var">us</span></a><span>
</span><a name="line-583"></a><span>        </span><a href="CoreMonad.html#modifyS"><span class="hs-identifier hs-var">modifyS</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628078153"><a href="#local-1628078153"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628078153"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cs_uniq_supply</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078152"><span class="hs-identifier hs-var">us2</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-584"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628078151"><span class="hs-identifier hs-var">us1</span></a><span>
</span><a name="line-585"></a><span>
</span><a name="line-586"></a><span>    </span><a name="local-1912671376"><a href="UniqSupply.html#getUniqueM"><span class="hs-identifier">getUniqueM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-587"></a><span>        </span><a name="local-1628078154"><a href="#local-1628078154"><span class="hs-identifier">us</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreMonad.html#getS"><span class="hs-identifier hs-var">getS</span></a><span> </span><span class="hs-identifier">cs_uniq_supply</span><span>
</span><a name="line-588"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628078155"><a href="#local-1628078155"><span class="hs-identifier">u</span></a></a><span class="hs-special">,</span><a name="local-1628078156"><a href="#local-1628078156"><span class="hs-identifier">us'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqSupply.html#takeUniqFromSupply"><span class="hs-identifier hs-var">takeUniqFromSupply</span></a><span> </span><a href="#local-1628078154"><span class="hs-identifier hs-var">us</span></a><span>
</span><a name="line-589"></a><span>        </span><a href="CoreMonad.html#modifyS"><span class="hs-identifier hs-var">modifyS</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628078157"><a href="#local-1628078157"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628078157"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cs_uniq_supply</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078156"><span class="hs-identifier hs-var">us'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-590"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628078155"><span class="hs-identifier hs-var">u</span></a><span>
</span><a name="line-591"></a><span>
</span><a name="line-592"></a><span class="hs-identifier">runCoreM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span>
</span><a name="line-593"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#RuleBase"><span class="hs-identifier hs-type">RuleBase</span></a><span>
</span><a name="line-594"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="UniqSupply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a><span>
</span><a name="line-595"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span>
</span><a name="line-596"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span>
</span><a name="line-597"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#PrintUnqualified"><span class="hs-identifier hs-type">PrintUnqualified</span></a><span>
</span><a name="line-598"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span>
</span><a name="line-599"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="#local-1628077981"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-600"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="#local-1628077981"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span class="hs-special">)</span><span>
</span><a name="line-601"></a><a name="runCoreM"><a href="CoreMonad.html#runCoreM"><span class="hs-identifier">runCoreM</span></a></a><span> </span><a name="local-1628078085"><a href="#local-1628078085"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-1628078086"><a href="#local-1628078086"><span class="hs-identifier">rule_base</span></a></a><span> </span><a name="local-1628078087"><a href="#local-1628078087"><span class="hs-identifier">us</span></a></a><span> </span><a name="local-1628078088"><a href="#local-1628078088"><span class="hs-identifier">mod</span></a></a><span> </span><a name="local-1628078089"><a href="#local-1628078089"><span class="hs-identifier">orph_imps</span></a></a><span> </span><a name="local-1628078090"><a href="#local-1628078090"><span class="hs-identifier">print_unqual</span></a></a><span> </span><a name="local-1628078091"><a href="#local-1628078091"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628078092"><a href="#local-1628078092"><span class="hs-identifier">m</span></a></a><span>
</span><a name="line-602"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628078100"><a href="#local-1628078100"><span class="hs-identifier">glbls</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Linker.html#saveLinkerGlobals"><span class="hs-identifier hs-var">saveLinkerGlobals</span></a><span>
</span><a name="line-603"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#liftM"><span class="hs-identifier hs-var">liftM</span></a><span> </span><a href="#local-1628078095"><span class="hs-identifier hs-var">extract</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="IOEnv.html#runIOEnv"><span class="hs-identifier hs-var">runIOEnv</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628078093"><span class="hs-identifier hs-var">reader</span></a><span> </span><a href="#local-1628078100"><span class="hs-identifier hs-var">glbls</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">unCoreM</span><span> </span><a href="#local-1628078092"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-1628078094"><span class="hs-identifier hs-var">state</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-604"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-605"></a><span>    </span><a name="local-1628078093"><a href="#local-1628078093"><span class="hs-identifier">reader</span></a></a><span> </span><a name="local-1628078097"><a href="#local-1628078097"><span class="hs-identifier">glbls</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreReader"><span class="hs-identifier hs-var">CoreReader</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-606"></a><span>            </span><span class="hs-identifier">cr_hsc_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078085"><span class="hs-identifier hs-var">hsc_env</span></a><span class="hs-special">,</span><span>
</span><a name="line-607"></a><span>            </span><span class="hs-identifier">cr_rule_base</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078086"><span class="hs-identifier hs-var">rule_base</span></a><span class="hs-special">,</span><span>
</span><a name="line-608"></a><span>            </span><span class="hs-identifier">cr_module</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078088"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">,</span><span>
</span><a name="line-609"></a><span>            </span><span class="hs-identifier">cr_visible_orphan_mods</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078089"><span class="hs-identifier hs-var">orph_imps</span></a><span class="hs-special">,</span><span>
</span><a name="line-610"></a><span>            </span><span class="hs-identifier">cr_globals</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078097"><span class="hs-identifier hs-var">glbls</span></a><span class="hs-special">,</span><span>
</span><a name="line-611"></a><span>            </span><span class="hs-identifier">cr_print_unqual</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078090"><span class="hs-identifier hs-var">print_unqual</span></a><span class="hs-special">,</span><span>
</span><a name="line-612"></a><span>            </span><span class="hs-identifier">cr_loc</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078091"><span class="hs-identifier hs-var">loc</span></a><span>
</span><a name="line-613"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-614"></a><span>    </span><a name="local-1628078094"><a href="#local-1628078094"><span class="hs-identifier">state</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreState"><span class="hs-identifier hs-var">CoreState</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-615"></a><span>            </span><span class="hs-identifier">cs_uniq_supply</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078087"><span class="hs-identifier hs-var">us</span></a><span>
</span><a name="line-616"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-617"></a><span>
</span><a name="line-618"></a><span>    </span><span class="hs-identifier">extract</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1628078096"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#CoreState"><span class="hs-identifier hs-type">CoreState</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier hs-type">CoreWriter</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1628078096"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span class="hs-special">)</span><span>
</span><a name="line-619"></a><span>    </span><a name="local-1628078095"><a href="#local-1628078095"><span class="hs-identifier">extract</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628078098"><a href="#local-1628078098"><span class="hs-identifier">value</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1628078099"><a href="#local-1628078099"><span class="hs-identifier">writer</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1628078098"><span class="hs-identifier hs-var">value</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cw_simpl_count</span><span> </span><a href="#local-1628078099"><span class="hs-identifier hs-var">writer</span></a><span class="hs-special">)</span><span>
</span><a name="line-620"></a><span>
</span><a name="line-621"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
             Core combinators, not exported
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-628"></a><span>
</span><a name="line-629"></a><span class="hs-identifier">nop</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreState"><span class="hs-identifier hs-type">CoreState</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628077980"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreIOEnv"><span class="hs-identifier hs-type">CoreIOEnv</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628077980"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#CoreState"><span class="hs-identifier hs-type">CoreState</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier hs-type">CoreWriter</span></a><span class="hs-special">)</span><span>
</span><a name="line-630"></a><a name="nop"><a href="CoreMonad.html#nop"><span class="hs-identifier">nop</span></a></a><span> </span><a name="local-1628078101"><a href="#local-1628078101"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1628078102"><a href="#local-1628078102"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-631"></a><span>    </span><a name="local-1628078103"><a href="#local-1628078103"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IOEnv.html#getEnv"><span class="hs-identifier hs-var">getEnv</span></a><span>
</span><a name="line-632"></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628078102"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628078101"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#emptyWriter"><span class="hs-identifier hs-var">emptyWriter</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">cr_hsc_env</span><span class="hs-special">)</span><span> </span><a href="#local-1628078103"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-633"></a><span>
</span><a name="line-634"></a><span class="hs-identifier">read</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CoreReader"><span class="hs-identifier hs-type">CoreReader</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628077979"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="#local-1628077979"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-635"></a><a name="read"><a href="CoreMonad.html#read"><span class="hs-identifier">read</span></a></a><span> </span><a name="local-1628078104"><a href="#local-1628078104"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-var">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628078105"><a href="#local-1628078105"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IOEnv.html#getEnv"><span class="hs-identifier hs-var">getEnv</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628078106"><a href="#local-1628078106"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#nop"><span class="hs-identifier hs-var">nop</span></a><span> </span><a href="#local-1628078105"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628078104"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1628078106"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-636"></a><span>
</span><a name="line-637"></a><span class="hs-identifier">getS</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CoreState"><span class="hs-identifier hs-type">CoreState</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628077978"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="#local-1628077978"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-638"></a><a name="getS"><a href="CoreMonad.html#getS"><span class="hs-identifier">getS</span></a></a><span> </span><a name="local-1628078107"><a href="#local-1628078107"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-var">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628078108"><a href="#local-1628078108"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#nop"><span class="hs-identifier hs-var">nop</span></a><span> </span><a href="#local-1628078108"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628078107"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1628078108"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-639"></a><span>
</span><a name="line-640"></a><span class="hs-identifier">modifyS</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CoreState"><span class="hs-identifier hs-type">CoreState</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreState"><span class="hs-identifier hs-type">CoreState</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-641"></a><a name="modifyS"><a href="CoreMonad.html#modifyS"><span class="hs-identifier">modifyS</span></a></a><span> </span><a name="local-1628078109"><a href="#local-1628078109"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-var">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628078110"><a href="#local-1628078110"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#nop"><span class="hs-identifier hs-var">nop</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628078109"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1628078110"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-642"></a><span>
</span><a name="line-643"></a><span class="hs-identifier">write</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier hs-type">CoreWriter</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-644"></a><a name="write"><a href="CoreMonad.html#write"><span class="hs-identifier">write</span></a></a><span> </span><a name="local-1628078111"><a href="#local-1628078111"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-var">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628078112"><a href="#local-1628078112"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-1628078112"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628078111"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-645"></a><span>
</span><a name="line-646"></a><span class="hs-comment">-- \subsection{Lifting IO into the monad}</span><span>
</span><a name="line-647"></a><span>
</span><a name="line-648"></a><span class="hs-comment">-- | Lift an 'IOEnv' operation into 'CoreM'</span><span>
</span><a name="line-649"></a><span class="hs-identifier">liftIOEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreIOEnv"><span class="hs-identifier hs-type">CoreIOEnv</span></a><span> </span><a href="#local-1628077977"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="#local-1628077977"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-650"></a><a name="liftIOEnv"><a href="CoreMonad.html#liftIOEnv"><span class="hs-identifier">liftIOEnv</span></a></a><span> </span><a name="local-1628078113"><a href="#local-1628078113"><span class="hs-identifier">mx</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-var">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628078114"><a href="#local-1628078114"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628078113"><span class="hs-identifier hs-var">mx</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628078115"><a href="#local-1628078115"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#nop"><span class="hs-identifier hs-var">nop</span></a><span> </span><a href="#local-1628078114"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-1628078115"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-651"></a><span>
</span><a name="line-652"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#MonadIO"><span class="hs-identifier hs-type">MonadIO</span></a><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-653"></a><span>    </span><a name="local-1912605974"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier">liftIO</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#liftIOEnv"><span class="hs-identifier hs-var">liftIOEnv</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">IOEnv</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">liftIO</span></a><span>
</span><a name="line-654"></a><span>
</span><a name="line-655"></a><span class="hs-comment">-- | Lift an 'IO' operation into 'CoreM' while consuming its 'SimplCount'</span><span>
</span><a name="line-656"></a><span class="hs-identifier">liftIOWithCount</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628077976"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="#local-1628077976"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-657"></a><a name="liftIOWithCount"><a href="CoreMonad.html#liftIOWithCount"><span class="hs-identifier">liftIOWithCount</span></a></a><span> </span><a name="local-1628078116"><a href="#local-1628078116"><span class="hs-identifier">what</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="#local-1628078116"><span class="hs-identifier hs-var">what</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1628078117"><a href="#local-1628078117"><span class="hs-identifier">count</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628078118"><a href="#local-1628078118"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#addSimplCount"><span class="hs-identifier hs-var">addSimplCount</span></a><span> </span><a href="#local-1628078117"><span class="hs-identifier hs-var">count</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628078118"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-658"></a><span>
</span><a name="line-659"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
             Reader, writer and state accessors
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-666"></a><span>
</span><a name="line-667"></a><span class="hs-identifier">getHscEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span>
</span><a name="line-668"></a><a name="getHscEnv"><a href="CoreMonad.html#getHscEnv"><span class="hs-identifier">getHscEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#read"><span class="hs-identifier hs-var">read</span></a><span> </span><span class="hs-identifier">cr_hsc_env</span><span>
</span><a name="line-669"></a><span>
</span><a name="line-670"></a><span class="hs-identifier">getRuleBase</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="CoreSyn.html#RuleBase"><span class="hs-identifier hs-type">RuleBase</span></a><span>
</span><a name="line-671"></a><a name="getRuleBase"><a href="CoreMonad.html#getRuleBase"><span class="hs-identifier">getRuleBase</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#read"><span class="hs-identifier hs-var">read</span></a><span> </span><span class="hs-identifier">cr_rule_base</span><span>
</span><a name="line-672"></a><span>
</span><a name="line-673"></a><span class="hs-identifier">getVisibleOrphanMods</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span>
</span><a name="line-674"></a><a name="getVisibleOrphanMods"><a href="CoreMonad.html#getVisibleOrphanMods"><span class="hs-identifier">getVisibleOrphanMods</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#read"><span class="hs-identifier hs-var">read</span></a><span> </span><span class="hs-identifier">cr_visible_orphan_mods</span><span>
</span><a name="line-675"></a><span>
</span><a name="line-676"></a><span class="hs-identifier">getPrintUnqualified</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="Outputable.html#PrintUnqualified"><span class="hs-identifier hs-type">PrintUnqualified</span></a><span>
</span><a name="line-677"></a><a name="getPrintUnqualified"><a href="CoreMonad.html#getPrintUnqualified"><span class="hs-identifier">getPrintUnqualified</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#read"><span class="hs-identifier hs-var">read</span></a><span> </span><span class="hs-identifier">cr_print_unqual</span><span>
</span><a name="line-678"></a><span>
</span><a name="line-679"></a><span class="hs-identifier">getSrcSpanM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span>
</span><a name="line-680"></a><a name="getSrcSpanM"><a href="CoreMonad.html#getSrcSpanM"><span class="hs-identifier">getSrcSpanM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#read"><span class="hs-identifier hs-var">read</span></a><span> </span><span class="hs-identifier">cr_loc</span><span>
</span><a name="line-681"></a><span>
</span><a name="line-682"></a><span class="hs-identifier">addSimplCount</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-683"></a><a name="addSimplCount"><a href="CoreMonad.html#addSimplCount"><span class="hs-identifier">addSimplCount</span></a></a><span> </span><a name="local-1628078119"><a href="#local-1628078119"><span class="hs-identifier">count</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#write"><span class="hs-identifier hs-var">write</span></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier hs-var">CoreWriter</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cw_simpl_count</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628078119"><span class="hs-identifier hs-var">count</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-684"></a><span>
</span><a name="line-685"></a><span class="hs-comment">-- Convenience accessors for useful fields of HscEnv</span><span>
</span><a name="line-686"></a><span>
</span><a name="line-687"></a><span class="hs-keyword">instance</span><span> </span><a href="DynFlags.html#HasDynFlags"><span class="hs-identifier hs-type">HasDynFlags</span></a><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-688"></a><span>    </span><a name="local-1912701244"><a href="DynFlags.html#getDynFlags"><span class="hs-identifier">getDynFlags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="CoreMonad.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a><span>
</span><a name="line-689"></a><span>
</span><a name="line-690"></a><span class="hs-keyword">instance</span><span> </span><a href="Module.html#HasModule"><span class="hs-identifier hs-type">HasModule</span></a><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-691"></a><span>    </span><a name="local-1912696829"><a href="Module.html#getModule"><span class="hs-identifier">getModule</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#read"><span class="hs-identifier hs-var">read</span></a><span> </span><span class="hs-identifier">cr_module</span><span>
</span><a name="line-692"></a><span>
</span><a name="line-693"></a><span class="hs-comment">-- | The original name cache is the current mapping from 'Module' and</span><span>
</span><a name="line-694"></a><span class="hs-comment">-- 'OccName' to a compiler-wide unique 'Name'</span><span>
</span><a name="line-695"></a><span class="hs-identifier">getOrigNameCache</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="HscTypes.html#OrigNameCache"><span class="hs-identifier hs-type">OrigNameCache</span></a><span>
</span><a name="line-696"></a><a name="getOrigNameCache"><a href="CoreMonad.html#getOrigNameCache"><span class="hs-identifier">getOrigNameCache</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-697"></a><span>    </span><a name="local-1628078120"><a href="#local-1628078120"><span class="hs-identifier">nameCacheRef</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><span class="hs-identifier">hsc_NC</span><span> </span><a href="CoreMonad.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a><span>
</span><a name="line-698"></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><span class="hs-identifier">nsNames</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><a href="#local-1628078120"><span class="hs-identifier hs-var">nameCacheRef</span></a><span>
</span><a name="line-699"></a><span>
</span><a name="line-700"></a><span class="hs-identifier">getPackageFamInstEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="HscTypes.html#PackageFamInstEnv"><span class="hs-identifier hs-type">PackageFamInstEnv</span></a><span>
</span><a name="line-701"></a><a name="getPackageFamInstEnv"><a href="CoreMonad.html#getPackageFamInstEnv"><span class="hs-identifier">getPackageFamInstEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-702"></a><span>    </span><a name="local-1628078121"><a href="#local-1628078121"><span class="hs-identifier">hsc_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreMonad.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a><span>
</span><a name="line-703"></a><span>    </span><a name="local-1628078122"><a href="#local-1628078122"><span class="hs-identifier">eps</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HscTypes.html#hscEPS"><span class="hs-identifier hs-var">hscEPS</span></a><span> </span><a href="#local-1628078121"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-704"></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">eps_fam_inst_env</span><span> </span><a href="#local-1628078122"><span class="hs-identifier hs-var">eps</span></a><span>
</span><a name="line-705"></a><span>
</span><a name="line-706"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
             Initializing globals
*                                                                      *
************************************************************************

This is a rather annoying function. When a plugin is loaded, it currently
gets linked against a *newly loaded* copy of the GHC package. This would
not be a problem, except that the new copy has its own mutable state
that is not shared with that state that has already been initialized by
the original GHC package.

(NB This mechanism is sufficient for granting plugins read-only access to
globals that are guaranteed to be initialized before the plugin is loaded.  If
any further synchronization is necessary, I would suggest using the more
sophisticated mechanism involving GHC.Conc.Sync.sharedCAF and rts/Globals.c to
share a single instance of the global variable among the compiler and the
plugins.  Perhaps we should migrate all global variables to use that mechanism,
for robustness... -- NSF July 2013)

This leads to loaded plugins calling GHC code which pokes the static flags,
and then dying with a panic because the static flags *it* sees are uninitialized.

There are two possible solutions:
  1. Export the symbols from the GHC executable from the GHC library and link
     against this existing copy rather than a new copy of the GHC library
  2. Carefully ensure that the global state in the two copies of the GHC
     library matches

I tried 1. and it *almost* works (and speeds up plugin load times!) except
on Windows. On Windows the GHC library tends to export more than 65536 symbols
(see #5292) which overflows the limit of what we can export from the EXE and
causes breakage.

(Note that if the GHC executable was dynamically linked this wouldn't be a
problem, because we could share the GHC library it links to.)

We are going to try 2. instead. Unfortunately, this means that every plugin
will have to say `reinitializeGlobals` before it does anything, but never mind.

I've threaded the cr_globals through CoreM rather than giving them as an
argument to the plugin function so that we can turn this function into
(return ()) without breaking any plugins when we eventually get 1. working.
-}</span><span>
</span><a name="line-751"></a><span>
</span><a name="line-752"></a><span class="hs-identifier">reinitializeGlobals</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-753"></a><a name="reinitializeGlobals"><a href="CoreMonad.html#reinitializeGlobals"><span class="hs-identifier">reinitializeGlobals</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-754"></a><span>    </span><a name="local-1628078123"><a href="#local-1628078123"><span class="hs-identifier">linker_globals</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreMonad.html#read"><span class="hs-identifier hs-var">read</span></a><span> </span><span class="hs-identifier">cr_globals</span><span>
</span><a name="line-755"></a><span>    </span><a name="local-1628078124"><a href="#local-1628078124"><span class="hs-identifier">hsc_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreMonad.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a><span>
</span><a name="line-756"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1628078125"><a href="#local-1628078125"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-1628078124"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-757"></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Linker.html#restoreLinkerGlobals"><span class="hs-identifier hs-var">restoreLinkerGlobals</span></a><span> </span><a href="#local-1628078123"><span class="hs-identifier hs-var">linker_globals</span></a><span>
</span><a name="line-758"></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="DynFlags.html#setUnsafeGlobalDynFlags"><span class="hs-identifier hs-var">setUnsafeGlobalDynFlags</span></a><span> </span><a href="#local-1628078125"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-759"></a><span>
</span><a name="line-760"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
             Dealing with annotations
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-767"></a><span>
</span><a name="line-768"></a><span class="hs-comment">-- | Get all annotations of a given type. This happens lazily, that is</span><span>
</span><a name="line-769"></a><span class="hs-comment">-- no deserialization will take place until the [a] is actually demanded and</span><span>
</span><a name="line-770"></a><span class="hs-comment">-- the [a] can also be empty (the UniqFM is not filtered).</span><span>
</span><a name="line-771"></a><span class="hs-comment">--</span><span>
</span><a name="line-772"></a><span class="hs-comment">-- This should be done once at the start of a Core-to-Core pass that uses</span><span>
</span><a name="line-773"></a><span class="hs-comment">-- annotations.</span><span>
</span><a name="line-774"></a><span class="hs-comment">--</span><span>
</span><a name="line-775"></a><span class="hs-comment">-- See Note [Annotations]</span><span>
</span><a name="line-776"></a><span class="hs-identifier">getAnnotations</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier hs-type">Typeable</span></a><span> </span><a href="#local-1628077975"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628077975"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><a href="UniqFM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628077975"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-777"></a><a name="getAnnotations"><a href="CoreMonad.html#getAnnotations"><span class="hs-identifier">getAnnotations</span></a></a><span> </span><a name="local-1628078126"><a href="#local-1628078126"><span class="hs-identifier">deserialize</span></a></a><span> </span><a name="local-1628078127"><a href="#local-1628078127"><span class="hs-identifier">guts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-778"></a><span>     </span><a name="local-1628078128"><a href="#local-1628078128"><span class="hs-identifier">hsc_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreMonad.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a><span>
</span><a name="line-779"></a><span>     </span><a name="local-1628078129"><a href="#local-1628078129"><span class="hs-identifier">ann_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HscTypes.html#prepareAnnotations"><span class="hs-identifier hs-var">prepareAnnotations</span></a><span> </span><a href="#local-1628078128"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628078127"><span class="hs-identifier hs-var">guts</span></a><span class="hs-special">)</span><span>
</span><a name="line-780"></a><span>     </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Annotations.html#deserializeAnns"><span class="hs-identifier hs-var">deserializeAnns</span></a><span> </span><a href="#local-1628078126"><span class="hs-identifier hs-var">deserialize</span></a><span> </span><a href="#local-1628078129"><span class="hs-identifier hs-var">ann_env</span></a><span class="hs-special">)</span><span>
</span><a name="line-781"></a><span>
</span><a name="line-782"></a><span class="hs-comment">-- | Get at most one annotation of a given type per Unique.</span><span>
</span><a name="line-783"></a><span class="hs-identifier">getFirstAnnotations</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier hs-type">Typeable</span></a><span> </span><a href="#local-1628077974"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628077974"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><a href="UniqFM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a><span> </span><a href="#local-1628077974"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-784"></a><a name="getFirstAnnotations"><a href="CoreMonad.html#getFirstAnnotations"><span class="hs-identifier">getFirstAnnotations</span></a></a><span> </span><a name="local-1628078130"><a href="#local-1628078130"><span class="hs-identifier">deserialize</span></a></a><span> </span><a name="local-1628078131"><a href="#local-1628078131"><span class="hs-identifier">guts</span></a></a><span>
</span><a name="line-785"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#liftM"><span class="hs-identifier hs-var">liftM</span></a><span> </span><span class="hs-special">(</span><a href="UniqFM.html#mapUFM"><span class="hs-identifier hs-var">mapUFM</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="UniqFM.html#filterUFM"><span class="hs-identifier hs-var">filterUFM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-786"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="CoreMonad.html#getAnnotations"><span class="hs-identifier hs-var">getAnnotations</span></a><span> </span><a href="#local-1628078130"><span class="hs-identifier hs-var">deserialize</span></a><span> </span><a href="#local-1628078131"><span class="hs-identifier hs-var">guts</span></a><span>
</span><a name="line-787"></a><span>
</span><a name="line-788"></a><span class="hs-comment">{-
Note [Annotations]
~~~~~~~~~~~~~~~~~~
A Core-to-Core pass that wants to make use of annotations calls
getAnnotations or getFirstAnnotations at the beginning to obtain a UniqFM with
annotations of a specific type. This produces all annotations from interface
files read so far. However, annotations from interface files read during the
pass will not be visible until getAnnotations is called again. This is similar
to how rules work and probably isn't too bad.

The current implementation could be optimised a bit: when looking up
annotations for a thing from the HomePackageTable, we could search directly in
the module where the thing is defined rather than building one UniqFM which
contains all annotations we know of. This would work because annotations can
only be given to things defined in the same module. However, since we would
only want to deserialise every annotation once, we would have to build a cache
for every module in the HTP. In the end, it's probably not worth it as long as
we aren't using annotations heavily.

************************************************************************
*                                                                      *
                Direct screen output
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-813"></a><span>
</span><a name="line-814"></a><span class="hs-identifier">msg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="ErrUtils.html#Severity"><span class="hs-identifier hs-type">Severity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-815"></a><a name="msg"><a href="CoreMonad.html#msg"><span class="hs-identifier">msg</span></a></a><span> </span><a name="local-1628078132"><a href="#local-1628078132"><span class="hs-identifier">sev</span></a></a><span> </span><a name="local-1628078133"><a href="#local-1628078133"><span class="hs-identifier">doc</span></a></a><span>
</span><a name="line-816"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628078134"><a href="#local-1628078134"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-817"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628078135"><a href="#local-1628078135"><span class="hs-identifier">loc</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreMonad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a><span>
</span><a name="line-818"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628078136"><a href="#local-1628078136"><span class="hs-identifier">unqual</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreMonad.html#getPrintUnqualified"><span class="hs-identifier hs-var">getPrintUnqualified</span></a><span>
</span><a name="line-819"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628078137"><a href="#local-1628078137"><span class="hs-identifier">sty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628078132"><span class="hs-identifier hs-var">sev</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-820"></a><span>                     </span><a href="ErrUtils.html#SevError"><span class="hs-identifier hs-var">SevError</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628078138"><span class="hs-identifier hs-var">err_sty</span></a><span>
</span><a name="line-821"></a><span>                     </span><a href="ErrUtils.html#SevWarning"><span class="hs-identifier hs-var">SevWarning</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628078138"><span class="hs-identifier hs-var">err_sty</span></a><span>
</span><a name="line-822"></a><span>                     </span><a href="ErrUtils.html#SevDump"><span class="hs-identifier hs-var">SevDump</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628078140"><span class="hs-identifier hs-var">dump_sty</span></a><span>
</span><a name="line-823"></a><span>                     </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628078139"><span class="hs-identifier hs-var">user_sty</span></a><span>
</span><a name="line-824"></a><span>             </span><a name="local-1628078138"><a href="#local-1628078138"><span class="hs-identifier">err_sty</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#mkErrStyle"><span class="hs-identifier hs-var">mkErrStyle</span></a><span> </span><a href="#local-1628078134"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1628078136"><span class="hs-identifier hs-var">unqual</span></a><span>
</span><a name="line-825"></a><span>             </span><a name="local-1628078139"><a href="#local-1628078139"><span class="hs-identifier">user_sty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#mkUserStyle"><span class="hs-identifier hs-var">mkUserStyle</span></a><span> </span><a href="#local-1628078136"><span class="hs-identifier hs-var">unqual</span></a><span> </span><a href="Outputable.html#AllTheWay"><span class="hs-identifier hs-var">AllTheWay</span></a><span>
</span><a name="line-826"></a><span>             </span><a name="local-1628078140"><a href="#local-1628078140"><span class="hs-identifier">dump_sty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#mkDumpStyle"><span class="hs-identifier hs-var">mkDumpStyle</span></a><span> </span><a href="#local-1628078136"><span class="hs-identifier hs-var">unqual</span></a><span>
</span><a name="line-827"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-828"></a><span>         </span><span class="hs-special">(</span><span class="hs-identifier">log_action</span><span> </span><a href="#local-1628078134"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628078134"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="DynFlags.html#NoReason"><span class="hs-identifier hs-var">NoReason</span></a><span> </span><a href="#local-1628078132"><span class="hs-identifier hs-var">sev</span></a><span> </span><a href="#local-1628078135"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-1628078137"><span class="hs-identifier hs-var">sty</span></a><span> </span><a href="#local-1628078133"><span class="hs-identifier hs-var">doc</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-829"></a><span>
</span><a name="line-830"></a><span class="hs-comment">-- | Output a String message to the screen</span><span>
</span><a name="line-831"></a><span class="hs-identifier">putMsgS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-832"></a><a name="putMsgS"><a href="CoreMonad.html#putMsgS"><span class="hs-identifier">putMsgS</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#putMsg"><span class="hs-identifier hs-var">putMsg</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span>
</span><a name="line-833"></a><span>
</span><a name="line-834"></a><span class="hs-comment">-- | Output a message to the screen</span><span>
</span><a name="line-835"></a><span class="hs-identifier">putMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-836"></a><a name="putMsg"><a href="CoreMonad.html#putMsg"><span class="hs-identifier">putMsg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#msg"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="ErrUtils.html#SevInfo"><span class="hs-identifier hs-var">SevInfo</span></a><span>
</span><a name="line-837"></a><span>
</span><a name="line-838"></a><span class="hs-comment">-- | Output a string error to the screen</span><span>
</span><a name="line-839"></a><span class="hs-identifier">errorMsgS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-840"></a><a name="errorMsgS"><a href="CoreMonad.html#errorMsgS"><span class="hs-identifier">errorMsgS</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#errorMsg"><span class="hs-identifier hs-var">errorMsg</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span>
</span><a name="line-841"></a><span>
</span><a name="line-842"></a><span class="hs-comment">-- | Output an error to the screen</span><span>
</span><a name="line-843"></a><span class="hs-identifier">errorMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-844"></a><a name="errorMsg"><a href="CoreMonad.html#errorMsg"><span class="hs-identifier">errorMsg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#msg"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="ErrUtils.html#SevError"><span class="hs-identifier hs-var">SevError</span></a><span>
</span><a name="line-845"></a><span>
</span><a name="line-846"></a><span class="hs-identifier">warnMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-847"></a><a name="warnMsg"><a href="CoreMonad.html#warnMsg"><span class="hs-identifier">warnMsg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#msg"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="ErrUtils.html#SevWarning"><span class="hs-identifier hs-var">SevWarning</span></a><span>
</span><a name="line-848"></a><span>
</span><a name="line-849"></a><span class="hs-comment">-- | Output a fatal string error to the screen. Note this does not by itself cause the compiler to die</span><span>
</span><a name="line-850"></a><span class="hs-identifier">fatalErrorMsgS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-851"></a><a name="fatalErrorMsgS"><a href="CoreMonad.html#fatalErrorMsgS"><span class="hs-identifier">fatalErrorMsgS</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#fatalErrorMsg"><span class="hs-identifier hs-var">fatalErrorMsg</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span>
</span><a name="line-852"></a><span>
</span><a name="line-853"></a><span class="hs-comment">-- | Output a fatal error to the screen. Note this does not by itself cause the compiler to die</span><span>
</span><a name="line-854"></a><span class="hs-identifier">fatalErrorMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-855"></a><a name="fatalErrorMsg"><a href="CoreMonad.html#fatalErrorMsg"><span class="hs-identifier">fatalErrorMsg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#msg"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="ErrUtils.html#SevFatal"><span class="hs-identifier hs-var">SevFatal</span></a><span>
</span><a name="line-856"></a><span>
</span><a name="line-857"></a><span class="hs-comment">-- | Output a string debugging message at verbosity level of @-v@ or higher</span><span>
</span><a name="line-858"></a><span class="hs-identifier">debugTraceMsgS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-859"></a><a name="debugTraceMsgS"><a href="CoreMonad.html#debugTraceMsgS"><span class="hs-identifier">debugTraceMsgS</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span>
</span><a name="line-860"></a><span>
</span><a name="line-861"></a><span class="hs-comment">-- | Outputs a debugging message at verbosity level of @-v@ or higher</span><span>
</span><a name="line-862"></a><span class="hs-identifier">debugTraceMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-863"></a><a name="debugTraceMsg"><a href="CoreMonad.html#debugTraceMsg"><span class="hs-identifier">debugTraceMsg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#msg"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="ErrUtils.html#SevDump"><span class="hs-identifier hs-var">SevDump</span></a><span>
</span><a name="line-864"></a><span>
</span><a name="line-865"></a><span class="hs-comment">-- | Show some labelled 'SDoc' if a particular flag is set or at a verbosity level of @-v -ddump-most@ or higher</span><span>
</span><a name="line-866"></a><span class="hs-identifier">dumpIfSet_dyn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DumpFlag"><span class="hs-identifier hs-type">DumpFlag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-867"></a><a name="dumpIfSet_dyn"><a href="CoreMonad.html#dumpIfSet_dyn"><span class="hs-identifier">dumpIfSet_dyn</span></a></a><span> </span><a name="local-1628078141"><a href="#local-1628078141"><span class="hs-identifier">flag</span></a></a><span> </span><a name="local-1628078142"><a href="#local-1628078142"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-1628078143"><a href="#local-1628078143"><span class="hs-identifier">doc</span></a></a><span>
</span><a name="line-868"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628078144"><a href="#local-1628078144"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-869"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628078145"><a href="#local-1628078145"><span class="hs-identifier">unqual</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreMonad.html#getPrintUnqualified"><span class="hs-identifier hs-var">getPrintUnqualified</span></a><span>
</span><a name="line-870"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#dopt"><span class="hs-identifier hs-var">dopt</span></a><span> </span><a href="#local-1628078141"><span class="hs-identifier hs-var">flag</span></a><span> </span><a href="#local-1628078144"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-871"></a><span>         </span><a href="ErrUtils.html#dumpSDoc"><span class="hs-identifier hs-var">Err</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">dumpSDoc</span></a><span> </span><a href="#local-1628078144"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1628078145"><span class="hs-identifier hs-var">unqual</span></a><span> </span><a href="#local-1628078141"><span class="hs-identifier hs-var">flag</span></a><span> </span><a href="#local-1628078142"><span class="hs-identifier hs-var">str</span></a><span> </span><a href="#local-1628078143"><span class="hs-identifier hs-var">doc</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-872"></a><span>
</span><a name="line-873"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
               Finding TyThings
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-880"></a><span>
</span><a name="line-881"></a><span class="hs-keyword">instance</span><span> </span><a href="HscTypes.html#MonadThings"><span class="hs-identifier hs-type">MonadThings</span></a><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-882"></a><span>    </span><a name="local-1913088805"><a href="HscTypes.html#lookupThing"><span class="hs-identifier">lookupThing</span></a></a><span> </span><a name="local-1628078148"><a href="#local-1628078148"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628078149"><a href="#local-1628078149"><span class="hs-identifier">hsc_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreMonad.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a><span>
</span><a name="line-883"></a><span>                          </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcEnv.html#lookupGlobal"><span class="hs-identifier hs-var">lookupGlobal</span></a><span> </span><a href="#local-1628078149"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-1628078148"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-884"></a><span>
</span><a name="line-885"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
               Template Haskell interoperability
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-892"></a><span>
</span><a name="line-893"></a><span class="hs-cpp">#ifdef GHCI</span><span>
</span><a name="line-894"></a><span class="hs-comment">-- | Attempt to convert a Template Haskell name to one that GHC can</span><span>
</span><a name="line-895"></a><span class="hs-comment">-- understand. Original TH names such as those you get when you use</span><span>
</span><a name="line-896"></a><span class="hs-comment">-- the @'foo@ syntax will be translated to their equivalent GHC name</span><span>
</span><a name="line-897"></a><span class="hs-comment">-- exactly. Qualified or unqualifed TH names will be dynamically bound</span><span>
</span><a name="line-898"></a><span class="hs-comment">-- to names in the module being compiled, if possible. Exact TH names</span><span>
</span><a name="line-899"></a><span class="hs-comment">-- will be bound to the name they represent, exactly.</span><span>
</span><a name="line-900"></a><span class="hs-identifier">thNameToGhcName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../template-haskell-2.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span>
</span><a name="line-901"></a><a name="thNameToGhcName"><a href="CoreMonad.html#thNameToGhcName"><span class="hs-identifier">thNameToGhcName</span></a></a><span> </span><a name="local-1628078146"><a href="#local-1628078146"><span class="hs-identifier">th_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-902"></a><span>    </span><a name="local-1628078147"><a href="#local-1628078147"><span class="hs-identifier">hsc_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreMonad.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a><span>
</span><a name="line-903"></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcRnMonad.html#initTcForLookup"><span class="hs-identifier hs-var">initTcForLookup</span></a><span> </span><a href="#local-1628078147"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><span class="hs-special">(</span><a href="TcSplice.html#lookupThName_maybe"><span class="hs-identifier hs-var">lookupThName_maybe</span></a><span> </span><a href="#local-1628078146"><span class="hs-identifier hs-var">th_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-904"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-905"></a></pre></body></html>