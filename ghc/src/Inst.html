<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998


The @Inst@ type: dictionaries or method instances
-}</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE CPP, MultiWayIf, TupleSections #-}</span><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Inst</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-12"></a><span>       </span><a href="Inst.html#deeplySkolemise"><span class="hs-identifier hs-var">deeplySkolemise</span></a><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>       </span><a href="Inst.html#topInstantiate"><span class="hs-identifier hs-var">topInstantiate</span></a><span class="hs-special">,</span><span> </span><a href="Inst.html#topInstantiateInferred"><span class="hs-identifier hs-var">topInstantiateInferred</span></a><span class="hs-special">,</span><span> </span><a href="Inst.html#deeplyInstantiate"><span class="hs-identifier hs-var">deeplyInstantiate</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>       </span><a href="Inst.html#instCall"><span class="hs-identifier hs-var">instCall</span></a><span class="hs-special">,</span><span> </span><a href="Inst.html#instDFunType"><span class="hs-identifier hs-var">instDFunType</span></a><span class="hs-special">,</span><span> </span><a href="Inst.html#instStupidTheta"><span class="hs-identifier hs-var">instStupidTheta</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>       </span><a href="TcMType.html#newWanted"><span class="hs-identifier hs-var">newWanted</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#newWanteds"><span class="hs-identifier hs-var">newWanteds</span></a><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span>       </span><a href="Inst.html#tcInstBinders"><span class="hs-identifier hs-var">tcInstBinders</span></a><span class="hs-special">,</span><span> </span><a href="Inst.html#tcInstBindersX"><span class="hs-identifier hs-var">tcInstBindersX</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span>       </span><a href="Inst.html#newOverloadedLit"><span class="hs-identifier hs-var">newOverloadedLit</span></a><span class="hs-special">,</span><span> </span><a href="Inst.html#mkOverLit"><span class="hs-identifier hs-var">mkOverLit</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span>       </span><a href="Inst.html#newClsInst"><span class="hs-identifier hs-var">newClsInst</span></a><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>       </span><a href="Inst.html#tcGetInsts"><span class="hs-identifier hs-var">tcGetInsts</span></a><span class="hs-special">,</span><span> </span><a href="TcEnv.html#tcGetInstEnvs"><span class="hs-identifier hs-var">tcGetInstEnvs</span></a><span class="hs-special">,</span><span> </span><a href="Inst.html#getOverlapFlag"><span class="hs-identifier hs-var">getOverlapFlag</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>       </span><a href="Inst.html#tcExtendLocalInstEnv"><span class="hs-identifier hs-var">tcExtendLocalInstEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>       </span><a href="Inst.html#instCallConstraints"><span class="hs-identifier hs-var">instCallConstraints</span></a><span class="hs-special">,</span><span> </span><a href="Inst.html#newMethodFromName"><span class="hs-identifier hs-var">newMethodFromName</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>       </span><a href="Inst.html#tcSyntaxName"><span class="hs-identifier hs-var">tcSyntaxName</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span>       </span><span class="hs-comment">-- Simple functions over evidence variables</span><span>
</span><a name="line-28"></a><span>       </span><a href="TcRnTypes.html#tyCoVarsOfWC"><span class="hs-identifier hs-var">tyCoVarsOfWC</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>       </span><a href="TcRnTypes.html#tyCoVarsOfCt"><span class="hs-identifier hs-var">tyCoVarsOfCt</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#tyCoVarsOfCts"><span class="hs-identifier hs-var">tyCoVarsOfCts</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE #-}</span><span>   </span><a href="TcExpr.html"><span class="hs-identifier">TcExpr</span></a><span class="hs-special">(</span><span> </span><a href="TcExpr.html#tcPolyExpr"><span class="hs-identifier hs-var">tcPolyExpr</span></a><span class="hs-special">,</span><span> </span><a href="TcExpr.html#tcSyntaxOp"><span class="hs-identifier hs-var">tcSyntaxOp</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE #-}</span><span>   </span><a href="TcUnify.html"><span class="hs-identifier">TcUnify</span></a><span class="hs-special">(</span><span> </span><a href="TcUnify.html#unifyType"><span class="hs-identifier hs-var">unifyType</span></a><span class="hs-special">,</span><span> </span><a href="TcUnify.html#unifyKind"><span class="hs-identifier hs-var">unifyKind</span></a><span class="hs-special">,</span><span> </span><a href="TcUnify.html#noThing"><span class="hs-identifier hs-var">noThing</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="HsSyn.html"><span class="hs-identifier">HsSyn</span></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><a href="TcHsSyn.html"><span class="hs-identifier">TcHsSyn</span></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnMonad.html"><span class="hs-identifier">TcRnMonad</span></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><a href="TcEnv.html"><span class="hs-identifier">TcEnv</span></a><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><a href="TcEvidence.html"><span class="hs-identifier">TcEvidence</span></a><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><a href="InstEnv.html"><span class="hs-identifier">InstEnv</span></a><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><a href="TysWiredIn.html"><span class="hs-identifier">TysWiredIn</span></a><span>  </span><span class="hs-special">(</span><span> </span><a href="TysWiredIn.html#heqDataCon"><span class="hs-identifier hs-var">heqDataCon</span></a><span class="hs-special">,</span><span> </span><a href="TysWiredIn.html#coercibleDataCon"><span class="hs-identifier hs-var">coercibleDataCon</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><a href="CoreSyn.html"><span class="hs-identifier">CoreSyn</span></a><span>     </span><span class="hs-special">(</span><span> </span><a href="CoreSyn.html#isOrphan"><span class="hs-identifier hs-var">isOrphan</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><a href="FunDeps.html"><span class="hs-identifier">FunDeps</span></a><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><a href="TcMType.html"><span class="hs-identifier">TcMType</span></a><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><a href="TcType.html"><span class="hs-identifier">TcType</span></a><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><a href="HscTypes.html"><span class="hs-identifier">HscTypes</span></a><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><a href="Class.html"><span class="hs-identifier">Class</span></a><span class="hs-special">(</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><a href="MkId.html"><span class="hs-identifier">MkId</span></a><span class="hs-special">(</span><span> </span><a href="MkId.html#mkDictFunId"><span class="hs-identifier hs-var">mkDictFunId</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><a href="Id.html"><span class="hs-identifier">Id</span></a><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><a href="Var.html"><span class="hs-identifier">Var</span></a><span>      </span><span class="hs-special">(</span><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#mkTyVar"><span class="hs-identifier hs-var">mkTyVar</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><a href="DataCon.html"><span class="hs-identifier">DataCon</span></a><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><a href="TyCon.html"><span class="hs-identifier">TyCon</span></a><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><a href="VarEnv.html"><span class="hs-identifier">VarEnv</span></a><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><a href="PrelNames.html"><span class="hs-identifier">PrelNames</span></a><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">LanguageExtensions</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LangExt</span><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span></a><span class="hs-special">(</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span></a><span class="hs-special">(</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Creating and emittind constraints
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span class="hs-identifier">newMethodFromName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span class="hs-comment">-- Used when Name is the wired-in name for a wired-in class method,</span><span>
</span><a name="line-79"></a><span class="hs-comment">-- so the caller knows its type for sure, which should be of form</span><span>
</span><a name="line-80"></a><span class="hs-comment">--    forall a. C a =&gt; &lt;blah&gt;</span><span>
</span><a name="line-81"></a><span class="hs-comment">-- newMethodFromName is supposed to instantiate just the outer</span><span>
</span><a name="line-82"></a><span class="hs-comment">-- type variable and constraint</span><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><a name="newMethodFromName"><a href="Inst.html#newMethodFromName"><span class="hs-identifier">newMethodFromName</span></a></a><span> </span><a name="local-1628043308"><a href="#local-1628043308"><span class="hs-identifier">origin</span></a></a><span> </span><a name="local-1628043309"><a href="#local-1628043309"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-1628043310"><a href="#local-1628043310"><span class="hs-identifier">inst_ty</span></a></a><span>
</span><a name="line-85"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628043311"><a href="#local-1628043311"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a><span> </span><a href="#local-1628043309"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-86"></a><span>              </span><span class="hs-comment">-- Use tcLookupId not tcLookupGlobalId; the method is almost</span><span>
</span><a name="line-87"></a><span>              </span><span class="hs-comment">-- always a class op, but with -XRebindableSyntax GHC is</span><span>
</span><a name="line-88"></a><span>              </span><span class="hs-comment">-- meant to find whatever thing is in scope, and that may</span><span>
</span><a name="line-89"></a><span>              </span><span class="hs-comment">-- be an ordinary function.</span><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628043312"><a href="#local-1628043312"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#piResultTy"><span class="hs-identifier hs-var">piResultTy</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628043311"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628043310"><span class="hs-identifier hs-var">inst_ty</span></a><span>
</span><a name="line-92"></a><span>             </span><span class="hs-special">(</span><a name="local-1628043313"><a href="#local-1628043313"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043314"><a href="#local-1628043314"><span class="hs-identifier">_caller_knows_this</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitPhiTy"><span class="hs-identifier hs-var">tcSplitPhiTy</span></a><span> </span><a href="#local-1628043312"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-93"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628043315"><a href="#local-1628043315"><span class="hs-identifier">wrap</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">not</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">isForAllTy</span><span> </span><span class="hs-identifier">ty</span><span class="hs-special">)</span><span> </span><a href="Type.html#isForAllTy"><span class="hs-operator hs-var">&amp;&amp;</span></a><span> </span><span class="hs-identifier">isSingleton</span><span> </span><span class="hs-identifier">theta</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span>                 </span><a href="Inst.html#instCall"><span class="hs-identifier hs-var">instCall</span></a><span> </span><a href="#local-1628043308"><span class="hs-identifier hs-var">origin</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628043310"><span class="hs-identifier hs-var">inst_ty</span></a><span class="hs-special">]</span><span> </span><a href="#local-1628043313"><span class="hs-identifier hs-var">theta</span></a><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsUtils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a><span> </span><a href="#local-1628043315"><span class="hs-identifier hs-var">wrap</span></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a><span> </span><a href="#local-1628043311"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Deep instantiation and skolemisation
*                                                                      *
************************************************************************

Note [Deep skolemisation]
~~~~~~~~~~~~~~~~~~~~~~~~~
deeplySkolemise decomposes and skolemises a type, returning a type
with all its arrows visible (ie not buried under foralls)

Examples:

  deeplySkolemise (Int -&gt; forall a. Ord a =&gt; blah)
    =  ( wp, [a], [d:Ord a], Int -&gt; blah )
    where wp = \x:Int. /\a. \(d:Ord a). &lt;hole&gt; x

  deeplySkolemise  (forall a. Ord a =&gt; Maybe a -&gt; forall b. Eq b =&gt; blah)
    =  ( wp, [a,b], [d1:Ord a,d2:Eq b], Maybe a -&gt; blah )
    where wp = /\a.\(d1:Ord a).\(x:Maybe a)./\b.\(d2:Ord b). &lt;hole&gt; x

In general,
  if      deeplySkolemise ty = (wrap, tvs, evs, rho)
    and   e :: rho
  then    wrap e :: ty
    and   'wrap' binds tvs, evs

ToDo: this eta-abstraction plays fast and loose with termination,
      because it can introduce extra lambdas.  Maybe add a `seq` to
      fix this
-}</span><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span class="hs-identifier">deeplySkolemise</span><span>
</span><a name="line-132"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a><span>
</span><a name="line-133"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="TcEvidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a><span>
</span><a name="line-134"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- all skolemised variables</span><span>
</span><a name="line-135"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- all &quot;given&quot;s</span><span>
</span><a name="line-136"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a><span class="hs-special">)</span><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><a name="deeplySkolemise"><a href="Inst.html#deeplySkolemise"><span class="hs-identifier">deeplySkolemise</span></a></a><span> </span><a name="local-1628043316"><a href="#local-1628043316"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-139"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1628043317"><a href="#local-1628043317"><span class="hs-identifier">arg_tys</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043318"><a href="#local-1628043318"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043319"><a href="#local-1628043319"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043320"><a href="#local-1628043320"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcType.html#tcDeepSplitSigmaTy_maybe"><span class="hs-identifier hs-var">tcDeepSplitSigmaTy_maybe</span></a><span> </span><a href="#local-1628043316"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-140"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628043321"><a href="#local-1628043321"><span class="hs-identifier">ids1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newSysLocalIds"><span class="hs-identifier hs-var">newSysLocalIds</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;dk&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628043317"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-141"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628043322"><a href="#local-1628043322"><span class="hs-identifier">subst</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043323"><a href="#local-1628043323"><span class="hs-identifier">tvs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#tcInstSkolTyVars"><span class="hs-identifier hs-var">tcInstSkolTyVars</span></a><span> </span><a href="#local-1628043318"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-142"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628043324"><a href="#local-1628043324"><span class="hs-identifier">ev_vars1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newEvVars"><span class="hs-identifier hs-var">newEvVars</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#substThetaUnchecked"><span class="hs-identifier hs-var">substThetaUnchecked</span></a><span> </span><a href="#local-1628043322"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1628043319"><span class="hs-identifier hs-var">theta</span></a><span class="hs-special">)</span><span>
</span><a name="line-143"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628043325"><a href="#local-1628043325"><span class="hs-identifier">wrap</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043326"><a href="#local-1628043326"><span class="hs-identifier">tvs2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043327"><a href="#local-1628043327"><span class="hs-identifier">ev_vars2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043328"><a href="#local-1628043328"><span class="hs-identifier">rho</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-144"></a><span>           </span><a href="Inst.html#deeplySkolemise"><span class="hs-identifier hs-var">deeplySkolemise</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#substTyAddInScope"><span class="hs-identifier hs-var">substTyAddInScope</span></a><span> </span><a href="#local-1628043322"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1628043320"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">)</span><span>
</span><a name="line-145"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="TcEvidence.html#mkWpLams"><span class="hs-identifier hs-var">mkWpLams</span></a><span> </span><a href="#local-1628043321"><span class="hs-identifier hs-var">ids1</span></a><span>
</span><a name="line-146"></a><span>                   </span><a href="TcEvidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="TcEvidence.html#mkWpTyLams"><span class="hs-identifier hs-var">mkWpTyLams</span></a><span> </span><a href="#local-1628043323"><span class="hs-identifier hs-var">tvs1</span></a><span>
</span><a name="line-147"></a><span>                   </span><a href="TcEvidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="TcEvidence.html#mkWpLams"><span class="hs-identifier hs-var">mkWpLams</span></a><span> </span><a href="#local-1628043324"><span class="hs-identifier hs-var">ev_vars1</span></a><span>
</span><a name="line-148"></a><span>                   </span><a href="TcEvidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="#local-1628043325"><span class="hs-identifier hs-var">wrap</span></a><span>
</span><a name="line-149"></a><span>                   </span><a href="TcEvidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="TcEvidence.html#mkWpEvVarApps"><span class="hs-identifier hs-var">mkWpEvVarApps</span></a><span> </span><a href="#local-1628043321"><span class="hs-identifier hs-var">ids1</span></a><span>
</span><a name="line-150"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="#local-1628043323"><span class="hs-identifier hs-var">tvs1</span></a><span>     </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628043326"><span class="hs-identifier hs-var">tvs2</span></a><span>
</span><a name="line-151"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="#local-1628043324"><span class="hs-identifier hs-var">ev_vars1</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628043327"><span class="hs-identifier hs-var">ev_vars2</span></a><span>
</span><a name="line-152"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkFunTys"><span class="hs-identifier hs-var">mkFunTys</span></a><span> </span><a href="#local-1628043317"><span class="hs-identifier hs-var">arg_tys</span></a><span> </span><a href="#local-1628043328"><span class="hs-identifier hs-var">rho</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-155"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcEvidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-1628043316"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span class="hs-comment">-- | Instantiate all outer type variables</span><span>
</span><a name="line-158"></a><span class="hs-comment">-- and any context. Never looks through arrows.</span><span>
</span><a name="line-159"></a><span class="hs-identifier">topInstantiate</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcEvidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a><span class="hs-special">)</span><span>
</span><a name="line-160"></a><span class="hs-comment">-- if    topInstantiate ty = (wrap, rho)</span><span>
</span><a name="line-161"></a><span class="hs-comment">-- and   e :: ty</span><span>
</span><a name="line-162"></a><span class="hs-comment">-- then  wrap e :: rho  (that is, wrap :: ty &quot;-&gt;&quot; rho)</span><span>
</span><a name="line-163"></a><a name="topInstantiate"><a href="Inst.html#topInstantiate"><span class="hs-identifier">topInstantiate</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Inst.html#top_instantiate"><span class="hs-identifier hs-var">top_instantiate</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span class="hs-comment">-- | Instantiate all outer 'Invisible' binders</span><span>
</span><a name="line-166"></a><span class="hs-comment">-- and any context. Never looks through arrows or specified type variables.</span><span>
</span><a name="line-167"></a><span class="hs-comment">-- Used for visible type application.</span><span>
</span><a name="line-168"></a><span class="hs-identifier">topInstantiateInferred</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a><span>
</span><a name="line-169"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcEvidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a><span class="hs-special">)</span><span>
</span><a name="line-170"></a><span class="hs-comment">-- if    topInstantiate ty = (wrap, rho)</span><span>
</span><a name="line-171"></a><span class="hs-comment">-- and   e :: ty</span><span>
</span><a name="line-172"></a><span class="hs-comment">-- then  wrap e :: rho</span><span>
</span><a name="line-173"></a><a name="topInstantiateInferred"><a href="Inst.html#topInstantiateInferred"><span class="hs-identifier">topInstantiateInferred</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Inst.html#top_instantiate"><span class="hs-identifier hs-var">top_instantiate</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-174"></a><span>
</span><a name="line-175"></a><span class="hs-identifier">top_instantiate</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>   </span><span class="hs-comment">-- True &lt;=&gt; instantiate *all* variables</span><span>
</span><a name="line-176"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcEvidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a><span class="hs-special">)</span><span>
</span><a name="line-177"></a><a name="top_instantiate"><a href="Inst.html#top_instantiate"><span class="hs-identifier">top_instantiate</span></a></a><span> </span><a name="local-1628043329"><a href="#local-1628043329"><span class="hs-identifier">inst_all</span></a></a><span> </span><a name="local-1628043330"><a href="#local-1628043330"><span class="hs-identifier">orig</span></a></a><span> </span><a name="local-1628043331"><a href="#local-1628043331"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-178"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628043332"><span class="hs-identifier hs-var">binders</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628043334"><span class="hs-identifier hs-var">theta</span></a><span class="hs-special">)</span><span>
</span><a name="line-179"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628043338"><a href="#local-1628043338"><span class="hs-identifier">inst_bndrs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043339"><a href="#local-1628043339"><span class="hs-identifier">leave_bndrs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#span"><span class="hs-identifier hs-var">span</span></a><span> </span><a href="#local-1628043336"><span class="hs-identifier hs-var">should_inst</span></a><span> </span><a href="#local-1628043332"><span class="hs-identifier hs-var">binders</span></a><span>
</span><a name="line-180"></a><span>             </span><span class="hs-special">(</span><a name="local-1628043340"><a href="#local-1628043340"><span class="hs-identifier">inst_theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043341"><a href="#local-1628043341"><span class="hs-identifier">leave_theta</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-181"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628043339"><span class="hs-identifier hs-var">leave_bndrs</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1628043334"><span class="hs-identifier hs-var">theta</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-182"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-1628043334"><span class="hs-identifier hs-var">theta</span></a><span class="hs-special">)</span><span>
</span><a name="line-183"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628043342"><a href="#local-1628043342"><span class="hs-identifier">subst</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043343"><a href="#local-1628043343"><span class="hs-identifier">inst_tvs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaTyVars"><span class="hs-identifier hs-var">newMetaTyVars</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#binderVar"><span class="hs-identifier hs-var">binderVar</span></a><span> </span><span class="hs-string">&quot;top_inst&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628043338"><span class="hs-identifier hs-var">inst_bndrs</span></a><span class="hs-special">)</span><span>
</span><a name="line-184"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628043344"><a href="#local-1628043344"><span class="hs-identifier">inst_theta'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substThetaUnchecked"><span class="hs-identifier hs-var">substThetaUnchecked</span></a><span> </span><a href="#local-1628043342"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1628043340"><span class="hs-identifier hs-var">inst_theta</span></a><span>
</span><a name="line-185"></a><span>             </span><a name="local-1628043345"><a href="#local-1628043345"><span class="hs-identifier">sigma'</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTyAddInScope"><span class="hs-identifier hs-var">substTyAddInScope</span></a><span> </span><a href="#local-1628043342"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkForAllTys"><span class="hs-identifier hs-var">mkForAllTys</span></a><span> </span><a href="#local-1628043339"><span class="hs-identifier hs-var">leave_bndrs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-186"></a><span>                                                    </span><a href="TyCoRep.html#mkFunTys"><span class="hs-identifier hs-var">mkFunTys</span></a><span> </span><a href="#local-1628043341"><span class="hs-identifier hs-var">leave_theta</span></a><span> </span><a href="#local-1628043335"><span class="hs-identifier hs-var">rho</span></a><span class="hs-special">)</span><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628043346"><a href="#local-1628043346"><span class="hs-identifier">wrap1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Inst.html#instCall"><span class="hs-identifier hs-var">instCall</span></a><span> </span><a href="#local-1628043330"><span class="hs-identifier hs-var">orig</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><a href="#local-1628043343"><span class="hs-identifier hs-var">inst_tvs'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628043344"><span class="hs-identifier hs-var">inst_theta'</span></a><span>
</span><a name="line-189"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Instantiating&quot;</span><span>
</span><a name="line-190"></a><span>                 </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;all tyvars?&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628043329"><span class="hs-identifier hs-var">inst_all</span></a><span>
</span><a name="line-191"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;origin&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TcRnTypes.html#pprCtOrigin"><span class="hs-identifier hs-var">pprCtOrigin</span></a><span> </span><a href="#local-1628043330"><span class="hs-identifier hs-var">orig</span></a><span>
</span><a name="line-192"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;type&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628043331"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-193"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;with&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628043343"><span class="hs-identifier hs-var">inst_tvs'</span></a><span>
</span><a name="line-194"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;theta:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>  </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628043344"><span class="hs-identifier hs-var">inst_theta'</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-195"></a><span>
</span><a name="line-196"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628043347"><a href="#local-1628043347"><span class="hs-identifier">wrap2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043348"><a href="#local-1628043348"><span class="hs-identifier">rho2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-197"></a><span>           </span><span class="hs-keyword">if</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628043339"><span class="hs-identifier hs-var">leave_bndrs</span></a><span>
</span><a name="line-198"></a><span>
</span><a name="line-199"></a><span>         </span><span class="hs-comment">-- account for types like forall a. Num a =&gt; forall b. Ord b =&gt; ...</span><span>
</span><a name="line-200"></a><span>           </span><span class="hs-keyword">then</span><span> </span><a href="Inst.html#top_instantiate"><span class="hs-identifier hs-var">top_instantiate</span></a><span> </span><a href="#local-1628043329"><span class="hs-identifier hs-var">inst_all</span></a><span> </span><a href="#local-1628043330"><span class="hs-identifier hs-var">orig</span></a><span> </span><a href="#local-1628043345"><span class="hs-identifier hs-var">sigma'</span></a><span>
</span><a name="line-201"></a><span>
</span><a name="line-202"></a><span>         </span><span class="hs-comment">-- but don't loop if there were any un-inst'able tyvars</span><span>
</span><a name="line-203"></a><span>           </span><span class="hs-keyword">else</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcEvidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043345"><span class="hs-identifier hs-var">sigma'</span></a><span class="hs-special">)</span><span>
</span><a name="line-204"></a><span>
</span><a name="line-205"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628043347"><span class="hs-identifier hs-var">wrap2</span></a><span> </span><a href="TcEvidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="#local-1628043346"><span class="hs-identifier hs-var">wrap1</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043348"><span class="hs-identifier hs-var">rho2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-206"></a><span>
</span><a name="line-207"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcEvidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043331"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-208"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-209"></a><span>    </span><span class="hs-special">(</span><a name="local-1628043332"><a href="#local-1628043332"><span class="hs-identifier">binders</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043333"><a href="#local-1628043333"><span class="hs-identifier">phi</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitNamedPiTys"><span class="hs-identifier hs-var">tcSplitNamedPiTys</span></a><span> </span><a href="#local-1628043331"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-210"></a><span>    </span><span class="hs-special">(</span><a name="local-1628043334"><a href="#local-1628043334"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043335"><a href="#local-1628043335"><span class="hs-identifier">rho</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitPhiTy"><span class="hs-identifier hs-var">tcSplitPhiTy</span></a><span> </span><a href="#local-1628043333"><span class="hs-identifier hs-var">phi</span></a><span>
</span><a name="line-211"></a><span>
</span><a name="line-212"></a><span>    </span><a name="local-1628043336"><a href="#local-1628043336"><span class="hs-identifier">should_inst</span></a></a><span> </span><a name="local-1628043337"><a href="#local-1628043337"><span class="hs-identifier">bndr</span></a></a><span>
</span><a name="line-213"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628043329"><span class="hs-identifier hs-var">inst_all</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-214"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#binderVisibility"><span class="hs-identifier hs-var">binderVisibility</span></a><span> </span><a href="#local-1628043337"><span class="hs-identifier hs-var">bndr</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="TyCoRep.html#Invisible"><span class="hs-identifier hs-var">Invisible</span></a><span>
</span><a name="line-215"></a><span>
</span><a name="line-216"></a><span class="hs-identifier">deeplyInstantiate</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcEvidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a><span class="hs-special">)</span><span>
</span><a name="line-217"></a><span class="hs-comment">--   Int -&gt; forall a. a -&gt; a  ==&gt;  (\x:Int. [] x alpha) :: Int -&gt; alpha</span><span>
</span><a name="line-218"></a><span class="hs-comment">-- In general if</span><span>
</span><a name="line-219"></a><span class="hs-comment">-- if    deeplyInstantiate ty = (wrap, rho)</span><span>
</span><a name="line-220"></a><span class="hs-comment">-- and   e :: ty</span><span>
</span><a name="line-221"></a><span class="hs-comment">-- then  wrap e :: rho</span><span>
</span><a name="line-222"></a><span class="hs-comment">-- That is, wrap :: ty &quot;-&gt;&quot; rho</span><span>
</span><a name="line-223"></a><span>
</span><a name="line-224"></a><a name="deeplyInstantiate"><a href="Inst.html#deeplyInstantiate"><span class="hs-identifier">deeplyInstantiate</span></a></a><span> </span><a name="local-1628043349"><a href="#local-1628043349"><span class="hs-identifier">orig</span></a></a><span> </span><a name="local-1628043350"><a href="#local-1628043350"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-225"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1628043351"><a href="#local-1628043351"><span class="hs-identifier">arg_tys</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043352"><a href="#local-1628043352"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043353"><a href="#local-1628043353"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043354"><a href="#local-1628043354"><span class="hs-identifier">rho</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcType.html#tcDeepSplitSigmaTy_maybe"><span class="hs-identifier hs-var">tcDeepSplitSigmaTy_maybe</span></a><span> </span><a href="#local-1628043350"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-226"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628043355"><a href="#local-1628043355"><span class="hs-identifier">subst</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043356"><a href="#local-1628043356"><span class="hs-identifier">tvs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaTyVars"><span class="hs-identifier hs-var">newMetaTyVars</span></a><span> </span><a href="#local-1628043352"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-227"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628043357"><a href="#local-1628043357"><span class="hs-identifier">ids1</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newSysLocalIds"><span class="hs-identifier hs-var">newSysLocalIds</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;di&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#substTysUnchecked"><span class="hs-identifier hs-var">substTysUnchecked</span></a><span> </span><a href="#local-1628043355"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1628043351"><span class="hs-identifier hs-var">arg_tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-228"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628043358"><a href="#local-1628043358"><span class="hs-identifier">theta'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substThetaUnchecked"><span class="hs-identifier hs-var">substThetaUnchecked</span></a><span> </span><a href="#local-1628043355"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1628043353"><span class="hs-identifier hs-var">theta</span></a><span>
</span><a name="line-229"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628043359"><a href="#local-1628043359"><span class="hs-identifier">wrap1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Inst.html#instCall"><span class="hs-identifier hs-var">instCall</span></a><span> </span><a href="#local-1628043349"><span class="hs-identifier hs-var">orig</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><a href="#local-1628043356"><span class="hs-identifier hs-var">tvs'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628043358"><span class="hs-identifier hs-var">theta'</span></a><span>
</span><a name="line-230"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Instantiating (deeply)&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;origin&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TcRnTypes.html#pprCtOrigin"><span class="hs-identifier hs-var">pprCtOrigin</span></a><span> </span><a href="#local-1628043349"><span class="hs-identifier hs-var">orig</span></a><span>
</span><a name="line-231"></a><span>                                                </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;type&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628043350"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-232"></a><span>                                                </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;with&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628043356"><span class="hs-identifier hs-var">tvs'</span></a><span>
</span><a name="line-233"></a><span>                                                </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;args:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628043357"><span class="hs-identifier hs-var">ids1</span></a><span>
</span><a name="line-234"></a><span>                                                </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;theta:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>  </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628043358"><span class="hs-identifier hs-var">theta'</span></a><span>
</span><a name="line-235"></a><span>                                                </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;subst:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628043355"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-236"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628043360"><a href="#local-1628043360"><span class="hs-identifier">wrap2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043361"><a href="#local-1628043361"><span class="hs-identifier">rho2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Inst.html#deeplyInstantiate"><span class="hs-identifier hs-var">deeplyInstantiate</span></a><span> </span><a href="#local-1628043349"><span class="hs-identifier hs-var">orig</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#substTyUnchecked"><span class="hs-identifier hs-var">substTyUnchecked</span></a><span> </span><a href="#local-1628043355"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1628043354"><span class="hs-identifier hs-var">rho</span></a><span class="hs-special">)</span><span>
</span><a name="line-237"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcEvidence.html#mkWpLams"><span class="hs-identifier hs-var">mkWpLams</span></a><span> </span><a href="#local-1628043357"><span class="hs-identifier hs-var">ids1</span></a><span>
</span><a name="line-238"></a><span>                    </span><a href="TcEvidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="#local-1628043360"><span class="hs-identifier hs-var">wrap2</span></a><span>
</span><a name="line-239"></a><span>                    </span><a href="TcEvidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="#local-1628043359"><span class="hs-identifier hs-var">wrap1</span></a><span>
</span><a name="line-240"></a><span>                    </span><a href="TcEvidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="TcEvidence.html#mkWpEvVarApps"><span class="hs-identifier hs-var">mkWpEvVarApps</span></a><span> </span><a href="#local-1628043357"><span class="hs-identifier hs-var">ids1</span></a><span class="hs-special">,</span><span>
</span><a name="line-241"></a><span>                 </span><a href="TyCoRep.html#mkFunTys"><span class="hs-identifier hs-var">mkFunTys</span></a><span> </span><a href="#local-1628043351"><span class="hs-identifier hs-var">arg_tys</span></a><span> </span><a href="#local-1628043361"><span class="hs-identifier hs-var">rho2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-242"></a><span>
</span><a name="line-243"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcEvidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043350"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span>
</span><a name="line-246"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
            Instantiating a call
*                                                                      *
************************************************************************

Note [Handling boxed equality]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The solver deals entirely in terms of unboxed (primitive) equality.
There should never be a boxed Wanted equality. Ever. But, what if
we are calling `foo :: forall a. (F a ~ Bool) =&gt; ...`? That equality
is boxed, so naive treatment here would emit a boxed Wanted equality.

So we simply check for this case and make the right boxing of evidence.

-}</span><span>
</span><a name="line-263"></a><span>
</span><a name="line-264"></a><span class="hs-comment">----------------</span><span>
</span><a name="line-265"></a><span class="hs-identifier">instCall</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcEvidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a><span>
</span><a name="line-266"></a><span class="hs-comment">-- Instantiate the constraints of a call</span><span>
</span><a name="line-267"></a><span class="hs-comment">--      (instCall o tys theta)</span><span>
</span><a name="line-268"></a><span class="hs-comment">-- (a) Makes fresh dictionaries as necessary for the constraints (theta)</span><span>
</span><a name="line-269"></a><span class="hs-comment">-- (b) Throws these dictionaries into the LIE</span><span>
</span><a name="line-270"></a><span class="hs-comment">-- (c) Returns an HsWrapper ([.] tys dicts)</span><span>
</span><a name="line-271"></a><span>
</span><a name="line-272"></a><a name="instCall"><a href="Inst.html#instCall"><span class="hs-identifier">instCall</span></a></a><span> </span><a name="local-1628043362"><a href="#local-1628043362"><span class="hs-identifier">orig</span></a></a><span> </span><a name="local-1628043363"><a href="#local-1628043363"><span class="hs-identifier">tys</span></a></a><span> </span><a name="local-1628043364"><a href="#local-1628043364"><span class="hs-identifier">theta</span></a></a><span>
</span><a name="line-273"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1628043365"><a href="#local-1628043365"><span class="hs-identifier">dict_app</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Inst.html#instCallConstraints"><span class="hs-identifier hs-var">instCallConstraints</span></a><span> </span><a href="#local-1628043362"><span class="hs-identifier hs-var">orig</span></a><span> </span><a href="#local-1628043364"><span class="hs-identifier hs-var">theta</span></a><span>
</span><a name="line-274"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628043365"><span class="hs-identifier hs-var">dict_app</span></a><span> </span><a href="TcEvidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="TcEvidence.html#mkWpTyApps"><span class="hs-identifier hs-var">mkWpTyApps</span></a><span> </span><a href="#local-1628043363"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-275"></a><span>
</span><a name="line-276"></a><span class="hs-comment">----------------</span><span>
</span><a name="line-277"></a><span class="hs-identifier">instCallConstraints</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcEvidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a><span>
</span><a name="line-278"></a><span class="hs-comment">-- Instantiates the TcTheta, puts all constraints thereby generated</span><span>
</span><a name="line-279"></a><span class="hs-comment">-- into the LIE, and returns a HsWrapper to enclose the call site.</span><span>
</span><a name="line-280"></a><span>
</span><a name="line-281"></a><a name="instCallConstraints"><a href="Inst.html#instCallConstraints"><span class="hs-identifier">instCallConstraints</span></a></a><span> </span><a name="local-1628043366"><a href="#local-1628043366"><span class="hs-identifier">orig</span></a></a><span> </span><a name="local-1628043367"><a href="#local-1628043367"><span class="hs-identifier">preds</span></a></a><span>
</span><a name="line-282"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628043367"><span class="hs-identifier hs-var">preds</span></a><span>
</span><a name="line-283"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="TcEvidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a><span>
</span><a name="line-284"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-285"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628043378"><a href="#local-1628043378"><span class="hs-identifier">evs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="#local-1628043368"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1628043367"><span class="hs-identifier hs-var">preds</span></a><span>
</span><a name="line-286"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;instCallConstraints&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628043378"><span class="hs-identifier hs-var">evs</span></a><span class="hs-special">)</span><span>
</span><a name="line-287"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcEvidence.html#mkWpEvApps"><span class="hs-identifier hs-var">mkWpEvApps</span></a><span> </span><a href="#local-1628043378"><span class="hs-identifier hs-var">evs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-288"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-289"></a><span>    </span><a name="local-1628043368"><a href="#local-1628043368"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-1628043369"><a href="#local-1628043369"><span class="hs-identifier">pred</span></a></a><span>
</span><a name="line-290"></a><span>     </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span class="hs-special">,</span><span> </span><a name="local-1628043370"><a href="#local-1628043370"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043371"><a href="#local-1628043371"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#getEqPredTys_maybe"><span class="hs-identifier hs-var">getEqPredTys_maybe</span></a><span> </span><a href="#local-1628043369"><span class="hs-identifier hs-var">pred</span></a><span> </span><span class="hs-comment">-- Try short-cut #1</span><span>
</span><a name="line-291"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1628043372"><a href="#local-1628043372"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcUnify.html#unifyType"><span class="hs-identifier hs-var">unifyType</span></a><span> </span><a href="TcUnify.html#noThing"><span class="hs-identifier hs-var">noThing</span></a><span> </span><a href="#local-1628043370"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-1628043371"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-292"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcEvidence.html#EvCoercion"><span class="hs-identifier hs-var">EvCoercion</span></a><span> </span><a href="#local-1628043372"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-293"></a><span>
</span><a name="line-294"></a><span>       </span><span class="hs-comment">-- Try short-cut #2</span><span>
</span><a name="line-295"></a><span>     </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1628043373"><a href="#local-1628043373"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043374"><a href="#local-1628043374"><span class="hs-identifier">args</span></a></a><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1628043375"><a href="#local-1628043375"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043376"><a href="#local-1628043376"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-1628043369"><span class="hs-identifier hs-var">pred</span></a><span>
</span><a name="line-296"></a><span>     </span><span class="hs-special">,</span><span> </span><a href="#local-1628043373"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#heqTyConKey"><span class="hs-identifier hs-var">heqTyConKey</span></a><span>
</span><a name="line-297"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628043377"><a href="#local-1628043377"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcUnify.html#unifyType"><span class="hs-identifier hs-var">unifyType</span></a><span> </span><a href="TcUnify.html#noThing"><span class="hs-identifier hs-var">noThing</span></a><span> </span><a href="#local-1628043375"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-1628043376"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-298"></a><span>          </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcEvidence.html#EvDFunApp"><span class="hs-identifier hs-var">EvDFunApp</span></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#dataConWrapId"><span class="hs-identifier hs-var">dataConWrapId</span></a><span> </span><a href="TysWiredIn.html#heqDataCon"><span class="hs-identifier hs-var">heqDataCon</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628043374"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">[</span><a href="TcEvidence.html#EvCoercion"><span class="hs-identifier hs-var">EvCoercion</span></a><span> </span><a href="#local-1628043377"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-299"></a><span>
</span><a name="line-300"></a><span>     </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-301"></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#emitWanted"><span class="hs-identifier hs-var">emitWanted</span></a><span> </span><a href="#local-1628043366"><span class="hs-identifier hs-var">orig</span></a><span> </span><a href="#local-1628043369"><span class="hs-identifier hs-var">pred</span></a><span>
</span><a name="line-302"></a><span>
</span><a name="line-303"></a><span class="hs-identifier">instDFunType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#DFunId"><span class="hs-identifier hs-type">DFunId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="InstEnv.html#DFunInstType"><span class="hs-identifier hs-type">DFunInstType</span></a><span class="hs-special">]</span><span>
</span><a name="line-304"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- instantiated argument types</span><span>
</span><a name="line-305"></a><span>                    </span><span class="hs-special">,</span><span> </span><a href="TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- instantiated constraint</span><span>
</span><a name="line-306"></a><span class="hs-comment">-- See Note [DFunInstType: instantiating types] in InstEnv</span><span>
</span><a name="line-307"></a><a name="instDFunType"><a href="Inst.html#instDFunType"><span class="hs-identifier">instDFunType</span></a></a><span> </span><a name="local-1628043379"><a href="#local-1628043379"><span class="hs-identifier">dfun_id</span></a></a><span> </span><a name="local-1628043380"><a href="#local-1628043380"><span class="hs-identifier">dfun_inst_tys</span></a></a><span>
</span><a name="line-308"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628043400"><a href="#local-1628043400"><span class="hs-identifier">subst</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043401"><a href="#local-1628043401"><span class="hs-identifier">inst_tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628043383"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="TyCoRep.html#emptyTCvSubst"><span class="hs-identifier hs-var">emptyTCvSubst</span></a><span> </span><a href="#local-1628043381"><span class="hs-identifier hs-var">dfun_tvs</span></a><span> </span><a href="#local-1628043380"><span class="hs-identifier hs-var">dfun_inst_tys</span></a><span>
</span><a name="line-309"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628043401"><span class="hs-identifier hs-var">inst_tys</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTheta"><span class="hs-identifier hs-var">substTheta</span></a><span> </span><a href="#local-1628043400"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1628043382"><span class="hs-identifier hs-var">dfun_theta</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-310"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-311"></a><span>    </span><span class="hs-special">(</span><a name="local-1628043381"><a href="#local-1628043381"><span class="hs-identifier">dfun_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043382"><a href="#local-1628043382"><span class="hs-identifier">dfun_theta</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitSigmaTy"><span class="hs-identifier hs-var">tcSplitSigmaTy</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628043379"><span class="hs-identifier hs-var">dfun_id</span></a><span class="hs-special">)</span><span>
</span><a name="line-312"></a><span>
</span><a name="line-313"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="InstEnv.html#DFunInstType"><span class="hs-identifier hs-type">DFunInstType</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-314"></a><span>    </span><a name="local-1628043383"><a href="#local-1628043383"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-1628043384"><a href="#local-1628043384"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628043384"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-315"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-1628043385"><a href="#local-1628043385"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628043386"><a href="#local-1628043386"><span class="hs-identifier">tv</span></a></a><span class="hs-glyph">:</span><a name="local-1628043387"><a href="#local-1628043387"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628043388"><a href="#local-1628043388"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-1628043389"><a href="#local-1628043389"><span class="hs-identifier">mb_tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-316"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628043390"><a href="#local-1628043390"><span class="hs-identifier">subst'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043391"><a href="#local-1628043391"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628043383"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#extendTvSubstAndInScope"><span class="hs-identifier hs-var">extendTvSubstAndInScope</span></a><span> </span><a href="#local-1628043385"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1628043386"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-1628043388"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-317"></a><span>                                 </span><a href="#local-1628043387"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-318"></a><span>                                 </span><a href="#local-1628043389"><span class="hs-identifier hs-var">mb_tys</span></a><span>
</span><a name="line-319"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628043390"><span class="hs-identifier hs-var">subst'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043388"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628043391"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-320"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-1628043392"><a href="#local-1628043392"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628043393"><a href="#local-1628043393"><span class="hs-identifier">tv</span></a></a><span class="hs-glyph">:</span><a name="local-1628043394"><a href="#local-1628043394"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-1628043395"><a href="#local-1628043395"><span class="hs-identifier">mb_tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-321"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628043396"><a href="#local-1628043396"><span class="hs-identifier">subst'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043397"><a href="#local-1628043397"><span class="hs-identifier">tv'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaTyVarX"><span class="hs-identifier hs-var">newMetaTyVarX</span></a><span> </span><a href="#local-1628043392"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1628043393"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-322"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628043398"><a href="#local-1628043398"><span class="hs-identifier">subst''</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043399"><a href="#local-1628043399"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628043383"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1628043396"><span class="hs-identifier hs-var">subst'</span></a><span> </span><a href="#local-1628043394"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-1628043395"><span class="hs-identifier hs-var">mb_tys</span></a><span>
</span><a name="line-323"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628043398"><span class="hs-identifier hs-var">subst''</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="#local-1628043397"><span class="hs-identifier hs-var">tv'</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628043399"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-324"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;instDFunTypes&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628043379"><span class="hs-identifier hs-var">dfun_id</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628043380"><span class="hs-identifier hs-var">dfun_inst_tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-325"></a><span>
</span><a name="line-326"></a><span class="hs-comment">----------------</span><span>
</span><a name="line-327"></a><span class="hs-identifier">instStupidTheta</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-328"></a><span class="hs-comment">-- Similar to instCall, but only emit the constraints in the LIE</span><span>
</span><a name="line-329"></a><span class="hs-comment">-- Used exclusively for the 'stupid theta' of a data constructor</span><span>
</span><a name="line-330"></a><a name="instStupidTheta"><a href="Inst.html#instStupidTheta"><span class="hs-identifier">instStupidTheta</span></a></a><span> </span><a name="local-1628043402"><a href="#local-1628043402"><span class="hs-identifier">orig</span></a></a><span> </span><a name="local-1628043403"><a href="#local-1628043403"><span class="hs-identifier">theta</span></a></a><span>
</span><a name="line-331"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1628043404"><a href="#local-1628043404"><span class="hs-identifier">_co</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Inst.html#instCallConstraints"><span class="hs-identifier hs-var">instCallConstraints</span></a><span> </span><a href="#local-1628043402"><span class="hs-identifier hs-var">orig</span></a><span> </span><a href="#local-1628043403"><span class="hs-identifier hs-var">theta</span></a><span> </span><span class="hs-comment">-- Discard the coercion</span><span>
</span><a name="line-332"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-333"></a><span>
</span><a name="line-334"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
         Instantiating Kinds
*                                                                      *
************************************************************************

-}</span><span>
</span><a name="line-342"></a><span>
</span><a name="line-343"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-344"></a><span class="hs-comment">-- | This is used to instantiate binders when type-checking *types* only.</span><span>
</span><a name="line-345"></a><span class="hs-comment">-- See also Note [Bidirectional type checking]</span><span>
</span><a name="line-346"></a><span class="hs-identifier">tcInstBinders</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-347"></a><a name="tcInstBinders"><a href="Inst.html#tcInstBinders"><span class="hs-identifier">tcInstBinders</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Inst.html#tcInstBindersX"><span class="hs-identifier hs-var">tcInstBindersX</span></a><span> </span><a href="TyCoRep.html#emptyTCvSubst"><span class="hs-identifier hs-var">emptyTCvSubst</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-348"></a><span>
</span><a name="line-349"></a><span class="hs-comment">-- | This is used to instantiate binders when type-checking *types* only.</span><span>
</span><a name="line-350"></a><span class="hs-comment">-- The @VarEnv Kind@ gives some known instantiations.</span><span>
</span><a name="line-351"></a><span class="hs-comment">-- See also Note [Bidirectional type checking]</span><span>
</span><a name="line-352"></a><span class="hs-identifier">tcInstBindersX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-353"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-354"></a><a name="tcInstBindersX"><a href="Inst.html#tcInstBindersX"><span class="hs-identifier">tcInstBindersX</span></a></a><span> </span><a name="local-1628043405"><a href="#local-1628043405"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-1628043406"><a href="#local-1628043406"><span class="hs-identifier">mb_kind_info</span></a></a><span> </span><a name="local-1628043407"><a href="#local-1628043407"><span class="hs-identifier">bndrs</span></a></a><span>
</span><a name="line-355"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628043408"><a href="#local-1628043408"><span class="hs-identifier">subst</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043409"><a href="#local-1628043409"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MonadUtils.html#mapAccumLM"><span class="hs-identifier hs-var">mapAccumLM</span></a><span> </span><span class="hs-special">(</span><a href="Inst.html#tcInstBinderX"><span class="hs-identifier hs-var">tcInstBinderX</span></a><span> </span><a href="#local-1628043406"><span class="hs-identifier hs-var">mb_kind_info</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628043405"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1628043407"><span class="hs-identifier hs-var">bndrs</span></a><span>
</span><a name="line-356"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;instantiating tybinders:&quot;</span><span>
</span><a name="line-357"></a><span>           </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628043410"><a href="#local-1628043410"><span class="hs-identifier">bndr</span></a></a><span> </span><a name="local-1628043411"><a href="#local-1628043411"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628043410"><span class="hs-identifier hs-var">bndr</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;:=&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628043411"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-358"></a><span>                           </span><a href="#local-1628043407"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><a href="#local-1628043409"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-359"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628043408"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043409"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-360"></a><span>
</span><a name="line-361"></a><span class="hs-comment">-- | Used only in *types*</span><span>
</span><a name="line-362"></a><span class="hs-identifier">tcInstBinderX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-363"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">)</span><span>
</span><a name="line-364"></a><a name="tcInstBinderX"><a href="Inst.html#tcInstBinderX"><span class="hs-identifier">tcInstBinderX</span></a></a><span> </span><a name="local-1628043412"><a href="#local-1628043412"><span class="hs-identifier">mb_kind_info</span></a></a><span> </span><a name="local-1628043413"><a href="#local-1628043413"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-1628043414"><a href="#local-1628043414"><span class="hs-identifier">binder</span></a></a><span>
</span><a name="line-365"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628043431"><a href="#local-1628043431"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#binderVar_maybe"><span class="hs-identifier hs-var">binderVar_maybe</span></a><span> </span><a href="#local-1628043414"><span class="hs-identifier hs-var">binder</span></a><span>
</span><a name="line-366"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628043416"><span class="hs-identifier hs-var">lookup_tv</span></a><span> </span><a href="#local-1628043431"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-367"></a><span>      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628043432"><a href="#local-1628043432"><span class="hs-identifier">ki</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#extendTvSubstAndInScope"><span class="hs-identifier hs-var">extendTvSubstAndInScope</span></a><span> </span><a href="#local-1628043413"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1628043431"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-1628043432"><span class="hs-identifier hs-var">ki</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043432"><span class="hs-identifier hs-var">ki</span></a><span class="hs-special">)</span><span>
</span><a name="line-368"></a><span>      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628043433"><a href="#local-1628043433"><span class="hs-identifier">subst'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043434"><a href="#local-1628043434"><span class="hs-identifier">tv'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaTyVarX"><span class="hs-identifier hs-var">newMetaTyVarX</span></a><span> </span><a href="#local-1628043413"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1628043431"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-369"></a><span>                    </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628043433"><span class="hs-identifier hs-var">subst'</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="#local-1628043434"><span class="hs-identifier hs-var">tv'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-370"></a><span>
</span><a name="line-371"></a><span>     </span><span class="hs-comment">-- This is the *only* constraint currently handled in types.</span><span>
</span><a name="line-372"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1628043435"><a href="#local-1628043435"><span class="hs-identifier">mk</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043436"><a href="#local-1628043436"><span class="hs-identifier">role</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043437"><a href="#local-1628043437"><span class="hs-identifier">k1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043438"><a href="#local-1628043438"><span class="hs-identifier">k2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628043417"><span class="hs-identifier hs-var">get_pred_tys_maybe</span></a><span> </span><a href="#local-1628043415"><span class="hs-identifier hs-var">substed_ty</span></a><span>
</span><a name="line-373"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628043439"><a href="#local-1628043439"><span class="hs-identifier">origin</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#TypeEqOrigin"><span class="hs-identifier hs-var">TypeEqOrigin</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">uo_actual</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628043437"><span class="hs-identifier hs-var">k1</span></a><span>
</span><a name="line-374"></a><span>                                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">uo_expected</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a><span> </span><a href="#local-1628043438"><span class="hs-identifier hs-var">k2</span></a><span>
</span><a name="line-375"></a><span>                                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">uo_thing</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-376"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628043440"><a href="#local-1628043440"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628043436"><span class="hs-identifier hs-var">role</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-377"></a><span>                 </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcUnify.html#unifyKind"><span class="hs-identifier hs-var">unifyKind</span></a><span> </span><a href="TcUnify.html#noThing"><span class="hs-identifier hs-var">noThing</span></a><span> </span><a href="#local-1628043437"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-1628043438"><span class="hs-identifier hs-var">k2</span></a><span>
</span><a name="line-378"></a><span>                 </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcMType.html#emitWantedEq"><span class="hs-identifier hs-var">emitWantedEq</span></a><span> </span><a href="#local-1628043439"><span class="hs-identifier hs-var">origin</span></a><span> </span><a href="TcRnTypes.html#KindLevel"><span class="hs-identifier hs-var">KindLevel</span></a><span> </span><a href="#local-1628043436"><span class="hs-identifier hs-var">role</span></a><span> </span><a href="#local-1628043437"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-1628043438"><span class="hs-identifier hs-var">k2</span></a><span>
</span><a name="line-379"></a><span>                 </span><a href="CoAxiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tcInstBinderX Phantom&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628043414"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span>
</span><a name="line-380"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628043441"><a href="#local-1628043441"><span class="hs-identifier">arg'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628043435"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-1628043440"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="#local-1628043437"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-1628043438"><span class="hs-identifier hs-var">k2</span></a><span>
</span><a name="line-381"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628043413"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043441"><span class="hs-identifier hs-var">arg'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-382"></a><span>
</span><a name="line-383"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#isPredTy"><span class="hs-identifier hs-var">isPredTy</span></a><span> </span><a href="#local-1628043415"><span class="hs-identifier hs-var">substed_ty</span></a><span>
</span><a name="line-384"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628043442"><a href="#local-1628043442"><span class="hs-identifier">env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043443"><a href="#local-1628043443"><span class="hs-identifier">tidy_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyOpenType"><span class="hs-identifier hs-var">tidyOpenType</span></a><span> </span><a href="VarEnv.html#emptyTidyEnv"><span class="hs-identifier hs-var">emptyTidyEnv</span></a><span> </span><a href="#local-1628043415"><span class="hs-identifier hs-var">substed_ty</span></a><span>
</span><a name="line-385"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#addErrTcM"><span class="hs-identifier hs-var">addErrTcM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628043442"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Illegal constraint in a type:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628043443"><span class="hs-identifier hs-var">tidy_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-386"></a><span>
</span><a name="line-387"></a><span>         </span><span class="hs-comment">-- just invent a new variable so that we can continue</span><span>
</span><a name="line-388"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628043444"><a href="#local-1628043444"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a><span>
</span><a name="line-389"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628043445"><a href="#local-1628043445"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#mkSysTvName"><span class="hs-identifier hs-var">mkSysTvName</span></a><span> </span><a href="#local-1628043444"><span class="hs-identifier hs-var">u</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;dict&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-390"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628043413"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Var.html#mkTyVar"><span class="hs-identifier hs-var">mkTyVar</span></a><span> </span><a href="#local-1628043445"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-1628043415"><span class="hs-identifier hs-var">substed_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-391"></a><span>
</span><a name="line-392"></a><span>
</span><a name="line-393"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-394"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628043446"><a href="#local-1628043446"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a><span> </span><a href="#local-1628043415"><span class="hs-identifier hs-var">substed_ty</span></a><span>
</span><a name="line-395"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628043413"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043446"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-396"></a><span>
</span><a name="line-397"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-398"></a><span>    </span><a name="local-1628043415"><a href="#local-1628043415"><span class="hs-identifier">substed_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><a href="#local-1628043413"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#binderType"><span class="hs-identifier hs-var">binderType</span></a><span> </span><a href="#local-1628043414"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span>
</span><a name="line-399"></a><span>
</span><a name="line-400"></a><span>    </span><a name="local-1628043416"><a href="#local-1628043416"><span class="hs-identifier">lookup_tv</span></a></a><span> </span><a name="local-1628043418"><a href="#local-1628043418"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628043419"><a href="#local-1628043419"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628043412"><span class="hs-identifier hs-var">mb_kind_info</span></a><span>   </span><span class="hs-comment">-- `Maybe` monad</span><span>
</span><a name="line-401"></a><span>                      </span><span class="hs-special">;</span><span> </span><a href="VarEnv.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a><span> </span><a href="#local-1628043419"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1628043418"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-402"></a><span>
</span><a name="line-403"></a><span>      </span><span class="hs-comment">-- handle boxed equality constraints, because it's so easy</span><span>
</span><a name="line-404"></a><span>    </span><a name="local-1628043417"><a href="#local-1628043417"><span class="hs-identifier">get_pred_tys_maybe</span></a></a><span> </span><a name="local-1628043420"><a href="#local-1628043420"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-405"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1628043421"><a href="#local-1628043421"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043422"><a href="#local-1628043422"><span class="hs-identifier">k1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043423"><a href="#local-1628043423"><span class="hs-identifier">k2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#getEqPredTys_maybe"><span class="hs-identifier hs-var">getEqPredTys_maybe</span></a><span> </span><a href="#local-1628043420"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-406"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628043424"><a href="#local-1628043424"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Type.html#mkCoercionTy"><span class="hs-identifier hs-var">mkCoercionTy</span></a><span> </span><a href="#local-1628043424"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043421"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043422"><span class="hs-identifier hs-var">k1</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043423"><span class="hs-identifier hs-var">k2</span></a><span class="hs-special">)</span><span>
</span><a name="line-407"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1628043425"><a href="#local-1628043425"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1628043426"><a href="#local-1628043426"><span class="hs-identifier">k1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043427"><a href="#local-1628043427"><span class="hs-identifier">k2</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-1628043420"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-408"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628043425"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#heqTyConKey"><span class="hs-identifier hs-var">heqTyConKey</span></a><span>
</span><a name="line-409"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="Inst.html#mkHEqBoxTy"><span class="hs-identifier hs-var">mkHEqBoxTy</span></a><span class="hs-special">,</span><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043426"><span class="hs-identifier hs-var">k1</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043427"><span class="hs-identifier hs-var">k2</span></a><span class="hs-special">)</span><span>
</span><a name="line-410"></a><span>           </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-411"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-412"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1628043428"><a href="#local-1628043428"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1628043429"><a href="#local-1628043429"><span class="hs-identifier">k1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043430"><a href="#local-1628043430"><span class="hs-identifier">k2</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-1628043420"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-413"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628043428"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#eqTyConKey"><span class="hs-identifier hs-var">eqTyConKey</span></a><span>
</span><a name="line-414"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="Inst.html#mkEqBoxTy"><span class="hs-identifier hs-var">mkEqBoxTy</span></a><span class="hs-special">,</span><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043429"><span class="hs-identifier hs-var">k1</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043430"><span class="hs-identifier hs-var">k2</span></a><span class="hs-special">)</span><span>
</span><a name="line-415"></a><span>           </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628043428"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#coercibleTyConKey"><span class="hs-identifier hs-var">coercibleTyConKey</span></a><span>
</span><a name="line-416"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="Inst.html#mkCoercibleBoxTy"><span class="hs-identifier hs-var">mkCoercibleBoxTy</span></a><span class="hs-special">,</span><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043429"><span class="hs-identifier hs-var">k1</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043430"><span class="hs-identifier hs-var">k2</span></a><span class="hs-special">)</span><span>
</span><a name="line-417"></a><span>           </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-418"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-419"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-420"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-421"></a><span>
</span><a name="line-422"></a><span class="hs-comment">-------------------------------</span><span>
</span><a name="line-423"></a><span class="hs-comment">-- | This takes @a ~# b@ and returns @a ~~ b@.</span><span>
</span><a name="line-424"></a><span class="hs-identifier">mkHEqBoxTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcEvidence.html#TcCoercion"><span class="hs-identifier hs-type">TcCoercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-425"></a><span class="hs-comment">-- monadic just for convenience with mkEqBoxTy</span><span>
</span><a name="line-426"></a><a name="mkHEqBoxTy"><a href="Inst.html#mkHEqBoxTy"><span class="hs-identifier">mkHEqBoxTy</span></a></a><span> </span><a name="local-1628043447"><a href="#local-1628043447"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-1628043448"><a href="#local-1628043448"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-1628043449"><a href="#local-1628043449"><span class="hs-identifier">ty2</span></a></a><span>
</span><a name="line-427"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-428"></a><span>    </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#promoteDataCon"><span class="hs-identifier hs-var">promoteDataCon</span></a><span> </span><a href="TysWiredIn.html#heqDataCon"><span class="hs-identifier hs-var">heqDataCon</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-1628043450"><span class="hs-identifier hs-var">k1</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043451"><span class="hs-identifier hs-var">k2</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043448"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043449"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#mkCoercionTy"><span class="hs-identifier hs-var">mkCoercionTy</span></a><span> </span><a href="#local-1628043447"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">]</span><span>
</span><a name="line-429"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-1628043450"><a href="#local-1628043450"><span class="hs-identifier">k1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-1628043448"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-430"></a><span>        </span><a name="local-1628043451"><a href="#local-1628043451"><span class="hs-identifier">k2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-1628043449"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-431"></a><span>
</span><a name="line-432"></a><span class="hs-comment">-- | This takes @a ~# b@ and returns @a ~ b@.</span><span>
</span><a name="line-433"></a><span class="hs-identifier">mkEqBoxTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcEvidence.html#TcCoercion"><span class="hs-identifier hs-type">TcCoercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-434"></a><a name="mkEqBoxTy"><a href="Inst.html#mkEqBoxTy"><span class="hs-identifier">mkEqBoxTy</span></a></a><span> </span><a name="local-1628043452"><a href="#local-1628043452"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-1628043453"><a href="#local-1628043453"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-1628043454"><a href="#local-1628043454"><span class="hs-identifier">ty2</span></a></a><span>
</span><a name="line-435"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628043456"><a href="#local-1628043456"><span class="hs-identifier">eq_tc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupTyCon"><span class="hs-identifier hs-var">tcLookupTyCon</span></a><span> </span><a href="PrelNames.html#eqTyConName"><span class="hs-identifier hs-var">eqTyConName</span></a><span>
</span><a name="line-436"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><a name="local-1628043457"><a href="#local-1628043457"><span class="hs-identifier">datacon</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><a href="#local-1628043456"><span class="hs-identifier hs-var">eq_tc</span></a><span>
</span><a name="line-437"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628043458"><a href="#local-1628043458"><span class="hs-identifier">hetero</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Inst.html#mkHEqBoxTy"><span class="hs-identifier hs-var">mkHEqBoxTy</span></a><span> </span><a href="#local-1628043452"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="#local-1628043453"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-1628043454"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-438"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#promoteDataCon"><span class="hs-identifier hs-var">promoteDataCon</span></a><span> </span><a href="#local-1628043457"><span class="hs-identifier hs-var">datacon</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-1628043455"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043453"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043454"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043458"><span class="hs-identifier hs-var">hetero</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-439"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-1628043455"><a href="#local-1628043455"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-1628043453"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-440"></a><span>
</span><a name="line-441"></a><span class="hs-comment">-- | This takes @a ~R# b@ and returns @Coercible a b@.</span><span>
</span><a name="line-442"></a><span class="hs-identifier">mkCoercibleBoxTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcEvidence.html#TcCoercion"><span class="hs-identifier hs-type">TcCoercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-443"></a><span class="hs-comment">-- monadic just for convenience with mkEqBoxTy</span><span>
</span><a name="line-444"></a><a name="mkCoercibleBoxTy"><a href="Inst.html#mkCoercibleBoxTy"><span class="hs-identifier">mkCoercibleBoxTy</span></a></a><span> </span><a name="local-1628043459"><a href="#local-1628043459"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-1628043460"><a href="#local-1628043460"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-1628043461"><a href="#local-1628043461"><span class="hs-identifier">ty2</span></a></a><span>
</span><a name="line-445"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-446"></a><span>         </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#promoteDataCon"><span class="hs-identifier hs-var">promoteDataCon</span></a><span> </span><a href="TysWiredIn.html#coercibleDataCon"><span class="hs-identifier hs-var">coercibleDataCon</span></a><span class="hs-special">)</span><span>
</span><a name="line-447"></a><span>                    </span><span class="hs-special">[</span><a href="#local-1628043462"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043460"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043461"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#mkCoercionTy"><span class="hs-identifier hs-var">mkCoercionTy</span></a><span> </span><a href="#local-1628043459"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-448"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-1628043462"><a href="#local-1628043462"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-1628043460"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-449"></a><span>
</span><a name="line-450"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Literals
*                                                                      *
************************************************************************

-}</span><span>
</span><a name="line-458"></a><span>
</span><a name="line-459"></a><span class="hs-comment">{-
In newOverloadedLit we convert directly to an Int or Integer if we
know that's what we want.  This may save some time, by not
temporarily generating overloaded literals, but it won't catch all
cases (the rest are caught in lookupInst).

-}</span><span>
</span><a name="line-466"></a><span>
</span><a name="line-467"></a><span class="hs-identifier">newOverloadedLit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsLit.html#HsOverLit"><span class="hs-identifier hs-type">HsOverLit</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-468"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a><span>
</span><a name="line-469"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="HsLit.html#HsOverLit"><span class="hs-identifier hs-type">HsOverLit</span></a><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">)</span><span>
</span><a name="line-470"></a><a name="newOverloadedLit"><a href="Inst.html#newOverloadedLit"><span class="hs-identifier">newOverloadedLit</span></a></a><span>
</span><a name="line-471"></a><span>  </span><a name="local-1628043463"><a href="#local-1628043463"><span class="hs-identifier">lit</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsLit.html#OverLit"><span class="hs-identifier hs-var">OverLit</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ol_val</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628043464"><a href="#local-1628043464"><span class="hs-identifier">val</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ol_rebindable</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628043465"><a href="#local-1628043465"><span class="hs-identifier">rebindable</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628043466"><a href="#local-1628043466"><span class="hs-identifier">res_ty</span></a></a><span>
</span><a name="line-472"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-1628043465"><span class="hs-identifier hs-var">rebindable</span></a><span>
</span><a name="line-473"></a><span>    </span><span class="hs-comment">-- all built-in overloaded lits are tau-types, so we can just</span><span>
</span><a name="line-474"></a><span>    </span><span class="hs-comment">-- tauify the ExpType</span><span>
</span><a name="line-475"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628043468"><a href="#local-1628043468"><span class="hs-identifier">res_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a><span> </span><a href="#local-1628043466"><span class="hs-identifier hs-var">res_ty</span></a><span>
</span><a name="line-476"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628043469"><a href="#local-1628043469"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-477"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TcHsSyn.html#shortCutLit"><span class="hs-identifier hs-var">shortCutLit</span></a><span> </span><a href="#local-1628043469"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1628043464"><span class="hs-identifier hs-var">val</span></a><span> </span><a href="#local-1628043468"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-478"></a><span>        </span><span class="hs-comment">-- Do not generate a LitInst for rebindable syntax.</span><span>
</span><a name="line-479"></a><span>        </span><span class="hs-comment">-- Reason: If we do, tcSimplify will call lookupInst, which</span><span>
</span><a name="line-480"></a><span>        </span><span class="hs-comment">--         will call tcSyntaxName, which does unification,</span><span>
</span><a name="line-481"></a><span>        </span><span class="hs-comment">--         which tcSimplify doesn't like</span><span>
</span><a name="line-482"></a><span>           </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628043470"><a href="#local-1628043470"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628043463"><span class="hs-identifier hs-var">lit</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ol_witness</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628043470"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ol_type</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628043468"><span class="hs-identifier hs-var">res_ty</span></a><span>
</span><a name="line-483"></a><span>                                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ol_rebindable</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-484"></a><span>           </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Inst.html#newNonTrivialOverloadedLit"><span class="hs-identifier hs-var">newNonTrivialOverloadedLit</span></a><span> </span><a href="#local-1628043467"><span class="hs-identifier hs-var">orig</span></a><span> </span><a href="#local-1628043463"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-485"></a><span>                                                   </span><span class="hs-special">(</span><a href="TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a><span> </span><a href="#local-1628043468"><span class="hs-identifier hs-var">res_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-486"></a><span>
</span><a name="line-487"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-488"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Inst.html#newNonTrivialOverloadedLit"><span class="hs-identifier hs-var">newNonTrivialOverloadedLit</span></a><span> </span><a href="#local-1628043467"><span class="hs-identifier hs-var">orig</span></a><span> </span><a href="#local-1628043463"><span class="hs-identifier hs-var">lit</span></a><span> </span><a href="#local-1628043466"><span class="hs-identifier hs-var">res_ty</span></a><span>
</span><a name="line-489"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-490"></a><span>    </span><a name="local-1628043467"><a href="#local-1628043467"><span class="hs-identifier">orig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#LiteralOrigin"><span class="hs-identifier hs-var">LiteralOrigin</span></a><span> </span><a href="#local-1628043463"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-491"></a><span>
</span><a name="line-492"></a><span class="hs-comment">-- Does not handle things that 'shortCutLit' can handle. See also</span><span>
</span><a name="line-493"></a><span class="hs-comment">-- newOverloadedLit in TcUnify</span><span>
</span><a name="line-494"></a><span class="hs-identifier">newNonTrivialOverloadedLit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span>
</span><a name="line-495"></a><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsLit.html#HsOverLit"><span class="hs-identifier hs-type">HsOverLit</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-496"></a><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a><span>
</span><a name="line-497"></a><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="HsLit.html#HsOverLit"><span class="hs-identifier hs-type">HsOverLit</span></a><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">)</span><span>
</span><a name="line-498"></a><a name="newNonTrivialOverloadedLit"><a href="Inst.html#newNonTrivialOverloadedLit"><span class="hs-identifier">newNonTrivialOverloadedLit</span></a></a><span> </span><a name="local-1628043471"><a href="#local-1628043471"><span class="hs-identifier">orig</span></a></a><span>
</span><a name="line-499"></a><span>  </span><a name="local-1628043472"><a href="#local-1628043472"><span class="hs-identifier">lit</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsLit.html#OverLit"><span class="hs-identifier hs-var">OverLit</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ol_val</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628043473"><a href="#local-1628043473"><span class="hs-identifier">val</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ol_witness</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsExpr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628043474"><a href="#local-1628043474"><span class="hs-identifier">meth_name</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-500"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ol_rebindable</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628043475"><a href="#local-1628043475"><span class="hs-identifier">rebindable</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628043476"><a href="#local-1628043476"><span class="hs-identifier">res_ty</span></a></a><span>
</span><a name="line-501"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1628043477"><a href="#local-1628043477"><span class="hs-identifier">hs_lit</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Inst.html#mkOverLit"><span class="hs-identifier hs-var">mkOverLit</span></a><span> </span><a href="#local-1628043473"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-502"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628043478"><a href="#local-1628043478"><span class="hs-identifier">lit_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#hsLitType"><span class="hs-identifier hs-var">hsLitType</span></a><span> </span><a href="#local-1628043477"><span class="hs-identifier hs-var">hs_lit</span></a><span>
</span><a name="line-503"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1628043479"><a href="#local-1628043479"><span class="hs-identifier">fi'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcExpr.html#tcSyntaxOp"><span class="hs-identifier hs-var">tcSyntaxOp</span></a><span> </span><a href="#local-1628043471"><span class="hs-identifier hs-var">orig</span></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#mkRnSyntaxExpr"><span class="hs-identifier hs-var">mkRnSyntaxExpr</span></a><span> </span><a href="#local-1628043474"><span class="hs-identifier hs-var">meth_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-504"></a><span>                                      </span><span class="hs-special">[</span><a href="TcType.html#synKnownType"><span class="hs-identifier hs-var">synKnownType</span></a><span> </span><a href="#local-1628043478"><span class="hs-identifier hs-var">lit_ty</span></a><span class="hs-special">]</span><span> </span><a href="#local-1628043476"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-505"></a><span>                      </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-506"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628043480"><a href="#local-1628043480"><span class="hs-identifier">witness</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsUtils.html#nlHsSyntaxApps"><span class="hs-identifier hs-var">nlHsSyntaxApps</span></a><span> </span><a href="#local-1628043479"><span class="hs-identifier hs-var">fi'</span></a><span> </span><span class="hs-special">[</span><a href="HsUtils.html#nlHsLit"><span class="hs-identifier hs-var">nlHsLit</span></a><span> </span><a href="#local-1628043477"><span class="hs-identifier hs-var">hs_lit</span></a><span class="hs-special">]</span><span>
</span><a name="line-507"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628043481"><a href="#local-1628043481"><span class="hs-identifier">res_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#readExpType"><span class="hs-identifier hs-var">readExpType</span></a><span> </span><a href="#local-1628043476"><span class="hs-identifier hs-var">res_ty</span></a><span>
</span><a name="line-508"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628043472"><span class="hs-identifier hs-var">lit</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ol_witness</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628043480"><span class="hs-identifier hs-var">witness</span></a><span>
</span><a name="line-509"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ol_type</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628043481"><span class="hs-identifier hs-var">res_ty</span></a><span>
</span><a name="line-510"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ol_rebindable</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628043475"><span class="hs-identifier hs-var">rebindable</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-511"></a><span class="hs-identifier">newNonTrivialOverloadedLit</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628043482"><a href="#local-1628043482"><span class="hs-identifier">lit</span></a></a><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-512"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;newNonTrivialOverloadedLit&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628043482"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-513"></a><span>
</span><a name="line-514"></a><span class="hs-comment">------------</span><span>
</span><a name="line-515"></a><span class="hs-identifier">mkOverLit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsLit.html#OverLitVal"><span class="hs-identifier hs-type">OverLitVal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="HsLit.html#HsLit"><span class="hs-identifier hs-type">HsLit</span></a><span>
</span><a name="line-516"></a><a name="mkOverLit"><a href="Inst.html#mkOverLit"><span class="hs-identifier">mkOverLit</span></a></a><span> </span><span class="hs-special">(</span><a href="HsLit.html#HsIntegral"><span class="hs-identifier hs-var">HsIntegral</span></a><span> </span><a name="local-1628043483"><a href="#local-1628043483"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-1628043484"><a href="#local-1628043484"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-517"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1628043485"><a href="#local-1628043485"><span class="hs-identifier">integer_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcMetaTy"><span class="hs-identifier hs-var">tcMetaTy</span></a><span> </span><a href="PrelNames.html#integerTyConName"><span class="hs-identifier hs-var">integerTyConName</span></a><span>
</span><a name="line-518"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsLit.html#HsInteger"><span class="hs-identifier hs-var">HsInteger</span></a><span> </span><a href="#local-1628043483"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-1628043484"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-1628043485"><span class="hs-identifier hs-var">integer_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-519"></a><span>
</span><a name="line-520"></a><span class="hs-identifier">mkOverLit</span><span> </span><span class="hs-special">(</span><a href="HsLit.html#HsFractional"><span class="hs-identifier hs-var">HsFractional</span></a><span> </span><a name="local-1628043486"><a href="#local-1628043486"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-521"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1628043487"><a href="#local-1628043487"><span class="hs-identifier">rat_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcMetaTy"><span class="hs-identifier hs-var">tcMetaTy</span></a><span> </span><a href="PrelNames.html#rationalTyConName"><span class="hs-identifier hs-var">rationalTyConName</span></a><span>
</span><a name="line-522"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsLit.html#HsRat"><span class="hs-identifier hs-var">HsRat</span></a><span> </span><a href="#local-1628043486"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-1628043487"><span class="hs-identifier hs-var">rat_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-523"></a><span>
</span><a name="line-524"></a><span class="hs-identifier">mkOverLit</span><span> </span><span class="hs-special">(</span><a href="HsLit.html#HsIsString"><span class="hs-identifier hs-var">HsIsString</span></a><span> </span><a name="local-1628043488"><a href="#local-1628043488"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-1628043489"><a href="#local-1628043489"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsLit.html#HsString"><span class="hs-identifier hs-var">HsString</span></a><span> </span><a href="#local-1628043488"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-1628043489"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-525"></a><span>
</span><a name="line-526"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Re-mappable syntax

     Used only for arrow syntax -- find a way to nuke this
*                                                                      *
************************************************************************

Suppose we are doing the -XRebindableSyntax thing, and we encounter
a do-expression.  We have to find (&gt;&gt;) in the current environment, which is
done by the rename. Then we have to check that it has the same type as
Control.Monad.(&gt;&gt;).  Or, more precisely, a compatible type. One 'customer' had
this:

  (&gt;&gt;) :: HB m n mn =&gt; m a -&gt; n b -&gt; mn b

So the idea is to generate a local binding for (&gt;&gt;), thus:

        let then72 :: forall a b. m a -&gt; m b -&gt; m b
            then72 = ...something involving the user's (&gt;&gt;)...
        in
        ...the do-expression...

Now the do-expression can proceed using then72, which has exactly
the expected type.

In fact tcSyntaxName just generates the RHS for then72, because we only
want an actual binding in the do-expression case. For literals, we can
just use the expression inline.
-}</span><span>
</span><a name="line-557"></a><span>
</span><a name="line-558"></a><span class="hs-identifier">tcSyntaxName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span>
</span><a name="line-559"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>                  </span><span class="hs-comment">-- Type to instantiate it at</span><span>
</span><a name="line-560"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="HsExpr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- (Standard name, user name)</span><span>
</span><a name="line-561"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="HsExpr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- (Standard name, suitable expression)</span><span>
</span><a name="line-562"></a><span class="hs-comment">-- USED ONLY FOR CmdTop (sigh) ***</span><span>
</span><a name="line-563"></a><span class="hs-comment">-- See Note [CmdSyntaxTable] in HsExpr</span><span>
</span><a name="line-564"></a><span>
</span><a name="line-565"></a><a name="tcSyntaxName"><a href="Inst.html#tcSyntaxName"><span class="hs-identifier">tcSyntaxName</span></a></a><span> </span><a name="local-1628043490"><a href="#local-1628043490"><span class="hs-identifier">orig</span></a></a><span> </span><a name="local-1628043491"><a href="#local-1628043491"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628043492"><a href="#local-1628043492"><span class="hs-identifier">std_nm</span></a></a><span class="hs-special">,</span><span> </span><a href="HsExpr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628043493"><a href="#local-1628043493"><span class="hs-identifier">user_nm</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-566"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628043492"><span class="hs-identifier hs-var">std_nm</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1628043493"><span class="hs-identifier hs-var">user_nm</span></a><span>
</span><a name="line-567"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-1628043494"><a href="#local-1628043494"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Inst.html#newMethodFromName"><span class="hs-identifier hs-var">newMethodFromName</span></a><span> </span><a href="#local-1628043490"><span class="hs-identifier hs-var">orig</span></a><span> </span><a href="#local-1628043492"><span class="hs-identifier hs-var">std_nm</span></a><span> </span><a href="#local-1628043491"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-568"></a><span>       </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628043492"><span class="hs-identifier hs-var">std_nm</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043494"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span>
</span><a name="line-569"></a><span>
</span><a name="line-570"></a><span class="hs-identifier">tcSyntaxName</span><span> </span><a name="local-1628043495"><a href="#local-1628043495"><span class="hs-identifier">orig</span></a></a><span> </span><a name="local-1628043496"><a href="#local-1628043496"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628043497"><a href="#local-1628043497"><span class="hs-identifier">std_nm</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043498"><a href="#local-1628043498"><span class="hs-identifier">user_nm_expr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-571"></a><span>    </span><a name="local-1628043499"><a href="#local-1628043499"><span class="hs-identifier">std_id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a><span> </span><a href="#local-1628043497"><span class="hs-identifier hs-var">std_nm</span></a><span>
</span><a name="line-572"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-573"></a><span>        </span><span class="hs-comment">-- C.f. newMethodAtLoc</span><span>
</span><a name="line-574"></a><span>        </span><span class="hs-special">(</span><span class="hs-special">[</span><a name="local-1628043500"><a href="#local-1628043500"><span class="hs-identifier">tv</span></a></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1628043501"><a href="#local-1628043501"><span class="hs-identifier">tau</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitSigmaTy"><span class="hs-identifier hs-var">tcSplitSigmaTy</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628043499"><span class="hs-identifier hs-var">std_id</span></a><span class="hs-special">)</span><span>
</span><a name="line-575"></a><span>        </span><a name="local-1628043502"><a href="#local-1628043502"><span class="hs-identifier">sigma1</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTyWith"><span class="hs-identifier hs-var">substTyWith</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628043500"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-1628043496"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">]</span><span> </span><a href="#local-1628043501"><span class="hs-identifier hs-var">tau</span></a><span>
</span><a name="line-576"></a><span>        </span><span class="hs-comment">-- Actually, the &quot;tau-type&quot; might be a sigma-type in the</span><span>
</span><a name="line-577"></a><span>        </span><span class="hs-comment">-- case of locally-polymorphic methods.</span><span>
</span><a name="line-578"></a><span>
</span><a name="line-579"></a><span>    </span><a href="TcRnMonad.html#addErrCtxtM"><span class="hs-identifier hs-var">addErrCtxtM</span></a><span> </span><span class="hs-special">(</span><a href="Inst.html#syntaxNameCtxt"><span class="hs-identifier hs-var">syntaxNameCtxt</span></a><span> </span><a href="#local-1628043498"><span class="hs-identifier hs-var">user_nm_expr</span></a><span> </span><a href="#local-1628043495"><span class="hs-identifier hs-var">orig</span></a><span> </span><a href="#local-1628043502"><span class="hs-identifier hs-var">sigma1</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-580"></a><span>
</span><a name="line-581"></a><span>        </span><span class="hs-comment">-- Check that the user-supplied thing has the</span><span>
</span><a name="line-582"></a><span>        </span><span class="hs-comment">-- same type as the standard one.</span><span>
</span><a name="line-583"></a><span>        </span><span class="hs-comment">-- Tiresome jiggling because tcCheckSigma takes a located expression</span><span>
</span><a name="line-584"></a><span>     </span><a name="local-1628043503"><a href="#local-1628043503"><span class="hs-identifier">span</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a><span>
</span><a name="line-585"></a><span>     </span><a name="local-1628043504"><a href="#local-1628043504"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcExpr.html#tcPolyExpr"><span class="hs-identifier hs-var">tcPolyExpr</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628043503"><span class="hs-identifier hs-var">span</span></a><span> </span><a href="#local-1628043498"><span class="hs-identifier hs-var">user_nm_expr</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628043502"><span class="hs-identifier hs-var">sigma1</span></a><span>
</span><a name="line-586"></a><span>     </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628043497"><span class="hs-identifier hs-var">std_nm</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628043504"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-587"></a><span>
</span><a name="line-588"></a><span class="hs-identifier">syntaxNameCtxt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsExpr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span>
</span><a name="line-589"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span class="hs-special">)</span><span>
</span><a name="line-590"></a><a name="syntaxNameCtxt"><a href="Inst.html#syntaxNameCtxt"><span class="hs-identifier">syntaxNameCtxt</span></a></a><span> </span><a name="local-1628043505"><a href="#local-1628043505"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-1628043506"><a href="#local-1628043506"><span class="hs-identifier">orig</span></a></a><span> </span><a name="local-1628043507"><a href="#local-1628043507"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-1628043508"><a href="#local-1628043508"><span class="hs-identifier">tidy_env</span></a></a><span>
</span><a name="line-591"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628043509"><a href="#local-1628043509"><span class="hs-identifier">inst_loc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getCtLocM"><span class="hs-identifier hs-var">getCtLocM</span></a><span> </span><a href="#local-1628043506"><span class="hs-identifier hs-var">orig</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="TcRnTypes.html#TypeLevel"><span class="hs-identifier hs-var">TypeLevel</span></a><span class="hs-special">)</span><span>
</span><a name="line-592"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628043510"><a href="#local-1628043510"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;When checking that&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628043505"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-593"></a><span>                          </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;(needed by a syntactic construct)&quot;</span><span>
</span><a name="line-594"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;has the required type:&quot;</span><span>
</span><a name="line-595"></a><span>                                  </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><a href="#local-1628043508"><span class="hs-identifier hs-var">tidy_env</span></a><span> </span><a href="#local-1628043507"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-596"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#pprCtLoc"><span class="hs-identifier hs-var">pprCtLoc</span></a><span> </span><a href="#local-1628043509"><span class="hs-identifier hs-var">inst_loc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-597"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628043508"><span class="hs-identifier hs-var">tidy_env</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043510"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-598"></a><span>
</span><a name="line-599"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Instances
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-606"></a><span>
</span><a name="line-607"></a><span class="hs-identifier">getOverlapFlag</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="BasicTypes.html#OverlapMode"><span class="hs-identifier hs-type">OverlapMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="BasicTypes.html#OverlapFlag"><span class="hs-identifier hs-type">OverlapFlag</span></a><span>
</span><a name="line-608"></a><span class="hs-comment">-- Construct the OverlapFlag from the global module flags,</span><span>
</span><a name="line-609"></a><span class="hs-comment">-- but if the overlap_mode argument is (Just m),</span><span>
</span><a name="line-610"></a><span class="hs-comment">--     set the OverlapMode to 'm'</span><span>
</span><a name="line-611"></a><a name="getOverlapFlag"><a href="Inst.html#getOverlapFlag"><span class="hs-identifier">getOverlapFlag</span></a></a><span> </span><a name="local-1628043511"><a href="#local-1628043511"><span class="hs-identifier">overlap_mode</span></a></a><span>
</span><a name="line-612"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1628043512"><a href="#local-1628043512"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-613"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628043513"><a href="#local-1628043513"><span class="hs-identifier">overlap_ok</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a><span> </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html#OverlappingInstances"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">OverlappingInstances</span></a><span> </span><a href="#local-1628043512"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-614"></a><span>              </span><a name="local-1628043514"><a href="#local-1628043514"><span class="hs-identifier">incoherent_ok</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a><span> </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html#IncoherentInstances"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">IncoherentInstances</span></a><span>  </span><a href="#local-1628043512"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-615"></a><span>              </span><a name="local-1628043515"><a href="#local-1628043515"><span class="hs-identifier">use</span></a></a><span> </span><a name="local-1628043518"><a href="#local-1628043518"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#OverlapFlag"><span class="hs-identifier hs-var">OverlapFlag</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">isSafeOverlap</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#safeLanguageOn"><span class="hs-identifier hs-var">safeLanguageOn</span></a><span> </span><a href="#local-1628043512"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-616"></a><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">overlapMode</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628043518"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-617"></a><span>              </span><a name="local-1628043516"><a href="#local-1628043516"><span class="hs-identifier">default_oflag</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628043514"><span class="hs-identifier hs-var">incoherent_ok</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628043515"><span class="hs-identifier hs-var">use</span></a><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#Incoherent"><span class="hs-identifier hs-var">Incoherent</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-618"></a><span>                            </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628043513"><span class="hs-identifier hs-var">overlap_ok</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628043515"><span class="hs-identifier hs-var">use</span></a><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#Overlaps"><span class="hs-identifier hs-var">Overlaps</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-619"></a><span>                            </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628043515"><span class="hs-identifier hs-var">use</span></a><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#NoOverlap"><span class="hs-identifier hs-var">NoOverlap</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-620"></a><span>
</span><a name="line-621"></a><span>              </span><a name="local-1628043517"><a href="#local-1628043517"><span class="hs-identifier">final_oflag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#setOverlapModeMaybe"><span class="hs-identifier hs-var">setOverlapModeMaybe</span></a><span> </span><a href="#local-1628043516"><span class="hs-identifier hs-var">default_oflag</span></a><span> </span><a href="#local-1628043511"><span class="hs-identifier hs-var">overlap_mode</span></a><span>
</span><a name="line-622"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628043517"><span class="hs-identifier hs-var">final_oflag</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-623"></a><span>
</span><a name="line-624"></a><span class="hs-identifier">tcGetInsts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span class="hs-special">]</span><span>
</span><a name="line-625"></a><span class="hs-comment">-- Gets the local class instances.</span><span>
</span><a name="line-626"></a><a name="tcGetInsts"><a href="Inst.html#tcGetInsts"><span class="hs-identifier">tcGetInsts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><span class="hs-identifier">tcg_insts</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-627"></a><span>
</span><a name="line-628"></a><span class="hs-identifier">newClsInst</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="BasicTypes.html#OverlapMode"><span class="hs-identifier hs-type">OverlapMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span>
</span><a name="line-629"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span>
</span><a name="line-630"></a><a name="newClsInst"><a href="Inst.html#newClsInst"><span class="hs-identifier">newClsInst</span></a></a><span> </span><a name="local-1628043519"><a href="#local-1628043519"><span class="hs-identifier">overlap_mode</span></a></a><span> </span><a name="local-1628043520"><a href="#local-1628043520"><span class="hs-identifier">dfun_name</span></a></a><span> </span><a name="local-1628043521"><a href="#local-1628043521"><span class="hs-identifier">tvs</span></a></a><span> </span><a name="local-1628043522"><a href="#local-1628043522"><span class="hs-identifier">theta</span></a></a><span> </span><a name="local-1628043523"><a href="#local-1628043523"><span class="hs-identifier">clas</span></a></a><span> </span><a name="local-1628043524"><a href="#local-1628043524"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-631"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628043525"><a href="#local-1628043525"><span class="hs-identifier">subst</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043526"><a href="#local-1628043526"><span class="hs-identifier">tvs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#freshenTyVarBndrs"><span class="hs-identifier hs-var">freshenTyVarBndrs</span></a><span> </span><a href="#local-1628043521"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-632"></a><span>             </span><span class="hs-comment">-- Be sure to freshen those type variables,</span><span>
</span><a name="line-633"></a><span>             </span><span class="hs-comment">-- so they are sure not to appear in any lookup</span><span>
</span><a name="line-634"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628043527"><a href="#local-1628043527"><span class="hs-identifier">tys'</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTys"><span class="hs-identifier hs-var">substTys</span></a><span> </span><a href="#local-1628043525"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1628043524"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-635"></a><span>             </span><a name="local-1628043528"><a href="#local-1628043528"><span class="hs-identifier">theta'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTheta"><span class="hs-identifier hs-var">substTheta</span></a><span> </span><a href="#local-1628043525"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1628043522"><span class="hs-identifier hs-var">theta</span></a><span>
</span><a name="line-636"></a><span>             </span><a name="local-1628043529"><a href="#local-1628043529"><span class="hs-identifier">dfun</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="MkId.html#mkDictFunId"><span class="hs-identifier hs-var">mkDictFunId</span></a><span> </span><a href="#local-1628043520"><span class="hs-identifier hs-var">dfun_name</span></a><span> </span><a href="#local-1628043526"><span class="hs-identifier hs-var">tvs'</span></a><span> </span><a href="#local-1628043528"><span class="hs-identifier hs-var">theta'</span></a><span> </span><a href="#local-1628043523"><span class="hs-identifier hs-var">clas</span></a><span> </span><a href="#local-1628043527"><span class="hs-identifier hs-var">tys'</span></a><span>
</span><a name="line-637"></a><span>             </span><span class="hs-comment">-- Substituting in the DFun type just makes sure that</span><span>
</span><a name="line-638"></a><span>             </span><span class="hs-comment">-- we are using TyVars rather than TcTyVars</span><span>
</span><a name="line-639"></a><span>             </span><span class="hs-comment">-- Not sure if this is really the right place to do so,</span><span>
</span><a name="line-640"></a><span>             </span><span class="hs-comment">-- but it'll do fine</span><span>
</span><a name="line-641"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628043530"><a href="#local-1628043530"><span class="hs-identifier">oflag</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Inst.html#getOverlapFlag"><span class="hs-identifier hs-var">getOverlapFlag</span></a><span> </span><a href="#local-1628043519"><span class="hs-identifier hs-var">overlap_mode</span></a><span>
</span><a name="line-642"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628043531"><a href="#local-1628043531"><span class="hs-identifier">inst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="InstEnv.html#mkLocalInstance"><span class="hs-identifier hs-var">mkLocalInstance</span></a><span> </span><a href="#local-1628043529"><span class="hs-identifier hs-var">dfun</span></a><span> </span><a href="#local-1628043530"><span class="hs-identifier hs-var">oflag</span></a><span> </span><a href="#local-1628043526"><span class="hs-identifier hs-var">tvs'</span></a><span> </span><a href="#local-1628043523"><span class="hs-identifier hs-var">clas</span></a><span> </span><a href="#local-1628043527"><span class="hs-identifier hs-var">tys'</span></a><span>
</span><a name="line-643"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628043532"><a href="#local-1628043532"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-644"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#warnIf"><span class="hs-identifier hs-var">warnIf</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a><span> </span><a href="DynFlags.html#Opt_WarnOrphans"><span class="hs-identifier hs-var">Opt_WarnOrphans</span></a><span class="hs-special">)</span><span>
</span><a name="line-645"></a><span>             </span><span class="hs-special">(</span><a href="CoreSyn.html#isOrphan"><span class="hs-identifier hs-var">isOrphan</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">is_orphan</span><span> </span><a href="#local-1628043531"><span class="hs-identifier hs-var">inst</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="DynFlags.html#wopt"><span class="hs-identifier hs-var">wopt</span></a><span> </span><a href="DynFlags.html#Opt_WarnOrphans"><span class="hs-identifier hs-var">Opt_WarnOrphans</span></a><span> </span><a href="#local-1628043532"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-646"></a><span>             </span><span class="hs-special">(</span><a href="Inst.html#instOrphWarn"><span class="hs-identifier hs-var">instOrphWarn</span></a><span> </span><a href="#local-1628043531"><span class="hs-identifier hs-var">inst</span></a><span class="hs-special">)</span><span>
</span><a name="line-647"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628043531"><span class="hs-identifier hs-var">inst</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-648"></a><span>
</span><a name="line-649"></a><span class="hs-identifier">instOrphWarn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-650"></a><a name="instOrphWarn"><a href="Inst.html#instOrphWarn"><span class="hs-identifier">instOrphWarn</span></a></a><span> </span><a name="local-1628043533"><a href="#local-1628043533"><span class="hs-identifier">inst</span></a></a><span>
</span><a name="line-651"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Orphan instance:&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="InstEnv.html#pprInstanceHdr"><span class="hs-identifier hs-var">pprInstanceHdr</span></a><span> </span><a href="#local-1628043533"><span class="hs-identifier hs-var">inst</span></a><span class="hs-special">)</span><span>
</span><a name="line-652"></a><span>    </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;To avoid this&quot;</span><span>
</span><a name="line-653"></a><span>    </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><a href="#local-1628043534"><span class="hs-identifier hs-var">possibilities</span></a><span class="hs-special">)</span><span>
</span><a name="line-654"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-655"></a><span>    </span><a name="local-1628043534"><a href="#local-1628043534"><span class="hs-identifier">possibilities</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-656"></a><span>      </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;move the instance declaration to the module of the class or of the type, or&quot;</span><span> </span><span class="hs-glyph">:</span><span>
</span><a name="line-657"></a><span>      </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;wrap the type with a newtype and declare the instance on the new type.&quot;</span><span> </span><span class="hs-glyph">:</span><span>
</span><a name="line-658"></a><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-659"></a><span>
</span><a name="line-660"></a><span class="hs-identifier">tcExtendLocalInstEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628043307"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628043307"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-661"></a><span>  </span><span class="hs-comment">-- Add new locally-defined instances</span><span>
</span><a name="line-662"></a><a name="tcExtendLocalInstEnv"><a href="Inst.html#tcExtendLocalInstEnv"><span class="hs-identifier">tcExtendLocalInstEnv</span></a></a><span> </span><a name="local-1628043535"><a href="#local-1628043535"><span class="hs-identifier">dfuns</span></a></a><span> </span><a name="local-1628043536"><a href="#local-1628043536"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-663"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="Inst.html#traceDFuns"><span class="hs-identifier hs-var">traceDFuns</span></a><span> </span><a href="#local-1628043535"><span class="hs-identifier hs-var">dfuns</span></a><span>
</span><a name="line-664"></a><span>      </span><span class="hs-special">;</span><span> </span><a name="local-1628043537"><a href="#local-1628043537"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-665"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628043538"><a href="#local-1628043538"><span class="hs-identifier">inst_env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043539"><a href="#local-1628043539"><span class="hs-identifier">cls_insts'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MonadUtils.html#foldlM"><span class="hs-identifier hs-var">foldlM</span></a><span> </span><a href="Inst.html#addLocalInst"><span class="hs-identifier hs-var">addLocalInst</span></a><span>
</span><a name="line-666"></a><span>                                          </span><span class="hs-special">(</span><span class="hs-identifier">tcg_inst_env</span><span> </span><a href="#local-1628043537"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcg_insts</span><span> </span><a href="#local-1628043537"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-667"></a><span>                                          </span><a href="#local-1628043535"><span class="hs-identifier hs-var">dfuns</span></a><span>
</span><a name="line-668"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628043540"><a href="#local-1628043540"><span class="hs-identifier">env'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628043537"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_insts</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628043539"><span class="hs-identifier hs-var">cls_insts'</span></a><span>
</span><a name="line-669"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcg_inst_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628043538"><span class="hs-identifier hs-var">inst_env'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-670"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#setGblEnv"><span class="hs-identifier hs-var">setGblEnv</span></a><span> </span><a href="#local-1628043540"><span class="hs-identifier hs-var">env'</span></a><span> </span><a href="#local-1628043536"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-671"></a><span>
</span><a name="line-672"></a><span class="hs-identifier">addLocalInst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="InstEnv.html#InstEnv"><span class="hs-identifier hs-type">InstEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="InstEnv.html#InstEnv"><span class="hs-identifier hs-type">InstEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-673"></a><span class="hs-comment">-- Check that the proposed new instance is OK,</span><span>
</span><a name="line-674"></a><span class="hs-comment">-- and then add it to the home inst env</span><span>
</span><a name="line-675"></a><span class="hs-comment">-- If overwrite_inst, then we can overwrite a direct match</span><span>
</span><a name="line-676"></a><a name="addLocalInst"><a href="Inst.html#addLocalInst"><span class="hs-identifier">addLocalInst</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628043541"><a href="#local-1628043541"><span class="hs-identifier">home_ie</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043542"><a href="#local-1628043542"><span class="hs-identifier">my_insts</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628043543"><a href="#local-1628043543"><span class="hs-identifier">ispec</span></a></a><span>
</span><a name="line-677"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-678"></a><span>             </span><span class="hs-comment">-- Load imported instances, so that we report</span><span>
</span><a name="line-679"></a><span>             </span><span class="hs-comment">-- duplicates correctly</span><span>
</span><a name="line-680"></a><span>
</span><a name="line-681"></a><span>             </span><span class="hs-comment">-- 'matches'  are existing instance declarations that are less</span><span>
</span><a name="line-682"></a><span>             </span><span class="hs-comment">--            specific than the new one</span><span>
</span><a name="line-683"></a><span>             </span><span class="hs-comment">-- 'dups'     are those 'matches' that are equal to the new one</span><span>
</span><a name="line-684"></a><span>         </span><span class="hs-special">;</span><span> </span><a name="local-1628043544"><a href="#local-1628043544"><span class="hs-identifier">isGHCi</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getIsGHCi"><span class="hs-identifier hs-var">getIsGHCi</span></a><span>
</span><a name="line-685"></a><span>         </span><span class="hs-special">;</span><span> </span><a name="local-1628043545"><a href="#local-1628043545"><span class="hs-identifier">eps</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getEps"><span class="hs-identifier hs-var">getEps</span></a><span>
</span><a name="line-686"></a><span>         </span><span class="hs-special">;</span><span> </span><a name="local-1628043546"><a href="#local-1628043546"><span class="hs-identifier">tcg_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-687"></a><span>
</span><a name="line-688"></a><span>           </span><span class="hs-comment">-- In GHCi, we *override* any identical instances</span><span>
</span><a name="line-689"></a><span>           </span><span class="hs-comment">-- that are also defined in the interactive context</span><span>
</span><a name="line-690"></a><span>           </span><span class="hs-comment">-- See Note [Override identical instances in GHCi]</span><span>
</span><a name="line-691"></a><span>         </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628043547"><a href="#local-1628043547"><span class="hs-identifier">home_ie'</span></a></a><span>
</span><a name="line-692"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628043544"><span class="hs-identifier hs-var">isGHCi</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="InstEnv.html#deleteFromInstEnv"><span class="hs-identifier hs-var">deleteFromInstEnv</span></a><span> </span><a href="#local-1628043541"><span class="hs-identifier hs-var">home_ie</span></a><span> </span><a href="#local-1628043543"><span class="hs-identifier hs-var">ispec</span></a><span>
</span><a name="line-693"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628043541"><span class="hs-identifier hs-var">home_ie</span></a><span>
</span><a name="line-694"></a><span>
</span><a name="line-695"></a><span>               </span><span class="hs-comment">-- If we're compiling sig-of and there's an external duplicate</span><span>
</span><a name="line-696"></a><span>               </span><span class="hs-comment">-- instance, silently ignore it (that's the instance we're</span><span>
</span><a name="line-697"></a><span>               </span><span class="hs-comment">-- implementing!)  NB: we still count local duplicate instances</span><span>
</span><a name="line-698"></a><span>               </span><span class="hs-comment">-- as errors.</span><span>
</span><a name="line-699"></a><span>               </span><span class="hs-comment">-- See Note [Signature files and type class instances]</span><span>
</span><a name="line-700"></a><span>               </span><a name="local-1628043548"><a href="#local-1628043548"><span class="hs-identifier">global_ie</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcg_sig_of</span><span> </span><a href="#local-1628043546"><span class="hs-identifier hs-var">tcg_env</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="InstEnv.html#emptyInstEnv"><span class="hs-identifier hs-var">emptyInstEnv</span></a><span>
</span><a name="line-701"></a><span>                         </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">eps_inst_env</span><span> </span><a href="#local-1628043545"><span class="hs-identifier hs-var">eps</span></a><span>
</span><a name="line-702"></a><span>               </span><a name="local-1628043549"><a href="#local-1628043549"><span class="hs-identifier">inst_envs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="InstEnv.html#InstEnvs"><span class="hs-identifier hs-var">InstEnvs</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ie_global</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628043548"><span class="hs-identifier hs-var">global_ie</span></a><span>
</span><a name="line-703"></a><span>                                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ie_local</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628043547"><span class="hs-identifier hs-var">home_ie'</span></a><span>
</span><a name="line-704"></a><span>                                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ie_visible</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#tcVisibleOrphanMods"><span class="hs-identifier hs-var">tcVisibleOrphanMods</span></a><span> </span><a href="#local-1628043546"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-705"></a><span>
</span><a name="line-706"></a><span>             </span><span class="hs-comment">-- Check for inconsistent functional dependencies</span><span>
</span><a name="line-707"></a><span>         </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628043550"><a href="#local-1628043550"><span class="hs-identifier">inconsistent_ispecs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FunDeps.html#checkFunDeps"><span class="hs-identifier hs-var">checkFunDeps</span></a><span> </span><a href="#local-1628043549"><span class="hs-identifier hs-var">inst_envs</span></a><span> </span><a href="#local-1628043543"><span class="hs-identifier hs-var">ispec</span></a><span>
</span><a name="line-708"></a><span>         </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628043550"><span class="hs-identifier hs-var">inconsistent_ispecs</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-709"></a><span>           </span><a href="Inst.html#funDepErr"><span class="hs-identifier hs-var">funDepErr</span></a><span> </span><a href="#local-1628043543"><span class="hs-identifier hs-var">ispec</span></a><span> </span><a href="#local-1628043550"><span class="hs-identifier hs-var">inconsistent_ispecs</span></a><span>
</span><a name="line-710"></a><span>
</span><a name="line-711"></a><span>             </span><span class="hs-comment">-- Check for duplicate instance decls.</span><span>
</span><a name="line-712"></a><span>         </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628043551"><a href="#local-1628043551"><span class="hs-identifier">_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043552"><a href="#local-1628043552"><span class="hs-identifier">cls</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628043553"><a href="#local-1628043553"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="InstEnv.html#instanceHead"><span class="hs-identifier hs-var">instanceHead</span></a><span> </span><a href="#local-1628043543"><span class="hs-identifier hs-var">ispec</span></a><span>
</span><a name="line-713"></a><span>               </span><span class="hs-special">(</span><a name="local-1628043554"><a href="#local-1628043554"><span class="hs-identifier">matches</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="InstEnv.html#lookupInstEnv"><span class="hs-identifier hs-var">lookupInstEnv</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-1628043549"><span class="hs-identifier hs-var">inst_envs</span></a><span> </span><a href="#local-1628043552"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-1628043553"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-714"></a><span>               </span><a name="local-1628043555"><a href="#local-1628043555"><span class="hs-identifier">dups</span></a></a><span>             </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><a href="InstEnv.html#identicalClsInstHead"><span class="hs-identifier hs-var">identicalClsInstHead</span></a><span> </span><a href="#local-1628043543"><span class="hs-identifier hs-var">ispec</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="#local-1628043554"><span class="hs-identifier hs-var">matches</span></a><span class="hs-special">)</span><span>
</span><a name="line-715"></a><span>         </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628043555"><span class="hs-identifier hs-var">dups</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-716"></a><span>           </span><a href="Inst.html#dupInstErr"><span class="hs-identifier hs-var">dupInstErr</span></a><span> </span><a href="#local-1628043543"><span class="hs-identifier hs-var">ispec</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a><span> </span><a href="#local-1628043555"><span class="hs-identifier hs-var">dups</span></a><span class="hs-special">)</span><span>
</span><a name="line-717"></a><span>
</span><a name="line-718"></a><span>         </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="InstEnv.html#extendInstEnv"><span class="hs-identifier hs-var">extendInstEnv</span></a><span> </span><a href="#local-1628043547"><span class="hs-identifier hs-var">home_ie'</span></a><span> </span><a href="#local-1628043543"><span class="hs-identifier hs-var">ispec</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043543"><span class="hs-identifier hs-var">ispec</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628043542"><span class="hs-identifier hs-var">my_insts</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-719"></a><span>
</span><a name="line-720"></a><span class="hs-comment">{-
Note [Signature files and type class instances]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Instances in signature files do not have an effect when compiling:
when you compile a signature against an implementation, you will
see the instances WHETHER OR NOT the instance is declared in
the file (this is because the signatures go in the EPS and we
can't filter them out easily.)  This is also why we cannot
place the instance in the hi file: it would show up as a duplicate,
and we don't have instance reexports anyway.

However, you might find them useful when typechecking against
a signature: the instance is a way of indicating to GHC that
some instance exists, in case downstream code uses it.

Implementing this is a little tricky.  Consider the following
situation (sigof03):

 module A where
     instance C T where ...

 module ASig where
     instance C T

When compiling ASig, A.hi is loaded, which brings its instances
into the EPS.  When we process the instance declaration in ASig,
we should ignore it for the purpose of doing a duplicate check,
since it's not actually a duplicate. But don't skip the check
entirely, we still want this to fail (tcfail221):

 module ASig where
     instance C T
     instance C T

Note that in some situations, the interface containing the type
class instances may not have been loaded yet at all.  The usual
situation when A imports another module which provides the
instances (sigof02m):

 module A(module B) where
     import B

See also Note [Signature lazy interface loading].  We can't
rely on this, however, since sometimes we'll have spurious
type class instances in the EPS, see #9422 (sigof02dm)

************************************************************************
*                                                                      *
        Errors and tracing
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-772"></a><span>
</span><a name="line-773"></a><span class="hs-identifier">traceDFuns</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-774"></a><a name="traceDFuns"><a href="Inst.html#traceDFuns"><span class="hs-identifier">traceDFuns</span></a></a><span> </span><a name="local-1628043556"><a href="#local-1628043556"><span class="hs-identifier">ispecs</span></a></a><span>
</span><a name="line-775"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Adding instances:&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1628043557"><span class="hs-identifier hs-var">pp</span></a><span> </span><a href="#local-1628043556"><span class="hs-identifier hs-var">ispecs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-776"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-777"></a><span>    </span><a name="local-1628043557"><a href="#local-1628043557"><span class="hs-identifier">pp</span></a></a><span> </span><a name="local-1628043558"><a href="#local-1628043558"><span class="hs-identifier">ispec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="InstEnv.html#instanceDFunId"><span class="hs-identifier hs-var">instanceDFunId</span></a><span> </span><a href="#local-1628043558"><span class="hs-identifier hs-var">ispec</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a><span class="hs-special">)</span><span>
</span><a name="line-778"></a><span>                  </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628043558"><span class="hs-identifier hs-var">ispec</span></a><span class="hs-special">)</span><span>
</span><a name="line-779"></a><span>        </span><span class="hs-comment">-- Print the dfun name itself too</span><span>
</span><a name="line-780"></a><span>
</span><a name="line-781"></a><span class="hs-identifier">funDepErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-782"></a><a name="funDepErr"><a href="Inst.html#funDepErr"><span class="hs-identifier">funDepErr</span></a></a><span> </span><a name="local-1628043559"><a href="#local-1628043559"><span class="hs-identifier">ispec</span></a></a><span> </span><a name="local-1628043560"><a href="#local-1628043560"><span class="hs-identifier">ispecs</span></a></a><span>
</span><a name="line-783"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Inst.html#addClsInstsErr"><span class="hs-identifier hs-var">addClsInstsErr</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Functional dependencies conflict between instance declarations:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-784"></a><span>                    </span><span class="hs-special">(</span><a href="#local-1628043559"><span class="hs-identifier hs-var">ispec</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628043560"><span class="hs-identifier hs-var">ispecs</span></a><span class="hs-special">)</span><span>
</span><a name="line-785"></a><span>
</span><a name="line-786"></a><span class="hs-identifier">dupInstErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-787"></a><a name="dupInstErr"><a href="Inst.html#dupInstErr"><span class="hs-identifier">dupInstErr</span></a></a><span> </span><a name="local-1628043561"><a href="#local-1628043561"><span class="hs-identifier">ispec</span></a></a><span> </span><a name="local-1628043562"><a href="#local-1628043562"><span class="hs-identifier">dup_ispec</span></a></a><span>
</span><a name="line-788"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Inst.html#addClsInstsErr"><span class="hs-identifier hs-var">addClsInstsErr</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Duplicate instance declarations:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-789"></a><span>                    </span><span class="hs-special">[</span><a href="#local-1628043561"><span class="hs-identifier hs-var">ispec</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628043562"><span class="hs-identifier hs-var">dup_ispec</span></a><span class="hs-special">]</span><span>
</span><a name="line-790"></a><span>
</span><a name="line-791"></a><span class="hs-identifier">addClsInstsErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-792"></a><a name="addClsInstsErr"><a href="Inst.html#addClsInstsErr"><span class="hs-identifier">addClsInstsErr</span></a></a><span> </span><a name="local-1628043563"><a href="#local-1628043563"><span class="hs-identifier">herald</span></a></a><span> </span><a name="local-1628043564"><a href="#local-1628043564"><span class="hs-identifier">ispecs</span></a></a><span>
</span><a name="line-793"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#getSrcSpan"><span class="hs-identifier hs-var">getSrcSpan</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a><span> </span><a href="#local-1628043565"><span class="hs-identifier hs-var">sorted</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-794"></a><span>    </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><a href="#local-1628043563"><span class="hs-identifier hs-var">herald</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="InstEnv.html#pprInstances"><span class="hs-identifier hs-var">pprInstances</span></a><span> </span><a href="#local-1628043565"><span class="hs-identifier hs-var">sorted</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-795"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-796"></a><span>   </span><a name="local-1628043565"><a href="#local-1628043565"><span class="hs-identifier">sorted</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Exts.html#sortWith"><span class="hs-identifier hs-var">sortWith</span></a><span> </span><a href="Name.html#getSrcLoc"><span class="hs-identifier hs-var">getSrcLoc</span></a><span> </span><a href="#local-1628043564"><span class="hs-identifier hs-var">ispecs</span></a><span>
</span><a name="line-797"></a><span>   </span><span class="hs-comment">-- The sortWith just arranges that instances are dislayed in order</span><span>
</span><a name="line-798"></a><span>   </span><span class="hs-comment">-- of source location, which reduced wobbling in error messages,</span><span>
</span><a name="line-799"></a><span>   </span><span class="hs-comment">-- and is better for users</span><span>
</span><a name="line-800"></a></pre></body></html>