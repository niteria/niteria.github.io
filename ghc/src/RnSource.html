<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

\section[RnSource]{Main pass of renamer}
-}</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE CPP, ScopedTypeVariables #-}</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">RnSource</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-10"></a><span>        </span><a href="RnSource.html#rnSrcDecls"><span class="hs-identifier hs-var">rnSrcDecls</span></a><span class="hs-special">,</span><span> </span><a href="RnSource.html#addTcgDUs"><span class="hs-identifier hs-var">addTcgDUs</span></a><span class="hs-special">,</span><span> </span><a href="RnSource.html#findSplice"><span class="hs-identifier hs-var">findSplice</span></a><span>
</span><a name="line-11"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE #-}</span><span> </span><a href="RnExpr.html"><span class="hs-identifier">RnExpr</span></a><span class="hs-special">(</span><span> </span><a href="RnExpr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE #-}</span><span> </span><a href="RnSplice.html"><span class="hs-identifier">RnSplice</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="RnSplice.html#rnSpliceDecl"><span class="hs-identifier hs-var">rnSpliceDecl</span></a><span class="hs-special">,</span><span> </span><a href="RnSplice.html#rnTopSpliceDecls"><span class="hs-identifier hs-var">rnTopSpliceDecls</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><a href="HsSyn.html"><span class="hs-identifier">HsSyn</span></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><a href="FieldLabel.html"><span class="hs-identifier">FieldLabel</span></a><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><a href="RdrName.html"><span class="hs-identifier">RdrName</span></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><a href="RnTypes.html"><span class="hs-identifier">RnTypes</span></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><a href="RnBinds.html"><span class="hs-identifier">RnBinds</span></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><a href="RnEnv.html"><span class="hs-identifier">RnEnv</span></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><a href="RnNames.html"><span class="hs-identifier">RnNames</span></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><a href="RnHsDoc.html"><span class="hs-identifier">RnHsDoc</span></a><span>          </span><span class="hs-special">(</span><span> </span><a href="RnHsDoc.html#rnHsDoc"><span class="hs-identifier hs-var">rnHsDoc</span></a><span class="hs-special">,</span><span> </span><a href="RnHsDoc.html#rnMbLHsDoc"><span class="hs-identifier hs-var">rnMbLHsDoc</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><a href="TcAnnotations.html"><span class="hs-identifier">TcAnnotations</span></a><span>    </span><span class="hs-special">(</span><span> </span><a href="TcAnnotations.html#annCtxt"><span class="hs-identifier hs-var">annCtxt</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnMonad.html"><span class="hs-identifier">TcRnMonad</span></a><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><a href="ForeignCall.html"><span class="hs-identifier">ForeignCall</span></a><span>      </span><span class="hs-special">(</span><span> </span><a href="ForeignCall.html#CCallTarget"><span class="hs-identifier hs-type">CCallTarget</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><a href="Module.html"><span class="hs-identifier">Module</span></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><a href="HscTypes.html"><span class="hs-identifier">HscTypes</span></a><span>         </span><span class="hs-special">(</span><span> </span><a href="HscTypes.html#Warnings"><span class="hs-identifier hs-type">Warnings</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#plusWarns"><span class="hs-identifier hs-var">plusWarns</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><a href="Class.html"><span class="hs-identifier">Class</span></a><span>            </span><span class="hs-special">(</span><span> </span><a href="Class.html#FunDep"><span class="hs-identifier hs-type">FunDep</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><a href="PrelNames.html"><span class="hs-identifier">PrelNames</span></a><span>        </span><span class="hs-special">(</span><span> </span><a href="PrelNames.html#applicativeClassName"><span class="hs-identifier hs-var">applicativeClassName</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#pureAName"><span class="hs-identifier hs-var">pureAName</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#thenAName"><span class="hs-identifier hs-var">thenAName</span></a><span>
</span><a name="line-34"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="PrelNames.html#monadClassName"><span class="hs-identifier hs-var">monadClassName</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#returnMName"><span class="hs-identifier hs-var">returnMName</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#thenMName"><span class="hs-identifier hs-var">thenMName</span></a><span>
</span><a name="line-35"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="PrelNames.html#monadFailClassName"><span class="hs-identifier hs-var">monadFailClassName</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#failMName"><span class="hs-identifier hs-var">failMName</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#failMName_preMFP"><span class="hs-identifier hs-var">failMName_preMFP</span></a><span>
</span><a name="line-36"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="PrelNames.html#semigroupClassName"><span class="hs-identifier hs-var">semigroupClassName</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#sappendName"><span class="hs-identifier hs-var">sappendName</span></a><span>
</span><a name="line-37"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="PrelNames.html#monoidClassName"><span class="hs-identifier hs-var">monoidClassName</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#mappendName"><span class="hs-identifier hs-var">mappendName</span></a><span>
</span><a name="line-38"></a><span>                        </span><span class="hs-special">)</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><a href="NameSet.html"><span class="hs-identifier">NameSet</span></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><a href="NameEnv.html"><span class="hs-identifier">NameEnv</span></a><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><a href="Avail.html"><span class="hs-identifier">Avail</span></a><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><a href="Bag.html"><span class="hs-identifier">Bag</span></a><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span>       </span><span class="hs-special">(</span><span> </span><a href="BasicTypes.html#RuleName"><span class="hs-identifier hs-type">RuleName</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#pprRuleName"><span class="hs-identifier hs-var">pprRuleName</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><a href="HscTypes.html"><span class="hs-identifier">HscTypes</span></a><span>         </span><span class="hs-special">(</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><a href="ListSetOps.html"><span class="hs-identifier">ListSetOps</span></a><span>       </span><span class="hs-special">(</span><span> </span><a href="ListSetOps.html#findDupsEq"><span class="hs-identifier hs-var">findDupsEq</span></a><span class="hs-special">,</span><span> </span><a href="ListSetOps.html#removeDups"><span class="hs-identifier hs-var">removeDups</span></a><span class="hs-special">,</span><span> </span><a href="ListSetOps.html#equivClasses"><span class="hs-identifier hs-var">equivClasses</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><a href="Digraph.html"><span class="hs-identifier">Digraph</span></a><span>          </span><span class="hs-special">(</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a><span class="hs-special">,</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Graph.html#flattenSCC"><span class="hs-identifier hs-var">flattenSCC</span></a><span class="hs-special">,</span><span> </span><a href="Digraph.html#stronglyConnCompFromEdgedVertices"><span class="hs-identifier hs-var">stronglyConnCompFromEdgedVertices</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">LanguageExtensions</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LangExt</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span></a><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Arrow.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Arrow</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Arrow.html#first"><span class="hs-identifier hs-var">first</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.List.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><a href="Maybes.html"><span class="hs-identifier">Maybes</span></a><span class="hs-special">(</span><span> </span><a href="Maybes.html#orElse"><span class="hs-identifier hs-var">orElse</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Set.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Set</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Set</span><span> </span><span class="hs-special">(</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Base.html#difference"><span class="hs-identifier hs-var">difference</span></a><span class="hs-special">,</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Base.html#fromList"><span class="hs-identifier hs-var">fromList</span></a><span class="hs-special">,</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Base.html#toList"><span class="hs-identifier hs-var">toList</span></a><span class="hs-special">,</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Base.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span class="hs-comment">{-
@rnSourceDecl@ `renames' declarations.
It simultaneously performs dependency analysis and precedence parsing.
It also does the following error checks:
\begin{enumerate}
\item
Checks that tyvars are used properly. This includes checking
for undefined tyvars, and tyvars in contexts that are ambiguous.
(Some of this checking has now been moved to module @TcMonoType@,
since we don't have functional dependency information at this point.)
\item
Checks that all variable occurrences are defined.
\item
Checks the @(..)@ etc constraints in the export list.
\end{enumerate}
-}</span><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span class="hs-comment">-- Brings the binders of the group into scope in the appropriate places;</span><span>
</span><a name="line-78"></a><span class="hs-comment">-- does NOT assume that anything is in scope already</span><span>
</span><a name="line-79"></a><span class="hs-identifier">rnSrcDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span class="hs-special">,</span><span> </span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span class="hs-comment">-- Rename a top-level HsGroup; used for normal source files *and* hs-boot files</span><span>
</span><a name="line-81"></a><a name="rnSrcDecls"><a href="RnSource.html#rnSrcDecls"><span class="hs-identifier">rnSrcDecls</span></a></a><span> </span><a name="local-1628204248"><a href="#local-1628204248"><span class="hs-identifier">group</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_valds</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204249"><a href="#local-1628204249"><span class="hs-identifier">val_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-82"></a><span>                            </span><span class="hs-identifier">hs_splcds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204250"><a href="#local-1628204250"><span class="hs-identifier">splice_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-83"></a><span>                            </span><span class="hs-identifier">hs_tyclds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204251"><a href="#local-1628204251"><span class="hs-identifier">tycl_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-84"></a><span>                            </span><span class="hs-identifier">hs_instds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204252"><a href="#local-1628204252"><span class="hs-identifier">inst_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-85"></a><span>                            </span><span class="hs-identifier">hs_derivds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204253"><a href="#local-1628204253"><span class="hs-identifier">deriv_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-86"></a><span>                            </span><span class="hs-identifier">hs_fixds</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204254"><a href="#local-1628204254"><span class="hs-identifier">fix_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-87"></a><span>                            </span><span class="hs-identifier">hs_warnds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204255"><a href="#local-1628204255"><span class="hs-identifier">warn_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-88"></a><span>                            </span><span class="hs-identifier">hs_annds</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204256"><a href="#local-1628204256"><span class="hs-identifier">ann_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-89"></a><span>                            </span><span class="hs-identifier">hs_fords</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204257"><a href="#local-1628204257"><span class="hs-identifier">foreign_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-90"></a><span>                            </span><span class="hs-identifier">hs_defds</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204258"><a href="#local-1628204258"><span class="hs-identifier">default_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-91"></a><span>                            </span><span class="hs-identifier">hs_ruleds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204259"><a href="#local-1628204259"><span class="hs-identifier">rule_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-92"></a><span>                            </span><span class="hs-identifier">hs_vects</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204260"><a href="#local-1628204260"><span class="hs-identifier">vect_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-93"></a><span>                            </span><span class="hs-identifier">hs_docs</span><span>    </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204261"><a href="#local-1628204261"><span class="hs-identifier">docs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-95"></a><span>   </span><span class="hs-comment">-- (A) Process the fixity declarations, creating a mapping from</span><span>
</span><a name="line-96"></a><span>   </span><span class="hs-comment">--     FastStrings to FixItems.</span><span>
</span><a name="line-97"></a><span>   </span><span class="hs-comment">--     Also checks for duplicates.</span><span>
</span><a name="line-98"></a><span>   </span><a name="local-1628204262"><a href="#local-1628204262"><span class="hs-identifier">local_fix_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnBinds.html#makeMiniFixityEnv"><span class="hs-identifier hs-var">makeMiniFixityEnv</span></a><span> </span><a href="#local-1628204254"><span class="hs-identifier hs-var">fix_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-99"></a><span>
</span><a name="line-100"></a><span>   </span><span class="hs-comment">-- (B) Bring top level binders (and their fixities) into scope,</span><span>
</span><a name="line-101"></a><span>   </span><span class="hs-comment">--     *except* for the value bindings, which get done in step (D)</span><span>
</span><a name="line-102"></a><span>   </span><span class="hs-comment">--     with collectHsIdBinders. However *do* include</span><span>
</span><a name="line-103"></a><span>   </span><span class="hs-comment">--</span><span>
</span><a name="line-104"></a><span>   </span><span class="hs-comment">--        * Class ops, data constructors, and record fields,</span><span>
</span><a name="line-105"></a><span>   </span><span class="hs-comment">--          because they do not have value declarations.</span><span>
</span><a name="line-106"></a><span>   </span><span class="hs-comment">--          Aso step (C) depends on datacons and record fields</span><span>
</span><a name="line-107"></a><span>   </span><span class="hs-comment">--</span><span>
</span><a name="line-108"></a><span>   </span><span class="hs-comment">--        * For hs-boot files, include the value signatures</span><span>
</span><a name="line-109"></a><span>   </span><span class="hs-comment">--          Again, they have no value declarations</span><span>
</span><a name="line-110"></a><span>   </span><span class="hs-comment">--</span><span>
</span><a name="line-111"></a><span>   </span><span class="hs-special">(</span><a name="local-1628204263"><a href="#local-1628204263"><span class="hs-identifier">tc_envs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204264"><a href="#local-1628204264"><span class="hs-identifier">tc_bndrs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnNames.html#getLocalNonValBinders"><span class="hs-identifier hs-var">getLocalNonValBinders</span></a><span> </span><a href="#local-1628204262"><span class="hs-identifier hs-var">local_fix_env</span></a><span> </span><a href="#local-1628204248"><span class="hs-identifier hs-var">group</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-112"></a><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span>   </span><a href="TcRnMonad.html#setEnvs"><span class="hs-identifier hs-var">setEnvs</span></a><span> </span><a href="#local-1628204263"><span class="hs-identifier hs-var">tc_envs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span>   </span><a href="TcRnMonad.html#failIfErrsM"><span class="hs-identifier hs-var">failIfErrsM</span></a><span> </span><span class="hs-special">;</span><span> </span><span class="hs-comment">-- No point in continuing if (say) we have duplicate declarations</span><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span>   </span><span class="hs-comment">-- (D1) Bring pattern synonyms into scope.</span><span>
</span><a name="line-119"></a><span>   </span><span class="hs-comment">--      Need to do this before (D2) because rnTopBindsLHS</span><span>
</span><a name="line-120"></a><span>   </span><span class="hs-comment">--      looks up those pattern synonyms (Trac #9889)</span><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span>   </span><a href="RnSource.html#extendPatSynEnv"><span class="hs-identifier hs-var">extendPatSynEnv</span></a><span> </span><a href="#local-1628204249"><span class="hs-identifier hs-var">val_decls</span></a><span> </span><a href="#local-1628204262"><span class="hs-identifier hs-var">local_fix_env</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1628204265"><a href="#local-1628204265"><span class="hs-identifier">pat_syn_bndrs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span>   </span><span class="hs-comment">-- (D2) Rename the left-hand sides of the value bindings.</span><span>
</span><a name="line-125"></a><span>   </span><span class="hs-comment">--     This depends on everything from (B) being in scope,</span><span>
</span><a name="line-126"></a><span>   </span><span class="hs-comment">--     and on (C) for resolving record wild cards.</span><span>
</span><a name="line-127"></a><span>   </span><span class="hs-comment">--     It uses the fixity env from (A) to bind fixities for view patterns.</span><span>
</span><a name="line-128"></a><span>   </span><a name="local-1628204266"><a href="#local-1628204266"><span class="hs-identifier">new_lhs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnBinds.html#rnTopBindsLHS"><span class="hs-identifier hs-var">rnTopBindsLHS</span></a><span> </span><a href="#local-1628204262"><span class="hs-identifier hs-var">local_fix_env</span></a><span> </span><a href="#local-1628204249"><span class="hs-identifier hs-var">val_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-129"></a><span>
</span><a name="line-130"></a><span>   </span><span class="hs-comment">-- Bind the LHSes (and their fixities) in the global rdr environment</span><span>
</span><a name="line-131"></a><span>   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204267"><a href="#local-1628204267"><span class="hs-identifier">id_bndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsUtils.html#collectHsIdBinders"><span class="hs-identifier hs-var">collectHsIdBinders</span></a><span> </span><a href="#local-1628204266"><span class="hs-identifier hs-var">new_lhs</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>  </span><span class="hs-comment">-- Excludes pattern-synonym binders</span><span>
</span><a name="line-132"></a><span>                                                    </span><span class="hs-comment">-- They are already in scope</span><span>
</span><a name="line-133"></a><span>   </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;rnSrcDecls&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204267"><span class="hs-identifier hs-var">id_bndrs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-134"></a><span>   </span><a name="local-1628204268"><a href="#local-1628204268"><span class="hs-identifier">tc_envs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnNames.html#extendGlobalRdrEnvRn"><span class="hs-identifier hs-var">extendGlobalRdrEnvRn</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Avail.html#avail"><span class="hs-identifier hs-var">avail</span></a><span> </span><a href="#local-1628204267"><span class="hs-identifier hs-var">id_bndrs</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204262"><span class="hs-identifier hs-var">local_fix_env</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-135"></a><span>   </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;D2&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcg_rdr_env</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="#local-1628204268"><span class="hs-identifier hs-var">tc_envs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">;</span><span>
</span><a name="line-136"></a><span>   </span><a href="TcRnMonad.html#setEnvs"><span class="hs-identifier hs-var">setEnvs</span></a><span> </span><a href="#local-1628204268"><span class="hs-identifier hs-var">tc_envs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span>   </span><span class="hs-comment">--  Now everything is in scope, as the remaining renaming assumes.</span><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span>   </span><span class="hs-comment">-- (E) Rename type and class decls</span><span>
</span><a name="line-141"></a><span>   </span><span class="hs-comment">--     (note that value LHSes need to be in scope for default methods)</span><span>
</span><a name="line-142"></a><span>   </span><span class="hs-comment">--</span><span>
</span><a name="line-143"></a><span>   </span><span class="hs-comment">-- You might think that we could build proper def/use information</span><span>
</span><a name="line-144"></a><span>   </span><span class="hs-comment">-- for type and class declarations, but they can be involved</span><span>
</span><a name="line-145"></a><span>   </span><span class="hs-comment">-- in mutual recursion across modules, and we only do the SCC</span><span>
</span><a name="line-146"></a><span>   </span><span class="hs-comment">-- analysis for them in the type checker.</span><span>
</span><a name="line-147"></a><span>   </span><span class="hs-comment">-- So we content ourselves with gathering uses only; that</span><span>
</span><a name="line-148"></a><span>   </span><span class="hs-comment">-- means we'll only report a declaration as unused if it isn't</span><span>
</span><a name="line-149"></a><span>   </span><span class="hs-comment">-- mentioned at all.  Ah well.</span><span>
</span><a name="line-150"></a><span>   </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Start rnTyClDecls&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-151"></a><span>   </span><span class="hs-special">(</span><a name="local-1628204269"><a href="#local-1628204269"><span class="hs-identifier">rn_tycl_decls</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204270"><a href="#local-1628204270"><span class="hs-identifier">src_fvs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnTyClDecls"><span class="hs-identifier hs-var">rnTyClDecls</span></a><span> </span><a href="#local-1628204251"><span class="hs-identifier hs-var">tycl_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-152"></a><span>
</span><a name="line-153"></a><span>   </span><span class="hs-comment">-- (F) Rename Value declarations right-hand sides</span><span>
</span><a name="line-154"></a><span>   </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Start rnmono&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-155"></a><span>   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204271"><a href="#local-1628204271"><span class="hs-identifier">val_bndr_set</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a><span> </span><a href="#local-1628204267"><span class="hs-identifier hs-var">id_bndrs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#unionNameSet"><span class="hs-identifier hs-var">unionNameSet</span></a><span class="hs-special">`</span><span> </span><a href="NameSet.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a><span> </span><a href="#local-1628204265"><span class="hs-identifier hs-var">pat_syn_bndrs</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-156"></a><span>   </span><a name="local-1628204272"><a href="#local-1628204272"><span class="hs-identifier">is_boot</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#tcIsHsBootOrSig"><span class="hs-identifier hs-var">tcIsHsBootOrSig</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-157"></a><span>   </span><span class="hs-special">(</span><a name="local-1628204273"><a href="#local-1628204273"><span class="hs-identifier">rn_val_decls</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204274"><a href="#local-1628204274"><span class="hs-identifier">bind_dus</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1628204272"><span class="hs-identifier hs-var">is_boot</span></a><span>
</span><a name="line-158"></a><span>    </span><span class="hs-comment">-- For an hs-boot, use tc_bndrs (which collects how we're renamed</span><span>
</span><a name="line-159"></a><span>    </span><span class="hs-comment">-- signatures), since val_bndr_set is empty (there are no x = ...</span><span>
</span><a name="line-160"></a><span>    </span><span class="hs-comment">-- bindings in an hs-boot.)</span><span>
</span><a name="line-161"></a><span>    </span><span class="hs-keyword">then</span><span> </span><a href="RnBinds.html#rnTopBindsBoot"><span class="hs-identifier hs-var">rnTopBindsBoot</span></a><span> </span><a href="#local-1628204264"><span class="hs-identifier hs-var">tc_bndrs</span></a><span> </span><a href="#local-1628204266"><span class="hs-identifier hs-var">new_lhs</span></a><span>
</span><a name="line-162"></a><span>    </span><span class="hs-keyword">else</span><span> </span><a href="RnBinds.html#rnValBindsRHS"><span class="hs-identifier hs-var">rnValBindsRHS</span></a><span> </span><span class="hs-special">(</span><a href="RnEnv.html#TopSigCtxt"><span class="hs-identifier hs-var">TopSigCtxt</span></a><span> </span><a href="#local-1628204271"><span class="hs-identifier hs-var">val_bndr_set</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204266"><span class="hs-identifier hs-var">new_lhs</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-163"></a><span>   </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;finish rnmono&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204273"><span class="hs-identifier hs-var">rn_val_decls</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span>   </span><span class="hs-comment">-- (G) Rename Fixity and deprecations</span><span>
</span><a name="line-166"></a><span>
</span><a name="line-167"></a><span>   </span><span class="hs-comment">-- Rename fixity declarations and error if we try to</span><span>
</span><a name="line-168"></a><span>   </span><span class="hs-comment">-- fix something from another module (duplicates were checked in (A))</span><span>
</span><a name="line-169"></a><span>   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204275"><a href="#local-1628204275"><span class="hs-identifier">all_bndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204264"><span class="hs-identifier hs-var">tc_bndrs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#unionNameSet"><span class="hs-identifier hs-var">unionNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204271"><span class="hs-identifier hs-var">val_bndr_set</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-170"></a><span>   </span><a name="local-1628204276"><a href="#local-1628204276"><span class="hs-identifier">rn_fix_decls</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnSrcFixityDecls"><span class="hs-identifier hs-var">rnSrcFixityDecls</span></a><span> </span><a href="#local-1628204275"><span class="hs-identifier hs-var">all_bndrs</span></a><span> </span><a href="#local-1628204254"><span class="hs-identifier hs-var">fix_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span>   </span><span class="hs-comment">-- Rename deprec decls;</span><span>
</span><a name="line-173"></a><span>   </span><span class="hs-comment">-- check for duplicates and ensure that deprecated things are defined locally</span><span>
</span><a name="line-174"></a><span>   </span><span class="hs-comment">-- at the moment, we don't keep these around past renaming</span><span>
</span><a name="line-175"></a><span>   </span><a name="local-1628204277"><a href="#local-1628204277"><span class="hs-identifier">rn_warns</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnSrcWarnDecls"><span class="hs-identifier hs-var">rnSrcWarnDecls</span></a><span> </span><a href="#local-1628204275"><span class="hs-identifier hs-var">all_bndrs</span></a><span> </span><a href="#local-1628204255"><span class="hs-identifier hs-var">warn_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span>   </span><span class="hs-comment">-- (H) Rename Everything else</span><span>
</span><a name="line-178"></a><span>
</span><a name="line-179"></a><span>   </span><span class="hs-special">(</span><a name="local-1628204278"><a href="#local-1628204278"><span class="hs-identifier">rn_inst_decls</span></a></a><span class="hs-special">,</span><span>    </span><a name="local-1628204279"><a href="#local-1628204279"><span class="hs-identifier">src_fvs2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><a href="RnSource.html#rnSrcInstDecl"><span class="hs-identifier hs-var">rnSrcInstDecl</span></a><span>   </span><a href="#local-1628204252"><span class="hs-identifier hs-var">inst_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-180"></a><span>   </span><span class="hs-special">(</span><a name="local-1628204280"><a href="#local-1628204280"><span class="hs-identifier">rn_rule_decls</span></a></a><span class="hs-special">,</span><span>    </span><a name="local-1628204281"><a href="#local-1628204281"><span class="hs-identifier">src_fvs3</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#setXOptM"><span class="hs-identifier hs-var">setXOptM</span></a><span> </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html#ScopedTypeVariables"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">ScopedTypeVariables</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-181"></a><span>                                   </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><a href="RnSource.html#rnHsRuleDecls"><span class="hs-identifier hs-var">rnHsRuleDecls</span></a><span> </span><a href="#local-1628204259"><span class="hs-identifier hs-var">rule_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-182"></a><span>                           </span><span class="hs-comment">-- Inside RULES, scoped type variables are on</span><span>
</span><a name="line-183"></a><span>   </span><span class="hs-special">(</span><a name="local-1628204282"><a href="#local-1628204282"><span class="hs-identifier">rn_vect_decls</span></a></a><span class="hs-special">,</span><span>    </span><a name="local-1628204283"><a href="#local-1628204283"><span class="hs-identifier">src_fvs4</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><a href="RnSource.html#rnHsVectDecl"><span class="hs-identifier hs-var">rnHsVectDecl</span></a><span>    </span><a href="#local-1628204260"><span class="hs-identifier hs-var">vect_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-184"></a><span>   </span><span class="hs-special">(</span><a name="local-1628204284"><a href="#local-1628204284"><span class="hs-identifier">rn_foreign_decls</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204285"><a href="#local-1628204285"><span class="hs-identifier">src_fvs5</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><a href="RnSource.html#rnHsForeignDecl"><span class="hs-identifier hs-var">rnHsForeignDecl</span></a><span> </span><a href="#local-1628204257"><span class="hs-identifier hs-var">foreign_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-185"></a><span>   </span><span class="hs-special">(</span><a name="local-1628204286"><a href="#local-1628204286"><span class="hs-identifier">rn_ann_decls</span></a></a><span class="hs-special">,</span><span>     </span><a name="local-1628204287"><a href="#local-1628204287"><span class="hs-identifier">src_fvs6</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><a href="RnSource.html#rnAnnDecl"><span class="hs-identifier hs-var">rnAnnDecl</span></a><span>       </span><a href="#local-1628204256"><span class="hs-identifier hs-var">ann_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-186"></a><span>   </span><span class="hs-special">(</span><a name="local-1628204288"><a href="#local-1628204288"><span class="hs-identifier">rn_default_decls</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204289"><a href="#local-1628204289"><span class="hs-identifier">src_fvs7</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><a href="RnSource.html#rnDefaultDecl"><span class="hs-identifier hs-var">rnDefaultDecl</span></a><span>   </span><a href="#local-1628204258"><span class="hs-identifier hs-var">default_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-187"></a><span>   </span><span class="hs-special">(</span><a name="local-1628204290"><a href="#local-1628204290"><span class="hs-identifier">rn_deriv_decls</span></a></a><span class="hs-special">,</span><span>   </span><a name="local-1628204291"><a href="#local-1628204291"><span class="hs-identifier">src_fvs8</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><a href="RnSource.html#rnSrcDerivDecl"><span class="hs-identifier hs-var">rnSrcDerivDecl</span></a><span>  </span><a href="#local-1628204253"><span class="hs-identifier hs-var">deriv_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-188"></a><span>   </span><span class="hs-special">(</span><a name="local-1628204292"><a href="#local-1628204292"><span class="hs-identifier">rn_splice_decls</span></a></a><span class="hs-special">,</span><span>  </span><a name="local-1628204293"><a href="#local-1628204293"><span class="hs-identifier">src_fvs9</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><a href="RnSplice.html#rnSpliceDecl"><span class="hs-identifier hs-var">rnSpliceDecl</span></a><span>    </span><a href="#local-1628204250"><span class="hs-identifier hs-var">splice_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-189"></a><span>      </span><span class="hs-comment">-- Haddock docs; no free vars</span><span>
</span><a name="line-190"></a><span>   </span><a name="local-1628204294"><a href="#local-1628204294"><span class="hs-identifier">rn_docs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><a href="RnSource.html#rnDocDecl"><span class="hs-identifier hs-var">rnDocDecl</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204261"><span class="hs-identifier hs-var">docs</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span>   </span><a name="local-1628204295"><a href="#local-1628204295"><span class="hs-identifier">last_tcg_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-193"></a><span>   </span><span class="hs-comment">-- (I) Compute the results and return</span><span>
</span><a name="line-194"></a><span>   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><a name="local-1628204296"><a href="#local-1628204296"><span class="hs-identifier">rn_group</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_valds</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204273"><span class="hs-identifier hs-var">rn_val_decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-195"></a><span>                             </span><span class="hs-identifier">hs_splcds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204292"><span class="hs-identifier hs-var">rn_splice_decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-196"></a><span>                             </span><span class="hs-identifier">hs_tyclds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204269"><span class="hs-identifier hs-var">rn_tycl_decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-197"></a><span>                             </span><span class="hs-identifier">hs_instds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204278"><span class="hs-identifier hs-var">rn_inst_decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-198"></a><span>                             </span><span class="hs-identifier">hs_derivds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204290"><span class="hs-identifier hs-var">rn_deriv_decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-199"></a><span>                             </span><span class="hs-identifier">hs_fixds</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204276"><span class="hs-identifier hs-var">rn_fix_decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-200"></a><span>                             </span><span class="hs-identifier">hs_warnds</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- warns are returned in the tcg_env</span><span>
</span><a name="line-201"></a><span>                                             </span><span class="hs-comment">-- (see below) not in the HsGroup</span><span>
</span><a name="line-202"></a><span>                             </span><span class="hs-identifier">hs_fords</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204284"><span class="hs-identifier hs-var">rn_foreign_decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-203"></a><span>                             </span><span class="hs-identifier">hs_annds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204286"><span class="hs-identifier hs-var">rn_ann_decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-204"></a><span>                             </span><span class="hs-identifier">hs_defds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204288"><span class="hs-identifier hs-var">rn_default_decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-205"></a><span>                             </span><span class="hs-identifier">hs_ruleds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204280"><span class="hs-identifier hs-var">rn_rule_decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-206"></a><span>                             </span><span class="hs-identifier">hs_vects</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204282"><span class="hs-identifier hs-var">rn_vect_decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-207"></a><span>                             </span><span class="hs-identifier">hs_docs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204294"><span class="hs-identifier hs-var">rn_docs</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-208"></a><span>
</span><a name="line-209"></a><span>        </span><a name="local-1628204297"><a href="#local-1628204297"><span class="hs-identifier">tcf_bndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsUtils.html#hsTyClForeignBinders"><span class="hs-identifier hs-var">hsTyClForeignBinders</span></a><span> </span><a href="#local-1628204269"><span class="hs-identifier hs-var">rn_tycl_decls</span></a><span> </span><a href="#local-1628204278"><span class="hs-identifier hs-var">rn_inst_decls</span></a><span> </span><a href="#local-1628204284"><span class="hs-identifier hs-var">rn_foreign_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-210"></a><span>        </span><a name="local-1628204298"><a href="#local-1628204298"><span class="hs-identifier">other_def</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="NameSet.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a><span> </span><a href="#local-1628204297"><span class="hs-identifier hs-var">tcf_bndrs</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="NameSet.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-211"></a><span>        </span><a name="local-1628204299"><a href="#local-1628204299"><span class="hs-identifier">other_fvs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#plusFVs"><span class="hs-identifier hs-var">plusFVs</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628204270"><span class="hs-identifier hs-var">src_fvs1</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204279"><span class="hs-identifier hs-var">src_fvs2</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204281"><span class="hs-identifier hs-var">src_fvs3</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204283"><span class="hs-identifier hs-var">src_fvs4</span></a><span class="hs-special">,</span><span>
</span><a name="line-212"></a><span>                              </span><a href="#local-1628204285"><span class="hs-identifier hs-var">src_fvs5</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204287"><span class="hs-identifier hs-var">src_fvs6</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204289"><span class="hs-identifier hs-var">src_fvs7</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204291"><span class="hs-identifier hs-var">src_fvs8</span></a><span class="hs-special">,</span><span>
</span><a name="line-213"></a><span>                              </span><a href="#local-1628204293"><span class="hs-identifier hs-var">src_fvs9</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-214"></a><span>                </span><span class="hs-comment">-- It is tiresome to gather the binders from type and class decls</span><span>
</span><a name="line-215"></a><span>
</span><a name="line-216"></a><span>        </span><a name="local-1628204300"><a href="#local-1628204300"><span class="hs-identifier">src_dus</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-1628204298"><span class="hs-identifier hs-var">other_def</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusDU"><span class="hs-identifier hs-var">plusDU</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204274"><span class="hs-identifier hs-var">bind_dus</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusDU"><span class="hs-identifier hs-var">plusDU</span></a><span class="hs-special">`</span><span> </span><a href="NameSet.html#usesOnly"><span class="hs-identifier hs-var">usesOnly</span></a><span> </span><a href="#local-1628204299"><span class="hs-identifier hs-var">other_fvs</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-217"></a><span>                </span><span class="hs-comment">-- Instance decls may have occurrences of things bound in bind_dus</span><span>
</span><a name="line-218"></a><span>                </span><span class="hs-comment">-- so we must put other_fvs last</span><span>
</span><a name="line-219"></a><span>
</span><a name="line-220"></a><span>        </span><a name="local-1628204301"><a href="#local-1628204301"><span class="hs-identifier">final_tcg_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204302"><a href="#local-1628204302"><span class="hs-identifier">tcg_env'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1628204295"><span class="hs-identifier hs-var">last_tcg_env</span></a><span> </span><span class="hs-special">`</span><a href="RnSource.html#addTcgDUs"><span class="hs-identifier hs-var">addTcgDUs</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204300"><span class="hs-identifier hs-var">src_dus</span></a><span class="hs-special">)</span><span>
</span><a name="line-221"></a><span>                        </span><span class="hs-keyword">in</span><span> </span><span class="hs-comment">-- we return the deprecs in the env, not in the HsGroup above</span><span>
</span><a name="line-222"></a><span>                        </span><a href="#local-1628204302"><span class="hs-identifier hs-var">tcg_env'</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_warns</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_warns</span><span> </span><a href="#local-1628204302"><span class="hs-identifier hs-var">tcg_env'</span></a><span> </span><span class="hs-special">`</span><a href="HscTypes.html#plusWarns"><span class="hs-identifier hs-var">plusWarns</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204277"><span class="hs-identifier hs-var">rn_warns</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">;</span><span>
</span><a name="line-223"></a><span>       </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-224"></a><span>   </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;last&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcg_rdr_env</span><span> </span><a href="#local-1628204301"><span class="hs-identifier hs-var">final_tcg_env</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-225"></a><span>   </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;finish rnSrc&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204296"><span class="hs-identifier hs-var">rn_group</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-226"></a><span>   </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;finish Dus&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204300"><span class="hs-identifier hs-var">src_dus</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-227"></a><span>   </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204301"><span class="hs-identifier hs-var">final_tcg_env</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204296"><span class="hs-identifier hs-var">rn_group</span></a><span class="hs-special">)</span><span>
</span><a name="line-228"></a><span>                    </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-229"></a><span>
</span><a name="line-230"></a><span class="hs-identifier">addTcgDUs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#DefUses"><span class="hs-identifier hs-type">DefUses</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span>
</span><a name="line-231"></a><span class="hs-comment">-- This function could be defined lower down in the module hierarchy,</span><span>
</span><a name="line-232"></a><span class="hs-comment">-- but there doesn't seem anywhere very logical to put it.</span><span>
</span><a name="line-233"></a><a name="addTcgDUs"><a href="RnSource.html#addTcgDUs"><span class="hs-identifier">addTcgDUs</span></a></a><span> </span><a name="local-1628204303"><a href="#local-1628204303"><span class="hs-identifier">tcg_env</span></a></a><span> </span><a name="local-1628204304"><a href="#local-1628204304"><span class="hs-identifier">dus</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204303"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_dus</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_dus</span><span> </span><a href="#local-1628204303"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusDU"><span class="hs-identifier hs-var">plusDU</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204304"><span class="hs-identifier hs-var">dus</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-234"></a><span>
</span><a name="line-235"></a><span class="hs-identifier">rnList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1628204246"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204247"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="#local-1628204246"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="#local-1628204247"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-236"></a><a name="rnList"><a href="RnSource.html#rnList"><span class="hs-identifier">rnList</span></a></a><span> </span><a name="local-1628204305"><a href="#local-1628204305"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1628204306"><a href="#local-1628204306"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnEnv.html#mapFvRn"><span class="hs-identifier hs-var">mapFvRn</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocFstM"><span class="hs-identifier hs-var">wrapLocFstM</span></a><span> </span><a href="#local-1628204305"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204306"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-237"></a><span>
</span><a name="line-238"></a><span class="hs-comment">{-
*********************************************************
*                                                       *
        HsDoc stuff
*                                                       *
*********************************************************
-}</span><span>
</span><a name="line-245"></a><span>
</span><a name="line-246"></a><span class="hs-identifier">rnDocDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#DocDecl"><span class="hs-identifier hs-type">DocDecl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><a href="HsDecls.html#DocDecl"><span class="hs-identifier hs-type">DocDecl</span></a><span>
</span><a name="line-247"></a><a name="rnDocDecl"><a href="RnSource.html#rnDocDecl"><span class="hs-identifier">rnDocDecl</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DocCommentNext"><span class="hs-identifier hs-var">DocCommentNext</span></a><span> </span><a name="local-1628204307"><a href="#local-1628204307"><span class="hs-identifier">doc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-248"></a><span>  </span><a name="local-1628204308"><a href="#local-1628204308"><span class="hs-identifier">rn_doc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnHsDoc.html#rnHsDoc"><span class="hs-identifier hs-var">rnHsDoc</span></a><span> </span><a href="#local-1628204307"><span class="hs-identifier hs-var">doc</span></a><span>
</span><a name="line-249"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DocCommentNext"><span class="hs-identifier hs-var">DocCommentNext</span></a><span> </span><a href="#local-1628204308"><span class="hs-identifier hs-var">rn_doc</span></a><span class="hs-special">)</span><span>
</span><a name="line-250"></a><span class="hs-identifier">rnDocDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DocCommentPrev"><span class="hs-identifier hs-var">DocCommentPrev</span></a><span> </span><a name="local-1628204309"><a href="#local-1628204309"><span class="hs-identifier">doc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-251"></a><span>  </span><a name="local-1628204310"><a href="#local-1628204310"><span class="hs-identifier">rn_doc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnHsDoc.html#rnHsDoc"><span class="hs-identifier hs-var">rnHsDoc</span></a><span> </span><a href="#local-1628204309"><span class="hs-identifier hs-var">doc</span></a><span>
</span><a name="line-252"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DocCommentPrev"><span class="hs-identifier hs-var">DocCommentPrev</span></a><span> </span><a href="#local-1628204310"><span class="hs-identifier hs-var">rn_doc</span></a><span class="hs-special">)</span><span>
</span><a name="line-253"></a><span class="hs-identifier">rnDocDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DocCommentNamed"><span class="hs-identifier hs-var">DocCommentNamed</span></a><span> </span><a name="local-1628204311"><a href="#local-1628204311"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-1628204312"><a href="#local-1628204312"><span class="hs-identifier">doc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-254"></a><span>  </span><a name="local-1628204313"><a href="#local-1628204313"><span class="hs-identifier">rn_doc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnHsDoc.html#rnHsDoc"><span class="hs-identifier hs-var">rnHsDoc</span></a><span> </span><a href="#local-1628204312"><span class="hs-identifier hs-var">doc</span></a><span>
</span><a name="line-255"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DocCommentNamed"><span class="hs-identifier hs-var">DocCommentNamed</span></a><span> </span><a href="#local-1628204311"><span class="hs-identifier hs-var">str</span></a><span> </span><a href="#local-1628204313"><span class="hs-identifier hs-var">rn_doc</span></a><span class="hs-special">)</span><span>
</span><a name="line-256"></a><span class="hs-identifier">rnDocDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DocGroup"><span class="hs-identifier hs-var">DocGroup</span></a><span> </span><a name="local-1628204314"><a href="#local-1628204314"><span class="hs-identifier">lev</span></a></a><span> </span><a name="local-1628204315"><a href="#local-1628204315"><span class="hs-identifier">doc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-257"></a><span>  </span><a name="local-1628204316"><a href="#local-1628204316"><span class="hs-identifier">rn_doc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnHsDoc.html#rnHsDoc"><span class="hs-identifier hs-var">rnHsDoc</span></a><span> </span><a href="#local-1628204315"><span class="hs-identifier hs-var">doc</span></a><span>
</span><a name="line-258"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DocGroup"><span class="hs-identifier hs-var">DocGroup</span></a><span> </span><a href="#local-1628204314"><span class="hs-identifier hs-var">lev</span></a><span> </span><a href="#local-1628204316"><span class="hs-identifier hs-var">rn_doc</span></a><span class="hs-special">)</span><span>
</span><a name="line-259"></a><span>
</span><a name="line-260"></a><span class="hs-comment">{-
*********************************************************
*                                                       *
        Source-code fixity declarations
*                                                       *
*********************************************************
-}</span><span>
</span><a name="line-267"></a><span>
</span><a name="line-268"></a><span class="hs-identifier">rnSrcFixityDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LFixitySig"><span class="hs-identifier hs-type">LFixitySig</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LFixitySig"><span class="hs-identifier hs-type">LFixitySig</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-269"></a><span class="hs-comment">-- Rename the fixity decls, so we can put</span><span>
</span><a name="line-270"></a><span class="hs-comment">-- the renamed decls in the renamed syntax tree</span><span>
</span><a name="line-271"></a><span class="hs-comment">-- Errors if the thing being fixed is not defined locally.</span><span>
</span><a name="line-272"></a><span class="hs-comment">--</span><span>
</span><a name="line-273"></a><span class="hs-comment">-- The returned FixitySigs are not actually used for anything,</span><span>
</span><a name="line-274"></a><span class="hs-comment">-- except perhaps the GHCi API</span><span>
</span><a name="line-275"></a><a name="rnSrcFixityDecls"><a href="RnSource.html#rnSrcFixityDecls"><span class="hs-identifier">rnSrcFixityDecls</span></a></a><span> </span><a name="local-1628204317"><a href="#local-1628204317"><span class="hs-identifier">bndr_set</span></a></a><span> </span><a name="local-1628204318"><a href="#local-1628204318"><span class="hs-identifier">fix_decls</span></a></a><span>
</span><a name="line-276"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-1628204332"><a href="#local-1628204332"><span class="hs-identifier">fix_decls</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="#local-1628204320"><span class="hs-identifier hs-var">rn_decl</span></a><span> </span><a href="#local-1628204318"><span class="hs-identifier hs-var">fix_decls</span></a><span>
</span><a name="line-277"></a><span>       </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a><span> </span><a href="#local-1628204332"><span class="hs-identifier hs-var">fix_decls</span></a><span class="hs-special">)</span><span>
</span><a name="line-278"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-279"></a><span>    </span><a name="local-1628204319"><a href="#local-1628204319"><span class="hs-identifier">sig_ctxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnEnv.html#TopSigCtxt"><span class="hs-identifier hs-var">TopSigCtxt</span></a><span> </span><a href="#local-1628204317"><span class="hs-identifier hs-var">bndr_set</span></a><span>
</span><a name="line-280"></a><span>
</span><a name="line-281"></a><span>    </span><span class="hs-identifier">rn_decl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsBinds.html#LFixitySig"><span class="hs-identifier hs-type">LFixitySig</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LFixitySig"><span class="hs-identifier hs-type">LFixitySig</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-282"></a><span>        </span><span class="hs-comment">-- GHC extension: look up both the tycon and data con</span><span>
</span><a name="line-283"></a><span>        </span><span class="hs-comment">-- for con-like things; hence returning a list</span><span>
</span><a name="line-284"></a><span>        </span><span class="hs-comment">-- If neither are in scope, report an error; otherwise</span><span>
</span><a name="line-285"></a><span>        </span><span class="hs-comment">-- return a fixity sig for each (slightly odd)</span><span>
</span><a name="line-286"></a><span>    </span><a name="local-1628204320"><a href="#local-1628204320"><span class="hs-identifier">rn_decl</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204323"><a href="#local-1628204323"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#FixitySig"><span class="hs-identifier hs-var">FixitySig</span></a><span> </span><a name="local-1628204324"><a href="#local-1628204324"><span class="hs-identifier">fnames</span></a></a><span> </span><a name="local-1628204325"><a href="#local-1628204325"><span class="hs-identifier">fixity</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-287"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-1628204326"><a href="#local-1628204326"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="#local-1628204321"><span class="hs-identifier hs-var">lookup_one</span></a><span> </span><a href="#local-1628204324"><span class="hs-identifier hs-var">fnames</span></a><span>
</span><a name="line-288"></a><span>           </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628204323"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#FixitySig"><span class="hs-identifier hs-var">FixitySig</span></a><span> </span><a href="#local-1628204327"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-1628204325"><span class="hs-identifier hs-var">fixity</span></a><span class="hs-special">)</span><span>
</span><a name="line-289"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><a name="local-1628204327"><a href="#local-1628204327"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204326"><span class="hs-identifier hs-var">names</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-290"></a><span>
</span><a name="line-291"></a><span>    </span><span class="hs-identifier">lookup_one</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-292"></a><span>    </span><a name="local-1628204321"><a href="#local-1628204321"><span class="hs-identifier">lookup_one</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204328"><a href="#local-1628204328"><span class="hs-identifier">name_loc</span></a></a><span> </span><a name="local-1628204329"><a href="#local-1628204329"><span class="hs-identifier">rdr_name</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-293"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-1628204328"><span class="hs-identifier hs-var">name_loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-294"></a><span>                    </span><span class="hs-comment">-- this lookup will fail if the definition isn't local</span><span>
</span><a name="line-295"></a><span>        </span><span class="hs-keyword">do</span><span> </span><a name="local-1628204330"><a href="#local-1628204330"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocalTcNames"><span class="hs-identifier hs-var">lookupLocalTcNames</span></a><span> </span><a href="#local-1628204319"><span class="hs-identifier hs-var">sig_ctxt</span></a><span> </span><a href="#local-1628204322"><span class="hs-identifier hs-var">what</span></a><span> </span><a href="#local-1628204329"><span class="hs-identifier hs-var">rdr_name</span></a><span>
</span><a name="line-296"></a><span>           </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628204328"><span class="hs-identifier hs-var">name_loc</span></a><span> </span><a href="#local-1628204331"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1628204331"><a href="#local-1628204331"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204330"><span class="hs-identifier hs-var">names</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-297"></a><span>    </span><a name="local-1628204322"><a href="#local-1628204322"><span class="hs-identifier">what</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;fixity signature&quot;</span><span>
</span><a name="line-298"></a><span>
</span><a name="line-299"></a><span class="hs-comment">{-
*********************************************************
*                                                       *
        Source-code deprecations declarations
*                                                       *
*********************************************************

Check that the deprecated names are defined, are defined locally, and
that there are no duplicate deprecations.

It's only imported deprecations, dealt with in RnIfaces, that we
gather them together.
-}</span><span>
</span><a name="line-312"></a><span>
</span><a name="line-313"></a><span class="hs-comment">-- checks that the deprecations are defined locally, and that there are no duplicates</span><span>
</span><a name="line-314"></a><span class="hs-identifier">rnSrcWarnDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LWarnDecls"><span class="hs-identifier hs-type">LWarnDecls</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><a href="HscTypes.html#Warnings"><span class="hs-identifier hs-type">Warnings</span></a><span>
</span><a name="line-315"></a><a name="rnSrcWarnDecls"><a href="RnSource.html#rnSrcWarnDecls"><span class="hs-identifier">rnSrcWarnDecls</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-316"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="HscTypes.html#NoWarnings"><span class="hs-identifier hs-var">NoWarnings</span></a><span>
</span><a name="line-317"></a><span>
</span><a name="line-318"></a><span class="hs-identifier">rnSrcWarnDecls</span><span> </span><a name="local-1628204333"><a href="#local-1628204333"><span class="hs-identifier">bndr_set</span></a></a><span> </span><a name="local-1628204334"><a href="#local-1628204334"><span class="hs-identifier">decls'</span></a></a><span>
</span><a name="line-319"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- check for duplicates</span><span>
</span><a name="line-320"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-1628204346"><a href="#local-1628204346"><span class="hs-identifier">dups</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204347"><a href="#local-1628204347"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204348"><a href="#local-1628204348"><span class="hs-identifier">rdr</span></a></a><span class="hs-glyph">:</span><a name="local-1628204349"><a href="#local-1628204349"><span class="hs-identifier">lrdr'</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204346"><span class="hs-identifier hs-var">dups</span></a><span>
</span><a name="line-321"></a><span>                          </span><span class="hs-keyword">in</span><span> </span><a href="TcRnMonad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a><span> </span><a href="#local-1628204347"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><a href="RnSource.html#dupWarnDecl"><span class="hs-identifier hs-var">dupWarnDecl</span></a><span> </span><a href="#local-1628204349"><span class="hs-identifier hs-var">lrdr'</span></a><span> </span><a href="#local-1628204348"><span class="hs-identifier hs-var">rdr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-322"></a><span>               </span><a href="#local-1628204339"><span class="hs-identifier hs-var">warn_rdr_dups</span></a><span>
</span><a name="line-323"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204350"><a href="#local-1628204350"><span class="hs-identifier">pairs_s</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#addLocM"><span class="hs-identifier hs-var">addLocM</span></a><span> </span><a href="#local-1628204337"><span class="hs-identifier hs-var">rn_deprec</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204335"><span class="hs-identifier hs-var">decls</span></a><span>
</span><a name="line-324"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#WarnSome"><span class="hs-identifier hs-var">WarnSome</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a><span> </span><a href="#local-1628204350"><span class="hs-identifier hs-var">pairs_s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-325"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-326"></a><span>   </span><a name="local-1628204335"><a href="#local-1628204335"><span class="hs-identifier">decls</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204340"><a href="#local-1628204340"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">wd_warnings</span><span> </span><a href="#local-1628204340"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204334"><span class="hs-identifier hs-var">decls'</span></a><span>
</span><a name="line-327"></a><span>
</span><a name="line-328"></a><span>   </span><a name="local-1628204336"><a href="#local-1628204336"><span class="hs-identifier">sig_ctxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnEnv.html#TopSigCtxt"><span class="hs-identifier hs-var">TopSigCtxt</span></a><span> </span><a href="#local-1628204333"><span class="hs-identifier hs-var">bndr_set</span></a><span>
</span><a name="line-329"></a><span>
</span><a name="line-330"></a><span>   </span><a name="local-1628204337"><a href="#local-1628204337"><span class="hs-identifier">rn_deprec</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#Warning"><span class="hs-identifier hs-var">Warning</span></a><span> </span><a name="local-1628204341"><a href="#local-1628204341"><span class="hs-identifier">rdr_names</span></a></a><span> </span><a name="local-1628204342"><a href="#local-1628204342"><span class="hs-identifier">txt</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-331"></a><span>       </span><span class="hs-comment">-- ensures that the names are defined locally</span><span>
</span><a name="line-332"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204343"><a href="#local-1628204343"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MonadUtils.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a><span> </span><span class="hs-special">(</span><a href="RnEnv.html#lookupLocalTcNames"><span class="hs-identifier hs-var">lookupLocalTcNames</span></a><span> </span><a href="#local-1628204336"><span class="hs-identifier hs-var">sig_ctxt</span></a><span> </span><a href="#local-1628204338"><span class="hs-identifier hs-var">what</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span class="hs-special">)</span><span>
</span><a name="line-333"></a><span>                                </span><a href="#local-1628204341"><span class="hs-identifier hs-var">rdr_names</span></a><span>
</span><a name="line-334"></a><span>          </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="RdrName.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a><span> </span><a href="#local-1628204344"><span class="hs-identifier hs-var">rdr</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204342"><span class="hs-identifier hs-var">txt</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-1628204344"><a href="#local-1628204344"><span class="hs-identifier">rdr</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204343"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-335"></a><span>
</span><a name="line-336"></a><span>   </span><a name="local-1628204338"><a href="#local-1628204338"><span class="hs-identifier">what</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;deprecation&quot;</span><span>
</span><a name="line-337"></a><span>
</span><a name="line-338"></a><span>   </span><a name="local-1628204339"><a href="#local-1628204339"><span class="hs-identifier">warn_rdr_dups</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#findDupRdrNames"><span class="hs-identifier hs-var">findDupRdrNames</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#Warning"><span class="hs-identifier hs-var">Warning</span></a><span> </span><a name="local-1628204345"><a href="#local-1628204345"><span class="hs-identifier">ns</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628204345"><span class="hs-identifier hs-var">ns</span></a><span class="hs-special">)</span><span>
</span><a name="line-339"></a><span>                                               </span><a href="#local-1628204335"><span class="hs-identifier hs-var">decls</span></a><span>
</span><a name="line-340"></a><span>
</span><a name="line-341"></a><span class="hs-identifier">findDupRdrNames</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-342"></a><a name="findDupRdrNames"><a href="RnSource.html#findDupRdrNames"><span class="hs-identifier">findDupRdrNames</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ListSetOps.html#findDupsEq"><span class="hs-identifier hs-var">findDupsEq</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-1628204351"><a href="#local-1628204351"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628204352"><a href="#local-1628204352"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628204351"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="RdrName.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628204352"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-343"></a><span>
</span><a name="line-344"></a><span class="hs-comment">-- look for duplicates among the OccNames;</span><span>
</span><a name="line-345"></a><span class="hs-comment">-- we check that the names are defined above</span><span>
</span><a name="line-346"></a><span class="hs-comment">-- invt: the lists returned by findDupsEq always have at least two elements</span><span>
</span><a name="line-347"></a><span>
</span><a name="line-348"></a><span class="hs-identifier">dupWarnDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-349"></a><span class="hs-comment">-- Located RdrName -&gt; DeprecDecl RdrName -&gt; SDoc</span><span>
</span><a name="line-350"></a><a name="dupWarnDecl"><a href="RnSource.html#dupWarnDecl"><span class="hs-identifier">dupWarnDecl</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204353"><a href="#local-1628204353"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-1628204354"><a href="#local-1628204354"><span class="hs-identifier">rdr_name</span></a></a><span>
</span><a name="line-351"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Multiple warning declarations for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204354"><span class="hs-identifier hs-var">rdr_name</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-352"></a><span>          </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;also at &quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204353"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">]</span><span>
</span><a name="line-353"></a><span>
</span><a name="line-354"></a><span class="hs-comment">{-
*********************************************************
*                                                      *
\subsection{Annotation declarations}
*                                                      *
*********************************************************
-}</span><span>
</span><a name="line-361"></a><span>
</span><a name="line-362"></a><span class="hs-identifier">rnAnnDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#AnnDecl"><span class="hs-identifier hs-type">AnnDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#AnnDecl"><span class="hs-identifier hs-type">AnnDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-363"></a><a name="rnAnnDecl"><a href="RnSource.html#rnAnnDecl"><span class="hs-identifier">rnAnnDecl</span></a></a><span> </span><a name="local-1628204355"><a href="#local-1628204355"><span class="hs-identifier">ann</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsAnnotation"><span class="hs-identifier hs-var">HsAnnotation</span></a><span> </span><a name="local-1628204356"><a href="#local-1628204356"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1628204357"><a href="#local-1628204357"><span class="hs-identifier">provenance</span></a></a><span> </span><a name="local-1628204358"><a href="#local-1628204358"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-364"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a><span> </span><span class="hs-special">(</span><a href="TcAnnotations.html#annCtxt"><span class="hs-identifier hs-var">annCtxt</span></a><span> </span><a href="#local-1628204355"><span class="hs-identifier hs-var">ann</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-365"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204359"><a href="#local-1628204359"><span class="hs-identifier">provenance'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204360"><a href="#local-1628204360"><span class="hs-identifier">provenance_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnAnnProvenance"><span class="hs-identifier hs-var">rnAnnProvenance</span></a><span> </span><a href="#local-1628204357"><span class="hs-identifier hs-var">provenance</span></a><span>
</span><a name="line-366"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204361"><a href="#local-1628204361"><span class="hs-identifier">expr'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204362"><a href="#local-1628204362"><span class="hs-identifier">expr_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#setStage"><span class="hs-identifier hs-var">setStage</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Splice"><span class="hs-identifier hs-var">Splice</span></a><span> </span><a href="TcRnTypes.html#Untyped"><span class="hs-identifier hs-var">Untyped</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-367"></a><span>                              </span><a href="RnExpr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a><span> </span><a href="#local-1628204358"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-368"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsAnnotation"><span class="hs-identifier hs-var">HsAnnotation</span></a><span> </span><a href="#local-1628204356"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-1628204359"><span class="hs-identifier hs-var">provenance'</span></a><span> </span><a href="#local-1628204361"><span class="hs-identifier hs-var">expr'</span></a><span class="hs-special">,</span><span>
</span><a name="line-369"></a><span>                 </span><a href="#local-1628204360"><span class="hs-identifier hs-var">provenance_fvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204362"><span class="hs-identifier hs-var">expr_fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-370"></a><span>
</span><a name="line-371"></a><span class="hs-identifier">rnAnnProvenance</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#AnnProvenance"><span class="hs-identifier hs-type">AnnProvenance</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#AnnProvenance"><span class="hs-identifier hs-type">AnnProvenance</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-372"></a><a name="rnAnnProvenance"><a href="RnSource.html#rnAnnProvenance"><span class="hs-identifier">rnAnnProvenance</span></a></a><span> </span><a name="local-1628204363"><a href="#local-1628204363"><span class="hs-identifier">provenance</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-373"></a><span>    </span><a name="local-1628204364"><a href="#local-1628204364"><span class="hs-identifier">provenance'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a><span> </span><a href="RnEnv.html#lookupTopBndrRn"><span class="hs-identifier hs-var">lookupTopBndrRn</span></a><span> </span><a href="#local-1628204363"><span class="hs-identifier hs-var">provenance</span></a><span>
</span><a name="line-374"></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204364"><span class="hs-identifier hs-var">provenance'</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a><span> </span><a href="NameSet.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a><span> </span><a href="NameSet.html#unitFV"><span class="hs-identifier hs-var">unitFV</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#annProvenanceName_maybe"><span class="hs-identifier hs-var">annProvenanceName_maybe</span></a><span> </span><a href="#local-1628204364"><span class="hs-identifier hs-var">provenance'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-375"></a><span>
</span><a name="line-376"></a><span class="hs-comment">{-
*********************************************************
*                                                      *
\subsection{Default declarations}
*                                                      *
*********************************************************
-}</span><span>
</span><a name="line-383"></a><span>
</span><a name="line-384"></a><span class="hs-identifier">rnDefaultDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#DefaultDecl"><span class="hs-identifier hs-type">DefaultDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DefaultDecl"><span class="hs-identifier hs-type">DefaultDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-385"></a><a name="rnDefaultDecl"><a href="RnSource.html#rnDefaultDecl"><span class="hs-identifier">rnDefaultDecl</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DefaultDecl"><span class="hs-identifier hs-var">DefaultDecl</span></a><span> </span><a name="local-1628204365"><a href="#local-1628204365"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-386"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204367"><a href="#local-1628204367"><span class="hs-identifier">tys'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204368"><a href="#local-1628204368"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTypes"><span class="hs-identifier hs-var">rnLHsTypes</span></a><span> </span><a href="#local-1628204366"><span class="hs-identifier hs-var">doc_str</span></a><span> </span><a href="#local-1628204365"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-387"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DefaultDecl"><span class="hs-identifier hs-var">DefaultDecl</span></a><span> </span><a href="#local-1628204367"><span class="hs-identifier hs-var">tys'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204368"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-388"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-389"></a><span>    </span><a name="local-1628204366"><a href="#local-1628204366"><span class="hs-identifier">doc_str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnEnv.html#DefaultDeclCtx"><span class="hs-identifier hs-var">DefaultDeclCtx</span></a><span>
</span><a name="line-390"></a><span>
</span><a name="line-391"></a><span class="hs-comment">{-
*********************************************************
*                                                      *
\subsection{Foreign declarations}
*                                                      *
*********************************************************
-}</span><span>
</span><a name="line-398"></a><span>
</span><a name="line-399"></a><span class="hs-identifier">rnHsForeignDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#ForeignDecl"><span class="hs-identifier hs-type">ForeignDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ForeignDecl"><span class="hs-identifier hs-type">ForeignDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-400"></a><a name="rnHsForeignDecl"><a href="RnSource.html#rnHsForeignDecl"><span class="hs-identifier">rnHsForeignDecl</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ForeignImport"><span class="hs-identifier hs-var">ForeignImport</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fd_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204369"><a href="#local-1628204369"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_sig_ty</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204370"><a href="#local-1628204370"><span class="hs-identifier">ty</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_fi</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204371"><a href="#local-1628204371"><span class="hs-identifier">spec</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-401"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204372"><a href="#local-1628204372"><span class="hs-identifier">topEnv</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a><span>
</span><a name="line-402"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204373"><a href="#local-1628204373"><span class="hs-identifier">name'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedTopBndrRn"><span class="hs-identifier hs-var">lookupLocatedTopBndrRn</span></a><span> </span><a href="#local-1628204369"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-403"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204374"><a href="#local-1628204374"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204375"><a href="#local-1628204375"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnHsSigType"><span class="hs-identifier hs-var">rnHsSigType</span></a><span> </span><span class="hs-special">(</span><a href="RnEnv.html#ForeignDeclCtx"><span class="hs-identifier hs-var">ForeignDeclCtx</span></a><span> </span><a href="#local-1628204369"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204370"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-404"></a><span>
</span><a name="line-405"></a><span>        </span><span class="hs-comment">-- Mark any PackageTarget style imports as coming from the current package</span><span>
</span><a name="line-406"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204376"><a href="#local-1628204376"><span class="hs-identifier">unitId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">thisPackage</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-1628204372"><span class="hs-identifier hs-var">topEnv</span></a><span>
</span><a name="line-407"></a><span>             </span><a name="local-1628204377"><a href="#local-1628204377"><span class="hs-identifier">spec'</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#patchForeignImport"><span class="hs-identifier hs-var">patchForeignImport</span></a><span> </span><a href="#local-1628204376"><span class="hs-identifier hs-var">unitId</span></a><span> </span><a href="#local-1628204371"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-408"></a><span>
</span><a name="line-409"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ForeignImport"><span class="hs-identifier hs-var">ForeignImport</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fd_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204373"><span class="hs-identifier hs-var">name'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_sig_ty</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204374"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-410"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_co</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsDecls.html#noForeignImportCoercionYet"><span class="hs-identifier hs-var">noForeignImportCoercionYet</span></a><span>
</span><a name="line-411"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_fi</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204377"><span class="hs-identifier hs-var">spec'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="#local-1628204375"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-412"></a><span>
</span><a name="line-413"></a><span class="hs-identifier">rnHsForeignDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ForeignExport"><span class="hs-identifier hs-var">ForeignExport</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fd_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204378"><a href="#local-1628204378"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_sig_ty</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204379"><a href="#local-1628204379"><span class="hs-identifier">ty</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_fe</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204380"><a href="#local-1628204380"><span class="hs-identifier">spec</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-414"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204381"><a href="#local-1628204381"><span class="hs-identifier">name'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedOccRn"><span class="hs-identifier hs-var">lookupLocatedOccRn</span></a><span> </span><a href="#local-1628204378"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-415"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204382"><a href="#local-1628204382"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204383"><a href="#local-1628204383"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnHsSigType"><span class="hs-identifier hs-var">rnHsSigType</span></a><span> </span><span class="hs-special">(</span><a href="RnEnv.html#ForeignDeclCtx"><span class="hs-identifier hs-var">ForeignDeclCtx</span></a><span> </span><a href="#local-1628204378"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204379"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-416"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ForeignExport"><span class="hs-identifier hs-var">ForeignExport</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fd_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204381"><span class="hs-identifier hs-var">name'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_sig_ty</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204382"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-417"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_co</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsDecls.html#noForeignExportCoercionYet"><span class="hs-identifier hs-var">noForeignExportCoercionYet</span></a><span>
</span><a name="line-418"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_fe</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204380"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-419"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="#local-1628204383"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#addOneFV"><span class="hs-identifier hs-var">addOneFV</span></a><span class="hs-special">`</span><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628204381"><span class="hs-identifier hs-var">name'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-420"></a><span>        </span><span class="hs-comment">-- NB: a foreign export is an *occurrence site* for name, so</span><span>
</span><a name="line-421"></a><span>        </span><span class="hs-comment">--     we add it to the free-variable list.  It might, for example,</span><span>
</span><a name="line-422"></a><span>        </span><span class="hs-comment">--     be imported from another module</span><span>
</span><a name="line-423"></a><span>
</span><a name="line-424"></a><span class="hs-comment">-- | For Windows DLLs we need to know what packages imported symbols are from</span><span>
</span><a name="line-425"></a><span class="hs-comment">--      to generate correct calls. Imported symbols are tagged with the current</span><span>
</span><a name="line-426"></a><span class="hs-comment">--      package, so if they get inlined across a package boundry we'll still</span><span>
</span><a name="line-427"></a><span class="hs-comment">--      know where they're from.</span><span>
</span><a name="line-428"></a><span class="hs-comment">--</span><span>
</span><a name="line-429"></a><span class="hs-identifier">patchForeignImport</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#ForeignImport"><span class="hs-identifier hs-type">ForeignImport</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#ForeignImport"><span class="hs-identifier hs-type">ForeignImport</span></a><span>
</span><a name="line-430"></a><a name="patchForeignImport"><a href="RnSource.html#patchForeignImport"><span class="hs-identifier">patchForeignImport</span></a></a><span> </span><a name="local-1628204384"><a href="#local-1628204384"><span class="hs-identifier">unitId</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#CImport"><span class="hs-identifier hs-var">CImport</span></a><span> </span><a name="local-1628204385"><a href="#local-1628204385"><span class="hs-identifier">cconv</span></a></a><span> </span><a name="local-1628204386"><a href="#local-1628204386"><span class="hs-identifier">safety</span></a></a><span> </span><a name="local-1628204387"><a href="#local-1628204387"><span class="hs-identifier">fs</span></a></a><span> </span><a name="local-1628204388"><a href="#local-1628204388"><span class="hs-identifier">spec</span></a></a><span> </span><a name="local-1628204389"><a href="#local-1628204389"><span class="hs-identifier">src</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-431"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="HsDecls.html#CImport"><span class="hs-identifier hs-var">CImport</span></a><span> </span><a href="#local-1628204385"><span class="hs-identifier hs-var">cconv</span></a><span> </span><a href="#local-1628204386"><span class="hs-identifier hs-var">safety</span></a><span> </span><a href="#local-1628204387"><span class="hs-identifier hs-var">fs</span></a><span> </span><span class="hs-special">(</span><a href="RnSource.html#patchCImportSpec"><span class="hs-identifier hs-var">patchCImportSpec</span></a><span> </span><a href="#local-1628204384"><span class="hs-identifier hs-var">unitId</span></a><span> </span><a href="#local-1628204388"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204389"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-432"></a><span>
</span><a name="line-433"></a><span class="hs-identifier">patchCImportSpec</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#CImportSpec"><span class="hs-identifier hs-type">CImportSpec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#CImportSpec"><span class="hs-identifier hs-type">CImportSpec</span></a><span>
</span><a name="line-434"></a><a name="patchCImportSpec"><a href="RnSource.html#patchCImportSpec"><span class="hs-identifier">patchCImportSpec</span></a></a><span> </span><a name="local-1628204390"><a href="#local-1628204390"><span class="hs-identifier">unitId</span></a></a><span> </span><a name="local-1628204391"><a href="#local-1628204391"><span class="hs-identifier">spec</span></a></a><span>
</span><a name="line-435"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628204391"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-436"></a><span>        </span><a href="HsDecls.html#CFunction"><span class="hs-identifier hs-var">CFunction</span></a><span> </span><a name="local-1628204392"><a href="#local-1628204392"><span class="hs-identifier">callTarget</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#CFunction"><span class="hs-identifier hs-var">CFunction</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="RnSource.html#patchCCallTarget"><span class="hs-identifier hs-var">patchCCallTarget</span></a><span> </span><a href="#local-1628204390"><span class="hs-identifier hs-var">unitId</span></a><span> </span><a href="#local-1628204392"><span class="hs-identifier hs-var">callTarget</span></a><span>
</span><a name="line-437"></a><span>        </span><span class="hs-identifier">_</span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628204391"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-438"></a><span>
</span><a name="line-439"></a><span class="hs-identifier">patchCCallTarget</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ForeignCall.html#CCallTarget"><span class="hs-identifier hs-type">CCallTarget</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ForeignCall.html#CCallTarget"><span class="hs-identifier hs-type">CCallTarget</span></a><span>
</span><a name="line-440"></a><a name="patchCCallTarget"><a href="RnSource.html#patchCCallTarget"><span class="hs-identifier">patchCCallTarget</span></a></a><span> </span><a name="local-1628204393"><a href="#local-1628204393"><span class="hs-identifier">unitId</span></a></a><span> </span><a name="local-1628204394"><a href="#local-1628204394"><span class="hs-identifier">callTarget</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-441"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628204394"><span class="hs-identifier hs-var">callTarget</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-442"></a><span>  </span><a href="ForeignCall.html#StaticTarget"><span class="hs-identifier hs-var">StaticTarget</span></a><span> </span><a name="local-1628204395"><a href="#local-1628204395"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-1628204396"><a href="#local-1628204396"><span class="hs-identifier">label</span></a></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a name="local-1628204397"><a href="#local-1628204397"><span class="hs-identifier">isFun</span></a></a><span>
</span><a name="line-443"></a><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ForeignCall.html#StaticTarget"><span class="hs-identifier hs-var">StaticTarget</span></a><span> </span><a href="#local-1628204395"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-1628204396"><span class="hs-identifier hs-var">label</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628204393"><span class="hs-identifier hs-var">unitId</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204397"><span class="hs-identifier hs-var">isFun</span></a><span>
</span><a name="line-444"></a><span>  </span><span class="hs-identifier">_</span><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628204394"><span class="hs-identifier hs-var">callTarget</span></a><span>
</span><a name="line-445"></a><span>
</span><a name="line-446"></a><span class="hs-comment">{-
*********************************************************
*                                                      *
\subsection{Instance declarations}
*                                                      *
*********************************************************
-}</span><span>
</span><a name="line-453"></a><span>
</span><a name="line-454"></a><span class="hs-identifier">rnSrcInstDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#InstDecl"><span class="hs-identifier hs-type">InstDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#InstDecl"><span class="hs-identifier hs-type">InstDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-455"></a><a name="rnSrcInstDecl"><a href="RnSource.html#rnSrcInstDecl"><span class="hs-identifier">rnSrcInstDecl</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyFamInstD"><span class="hs-identifier hs-var">TyFamInstD</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tfid_inst</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204398"><a href="#local-1628204398"><span class="hs-identifier">tfi</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-456"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204399"><a href="#local-1628204399"><span class="hs-identifier">tfi'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204400"><a href="#local-1628204400"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnTyFamInstDecl"><span class="hs-identifier hs-var">rnTyFamInstDecl</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-1628204398"><span class="hs-identifier hs-var">tfi</span></a><span>
</span><a name="line-457"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyFamInstD"><span class="hs-identifier hs-var">TyFamInstD</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tfid_inst</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204399"><span class="hs-identifier hs-var">tfi'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="#local-1628204400"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-458"></a><span>
</span><a name="line-459"></a><span class="hs-identifier">rnSrcInstDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DataFamInstD"><span class="hs-identifier hs-var">DataFamInstD</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dfid_inst</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204401"><a href="#local-1628204401"><span class="hs-identifier">dfi</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-460"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204402"><a href="#local-1628204402"><span class="hs-identifier">dfi'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204403"><a href="#local-1628204403"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnDataFamInstDecl"><span class="hs-identifier hs-var">rnDataFamInstDecl</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-1628204401"><span class="hs-identifier hs-var">dfi</span></a><span>
</span><a name="line-461"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DataFamInstD"><span class="hs-identifier hs-var">DataFamInstD</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dfid_inst</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204402"><span class="hs-identifier hs-var">dfi'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="#local-1628204403"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-462"></a><span>
</span><a name="line-463"></a><span class="hs-identifier">rnSrcInstDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ClsInstD"><span class="hs-identifier hs-var">ClsInstD</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cid_inst</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204404"><a href="#local-1628204404"><span class="hs-identifier">cid</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-464"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204405"><a href="#local-1628204405"><span class="hs-identifier">cid'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204406"><a href="#local-1628204406"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnClsInstDecl"><span class="hs-identifier hs-var">rnClsInstDecl</span></a><span> </span><a href="#local-1628204404"><span class="hs-identifier hs-var">cid</span></a><span>
</span><a name="line-465"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ClsInstD"><span class="hs-identifier hs-var">ClsInstD</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cid_inst</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204405"><span class="hs-identifier hs-var">cid'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="#local-1628204406"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-466"></a><span>
</span><a name="line-467"></a><span class="hs-comment">-- | Warn about non-canonical typeclass instance declarations</span><span>
</span><a name="line-468"></a><span class="hs-comment">--</span><span>
</span><a name="line-469"></a><span class="hs-comment">-- A &quot;non-canonical&quot; instance definition can occur for instances of a</span><span>
</span><a name="line-470"></a><span class="hs-comment">-- class which redundantly defines an operation its superclass</span><span>
</span><a name="line-471"></a><span class="hs-comment">-- provides as well (c.f. `return`/`pure`). In such cases, a canonical</span><span>
</span><a name="line-472"></a><span class="hs-comment">-- instance is one where the subclass inherits its method</span><span>
</span><a name="line-473"></a><span class="hs-comment">-- implementation from its superclass instance (usually the subclass</span><span>
</span><a name="line-474"></a><span class="hs-comment">-- has a default method implementation to that effect). Consequently,</span><span>
</span><a name="line-475"></a><span class="hs-comment">-- a non-canonical instance occurs when this is not the case.</span><span>
</span><a name="line-476"></a><span class="hs-comment">--</span><span>
</span><a name="line-477"></a><span class="hs-comment">-- See also descriptions of 'checkCanonicalMonadInstances' and</span><span>
</span><a name="line-478"></a><span class="hs-comment">-- 'checkCanonicalMonoidInstances'</span><span>
</span><a name="line-479"></a><span class="hs-identifier">checkCanonicalInstances</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-480"></a><a name="checkCanonicalInstances"><a href="RnSource.html#checkCanonicalInstances"><span class="hs-identifier">checkCanonicalInstances</span></a></a><span> </span><a name="local-1628204407"><a href="#local-1628204407"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-1628204408"><a href="#local-1628204408"><span class="hs-identifier">poly_ty</span></a></a><span> </span><a name="local-1628204409"><a href="#local-1628204409"><span class="hs-identifier">mbinds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-481"></a><span>    </span><a href="TcRnMonad.html#whenWOptM"><span class="hs-identifier hs-var">whenWOptM</span></a><span> </span><a href="DynFlags.html#Opt_WarnNonCanonicalMonadInstances"><span class="hs-identifier hs-var">Opt_WarnNonCanonicalMonadInstances</span></a><span>
</span><a name="line-482"></a><span>        </span><a href="#local-1628204410"><span class="hs-identifier hs-var">checkCanonicalMonadInstances</span></a><span>
</span><a name="line-483"></a><span>
</span><a name="line-484"></a><span>    </span><a href="TcRnMonad.html#whenWOptM"><span class="hs-identifier hs-var">whenWOptM</span></a><span> </span><a href="DynFlags.html#Opt_WarnNonCanonicalMonadFailInstances"><span class="hs-identifier hs-var">Opt_WarnNonCanonicalMonadFailInstances</span></a><span>
</span><a name="line-485"></a><span>        </span><a href="#local-1628204411"><span class="hs-identifier hs-var">checkCanonicalMonadFailInstances</span></a><span>
</span><a name="line-486"></a><span>
</span><a name="line-487"></a><span>    </span><a href="TcRnMonad.html#whenWOptM"><span class="hs-identifier hs-var">whenWOptM</span></a><span> </span><a href="DynFlags.html#Opt_WarnNonCanonicalMonoidInstances"><span class="hs-identifier hs-var">Opt_WarnNonCanonicalMonoidInstances</span></a><span>
</span><a name="line-488"></a><span>        </span><a href="#local-1628204412"><span class="hs-identifier hs-var">checkCanonicalMonoidInstances</span></a><span>
</span><a name="line-489"></a><span>
</span><a name="line-490"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-491"></a><span>    </span><span class="hs-comment">-- | Warn about unsound/non-canonical 'Applicative'/'Monad' instance</span><span>
</span><a name="line-492"></a><span>    </span><span class="hs-comment">-- declarations. Specifically, the following conditions are verified:</span><span>
</span><a name="line-493"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-494"></a><span>    </span><span class="hs-comment">-- In 'Monad' instances declarations:</span><span>
</span><a name="line-495"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-496"></a><span>    </span><span class="hs-comment">--  * If 'return' is overridden it must be canonical (i.e. @return = pure@)</span><span>
</span><a name="line-497"></a><span>    </span><span class="hs-comment">--  * If '(&gt;&gt;)' is overridden it must be canonical (i.e. @(&gt;&gt;) = (*&gt;)@)</span><span>
</span><a name="line-498"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-499"></a><span>    </span><span class="hs-comment">-- In 'Applicative' instance declarations:</span><span>
</span><a name="line-500"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-501"></a><span>    </span><span class="hs-comment">--  * Warn if 'pure' is defined backwards (i.e. @pure = return@).</span><span>
</span><a name="line-502"></a><span>    </span><span class="hs-comment">--  * Warn if '(*&gt;)' is defined backwards (i.e. @(*&gt;) = (&gt;&gt;)@).</span><span>
</span><a name="line-503"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-504"></a><span>    </span><a name="local-1628204410"><a href="#local-1628204410"><span class="hs-identifier">checkCanonicalMonadInstances</span></a></a><span>
</span><a name="line-505"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628204407"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#applicativeClassName"><span class="hs-identifier hs-var">applicativeClassName</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-506"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><a href="#local-1628204409"><span class="hs-identifier hs-var">mbinds</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204419"><a href="#local-1628204419"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204420"><a href="#local-1628204420"><span class="hs-identifier">mbind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-1628204419"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-507"></a><span>              </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628204420"><span class="hs-identifier hs-var">mbind</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-508"></a><span>                  </span><a href="HsBinds.html#FunBind"><span class="hs-identifier hs-var">FunBind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204421"><a href="#local-1628204421"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204422"><a href="#local-1628204422"><span class="hs-identifier">mg</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-509"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628204421"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#pureAName"><span class="hs-identifier hs-var">pureAName</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204413"><span class="hs-identifier hs-var">isAliasMG</span></a><span> </span><a href="#local-1628204422"><span class="hs-identifier hs-var">mg</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="PrelNames.html#returnMName"><span class="hs-identifier hs-var">returnMName</span></a><span>
</span><a name="line-510"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628204414"><span class="hs-identifier hs-var">addWarnNonCanonicalMethod1</span></a><span>
</span><a name="line-511"></a><span>                            </span><a href="DynFlags.html#Opt_WarnNonCanonicalMonadInstances"><span class="hs-identifier hs-var">Opt_WarnNonCanonicalMonadInstances</span></a><span> </span><span class="hs-string">&quot;pure&quot;</span><span> </span><span class="hs-string">&quot;return&quot;</span><span>
</span><a name="line-512"></a><span>
</span><a name="line-513"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628204421"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#thenAName"><span class="hs-identifier hs-var">thenAName</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204413"><span class="hs-identifier hs-var">isAliasMG</span></a><span> </span><a href="#local-1628204422"><span class="hs-identifier hs-var">mg</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="PrelNames.html#thenMName"><span class="hs-identifier hs-var">thenMName</span></a><span>
</span><a name="line-514"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628204414"><span class="hs-identifier hs-var">addWarnNonCanonicalMethod1</span></a><span>
</span><a name="line-515"></a><span>                            </span><a href="DynFlags.html#Opt_WarnNonCanonicalMonadInstances"><span class="hs-identifier hs-var">Opt_WarnNonCanonicalMonadInstances</span></a><span> </span><span class="hs-string">&quot;(*&gt;)&quot;</span><span> </span><span class="hs-string">&quot;(&gt;&gt;)&quot;</span><span>
</span><a name="line-516"></a><span>
</span><a name="line-517"></a><span>                  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-518"></a><span>
</span><a name="line-519"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628204407"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#monadClassName"><span class="hs-identifier hs-var">monadClassName</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-520"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><a href="#local-1628204409"><span class="hs-identifier hs-var">mbinds</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204423"><a href="#local-1628204423"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204424"><a href="#local-1628204424"><span class="hs-identifier">mbind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-1628204423"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-521"></a><span>              </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628204424"><span class="hs-identifier hs-var">mbind</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-522"></a><span>                  </span><a href="HsBinds.html#FunBind"><span class="hs-identifier hs-var">FunBind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204425"><a href="#local-1628204425"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204426"><a href="#local-1628204426"><span class="hs-identifier">mg</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-523"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628204425"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#returnMName"><span class="hs-identifier hs-var">returnMName</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204413"><span class="hs-identifier hs-var">isAliasMG</span></a><span> </span><a href="#local-1628204426"><span class="hs-identifier hs-var">mg</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="PrelNames.html#pureAName"><span class="hs-identifier hs-var">pureAName</span></a><span>
</span><a name="line-524"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628204415"><span class="hs-identifier hs-var">addWarnNonCanonicalMethod2</span></a><span>
</span><a name="line-525"></a><span>                            </span><a href="DynFlags.html#Opt_WarnNonCanonicalMonadInstances"><span class="hs-identifier hs-var">Opt_WarnNonCanonicalMonadInstances</span></a><span> </span><span class="hs-string">&quot;return&quot;</span><span> </span><span class="hs-string">&quot;pure&quot;</span><span>
</span><a name="line-526"></a><span>
</span><a name="line-527"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628204425"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#thenMName"><span class="hs-identifier hs-var">thenMName</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204413"><span class="hs-identifier hs-var">isAliasMG</span></a><span> </span><a href="#local-1628204426"><span class="hs-identifier hs-var">mg</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="PrelNames.html#thenAName"><span class="hs-identifier hs-var">thenAName</span></a><span>
</span><a name="line-528"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628204415"><span class="hs-identifier hs-var">addWarnNonCanonicalMethod2</span></a><span>
</span><a name="line-529"></a><span>                            </span><a href="DynFlags.html#Opt_WarnNonCanonicalMonadInstances"><span class="hs-identifier hs-var">Opt_WarnNonCanonicalMonadInstances</span></a><span> </span><span class="hs-string">&quot;(&gt;&gt;)&quot;</span><span> </span><span class="hs-string">&quot;(*&gt;)&quot;</span><span>
</span><a name="line-530"></a><span>
</span><a name="line-531"></a><span>                  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-532"></a><span>
</span><a name="line-533"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-534"></a><span>
</span><a name="line-535"></a><span>    </span><span class="hs-comment">-- | Warn about unsound/non-canonical 'Monad'/'MonadFail' instance</span><span>
</span><a name="line-536"></a><span>    </span><span class="hs-comment">-- declarations. Specifically, the following conditions are verified:</span><span>
</span><a name="line-537"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-538"></a><span>    </span><span class="hs-comment">-- In 'Monad' instances declarations:</span><span>
</span><a name="line-539"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-540"></a><span>    </span><span class="hs-comment">--  * If 'fail' is overridden it must be canonical</span><span>
</span><a name="line-541"></a><span>    </span><span class="hs-comment">--    (i.e. @fail = Control.Monad.Fail.fail@)</span><span>
</span><a name="line-542"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-543"></a><span>    </span><span class="hs-comment">-- In 'MonadFail' instance declarations:</span><span>
</span><a name="line-544"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-545"></a><span>    </span><span class="hs-comment">--  * Warn if 'fail' is defined backwards</span><span>
</span><a name="line-546"></a><span>    </span><span class="hs-comment">--    (i.e. @fail = Control.Monad.fail@).</span><span>
</span><a name="line-547"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-548"></a><span>    </span><a name="local-1628204411"><a href="#local-1628204411"><span class="hs-identifier">checkCanonicalMonadFailInstances</span></a></a><span>
</span><a name="line-549"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628204407"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#monadFailClassName"><span class="hs-identifier hs-var">monadFailClassName</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-550"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><a href="#local-1628204409"><span class="hs-identifier hs-var">mbinds</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204427"><a href="#local-1628204427"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204428"><a href="#local-1628204428"><span class="hs-identifier">mbind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-1628204427"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-551"></a><span>              </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628204428"><span class="hs-identifier hs-var">mbind</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-552"></a><span>                  </span><a href="HsBinds.html#FunBind"><span class="hs-identifier hs-var">FunBind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204429"><a href="#local-1628204429"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204430"><a href="#local-1628204430"><span class="hs-identifier">mg</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-553"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628204429"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#failMName"><span class="hs-identifier hs-var">failMName</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204413"><span class="hs-identifier hs-var">isAliasMG</span></a><span> </span><a href="#local-1628204430"><span class="hs-identifier hs-var">mg</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="PrelNames.html#failMName_preMFP"><span class="hs-identifier hs-var">failMName_preMFP</span></a><span>
</span><a name="line-554"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628204414"><span class="hs-identifier hs-var">addWarnNonCanonicalMethod1</span></a><span>
</span><a name="line-555"></a><span>                            </span><a href="DynFlags.html#Opt_WarnNonCanonicalMonadFailInstances"><span class="hs-identifier hs-var">Opt_WarnNonCanonicalMonadFailInstances</span></a><span> </span><span class="hs-string">&quot;fail&quot;</span><span>
</span><a name="line-556"></a><span>                            </span><span class="hs-string">&quot;Control.Monad.fail&quot;</span><span>
</span><a name="line-557"></a><span>
</span><a name="line-558"></a><span>                  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-559"></a><span>
</span><a name="line-560"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628204407"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#monadClassName"><span class="hs-identifier hs-var">monadClassName</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-561"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><a href="#local-1628204409"><span class="hs-identifier hs-var">mbinds</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204431"><a href="#local-1628204431"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204432"><a href="#local-1628204432"><span class="hs-identifier">mbind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-1628204431"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-562"></a><span>              </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628204432"><span class="hs-identifier hs-var">mbind</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-563"></a><span>                  </span><a href="HsBinds.html#FunBind"><span class="hs-identifier hs-var">FunBind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204433"><a href="#local-1628204433"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204434"><a href="#local-1628204434"><span class="hs-identifier">mg</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-564"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628204433"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#failMName_preMFP"><span class="hs-identifier hs-var">failMName_preMFP</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204413"><span class="hs-identifier hs-var">isAliasMG</span></a><span> </span><a href="#local-1628204434"><span class="hs-identifier hs-var">mg</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="PrelNames.html#failMName"><span class="hs-identifier hs-var">failMName</span></a><span>
</span><a name="line-565"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628204415"><span class="hs-identifier hs-var">addWarnNonCanonicalMethod2</span></a><span>
</span><a name="line-566"></a><span>                            </span><a href="DynFlags.html#Opt_WarnNonCanonicalMonadFailInstances"><span class="hs-identifier hs-var">Opt_WarnNonCanonicalMonadFailInstances</span></a><span> </span><span class="hs-string">&quot;fail&quot;</span><span>
</span><a name="line-567"></a><span>                            </span><span class="hs-string">&quot;Control.Monad.Fail.fail&quot;</span><span>
</span><a name="line-568"></a><span>                  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-569"></a><span>
</span><a name="line-570"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-571"></a><span>
</span><a name="line-572"></a><span>    </span><span class="hs-comment">-- | Check whether Monoid(mappend) is defined in terms of</span><span>
</span><a name="line-573"></a><span>    </span><span class="hs-comment">-- Semigroup((&lt;&gt;)) (and not the other way round). Specifically,</span><span>
</span><a name="line-574"></a><span>    </span><span class="hs-comment">-- the following conditions are verified:</span><span>
</span><a name="line-575"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-576"></a><span>    </span><span class="hs-comment">-- In 'Monoid' instances declarations:</span><span>
</span><a name="line-577"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-578"></a><span>    </span><span class="hs-comment">--  * If 'mappend' is overridden it must be canonical</span><span>
</span><a name="line-579"></a><span>    </span><span class="hs-comment">--    (i.e. @mappend = (&lt;&gt;)@)</span><span>
</span><a name="line-580"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-581"></a><span>    </span><span class="hs-comment">-- In 'Semigroup' instance declarations:</span><span>
</span><a name="line-582"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-583"></a><span>    </span><span class="hs-comment">--  * Warn if '(&lt;&gt;)' is defined backwards (i.e. @(&lt;&gt;) = mappend@).</span><span>
</span><a name="line-584"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-585"></a><span>    </span><a name="local-1628204412"><a href="#local-1628204412"><span class="hs-identifier">checkCanonicalMonoidInstances</span></a></a><span>
</span><a name="line-586"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628204407"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#semigroupClassName"><span class="hs-identifier hs-var">semigroupClassName</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-587"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><a href="#local-1628204409"><span class="hs-identifier hs-var">mbinds</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204435"><a href="#local-1628204435"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204436"><a href="#local-1628204436"><span class="hs-identifier">mbind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-1628204435"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-588"></a><span>              </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628204436"><span class="hs-identifier hs-var">mbind</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-589"></a><span>                  </span><a href="HsBinds.html#FunBind"><span class="hs-identifier hs-var">FunBind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204437"><a href="#local-1628204437"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204438"><a href="#local-1628204438"><span class="hs-identifier">mg</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-590"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628204437"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#sappendName"><span class="hs-identifier hs-var">sappendName</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204413"><span class="hs-identifier hs-var">isAliasMG</span></a><span> </span><a href="#local-1628204438"><span class="hs-identifier hs-var">mg</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="PrelNames.html#mappendName"><span class="hs-identifier hs-var">mappendName</span></a><span>
</span><a name="line-591"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628204414"><span class="hs-identifier hs-var">addWarnNonCanonicalMethod1</span></a><span>
</span><a name="line-592"></a><span>                            </span><a href="DynFlags.html#Opt_WarnNonCanonicalMonoidInstances"><span class="hs-identifier hs-var">Opt_WarnNonCanonicalMonoidInstances</span></a><span> </span><span class="hs-string">&quot;(&lt;&gt;)&quot;</span><span> </span><span class="hs-string">&quot;mappend&quot;</span><span>
</span><a name="line-593"></a><span>
</span><a name="line-594"></a><span>                  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-595"></a><span>
</span><a name="line-596"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628204407"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#monoidClassName"><span class="hs-identifier hs-var">monoidClassName</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-597"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><a href="#local-1628204409"><span class="hs-identifier hs-var">mbinds</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204439"><a href="#local-1628204439"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204440"><a href="#local-1628204440"><span class="hs-identifier">mbind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-1628204439"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-598"></a><span>              </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628204440"><span class="hs-identifier hs-var">mbind</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-599"></a><span>                  </span><a href="HsBinds.html#FunBind"><span class="hs-identifier hs-var">FunBind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204441"><a href="#local-1628204441"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204442"><a href="#local-1628204442"><span class="hs-identifier">mg</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-600"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628204441"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#mappendName"><span class="hs-identifier hs-var">mappendName</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204413"><span class="hs-identifier hs-var">isAliasMG</span></a><span> </span><a href="#local-1628204442"><span class="hs-identifier hs-var">mg</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="PrelNames.html#sappendName"><span class="hs-identifier hs-var">sappendName</span></a><span>
</span><a name="line-601"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628204416"><span class="hs-identifier hs-var">addWarnNonCanonicalMethod2NoDefault</span></a><span>
</span><a name="line-602"></a><span>                            </span><a href="DynFlags.html#Opt_WarnNonCanonicalMonoidInstances"><span class="hs-identifier hs-var">Opt_WarnNonCanonicalMonoidInstances</span></a><span> </span><span class="hs-string">&quot;mappend&quot;</span><span> </span><span class="hs-string">&quot;(&lt;&gt;)&quot;</span><span>
</span><a name="line-603"></a><span>
</span><a name="line-604"></a><span>                  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-605"></a><span>
</span><a name="line-606"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-607"></a><span>
</span><a name="line-608"></a><span>    </span><span class="hs-comment">-- | test whether MatchGroup represents a trivial \&quot;lhsName = rhsName\&quot;</span><span>
</span><a name="line-609"></a><span>    </span><span class="hs-comment">-- binding, and return @Just rhsName@ if this is the case</span><span>
</span><a name="line-610"></a><span>    </span><span class="hs-identifier">isAliasMG</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsExpr.html#MatchGroup"><span class="hs-identifier hs-type">MatchGroup</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-611"></a><span>    </span><a name="local-1628204413"><a href="#local-1628204413"><span class="hs-identifier">isAliasMG</span></a></a><span> </span><a href="HsExpr.html#MG"><span class="hs-identifier hs-var">MG</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">mg_alts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#Match"><span class="hs-identifier hs-var">Match</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">m_pats</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">m_grhss</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204443"><a href="#local-1628204443"><span class="hs-identifier">grhss</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">}</span><span>
</span><a name="line-612"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="HsExpr.html#GRHSs"><span class="hs-identifier hs-var">GRHSs</span></a><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#GRHS"><span class="hs-identifier hs-var">GRHS</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-1628204444"><a href="#local-1628204444"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><a name="local-1628204445"><a href="#local-1628204445"><span class="hs-identifier">lbinds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204443"><span class="hs-identifier hs-var">grhss</span></a><span>
</span><a name="line-613"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a href="HsBinds.html#EmptyLocalBinds"><span class="hs-identifier hs-var">EmptyLocalBinds</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204445"><span class="hs-identifier hs-var">lbinds</span></a><span>
</span><a name="line-614"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204446"><a href="#local-1628204446"><span class="hs-identifier">rhsName</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204444"><span class="hs-identifier hs-var">body</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628204446"><span class="hs-identifier hs-var">rhsName</span></a><span>
</span><a name="line-615"></a><span>    </span><span class="hs-identifier">isAliasMG</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-616"></a><span>
</span><a name="line-617"></a><span>    </span><span class="hs-comment">-- got &quot;lhs = rhs&quot; but expected something different</span><span>
</span><a name="line-618"></a><span>    </span><a name="local-1628204414"><a href="#local-1628204414"><span class="hs-identifier">addWarnNonCanonicalMethod1</span></a></a><span> </span><a name="local-1628204447"><a href="#local-1628204447"><span class="hs-identifier">flag</span></a></a><span> </span><a name="local-1628204448"><a href="#local-1628204448"><span class="hs-identifier">lhs</span></a></a><span> </span><a name="local-1628204449"><a href="#local-1628204449"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-619"></a><span>        </span><a href="TcRnMonad.html#addWarn"><span class="hs-identifier hs-var">addWarn</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a><span> </span><a href="#local-1628204447"><span class="hs-identifier hs-var">flag</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span>
</span><a name="line-620"></a><span>                       </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Noncanonical&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-621"></a><span>                         </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204448"><span class="hs-identifier hs-var">lhs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot; = &quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628204449"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-622"></a><span>                         </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;definition detected&quot;</span><span>
</span><a name="line-623"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="#local-1628204417"><span class="hs-identifier hs-var">instDeclCtxt1</span></a><span> </span><a href="#local-1628204408"><span class="hs-identifier hs-var">poly_ty</span></a><span>
</span><a name="line-624"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Move definition from&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-625"></a><span>                         </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-1628204449"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-626"></a><span>                         </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;to&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-1628204448"><span class="hs-identifier hs-var">lhs</span></a><span class="hs-special">)</span><span>
</span><a name="line-627"></a><span>                       </span><span class="hs-special">]</span><span>
</span><a name="line-628"></a><span>
</span><a name="line-629"></a><span>    </span><span class="hs-comment">-- expected &quot;lhs = rhs&quot; but got something else</span><span>
</span><a name="line-630"></a><span>    </span><a name="local-1628204415"><a href="#local-1628204415"><span class="hs-identifier">addWarnNonCanonicalMethod2</span></a></a><span> </span><a name="local-1628204450"><a href="#local-1628204450"><span class="hs-identifier">flag</span></a></a><span> </span><a name="local-1628204451"><a href="#local-1628204451"><span class="hs-identifier">lhs</span></a></a><span> </span><a name="local-1628204452"><a href="#local-1628204452"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-631"></a><span>        </span><a href="TcRnMonad.html#addWarn"><span class="hs-identifier hs-var">addWarn</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a><span> </span><a href="#local-1628204450"><span class="hs-identifier hs-var">flag</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span>
</span><a name="line-632"></a><span>                       </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Noncanonical&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-633"></a><span>                         </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-1628204451"><span class="hs-identifier hs-var">lhs</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-634"></a><span>                         </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;definition detected&quot;</span><span>
</span><a name="line-635"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="#local-1628204417"><span class="hs-identifier hs-var">instDeclCtxt1</span></a><span> </span><a href="#local-1628204408"><span class="hs-identifier hs-var">poly_ty</span></a><span>
</span><a name="line-636"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Either remove definition for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-637"></a><span>                         </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-1628204451"><span class="hs-identifier hs-var">lhs</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;or define as&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-638"></a><span>                         </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204451"><span class="hs-identifier hs-var">lhs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot; = &quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628204452"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-639"></a><span>                       </span><span class="hs-special">]</span><span>
</span><a name="line-640"></a><span>
</span><a name="line-641"></a><span>    </span><span class="hs-comment">-- like above, but method has no default impl</span><span>
</span><a name="line-642"></a><span>    </span><a name="local-1628204416"><a href="#local-1628204416"><span class="hs-identifier">addWarnNonCanonicalMethod2NoDefault</span></a></a><span> </span><a name="local-1628204453"><a href="#local-1628204453"><span class="hs-identifier">flag</span></a></a><span> </span><a name="local-1628204454"><a href="#local-1628204454"><span class="hs-identifier">lhs</span></a></a><span> </span><a name="local-1628204455"><a href="#local-1628204455"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-643"></a><span>        </span><a href="TcRnMonad.html#addWarn"><span class="hs-identifier hs-var">addWarn</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a><span> </span><a href="#local-1628204453"><span class="hs-identifier hs-var">flag</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span>
</span><a name="line-644"></a><span>                       </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Noncanonical&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-645"></a><span>                         </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-1628204454"><span class="hs-identifier hs-var">lhs</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-646"></a><span>                         </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;definition detected&quot;</span><span>
</span><a name="line-647"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="#local-1628204417"><span class="hs-identifier hs-var">instDeclCtxt1</span></a><span> </span><a href="#local-1628204408"><span class="hs-identifier hs-var">poly_ty</span></a><span>
</span><a name="line-648"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Define as&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-649"></a><span>                         </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204454"><span class="hs-identifier hs-var">lhs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot; = &quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628204455"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-650"></a><span>                       </span><span class="hs-special">]</span><span>
</span><a name="line-651"></a><span>
</span><a name="line-652"></a><span>    </span><span class="hs-comment">-- stolen from TcInstDcls</span><span>
</span><a name="line-653"></a><span>    </span><span class="hs-identifier">instDeclCtxt1</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-654"></a><span>    </span><a name="local-1628204417"><a href="#local-1628204417"><span class="hs-identifier">instDeclCtxt1</span></a></a><span> </span><a name="local-1628204456"><a href="#local-1628204456"><span class="hs-identifier">hs_inst_ty</span></a></a><span>
</span><a name="line-655"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204418"><span class="hs-identifier hs-var">inst_decl_ctxt</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#getLHsInstDeclHead"><span class="hs-identifier hs-var">getLHsInstDeclHead</span></a><span> </span><a href="#local-1628204456"><span class="hs-identifier hs-var">hs_inst_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-656"></a><span>
</span><a name="line-657"></a><span>    </span><span class="hs-identifier">inst_decl_ctxt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-658"></a><span>    </span><a name="local-1628204418"><a href="#local-1628204418"><span class="hs-identifier">inst_decl_ctxt</span></a></a><span> </span><a name="local-1628204457"><a href="#local-1628204457"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;in the instance declaration for&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-659"></a><span>                         </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><a href="#local-1628204457"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;.&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-660"></a><span>
</span><a name="line-661"></a><span>
</span><a name="line-662"></a><span class="hs-identifier">rnClsInstDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#ClsInstDecl"><span class="hs-identifier hs-type">ClsInstDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ClsInstDecl"><span class="hs-identifier hs-type">ClsInstDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-663"></a><a name="rnClsInstDecl"><a href="RnSource.html#rnClsInstDecl"><span class="hs-identifier">rnClsInstDecl</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ClsInstDecl"><span class="hs-identifier hs-var">ClsInstDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cid_poly_ty</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204458"><a href="#local-1628204458"><span class="hs-identifier">inst_ty</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cid_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204459"><a href="#local-1628204459"><span class="hs-identifier">mbinds</span></a></a><span>
</span><a name="line-664"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cid_sigs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204460"><a href="#local-1628204460"><span class="hs-identifier">uprags</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cid_tyfam_insts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204461"><a href="#local-1628204461"><span class="hs-identifier">ats</span></a></a><span>
</span><a name="line-665"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cid_overlap_mode</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204462"><a href="#local-1628204462"><span class="hs-identifier">oflag</span></a></a><span>
</span><a name="line-666"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cid_datafam_insts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204463"><a href="#local-1628204463"><span class="hs-identifier">adts</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-667"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204464"><a href="#local-1628204464"><span class="hs-identifier">inst_ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204465"><a href="#local-1628204465"><span class="hs-identifier">inst_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsInstType"><span class="hs-identifier hs-var">rnLHsInstType</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;an instance declaration&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628204458"><span class="hs-identifier hs-var">inst_ty</span></a><span>
</span><a name="line-668"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628204466"><a href="#local-1628204466"><span class="hs-identifier">ktv_names</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1628204467"><a href="#local-1628204467"><span class="hs-identifier">head_ty'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsTypes.html#splitLHsInstDeclTy"><span class="hs-identifier hs-var">splitLHsInstDeclTy</span></a><span> </span><a href="#local-1628204464"><span class="hs-identifier hs-var">inst_ty'</span></a><span>
</span><a name="line-669"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204468"><a href="#local-1628204468"><span class="hs-identifier">cls</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="HsTypes.html#hsTyGetAppHead_maybe"><span class="hs-identifier hs-var">hsTyGetAppHead_maybe</span></a><span> </span><a href="#local-1628204467"><span class="hs-identifier hs-var">head_ty'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-670"></a><span>                     </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelNames.html#mkUnboundName"><span class="hs-identifier hs-var">mkUnboundName</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#mkTcOccFS"><span class="hs-identifier hs-var">mkTcOccFS</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;&lt;class&gt;&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-671"></a><span>                     </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204469"><a href="#local-1628204469"><span class="hs-identifier">cls</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628204469"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-672"></a><span>                     </span><span class="hs-comment">-- rnLHsInstType has added an error message</span><span>
</span><a name="line-673"></a><span>                     </span><span class="hs-comment">-- if hsTyGetAppHead_maybe fails</span><span>
</span><a name="line-674"></a><span>
</span><a name="line-675"></a><span>          </span><span class="hs-comment">-- Rename the bindings</span><span>
</span><a name="line-676"></a><span>          </span><span class="hs-comment">-- The typechecker (not the renamer) checks that all</span><span>
</span><a name="line-677"></a><span>          </span><span class="hs-comment">-- the bindings are for the right class</span><span>
</span><a name="line-678"></a><span>          </span><span class="hs-comment">-- (Slightly strangely) when scoped type variables are on, the</span><span>
</span><a name="line-679"></a><span>          </span><span class="hs-comment">-- forall-d tyvars scope over the method bindings too</span><span>
</span><a name="line-680"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204470"><a href="#local-1628204470"><span class="hs-identifier">mbinds'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204471"><a href="#local-1628204471"><span class="hs-identifier">uprags'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204472"><a href="#local-1628204472"><span class="hs-identifier">meth_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnBinds.html#rnMethodBinds"><span class="hs-identifier hs-var">rnMethodBinds</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-1628204468"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-1628204466"><span class="hs-identifier hs-var">ktv_names</span></a><span> </span><a href="#local-1628204459"><span class="hs-identifier hs-var">mbinds</span></a><span> </span><a href="#local-1628204460"><span class="hs-identifier hs-var">uprags</span></a><span>
</span><a name="line-681"></a><span>
</span><a name="line-682"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnSource.html#checkCanonicalInstances"><span class="hs-identifier hs-var">checkCanonicalInstances</span></a><span> </span><a href="#local-1628204468"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-1628204464"><span class="hs-identifier hs-var">inst_ty'</span></a><span> </span><a href="#local-1628204470"><span class="hs-identifier hs-var">mbinds'</span></a><span>
</span><a name="line-683"></a><span>
</span><a name="line-684"></a><span>       </span><span class="hs-comment">-- Rename the associated types, and type signatures</span><span>
</span><a name="line-685"></a><span>       </span><span class="hs-comment">-- Both need to have the instance type variables in scope</span><span>
</span><a name="line-686"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;rnSrcInstDecl&quot;</span><span>  </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204464"><span class="hs-identifier hs-var">inst_ty'</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204466"><span class="hs-identifier hs-var">ktv_names</span></a><span class="hs-special">)</span><span>
</span><a name="line-687"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-1628204477"><a href="#local-1628204477"><span class="hs-identifier">ats'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204478"><a href="#local-1628204478"><span class="hs-identifier">adts'</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1628204479"><a href="#local-1628204479"><span class="hs-identifier">more_fvs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-688"></a><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#extendTyVarEnvFVRn"><span class="hs-identifier hs-var">extendTyVarEnvFVRn</span></a><span> </span><a href="#local-1628204466"><span class="hs-identifier hs-var">ktv_names</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-689"></a><span>                </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204473"><a href="#local-1628204473"><span class="hs-identifier">ats'</span></a></a><span class="hs-special">,</span><span>  </span><a name="local-1628204474"><a href="#local-1628204474"><span class="hs-identifier">at_fvs</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnATInstDecls"><span class="hs-identifier hs-var">rnATInstDecls</span></a><span> </span><a href="RnSource.html#rnTyFamInstDecl"><span class="hs-identifier hs-var">rnTyFamInstDecl</span></a><span> </span><a href="#local-1628204468"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-1628204466"><span class="hs-identifier hs-var">ktv_names</span></a><span> </span><a href="#local-1628204461"><span class="hs-identifier hs-var">ats</span></a><span>
</span><a name="line-690"></a><span>                   </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204475"><a href="#local-1628204475"><span class="hs-identifier">adts'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204476"><a href="#local-1628204476"><span class="hs-identifier">adt_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnATInstDecls"><span class="hs-identifier hs-var">rnATInstDecls</span></a><span> </span><a href="RnSource.html#rnDataFamInstDecl"><span class="hs-identifier hs-var">rnDataFamInstDecl</span></a><span> </span><a href="#local-1628204468"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-1628204466"><span class="hs-identifier hs-var">ktv_names</span></a><span> </span><a href="#local-1628204463"><span class="hs-identifier hs-var">adts</span></a><span>
</span><a name="line-691"></a><span>                   </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><a href="#local-1628204473"><span class="hs-identifier hs-var">ats'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204475"><span class="hs-identifier hs-var">adts'</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-1628204474"><span class="hs-identifier hs-var">at_fvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204476"><span class="hs-identifier hs-var">adt_fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-692"></a><span>
</span><a name="line-693"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204480"><a href="#local-1628204480"><span class="hs-identifier">all_fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204472"><span class="hs-identifier hs-var">meth_fvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204479"><span class="hs-identifier hs-var">more_fvs</span></a><span>
</span><a name="line-694"></a><span>                                </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204465"><span class="hs-identifier hs-var">inst_fvs</span></a><span>
</span><a name="line-695"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ClsInstDecl"><span class="hs-identifier hs-var">ClsInstDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cid_poly_ty</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204464"><span class="hs-identifier hs-var">inst_ty'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cid_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204470"><span class="hs-identifier hs-var">mbinds'</span></a><span>
</span><a name="line-696"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cid_sigs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204471"><span class="hs-identifier hs-var">uprags'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cid_tyfam_insts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204477"><span class="hs-identifier hs-var">ats'</span></a><span>
</span><a name="line-697"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cid_overlap_mode</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204462"><span class="hs-identifier hs-var">oflag</span></a><span>
</span><a name="line-698"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cid_datafam_insts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204478"><span class="hs-identifier hs-var">adts'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><a name="line-699"></a><span>                 </span><a href="#local-1628204480"><span class="hs-identifier hs-var">all_fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-700"></a><span>             </span><span class="hs-comment">-- We return the renamed associated data type declarations so</span><span>
</span><a name="line-701"></a><span>             </span><span class="hs-comment">-- that they can be entered into the list of type declarations</span><span>
</span><a name="line-702"></a><span>             </span><span class="hs-comment">-- for the binding group, but we also keep a copy in the instance.</span><span>
</span><a name="line-703"></a><span>             </span><span class="hs-comment">-- The latter is needed for well-formedness checks in the type</span><span>
</span><a name="line-704"></a><span>             </span><span class="hs-comment">-- checker (eg, to ensure that all ATs of the instance actually</span><span>
</span><a name="line-705"></a><span>             </span><span class="hs-comment">-- receive a declaration).</span><span>
</span><a name="line-706"></a><span>             </span><span class="hs-comment">-- NB: Even the copies in the instance declaration carry copies of</span><span>
</span><a name="line-707"></a><span>             </span><span class="hs-comment">--     the instance context after renaming.  This is a bit</span><span>
</span><a name="line-708"></a><span>             </span><span class="hs-comment">--     strange, but should not matter (and it would be more work</span><span>
</span><a name="line-709"></a><span>             </span><span class="hs-comment">--     to remove the context).</span><span>
</span><a name="line-710"></a><span>
</span><a name="line-711"></a><span class="hs-identifier">rnFamInstDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnEnv.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span>
</span><a name="line-712"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-713"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-714"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#HsTyPats"><span class="hs-identifier hs-type">HsTyPats</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-715"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628204244"><span class="hs-identifier hs-type">rhs</span></a><span>
</span><a name="line-716"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="RnEnv.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628204244"><span class="hs-identifier hs-type">rhs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204245"><span class="hs-identifier hs-type">rhs'</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-717"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="HsDecls.html#HsTyPats"><span class="hs-identifier hs-type">HsTyPats</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204245"><span class="hs-identifier hs-type">rhs'</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-718"></a><a name="rnFamInstDecl"><a href="RnSource.html#rnFamInstDecl"><span class="hs-identifier">rnFamInstDecl</span></a></a><span> </span><a name="local-1628204481"><a href="#local-1628204481"><span class="hs-identifier">doc</span></a></a><span> </span><a name="local-1628204482"><a href="#local-1628204482"><span class="hs-identifier">mb_cls</span></a></a><span> </span><a name="local-1628204483"><a href="#local-1628204483"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsIB"><span class="hs-identifier hs-var">HsIB</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsib_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204484"><a href="#local-1628204484"><span class="hs-identifier">pats</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628204485"><a href="#local-1628204485"><span class="hs-identifier">payload</span></a></a><span> </span><a name="local-1628204486"><a href="#local-1628204486"><span class="hs-identifier">rnPayload</span></a></a><span>
</span><a name="line-719"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204487"><a href="#local-1628204487"><span class="hs-identifier">tycon'</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupFamInstName"><span class="hs-identifier hs-var">lookupFamInstName</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="#local-1628204482"><span class="hs-identifier hs-var">mb_cls</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204483"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-720"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204488"><a href="#local-1628204488"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628204484"><span class="hs-identifier hs-var">pats</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-721"></a><span>                     </span><span class="hs-special">[</span><span class="hs-special">]</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;rnFamInstDecl&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204483"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span>
</span><a name="line-722"></a><span>                     </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204489"><a href="#local-1628204489"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628204489"><span class="hs-identifier hs-var">loc</span></a><span>
</span><a name="line-723"></a><span>                     </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204490"><a href="#local-1628204490"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-1628204491"><a href="#local-1628204491"><span class="hs-identifier">ps</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SrcLoc.html#combineSrcSpans"><span class="hs-identifier hs-var">combineSrcSpans</span></a><span> </span><a href="#local-1628204490"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#getLoc"><span class="hs-identifier hs-var">getLoc</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#last"><span class="hs-identifier hs-var">last</span></a><span> </span><a href="#local-1628204491"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-724"></a><span>
</span><a name="line-725"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204492"><a href="#local-1628204492"><span class="hs-identifier">pat_kity_vars_with_dups</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#extractHsTysRdrTyVarsDups"><span class="hs-identifier hs-var">extractHsTysRdrTyVarsDups</span></a><span> </span><a href="#local-1628204484"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-726"></a><span>             </span><span class="hs-comment">-- Use the &quot;...Dups&quot; form because it's needed</span><span>
</span><a name="line-727"></a><span>             </span><span class="hs-comment">-- below to report unsed binder on the LHS</span><span>
</span><a name="line-728"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204493"><a href="#local-1628204493"><span class="hs-identifier">var_names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#newTyVarNameRn"><span class="hs-identifier hs-var">newTyVarNameRn</span></a><span> </span><a href="#local-1628204482"><span class="hs-identifier hs-var">mb_cls</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628204488"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-729"></a><span>                      </span><a href="RnTypes.html#freeKiTyVarsAllVars"><span class="hs-identifier hs-var">freeKiTyVarsAllVars</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-730"></a><span>                      </span><a href="RnTypes.html#rmDupsInRdrTyVars"><span class="hs-identifier hs-var">rmDupsInRdrTyVars</span></a><span> </span><a href="#local-1628204492"><span class="hs-identifier hs-var">pat_kity_vars_with_dups</span></a><span>
</span><a name="line-731"></a><span>
</span><a name="line-732"></a><span>             </span><span class="hs-comment">-- All the free vars of the family patterns</span><span>
</span><a name="line-733"></a><span>             </span><span class="hs-comment">-- with a sensible binding location</span><span>
</span><a name="line-734"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-1628204507"><a href="#local-1628204507"><span class="hs-identifier">pats'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204508"><a href="#local-1628204508"><span class="hs-identifier">payload'</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1628204509"><a href="#local-1628204509"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-735"></a><span>              </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#bindLocalNamesFV"><span class="hs-identifier hs-var">bindLocalNamesFV</span></a><span> </span><a href="#local-1628204493"><span class="hs-identifier hs-var">var_names</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-736"></a><span>                 </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204494"><a href="#local-1628204494"><span class="hs-identifier">pats'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204495"><a href="#local-1628204495"><span class="hs-identifier">pat_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTypes"><span class="hs-identifier hs-var">rnLHsTypes</span></a><span> </span><span class="hs-special">(</span><a href="RnEnv.html#FamPatCtx"><span class="hs-identifier hs-var">FamPatCtx</span></a><span> </span><a href="#local-1628204483"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204484"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-737"></a><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204496"><a href="#local-1628204496"><span class="hs-identifier">payload'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204497"><a href="#local-1628204497"><span class="hs-identifier">rhs_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204486"><span class="hs-identifier hs-var">rnPayload</span></a><span> </span><a href="#local-1628204481"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-1628204485"><span class="hs-identifier hs-var">payload</span></a><span>
</span><a name="line-738"></a><span>
</span><a name="line-739"></a><span>                       </span><span class="hs-comment">-- Report unused binders on the LHS</span><span>
</span><a name="line-740"></a><span>                       </span><span class="hs-comment">-- See Note [Unused type variables in family instances]</span><span>
</span><a name="line-741"></a><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">groups</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-742"></a><span>                          </span><a name="local-1628204498"><a href="#local-1628204498"><span class="hs-identifier">groups</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ListSetOps.html#equivClasses"><span class="hs-identifier hs-var">equivClasses</span></a><span> </span><a href="SrcLoc.html#cmpLocated"><span class="hs-identifier hs-var">cmpLocated</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-743"></a><span>                                   </span><a href="RnTypes.html#freeKiTyVarsAllVars"><span class="hs-identifier hs-var">freeKiTyVarsAllVars</span></a><span> </span><a href="#local-1628204492"><span class="hs-identifier hs-var">pat_kity_vars_with_dups</span></a><span>
</span><a name="line-744"></a><span>                    </span><span class="hs-special">;</span><span> </span><a name="local-1628204500"><a href="#local-1628204500"><span class="hs-identifier">tv_nms_dups</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="RnEnv.html#lookupOccRn"><span class="hs-identifier hs-var">lookupOccRn</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-745"></a><span>                                     </span><span class="hs-special">[</span><span> </span><a href="#local-1628204499"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-1628204499"><a href="#local-1628204499"><span class="hs-identifier">tv</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204498"><span class="hs-identifier hs-var">groups</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-746"></a><span>                          </span><span class="hs-comment">-- Add to the used variables any variables that</span><span>
</span><a name="line-747"></a><span>                          </span><span class="hs-comment">-- appear *more than once* on the LHS</span><span>
</span><a name="line-748"></a><span>                          </span><span class="hs-comment">-- e.g.   F a Int a = Bool</span><span>
</span><a name="line-749"></a><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204501"><a href="#local-1628204501"><span class="hs-identifier">tv_nms_used</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#extendNameSetList"><span class="hs-identifier hs-var">extendNameSetList</span></a><span> </span><a href="#local-1628204497"><span class="hs-identifier hs-var">rhs_fvs</span></a><span> </span><a href="#local-1628204500"><span class="hs-identifier hs-var">tv_nms_dups</span></a><span>
</span><a name="line-750"></a><span>                    </span><span class="hs-special">;</span><span> </span><a href="RnEnv.html#warnUnusedTypePatterns"><span class="hs-identifier hs-var">warnUnusedTypePatterns</span></a><span> </span><a href="#local-1628204493"><span class="hs-identifier hs-var">var_names</span></a><span> </span><a href="#local-1628204501"><span class="hs-identifier hs-var">tv_nms_used</span></a><span>
</span><a name="line-751"></a><span>
</span><a name="line-752"></a><span>                         </span><span class="hs-comment">-- See Note [Renaming associated types]</span><span>
</span><a name="line-753"></a><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204502"><a href="#local-1628204502"><span class="hs-identifier">bad_tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628204482"><span class="hs-identifier hs-var">mb_cls</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-754"></a><span>                                      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-755"></a><span>                                      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-1628204505"><a href="#local-1628204505"><span class="hs-identifier">cls_tkvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="#local-1628204504"><span class="hs-identifier hs-var">is_bad</span></a><span> </span><a href="#local-1628204505"><span class="hs-identifier hs-var">cls_tkvs</span></a><span>
</span><a name="line-756"></a><span>                          </span><a name="local-1628204503"><a href="#local-1628204503"><span class="hs-identifier">var_name_set</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a><span> </span><a href="#local-1628204493"><span class="hs-identifier hs-var">var_names</span></a><span>
</span><a name="line-757"></a><span>
</span><a name="line-758"></a><span>                          </span><a name="local-1628204504"><a href="#local-1628204504"><span class="hs-identifier">is_bad</span></a></a><span> </span><a name="local-1628204506"><a href="#local-1628204506"><span class="hs-identifier">cls_tkv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204506"><span class="hs-identifier hs-var">cls_tkv</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#elemNameSet"><span class="hs-identifier hs-var">elemNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204497"><span class="hs-identifier hs-var">rhs_fvs</span></a><span>
</span><a name="line-759"></a><span>                                        </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-1628204506"><span class="hs-identifier hs-var">cls_tkv</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#elemNameSet"><span class="hs-identifier hs-var">elemNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204503"><span class="hs-identifier hs-var">var_name_set</span></a><span class="hs-special">)</span><span>
</span><a name="line-760"></a><span>
</span><a name="line-761"></a><span>                    </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628204502"><span class="hs-identifier hs-var">bad_tvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="RnSource.html#badAssocRhs"><span class="hs-identifier hs-var">badAssocRhs</span></a><span> </span><a href="#local-1628204502"><span class="hs-identifier hs-var">bad_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-762"></a><span>                    </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-1628204494"><span class="hs-identifier hs-var">pats'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204496"><span class="hs-identifier hs-var">payload'</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-1628204497"><span class="hs-identifier hs-var">rhs_fvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204495"><span class="hs-identifier hs-var">pat_fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-763"></a><span>
</span><a name="line-764"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204510"><a href="#local-1628204510"><span class="hs-identifier">anon_wcs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><a href="RnTypes.html#collectAnonWildCards"><span class="hs-identifier hs-var">collectAnonWildCards</span></a><span> </span><a href="#local-1628204507"><span class="hs-identifier hs-var">pats'</span></a><span>
</span><a name="line-765"></a><span>             </span><a name="local-1628204511"><a href="#local-1628204511"><span class="hs-identifier">all_ibs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204510"><span class="hs-identifier hs-var">anon_wcs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628204493"><span class="hs-identifier hs-var">var_names</span></a><span>
</span><a name="line-766"></a><span>                        </span><span class="hs-comment">-- all_ibs: include anonymous wildcards in the implicit</span><span>
</span><a name="line-767"></a><span>                        </span><span class="hs-comment">-- binders In a type pattern they behave just like any</span><span>
</span><a name="line-768"></a><span>                        </span><span class="hs-comment">-- other type variable except for being anoymous.  See</span><span>
</span><a name="line-769"></a><span>                        </span><span class="hs-comment">-- Note [Wildcards in family instances]</span><span>
</span><a name="line-770"></a><span>             </span><a name="local-1628204512"><a href="#local-1628204512"><span class="hs-identifier">all_fvs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204509"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#addOneFV"><span class="hs-identifier hs-var">addOneFV</span></a><span class="hs-special">`</span><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628204487"><span class="hs-identifier hs-var">tycon'</span></a><span>
</span><a name="line-771"></a><span>
</span><a name="line-772"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204487"><span class="hs-identifier hs-var">tycon'</span></a><span class="hs-special">,</span><span>
</span><a name="line-773"></a><span>                 </span><a href="HsTypes.html#HsIB"><span class="hs-identifier hs-var">HsIB</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsib_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204507"><span class="hs-identifier hs-var">pats'</span></a><span>
</span><a name="line-774"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsib_vars</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204511"><span class="hs-identifier hs-var">all_ibs</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><a name="line-775"></a><span>                 </span><a href="#local-1628204508"><span class="hs-identifier hs-var">payload'</span></a><span class="hs-special">,</span><span>
</span><a name="line-776"></a><span>                 </span><a href="#local-1628204512"><span class="hs-identifier hs-var">all_fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-777"></a><span>             </span><span class="hs-comment">-- type instance =&gt; use, hence addOneFV</span><span>
</span><a name="line-778"></a><span>
</span><a name="line-779"></a><span class="hs-identifier">rnTyFamInstDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-780"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#TyFamInstDecl"><span class="hs-identifier hs-type">TyFamInstDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-781"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyFamInstDecl"><span class="hs-identifier hs-type">TyFamInstDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-782"></a><a name="rnTyFamInstDecl"><a href="RnSource.html#rnTyFamInstDecl"><span class="hs-identifier">rnTyFamInstDecl</span></a></a><span> </span><a name="local-1628204513"><a href="#local-1628204513"><span class="hs-identifier">mb_cls</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyFamInstDecl"><span class="hs-identifier hs-var">TyFamInstDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tfid_eqn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204514"><a href="#local-1628204514"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204515"><a href="#local-1628204515"><span class="hs-identifier">eqn</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-783"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204516"><a href="#local-1628204516"><span class="hs-identifier">eqn'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204517"><a href="#local-1628204517"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnTyFamInstEqn"><span class="hs-identifier hs-var">rnTyFamInstEqn</span></a><span> </span><a href="#local-1628204513"><span class="hs-identifier hs-var">mb_cls</span></a><span> </span><a href="#local-1628204515"><span class="hs-identifier hs-var">eqn</span></a><span>
</span><a name="line-784"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyFamInstDecl"><span class="hs-identifier hs-var">TyFamInstDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tfid_eqn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628204514"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-1628204516"><span class="hs-identifier hs-var">eqn'</span></a><span>
</span><a name="line-785"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tfid_fvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204517"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="#local-1628204517"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-786"></a><span>
</span><a name="line-787"></a><span class="hs-identifier">rnTyFamInstEqn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-788"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#TyFamInstEqn"><span class="hs-identifier hs-type">TyFamInstEqn</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-789"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyFamInstEqn"><span class="hs-identifier hs-type">TyFamInstEqn</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-790"></a><a name="rnTyFamInstEqn"><a href="RnSource.html#rnTyFamInstEqn"><span class="hs-identifier">rnTyFamInstEqn</span></a></a><span> </span><a name="local-1628204518"><a href="#local-1628204518"><span class="hs-identifier">mb_cls</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyFamEqn"><span class="hs-identifier hs-var">TyFamEqn</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tfe_tycon</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204519"><a href="#local-1628204519"><span class="hs-identifier">tycon</span></a></a><span>
</span><a name="line-791"></a><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tfe_pats</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204520"><a href="#local-1628204520"><span class="hs-identifier">pats</span></a></a><span>
</span><a name="line-792"></a><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tfe_rhs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204521"><a href="#local-1628204521"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-793"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204522"><a href="#local-1628204522"><span class="hs-identifier">tycon'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204523"><a href="#local-1628204523"><span class="hs-identifier">pats'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204524"><a href="#local-1628204524"><span class="hs-identifier">rhs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204525"><a href="#local-1628204525"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-794"></a><span>           </span><a href="RnSource.html#rnFamInstDecl"><span class="hs-identifier hs-var">rnFamInstDecl</span></a><span> </span><span class="hs-special">(</span><a href="RnEnv.html#TySynCtx"><span class="hs-identifier hs-var">TySynCtx</span></a><span> </span><a href="#local-1628204519"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204518"><span class="hs-identifier hs-var">mb_cls</span></a><span> </span><a href="#local-1628204519"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="#local-1628204520"><span class="hs-identifier hs-var">pats</span></a><span> </span><a href="#local-1628204521"><span class="hs-identifier hs-var">rhs</span></a><span> </span><a href="RnSource.html#rnTySyn"><span class="hs-identifier hs-var">rnTySyn</span></a><span>
</span><a name="line-795"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyFamEqn"><span class="hs-identifier hs-var">TyFamEqn</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tfe_tycon</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204522"><span class="hs-identifier hs-var">tycon'</span></a><span>
</span><a name="line-796"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tfe_pats</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204523"><span class="hs-identifier hs-var">pats'</span></a><span>
</span><a name="line-797"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tfe_rhs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204524"><span class="hs-identifier hs-var">rhs'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="#local-1628204525"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-798"></a><span>
</span><a name="line-799"></a><span class="hs-identifier">rnTyFamDefltEqn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-800"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#TyFamDefltEqn"><span class="hs-identifier hs-type">TyFamDefltEqn</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-801"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyFamDefltEqn"><span class="hs-identifier hs-type">TyFamDefltEqn</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-802"></a><a name="rnTyFamDefltEqn"><a href="RnSource.html#rnTyFamDefltEqn"><span class="hs-identifier">rnTyFamDefltEqn</span></a></a><span> </span><a name="local-1628204526"><a href="#local-1628204526"><span class="hs-identifier">cls</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyFamEqn"><span class="hs-identifier hs-var">TyFamEqn</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tfe_tycon</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204527"><a href="#local-1628204527"><span class="hs-identifier">tycon</span></a></a><span>
</span><a name="line-803"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tfe_pats</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204528"><a href="#local-1628204528"><span class="hs-identifier">tyvars</span></a></a><span>
</span><a name="line-804"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tfe_rhs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204529"><a href="#local-1628204529"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-805"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#bindHsQTyVars"><span class="hs-identifier hs-var">bindHsQTyVars</span></a><span> </span><a href="#local-1628204530"><span class="hs-identifier hs-var">ctx</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628204526"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-1628204528"><span class="hs-identifier hs-var">tyvars</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628204531"><a href="#local-1628204531"><span class="hs-identifier">tyvars'</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-806"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204532"><a href="#local-1628204532"><span class="hs-identifier">tycon'</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupFamInstName"><span class="hs-identifier hs-var">lookupFamInstName</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628204526"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204527"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-807"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204533"><a href="#local-1628204533"><span class="hs-identifier">rhs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204534"><a href="#local-1628204534"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsType"><span class="hs-identifier hs-var">rnLHsType</span></a><span> </span><a href="#local-1628204530"><span class="hs-identifier hs-var">ctx</span></a><span> </span><a href="#local-1628204529"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-808"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyFamEqn"><span class="hs-identifier hs-var">TyFamEqn</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tfe_tycon</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204532"><span class="hs-identifier hs-var">tycon'</span></a><span>
</span><a name="line-809"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tfe_pats</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204531"><span class="hs-identifier hs-var">tyvars'</span></a><span>
</span><a name="line-810"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tfe_rhs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204533"><span class="hs-identifier hs-var">rhs'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="#local-1628204534"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-811"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-812"></a><span>    </span><a name="local-1628204530"><a href="#local-1628204530"><span class="hs-identifier">ctx</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnEnv.html#TyFamilyCtx"><span class="hs-identifier hs-var">TyFamilyCtx</span></a><span> </span><a href="#local-1628204527"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-813"></a><span>
</span><a name="line-814"></a><span class="hs-identifier">rnDataFamInstDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-815"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#DataFamInstDecl"><span class="hs-identifier hs-type">DataFamInstDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-816"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DataFamInstDecl"><span class="hs-identifier hs-type">DataFamInstDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-817"></a><a name="rnDataFamInstDecl"><a href="RnSource.html#rnDataFamInstDecl"><span class="hs-identifier">rnDataFamInstDecl</span></a></a><span> </span><a name="local-1628204535"><a href="#local-1628204535"><span class="hs-identifier">mb_cls</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DataFamInstDecl"><span class="hs-identifier hs-var">DataFamInstDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dfid_tycon</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204536"><a href="#local-1628204536"><span class="hs-identifier">tycon</span></a></a><span>
</span><a name="line-818"></a><span>                                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dfid_pats</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204537"><a href="#local-1628204537"><span class="hs-identifier">pats</span></a></a><span>
</span><a name="line-819"></a><span>                                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dfid_defn</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204538"><a href="#local-1628204538"><span class="hs-identifier">defn</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-820"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204539"><a href="#local-1628204539"><span class="hs-identifier">tycon'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204540"><a href="#local-1628204540"><span class="hs-identifier">pats'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-1628204541"><a href="#local-1628204541"><span class="hs-identifier">defn'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1628204542"><a href="#local-1628204542"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-821"></a><span>           </span><a href="RnSource.html#rnFamInstDecl"><span class="hs-identifier hs-var">rnFamInstDecl</span></a><span> </span><span class="hs-special">(</span><a href="RnEnv.html#TyDataCtx"><span class="hs-identifier hs-var">TyDataCtx</span></a><span> </span><a href="#local-1628204536"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204535"><span class="hs-identifier hs-var">mb_cls</span></a><span> </span><a href="#local-1628204536"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="#local-1628204537"><span class="hs-identifier hs-var">pats</span></a><span> </span><a href="#local-1628204538"><span class="hs-identifier hs-var">defn</span></a><span> </span><a href="RnSource.html#rnDataDefn"><span class="hs-identifier hs-var">rnDataDefn</span></a><span>
</span><a name="line-822"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DataFamInstDecl"><span class="hs-identifier hs-var">DataFamInstDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dfid_tycon</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204539"><span class="hs-identifier hs-var">tycon'</span></a><span>
</span><a name="line-823"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dfid_pats</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204540"><span class="hs-identifier hs-var">pats'</span></a><span>
</span><a name="line-824"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dfid_defn</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204541"><span class="hs-identifier hs-var">defn'</span></a><span>
</span><a name="line-825"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dfid_fvs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204542"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="#local-1628204542"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-826"></a><span>
</span><a name="line-827"></a><span class="hs-comment">-- Renaming of the associated types in instances.</span><span>
</span><a name="line-828"></a><span>
</span><a name="line-829"></a><span class="hs-comment">-- Rename associated type family decl in class</span><span>
</span><a name="line-830"></a><span class="hs-identifier">rnATDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>      </span><span class="hs-comment">-- Class</span><span>
</span><a name="line-831"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LFamilyDecl"><span class="hs-identifier hs-type">LFamilyDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span>
</span><a name="line-832"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="HsDecls.html#LFamilyDecl"><span class="hs-identifier hs-type">LFamilyDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-833"></a><a name="rnATDecls"><a href="RnSource.html#rnATDecls"><span class="hs-identifier">rnATDecls</span></a></a><span> </span><a name="local-1628204543"><a href="#local-1628204543"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-1628204544"><a href="#local-1628204544"><span class="hs-identifier">at_decls</span></a></a><span>
</span><a name="line-834"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><span class="hs-special">(</span><a href="RnSource.html#rnFamDecl"><span class="hs-identifier hs-var">rnFamDecl</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628204543"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1628204544"><span class="hs-identifier hs-var">at_decls</span></a><span>
</span><a name="line-835"></a><span>
</span><a name="line-836"></a><span class="hs-identifier">rnATInstDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>    </span><span class="hs-comment">-- The function that renames</span><span>
</span><a name="line-837"></a><span>                  </span><a href="#local-1628204243"><span class="hs-identifier hs-type">decl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>            </span><span class="hs-comment">-- an instance. rnTyFamInstDecl</span><span>
</span><a name="line-838"></a><span>                  </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204243"><span class="hs-identifier hs-type">decl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- or rnDataFamInstDecl</span><span>
</span><a name="line-839"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>      </span><span class="hs-comment">-- Class</span><span>
</span><a name="line-840"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-841"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204243"><span class="hs-identifier hs-type">decl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-842"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204243"><span class="hs-identifier hs-type">decl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-843"></a><span class="hs-comment">-- Used for data and type family defaults in a class decl</span><span>
</span><a name="line-844"></a><span class="hs-comment">-- and the family instance declarations in an instance</span><span>
</span><a name="line-845"></a><span class="hs-comment">--</span><span>
</span><a name="line-846"></a><span class="hs-comment">-- NB: We allow duplicate associated-type decls;</span><span>
</span><a name="line-847"></a><span class="hs-comment">--     See Note [Associated type instances] in TcInstDcls</span><span>
</span><a name="line-848"></a><a name="rnATInstDecls"><a href="RnSource.html#rnATInstDecls"><span class="hs-identifier">rnATInstDecls</span></a></a><span> </span><a name="local-1628204545"><a href="#local-1628204545"><span class="hs-identifier">rnFun</span></a></a><span> </span><a name="local-1628204546"><a href="#local-1628204546"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-1628204547"><a href="#local-1628204547"><span class="hs-identifier">tv_ns</span></a></a><span> </span><a name="local-1628204548"><a href="#local-1628204548"><span class="hs-identifier">at_insts</span></a></a><span>
</span><a name="line-849"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204545"><span class="hs-identifier hs-var">rnFun</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204546"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204547"><span class="hs-identifier hs-var">tv_ns</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1628204548"><span class="hs-identifier hs-var">at_insts</span></a><span>
</span><a name="line-850"></a><span>    </span><span class="hs-comment">-- See Note [Renaming associated types]</span><span>
</span><a name="line-851"></a><span>
</span><a name="line-852"></a><span class="hs-comment">{- Note [Wildcards in family instances]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Wild cards can be used in type/data family instance declarations to indicate
that the name of a type variable doesn't matter. Each wild card will be
replaced with a new unique type variable. For instance:

    type family F a b :: *
    type instance F Int _ = Int

is the same as

    type family F a b :: *
    type instance F Int b = Int

This is implemented as follows: during renaming anonymous wild cards
'_' are given freshly generated names. These names are collected after
renaming (rnFamInstDecl) and used to make new type variables during
type checking (tc_fam_ty_pats). One should not confuse these wild
cards with the ones from partial type signatures. The latter generate
fresh meta-variables whereas the former generate fresh skolems.

Note [Unused type variables in family instances]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When the flag -fwarn-unused-type-patterns is on, the compiler reports warnings
about unused type variables. (rnFamInstDecl) A type variable is considered
used
 * when it is either occurs on the RHS of the family instance, or
   e.g.   type instance F a b = a    -- a is used on the RHS

 * it occurs multiple times in the patterns on the LHS
   e.g.   type instance F a a = Int  -- a appears more than once on LHS

As usual, the warnings are not reported for for type variables with names
beginning with an underscore.

Extra-constraints wild cards are not supported in type/data family
instance declarations.

Relevant tickets: #3699, #10586, #10982 and #11451.

Note [Renaming associated types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Check that the RHS of the decl mentions only type variables
bound on the LHS.  For example, this is not ok
   class C a b where
      type F a x :: *
   instance C (p,q) r where
      type F (p,q) x = (x, r)   -- BAD: mentions 'r'
c.f. Trac #5515

The same thing applies to kind variables, of course (Trac #7938, #9574):
   class Funct f where
      type Codomain f :: *
   instance Funct ('KProxy :: KProxy o) where
      type Codomain 'KProxy = NatTr (Proxy :: o -&gt; *)
Here 'o' is mentioned on the RHS of the Codomain function, but
not on the LHS.

All this applies only for *instance* declarations.  In *class*
declarations there is no RHS to worry about, and the class variables
can all be in scope (Trac #5862):
    class Category (x :: k -&gt; k -&gt; *) where
      type Ob x :: k -&gt; Constraint
      id :: Ob x a =&gt; x a a
      (.) :: (Ob x a, Ob x b, Ob x c) =&gt; x b c -&gt; x a b -&gt; x a c
Here 'k' is in scope in the kind signature, just like 'x'.
-}</span><span>
</span><a name="line-919"></a><span>
</span><a name="line-920"></a><span>
</span><a name="line-921"></a><span class="hs-comment">{-
*********************************************************
*                                                      *
\subsection{Stand-alone deriving declarations}
*                                                      *
*********************************************************
-}</span><span>
</span><a name="line-928"></a><span>
</span><a name="line-929"></a><span class="hs-identifier">rnSrcDerivDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#DerivDecl"><span class="hs-identifier hs-type">DerivDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DerivDecl"><span class="hs-identifier hs-type">DerivDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-930"></a><a name="rnSrcDerivDecl"><a href="RnSource.html#rnSrcDerivDecl"><span class="hs-identifier">rnSrcDerivDecl</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DerivDecl"><span class="hs-identifier hs-var">DerivDecl</span></a><span> </span><a name="local-1628204549"><a href="#local-1628204549"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-1628204550"><a href="#local-1628204550"><span class="hs-identifier">overlap</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-931"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204551"><a href="#local-1628204551"><span class="hs-identifier">standalone_deriv_ok</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html#StandaloneDeriving"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">StandaloneDeriving</span></a><span>
</span><a name="line-932"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><a href="#local-1628204551"><span class="hs-identifier hs-var">standalone_deriv_ok</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><a href="RnSource.html#standaloneDerivErr"><span class="hs-identifier hs-var">standaloneDerivErr</span></a><span class="hs-special">)</span><span>
</span><a name="line-933"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204552"><a href="#local-1628204552"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204553"><a href="#local-1628204553"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsInstType"><span class="hs-identifier hs-var">rnLHsInstType</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;In a deriving declaration&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628204549"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-934"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DerivDecl"><span class="hs-identifier hs-var">DerivDecl</span></a><span> </span><a href="#local-1628204552"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-1628204550"><span class="hs-identifier hs-var">overlap</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204553"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-935"></a><span>
</span><a name="line-936"></a><span class="hs-identifier">standaloneDerivErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-937"></a><a name="standaloneDerivErr"><a href="RnSource.html#standaloneDerivErr"><span class="hs-identifier">standaloneDerivErr</span></a></a><span>
</span><a name="line-938"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Illegal standalone deriving declaration&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-939"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Use StandaloneDeriving to enable this extension&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-940"></a><span>
</span><a name="line-941"></a><span class="hs-comment">{-
*********************************************************
*                                                      *
\subsection{Rules}
*                                                      *
*********************************************************
-}</span><span>
</span><a name="line-948"></a><span>
</span><a name="line-949"></a><span class="hs-identifier">rnHsRuleDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#RuleDecls"><span class="hs-identifier hs-type">RuleDecls</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#RuleDecls"><span class="hs-identifier hs-type">RuleDecls</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-950"></a><a name="rnHsRuleDecls"><a href="RnSource.html#rnHsRuleDecls"><span class="hs-identifier">rnHsRuleDecls</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsRules"><span class="hs-identifier hs-var">HsRules</span></a><span> </span><a name="local-1628204554"><a href="#local-1628204554"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-1628204555"><a href="#local-1628204555"><span class="hs-identifier">rules</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-951"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204556"><a href="#local-1628204556"><span class="hs-identifier">rn_rules</span></a></a><span class="hs-special">,</span><a name="local-1628204557"><a href="#local-1628204557"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><a href="RnSource.html#rnHsRuleDecl"><span class="hs-identifier hs-var">rnHsRuleDecl</span></a><span> </span><a href="#local-1628204555"><span class="hs-identifier hs-var">rules</span></a><span>
</span><a name="line-952"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsRules"><span class="hs-identifier hs-var">HsRules</span></a><span> </span><a href="#local-1628204554"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-1628204556"><span class="hs-identifier hs-var">rn_rules</span></a><span class="hs-special">,</span><a href="#local-1628204557"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-953"></a><span>
</span><a name="line-954"></a><span class="hs-identifier">rnHsRuleDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#RuleDecl"><span class="hs-identifier hs-type">RuleDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#RuleDecl"><span class="hs-identifier hs-type">RuleDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-955"></a><a name="rnHsRuleDecl"><a href="RnSource.html#rnHsRuleDecl"><span class="hs-identifier">rnHsRuleDecl</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsRule"><span class="hs-identifier hs-var">HsRule</span></a><span> </span><a name="local-1628204558"><a href="#local-1628204558"><span class="hs-identifier">rule_name</span></a></a><span> </span><a name="local-1628204559"><a href="#local-1628204559"><span class="hs-identifier">act</span></a></a><span> </span><a name="local-1628204560"><a href="#local-1628204560"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-1628204561"><a href="#local-1628204561"><span class="hs-identifier">lhs</span></a></a><span> </span><a name="local-1628204562"><a href="#local-1628204562"><span class="hs-identifier">_fv_lhs</span></a></a><span> </span><a name="local-1628204563"><a href="#local-1628204563"><span class="hs-identifier">rhs</span></a></a><span> </span><a name="local-1628204564"><a href="#local-1628204564"><span class="hs-identifier">_fv_rhs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-956"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204568"><a href="#local-1628204568"><span class="hs-identifier">rdr_names_w_loc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1628204565"><span class="hs-identifier hs-var">get_var</span></a><span> </span><a href="#local-1628204560"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-957"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnEnv.html#checkDupRdrNames"><span class="hs-identifier hs-var">checkDupRdrNames</span></a><span> </span><a href="#local-1628204568"><span class="hs-identifier hs-var">rdr_names_w_loc</span></a><span>
</span><a name="line-958"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnEnv.html#checkShadowedRdrNames"><span class="hs-identifier hs-var">checkShadowedRdrNames</span></a><span> </span><a href="#local-1628204568"><span class="hs-identifier hs-var">rdr_names_w_loc</span></a><span>
</span><a name="line-959"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204569"><a href="#local-1628204569"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#newLocalBndrsRn"><span class="hs-identifier hs-var">newLocalBndrsRn</span></a><span> </span><a href="#local-1628204568"><span class="hs-identifier hs-var">rdr_names_w_loc</span></a><span>
</span><a name="line-960"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnSource.html#bindHsRuleVars"><span class="hs-identifier hs-var">bindHsRuleVars</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628204558"><span class="hs-identifier hs-var">rule_name</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204560"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="#local-1628204569"><span class="hs-identifier hs-var">names</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628204570"><a href="#local-1628204570"><span class="hs-identifier">vars'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-961"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204571"><a href="#local-1628204571"><span class="hs-identifier">lhs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204572"><a href="#local-1628204572"><span class="hs-identifier">fv_lhs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnExpr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a><span> </span><a href="#local-1628204561"><span class="hs-identifier hs-var">lhs</span></a><span>
</span><a name="line-962"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204573"><a href="#local-1628204573"><span class="hs-identifier">rhs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204574"><a href="#local-1628204574"><span class="hs-identifier">fv_rhs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnExpr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a><span> </span><a href="#local-1628204563"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-963"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnSource.html#checkValidRule"><span class="hs-identifier hs-var">checkValidRule</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628204558"><span class="hs-identifier hs-var">rule_name</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204569"><span class="hs-identifier hs-var">names</span></a><span> </span><a href="#local-1628204571"><span class="hs-identifier hs-var">lhs'</span></a><span> </span><a href="#local-1628204572"><span class="hs-identifier hs-var">fv_lhs'</span></a><span>
</span><a name="line-964"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsRule"><span class="hs-identifier hs-var">HsRule</span></a><span> </span><a href="#local-1628204558"><span class="hs-identifier hs-var">rule_name</span></a><span> </span><a href="#local-1628204559"><span class="hs-identifier hs-var">act</span></a><span> </span><a href="#local-1628204570"><span class="hs-identifier hs-var">vars'</span></a><span> </span><a href="#local-1628204571"><span class="hs-identifier hs-var">lhs'</span></a><span> </span><a href="#local-1628204572"><span class="hs-identifier hs-var">fv_lhs'</span></a><span> </span><a href="#local-1628204573"><span class="hs-identifier hs-var">rhs'</span></a><span> </span><a href="#local-1628204574"><span class="hs-identifier hs-var">fv_rhs'</span></a><span class="hs-special">,</span><span>
</span><a name="line-965"></a><span>                 </span><a href="#local-1628204572"><span class="hs-identifier hs-var">fv_lhs'</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204574"><span class="hs-identifier hs-var">fv_rhs'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-966"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-967"></a><span>    </span><a name="local-1628204565"><a href="#local-1628204565"><span class="hs-identifier">get_var</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#RuleBndrSig"><span class="hs-identifier hs-var">RuleBndrSig</span></a><span> </span><a name="local-1628204566"><a href="#local-1628204566"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204566"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-968"></a><span>    </span><span class="hs-identifier">get_var</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#RuleBndr"><span class="hs-identifier hs-var">RuleBndr</span></a><span> </span><a name="local-1628204567"><a href="#local-1628204567"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204567"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-969"></a><span>
</span><a name="line-970"></a><span class="hs-identifier">bindHsRuleVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#RuleName"><span class="hs-identifier hs-type">RuleName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LRuleBndr"><span class="hs-identifier hs-type">LRuleBndr</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-971"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="HsDecls.html#LRuleBndr"><span class="hs-identifier hs-type">LRuleBndr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204242"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-972"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204242"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-973"></a><a name="bindHsRuleVars"><a href="RnSource.html#bindHsRuleVars"><span class="hs-identifier">bindHsRuleVars</span></a></a><span> </span><a name="local-1628204575"><a href="#local-1628204575"><span class="hs-identifier">rule_name</span></a></a><span> </span><a name="local-1628204576"><a href="#local-1628204576"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-1628204577"><a href="#local-1628204577"><span class="hs-identifier">names</span></a></a><span> </span><a name="local-1628204578"><a href="#local-1628204578"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-974"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204580"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1628204576"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="#local-1628204577"><span class="hs-identifier hs-var">names</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628204600"><a href="#local-1628204600"><span class="hs-identifier">vars'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-975"></a><span>    </span><a href="RnEnv.html#bindLocalNamesFV"><span class="hs-identifier hs-var">bindLocalNamesFV</span></a><span> </span><a href="#local-1628204577"><span class="hs-identifier hs-var">names</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204578"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-1628204600"><span class="hs-identifier hs-var">vars'</span></a><span class="hs-special">)</span><span>
</span><a name="line-976"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-977"></a><span>    </span><a name="local-1628204579"><a href="#local-1628204579"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnEnv.html#RuleCtx"><span class="hs-identifier hs-var">RuleCtx</span></a><span> </span><a href="#local-1628204575"><span class="hs-identifier hs-var">rule_name</span></a><span>
</span><a name="line-978"></a><span>
</span><a name="line-979"></a><span>    </span><a name="local-1628204580"><a href="#local-1628204580"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204581"><a href="#local-1628204581"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#RuleBndr"><span class="hs-identifier hs-var">RuleBndr</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204582"><a href="#local-1628204582"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-1628204583"><a href="#local-1628204583"><span class="hs-identifier">vars</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1628204584"><a href="#local-1628204584"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-1628204585"><a href="#local-1628204585"><span class="hs-identifier">ns</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628204586"><a href="#local-1628204586"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-980"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204580"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1628204583"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="#local-1628204585"><span class="hs-identifier hs-var">ns</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628204587"><a href="#local-1628204587"><span class="hs-identifier">vars'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-981"></a><span>        </span><a href="#local-1628204586"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628204581"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#RuleBndr"><span class="hs-identifier hs-var">RuleBndr</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628204582"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-1628204584"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628204587"><span class="hs-identifier hs-var">vars'</span></a><span class="hs-special">)</span><span>
</span><a name="line-982"></a><span>
</span><a name="line-983"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204588"><a href="#local-1628204588"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#RuleBndrSig"><span class="hs-identifier hs-var">RuleBndrSig</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204589"><a href="#local-1628204589"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-1628204590"><a href="#local-1628204590"><span class="hs-identifier">bsig</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-1628204591"><a href="#local-1628204591"><span class="hs-identifier">vars</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1628204592"><a href="#local-1628204592"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-1628204593"><a href="#local-1628204593"><span class="hs-identifier">ns</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628204594"><a href="#local-1628204594"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-984"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#rnHsSigWcTypeScoped"><span class="hs-identifier hs-var">rnHsSigWcTypeScoped</span></a><span> </span><a href="#local-1628204579"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-1628204590"><span class="hs-identifier hs-var">bsig</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628204595"><a href="#local-1628204595"><span class="hs-identifier">bsig'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-985"></a><span>        </span><a href="#local-1628204580"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1628204591"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="#local-1628204593"><span class="hs-identifier hs-var">ns</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628204596"><a href="#local-1628204596"><span class="hs-identifier">vars'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-986"></a><span>        </span><a href="#local-1628204594"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628204588"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#RuleBndrSig"><span class="hs-identifier hs-var">RuleBndrSig</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628204589"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-1628204592"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204595"><span class="hs-identifier hs-var">bsig'</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628204596"><span class="hs-identifier hs-var">vars'</span></a><span class="hs-special">)</span><span>
</span><a name="line-987"></a><span>
</span><a name="line-988"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-1628204597"><a href="#local-1628204597"><span class="hs-identifier">thing_inside</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204597"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-989"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-1628204598"><a href="#local-1628204598"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-1628204599"><a href="#local-1628204599"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;bindRuleVars&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204598"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204599"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">)</span><span>
</span><a name="line-990"></a><span>
</span><a name="line-991"></a><span class="hs-comment">{-
Note [Rule LHS validity checking]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Check the shape of a transformation rule LHS.  Currently we only allow
LHSs of the form @(f e1 .. en)@, where @f@ is not one of the
@forall@'d variables.

We used restrict the form of the 'ei' to prevent you writing rules
with LHSs with a complicated desugaring (and hence unlikely to match);
(e.g. a case expression is not allowed: too elaborate.)

But there are legitimate non-trivial args ei, like sections and
lambdas.  So it seems simmpler not to check at all, and that is why
check_e is commented out.
-}</span><span>
</span><a name="line-1006"></a><span>
</span><a name="line-1007"></a><span class="hs-identifier">checkValidRule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1008"></a><a name="checkValidRule"><a href="RnSource.html#checkValidRule"><span class="hs-identifier">checkValidRule</span></a></a><span> </span><a name="local-1628204601"><a href="#local-1628204601"><span class="hs-identifier">rule_name</span></a></a><span> </span><a name="local-1628204602"><a href="#local-1628204602"><span class="hs-identifier">ids</span></a></a><span> </span><a name="local-1628204603"><a href="#local-1628204603"><span class="hs-identifier">lhs'</span></a></a><span> </span><a name="local-1628204604"><a href="#local-1628204604"><span class="hs-identifier">fv_lhs'</span></a></a><span>
</span><a name="line-1009"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span>       </span><span class="hs-comment">-- Check for the form of the LHS</span><span>
</span><a name="line-1010"></a><span>          </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="RnSource.html#validRuleLhs"><span class="hs-identifier hs-var">validRuleLhs</span></a><span> </span><a href="#local-1628204602"><span class="hs-identifier hs-var">ids</span></a><span> </span><a href="#local-1628204603"><span class="hs-identifier hs-var">lhs'</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1011"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1012"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628204605"><a href="#local-1628204605"><span class="hs-identifier">bad</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a><span> </span><span class="hs-special">(</span><a href="RnSource.html#badRuleLhsErr"><span class="hs-identifier hs-var">badRuleLhsErr</span></a><span> </span><a href="#local-1628204601"><span class="hs-identifier hs-var">rule_name</span></a><span> </span><a href="#local-1628204603"><span class="hs-identifier hs-var">lhs'</span></a><span> </span><a href="#local-1628204605"><span class="hs-identifier hs-var">bad</span></a><span class="hs-special">)</span><span>
</span><a name="line-1013"></a><span>
</span><a name="line-1014"></a><span>                </span><span class="hs-comment">-- Check that LHS vars are all bound</span><span>
</span><a name="line-1015"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204606"><a href="#local-1628204606"><span class="hs-identifier">bad_vars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-1628204607"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1628204607"><a href="#local-1628204607"><span class="hs-identifier">var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204602"><span class="hs-identifier hs-var">ids</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-1628204607"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#elemNameSet"><span class="hs-identifier hs-var">elemNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204604"><span class="hs-identifier hs-var">fv_lhs'</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1016"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="RnSource.html#badRuleVar"><span class="hs-identifier hs-var">badRuleVar</span></a><span> </span><a href="#local-1628204601"><span class="hs-identifier hs-var">rule_name</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204606"><span class="hs-identifier hs-var">bad_vars</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1017"></a><span>
</span><a name="line-1018"></a><span class="hs-identifier">validRuleLhs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1019"></a><span class="hs-comment">-- Nothing =&gt; OK</span><span>
</span><a name="line-1020"></a><span class="hs-comment">-- Just e  =&gt; Not ok, and e is the offending sub-expression</span><span>
</span><a name="line-1021"></a><a name="validRuleLhs"><a href="RnSource.html#validRuleLhs"><span class="hs-identifier">validRuleLhs</span></a></a><span> </span><a name="local-1628204608"><a href="#local-1628204608"><span class="hs-identifier">foralls</span></a></a><span> </span><a name="local-1628204609"><a href="#local-1628204609"><span class="hs-identifier">lhs</span></a></a><span>
</span><a name="line-1022"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204610"><span class="hs-identifier hs-var">checkl</span></a><span> </span><a href="#local-1628204609"><span class="hs-identifier hs-var">lhs</span></a><span>
</span><a name="line-1023"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1024"></a><span>    </span><a name="local-1628204610"><a href="#local-1628204610"><span class="hs-identifier">checkl</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204613"><a href="#local-1628204613"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204611"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-1628204613"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1025"></a><span>
</span><a name="line-1026"></a><span>    </span><a name="local-1628204611"><a href="#local-1628204611"><span class="hs-identifier">check</span></a></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#OpApp"><span class="hs-identifier hs-var">OpApp</span></a><span> </span><a name="local-1628204614"><a href="#local-1628204614"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-1628204615"><a href="#local-1628204615"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204616"><a href="#local-1628204616"><span class="hs-identifier">e2</span></a></a><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204610"><span class="hs-identifier hs-var">checkl</span></a><span> </span><a href="#local-1628204615"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#mplus"><span class="hs-identifier hs-var">mplus</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204612"><span class="hs-identifier hs-var">checkl_e</span></a><span> </span><a href="#local-1628204614"><span class="hs-identifier hs-var">e1</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#mplus"><span class="hs-identifier hs-var">mplus</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204612"><span class="hs-identifier hs-var">checkl_e</span></a><span> </span><a href="#local-1628204616"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-1027"></a><span>    </span><span class="hs-identifier">check</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsApp"><span class="hs-identifier hs-var">HsApp</span></a><span> </span><a name="local-1628204617"><a href="#local-1628204617"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-1628204618"><a href="#local-1628204618"><span class="hs-identifier">e2</span></a></a><span class="hs-special">)</span><span>                   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204610"><span class="hs-identifier hs-var">checkl</span></a><span> </span><a href="#local-1628204617"><span class="hs-identifier hs-var">e1</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#mplus"><span class="hs-identifier hs-var">mplus</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204612"><span class="hs-identifier hs-var">checkl_e</span></a><span> </span><a href="#local-1628204618"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-1028"></a><span>    </span><span class="hs-identifier">check</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsAppType"><span class="hs-identifier hs-var">HsAppType</span></a><span> </span><a name="local-1628204619"><a href="#local-1628204619"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204610"><span class="hs-identifier hs-var">checkl</span></a><span> </span><a href="#local-1628204619"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1029"></a><span>    </span><span class="hs-identifier">check</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204620"><a href="#local-1628204620"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628204620"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#notElem"><span class="hs-identifier hs-var">notElem</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204608"><span class="hs-identifier hs-var">foralls</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1030"></a><span>    </span><span class="hs-identifier">check</span><span> </span><a name="local-1628204621"><a href="#local-1628204621"><span class="hs-identifier">other</span></a></a><span>                           </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628204621"><span class="hs-identifier hs-var">other</span></a><span>  </span><span class="hs-comment">-- Failure</span><span>
</span><a name="line-1031"></a><span>
</span><a name="line-1032"></a><span>        </span><span class="hs-comment">-- Check an argument</span><span>
</span><a name="line-1033"></a><span>    </span><a name="local-1628204612"><a href="#local-1628204612"><span class="hs-identifier">checkl_e</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204622"><a href="#local-1628204622"><span class="hs-identifier">_e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>         </span><span class="hs-comment">-- Was (check_e e); see Note [Rule LHS validity checking]</span><span>
</span><a name="line-1034"></a><span>
</span><a name="line-1035"></a><span class="hs-comment">{-      Commented out; see Note [Rule LHS validity checking] above
    check_e (HsVar v)     = Nothing
    check_e (HsPar e)     = checkl_e e
    check_e (HsLit e)     = Nothing
    check_e (HsOverLit e) = Nothing

    check_e (OpApp e1 op _ e2)   = checkl_e e1 `mplus` checkl_e op `mplus` checkl_e e2
    check_e (HsApp e1 e2)        = checkl_e e1 `mplus` checkl_e e2
    check_e (NegApp e _)         = checkl_e e
    check_e (ExplicitList _ es)  = checkl_es es
    check_e other                = Just other   -- Fails

    checkl_es es = foldr (mplus . checkl_e) Nothing es
-}</span><span>
</span><a name="line-1049"></a><span>
</span><a name="line-1050"></a><span class="hs-identifier">badRuleVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1051"></a><a name="badRuleVar"><a href="RnSource.html#badRuleVar"><span class="hs-identifier">badRuleVar</span></a></a><span> </span><a name="local-1628204623"><a href="#local-1628204623"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-1628204624"><a href="#local-1628204624"><span class="hs-identifier">var</span></a></a><span>
</span><a name="line-1052"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Rule&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#doubleQuotes"><span class="hs-identifier hs-var">doubleQuotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a><span> </span><a href="#local-1628204623"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a><span class="hs-special">,</span><span>
</span><a name="line-1053"></a><span>         </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Forall'd variable&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204624"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1054"></a><span>                </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;does not appear on left hand side&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-1055"></a><span>
</span><a name="line-1056"></a><span class="hs-identifier">badRuleLhsErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsExpr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1057"></a><a name="badRuleLhsErr"><a href="RnSource.html#badRuleLhsErr"><span class="hs-identifier">badRuleLhsErr</span></a></a><span> </span><a name="local-1628204625"><a href="#local-1628204625"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-1628204626"><a href="#local-1628204626"><span class="hs-identifier">lhs</span></a></a><span> </span><a name="local-1628204627"><a href="#local-1628204627"><span class="hs-identifier">bad_e</span></a></a><span>
</span><a name="line-1058"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Rule&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="BasicTypes.html#pprRuleName"><span class="hs-identifier hs-var">pprRuleName</span></a><span> </span><a href="#local-1628204625"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a><span class="hs-special">,</span><span>
</span><a name="line-1059"></a><span>         </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628204628"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">,</span><span>
</span><a name="line-1060"></a><span>                       </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;in left-hand side:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204626"><span class="hs-identifier hs-var">lhs</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1061"></a><span>    </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span>
</span><a name="line-1062"></a><span>    </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;LHS must be of form (f e1 .. en) where f is not forall'd&quot;</span><span>
</span><a name="line-1063"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1064"></a><span>    </span><a name="local-1628204628"><a href="#local-1628204628"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628204627"><span class="hs-identifier hs-var">bad_e</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1065"></a><span>            </span><a href="HsExpr.html#HsUnboundVar"><span class="hs-identifier hs-var">HsUnboundVar</span></a><span> </span><a name="local-1628204629"><a href="#local-1628204629"><span class="hs-identifier">uv</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Not in scope:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204629"><span class="hs-identifier hs-var">uv</span></a><span>
</span><a name="line-1066"></a><span>            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Illegal expression:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204627"><span class="hs-identifier hs-var">bad_e</span></a><span>
</span><a name="line-1067"></a><span>
</span><a name="line-1068"></a><span class="hs-comment">{-
*********************************************************
*                                                      *
\subsection{Vectorisation declarations}
*                                                      *
*********************************************************
-}</span><span>
</span><a name="line-1075"></a><span>
</span><a name="line-1076"></a><span class="hs-identifier">rnHsVectDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#VectDecl"><span class="hs-identifier hs-type">VectDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#VectDecl"><span class="hs-identifier hs-type">VectDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1077"></a><span class="hs-comment">-- FIXME: For the moment, the right-hand side is restricted to be a variable as we cannot properly</span><span>
</span><a name="line-1078"></a><span class="hs-comment">--        typecheck a complex right-hand side without invoking 'vectType' from the vectoriser.</span><span>
</span><a name="line-1079"></a><a name="rnHsVectDecl"><a href="RnSource.html#rnHsVectDecl"><span class="hs-identifier">rnHsVectDecl</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVect"><span class="hs-identifier hs-var">HsVect</span></a><span> </span><a name="local-1628204630"><a href="#local-1628204630"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1628204631"><a href="#local-1628204631"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-1628204632"><a href="#local-1628204632"><span class="hs-identifier">rhs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1080"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204633"><a href="#local-1628204633"><span class="hs-identifier">var'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedOccRn"><span class="hs-identifier hs-var">lookupLocatedOccRn</span></a><span> </span><a href="#local-1628204631"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-1081"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204634"><a href="#local-1628204634"><span class="hs-identifier">rhs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204635"><a href="#local-1628204635"><span class="hs-identifier">fv_rhs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnExpr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a><span> </span><a href="#local-1628204632"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1082"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVect"><span class="hs-identifier hs-var">HsVect</span></a><span> </span><a href="#local-1628204630"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-1628204633"><span class="hs-identifier hs-var">var'</span></a><span> </span><a href="#local-1628204634"><span class="hs-identifier hs-var">rhs'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204635"><span class="hs-identifier hs-var">fv_rhs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#addOneFV"><span class="hs-identifier hs-var">addOneFV</span></a><span class="hs-special">`</span><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628204633"><span class="hs-identifier hs-var">var'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1083"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-1084"></a><span class="hs-identifier">rnHsVectDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVect"><span class="hs-identifier hs-var">HsVect</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204636"><a href="#local-1628204636"><span class="hs-identifier">_var</span></a></a><span> </span><a name="local-1628204637"><a href="#local-1628204637"><span class="hs-identifier">_rhs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1085"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span>
</span><a name="line-1086"></a><span>               </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;IMPLEMENTATION RESTRICTION: right-hand side of a VECTORISE pragma&quot;</span><span>
</span><a name="line-1087"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;must be an identifier&quot;</span><span>
</span><a name="line-1088"></a><span>               </span><span class="hs-special">]</span><span>
</span><a name="line-1089"></a><span class="hs-identifier">rnHsVectDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsNoVect"><span class="hs-identifier hs-var">HsNoVect</span></a><span> </span><a name="local-1628204638"><a href="#local-1628204638"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1628204639"><a href="#local-1628204639"><span class="hs-identifier">var</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1090"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204640"><a href="#local-1628204640"><span class="hs-identifier">var'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedTopBndrRn"><span class="hs-identifier hs-var">lookupLocatedTopBndrRn</span></a><span> </span><a href="#local-1628204639"><span class="hs-identifier hs-var">var</span></a><span>           </span><span class="hs-comment">-- only applies to local (not imported) names</span><span>
</span><a name="line-1091"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsNoVect"><span class="hs-identifier hs-var">HsNoVect</span></a><span> </span><a href="#local-1628204638"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-1628204640"><span class="hs-identifier hs-var">var'</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#unitFV"><span class="hs-identifier hs-var">unitFV</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628204640"><span class="hs-identifier hs-var">var'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1092"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-1093"></a><span class="hs-identifier">rnHsVectDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectTypeIn"><span class="hs-identifier hs-var">HsVectTypeIn</span></a><span> </span><a name="local-1628204641"><a href="#local-1628204641"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1628204642"><a href="#local-1628204642"><span class="hs-identifier">isScalar</span></a></a><span> </span><a name="local-1628204643"><a href="#local-1628204643"><span class="hs-identifier">tycon</span></a></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span>
</span><a name="line-1094"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204644"><a href="#local-1628204644"><span class="hs-identifier">tycon'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedOccRn"><span class="hs-identifier hs-var">lookupLocatedOccRn</span></a><span> </span><a href="#local-1628204643"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1095"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectTypeIn"><span class="hs-identifier hs-var">HsVectTypeIn</span></a><span> </span><a href="#local-1628204641"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-1628204642"><span class="hs-identifier hs-var">isScalar</span></a><span> </span><a href="#local-1628204644"><span class="hs-identifier hs-var">tycon'</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#unitFV"><span class="hs-identifier hs-var">unitFV</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628204644"><span class="hs-identifier hs-var">tycon'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1096"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-1097"></a><span class="hs-identifier">rnHsVectDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectTypeIn"><span class="hs-identifier hs-var">HsVectTypeIn</span></a><span> </span><a name="local-1628204645"><a href="#local-1628204645"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1628204646"><a href="#local-1628204646"><span class="hs-identifier">isScalar</span></a></a><span> </span><a name="local-1628204647"><a href="#local-1628204647"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628204648"><a href="#local-1628204648"><span class="hs-identifier">rhs_tycon</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1098"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204649"><a href="#local-1628204649"><span class="hs-identifier">tycon'</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedOccRn"><span class="hs-identifier hs-var">lookupLocatedOccRn</span></a><span> </span><a href="#local-1628204647"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1099"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204650"><a href="#local-1628204650"><span class="hs-identifier">rhs_tycon'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedOccRn"><span class="hs-identifier hs-var">lookupLocatedOccRn</span></a><span> </span><a href="#local-1628204648"><span class="hs-identifier hs-var">rhs_tycon</span></a><span>
</span><a name="line-1100"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="HsDecls.html#HsVectTypeIn"><span class="hs-identifier hs-var">HsVectTypeIn</span></a><span> </span><a href="#local-1628204645"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-1628204646"><span class="hs-identifier hs-var">isScalar</span></a><span> </span><a href="#local-1628204649"><span class="hs-identifier hs-var">tycon'</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628204650"><span class="hs-identifier hs-var">rhs_tycon'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1101"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="NameSet.html#mkFVs"><span class="hs-identifier hs-var">mkFVs</span></a><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628204649"><span class="hs-identifier hs-var">tycon'</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628204650"><span class="hs-identifier hs-var">rhs_tycon'</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1102"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-1103"></a><span class="hs-identifier">rnHsVectDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectTypeOut"><span class="hs-identifier hs-var">HsVectTypeOut</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1104"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;RnSource.rnHsVectDecl: Unexpected 'HsVectTypeOut'&quot;</span><span>
</span><a name="line-1105"></a><span class="hs-identifier">rnHsVectDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectClassIn"><span class="hs-identifier hs-var">HsVectClassIn</span></a><span> </span><a name="local-1628204651"><a href="#local-1628204651"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1628204652"><a href="#local-1628204652"><span class="hs-identifier">cls</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1106"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204653"><a href="#local-1628204653"><span class="hs-identifier">cls'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedOccRn"><span class="hs-identifier hs-var">lookupLocatedOccRn</span></a><span> </span><a href="#local-1628204652"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-1107"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectClassIn"><span class="hs-identifier hs-var">HsVectClassIn</span></a><span> </span><a href="#local-1628204651"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-1628204653"><span class="hs-identifier hs-var">cls'</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#unitFV"><span class="hs-identifier hs-var">unitFV</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628204653"><span class="hs-identifier hs-var">cls'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1108"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-1109"></a><span class="hs-identifier">rnHsVectDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectClassOut"><span class="hs-identifier hs-var">HsVectClassOut</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1110"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;RnSource.rnHsVectDecl: Unexpected 'HsVectClassOut'&quot;</span><span>
</span><a name="line-1111"></a><span class="hs-identifier">rnHsVectDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectInstIn"><span class="hs-identifier hs-var">HsVectInstIn</span></a><span> </span><a name="local-1628204654"><a href="#local-1628204654"><span class="hs-identifier">instTy</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1112"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204655"><a href="#local-1628204655"><span class="hs-identifier">instTy'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204656"><a href="#local-1628204656"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsInstType"><span class="hs-identifier hs-var">rnLHsInstType</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a VECTORISE pragma&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628204654"><span class="hs-identifier hs-var">instTy</span></a><span>
</span><a name="line-1113"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectInstIn"><span class="hs-identifier hs-var">HsVectInstIn</span></a><span> </span><a href="#local-1628204655"><span class="hs-identifier hs-var">instTy'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204656"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1114"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-1115"></a><span class="hs-identifier">rnHsVectDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectInstOut"><span class="hs-identifier hs-var">HsVectInstOut</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1116"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;RnSource.rnHsVectDecl: Unexpected 'HsVectInstOut'&quot;</span><span>
</span><a name="line-1117"></a><span>
</span><a name="line-1118"></a><span class="hs-comment">{-
*********************************************************
*                                                      *
\subsection{Type, class and iface sig declarations}
*                                                      *
*********************************************************

@rnTyDecl@ uses the `global name function' to create a new type
declaration in which local names have been replaced by their original
names, reporting any unknown names.

Renaming type variables is a pain. Because they now contain uniques,
it is necessary to pass in an association list which maps a parsed
tyvar to its @Name@ representation.
In some cases (type signatures of values),
it is even necessary to go over the type first
in order to get the set of tyvars used by it, make an assoc list,
and then go over it again to rename the tyvars!
However, we can also do some scoping checks at the same time.


Note [Extra dependencies from .hs-boot files]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider the following case:

A.hs-boot
  module A where
    data A1

B.hs
  module B where
    import {-# SOURCE #-} A
    type DisguisedA1 = A1
    data B1 = B1 DisguisedA1

A.hs
  module A where
    import B
    data A2 = A2 A1
    data A1 = A1 B1

Here A1 is really recursive (via B1), but we won't see that easily when
doing dependency analysis when compiling A.hs

To handle this problem, we add a dependency
  - from every local declaration
  - to everything that comes from this module's .hs-boot file.
In this case, we'll ad and edges
  - from A2 to A1 (but that edge is there already)
  - from A1 to A1 (which is new)

Well, not quite *every* declaration. Imagine module A
above had another datatype declaration:

  data A3 = A3 Int

Even though A3 has a dependency (on Int), all its dependencies are from things
that live on other packages. Since we don't have mutual dependencies across
packages, it is safe not to add the dependencies on the .hs-boot stuff to A2.

Hence function Name.thisPackageImport.

See also Note [Grouping of type and class declarations] in TcTyClsDecls.
-}</span><span>
</span><a name="line-1182"></a><span>
</span><a name="line-1183"></a><span>
</span><a name="line-1184"></a><span class="hs-identifier">rnTyClDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-type">TyClGroup</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span>
</span><a name="line-1185"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-type">TyClGroup</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1186"></a><span class="hs-comment">-- Rename the declarations and do dependency analysis on them</span><span>
</span><a name="line-1187"></a><a name="rnTyClDecls"><a href="RnSource.html#rnTyClDecls"><span class="hs-identifier">rnTyClDecls</span></a></a><span> </span><a name="local-1628204657"><a href="#local-1628204657"><span class="hs-identifier">tycl_ds</span></a></a><span>
</span><a name="line-1188"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204658"><a href="#local-1628204658"><span class="hs-identifier">ds_w_fvs</span></a></a><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocFstM"><span class="hs-identifier hs-var">wrapLocFstM</span></a><span> </span><a href="RnSource.html#rnTyClDecl"><span class="hs-identifier hs-var">rnTyClDecl</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#tyClGroupConcat"><span class="hs-identifier hs-var">tyClGroupConcat</span></a><span> </span><a href="#local-1628204657"><span class="hs-identifier hs-var">tycl_ds</span></a><span class="hs-special">)</span><span>
</span><a name="line-1189"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204659"><a href="#local-1628204659"><span class="hs-identifier">decl_names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#tcdName"><span class="hs-identifier hs-var">tcdName</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204658"><span class="hs-identifier hs-var">ds_w_fvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1190"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204660"><a href="#local-1628204660"><span class="hs-identifier">role_annot_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnRoleAnnots"><span class="hs-identifier hs-var">rnRoleAnnots</span></a><span> </span><a href="#local-1628204659"><span class="hs-identifier hs-var">decl_names</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><span class="hs-identifier">group_roles</span><span> </span><a href="#local-1628204657"><span class="hs-identifier hs-var">tycl_ds</span></a><span class="hs-special">)</span><span>
</span><a name="line-1191"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204661"><a href="#local-1628204661"><span class="hs-identifier">tcg_env</span></a></a><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-1192"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204662"><a href="#local-1628204662"><span class="hs-identifier">this_mod</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_mod</span><span> </span><a href="#local-1628204661"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-1193"></a><span>             </span><a name="local-1628204663"><a href="#local-1628204663"><span class="hs-identifier">boot_info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_self_boot</span><span> </span><a href="#local-1628204661"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-1194"></a><span>
</span><a name="line-1195"></a><span>             </span><span class="hs-identifier">add_boot_deps</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="HsDecls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="HsDecls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1196"></a><span>             </span><span class="hs-comment">-- See Note [Extra dependencies from .hs-boot files]</span><span>
</span><a name="line-1197"></a><span>             </span><a name="local-1628204664"><a href="#local-1628204664"><span class="hs-identifier">add_boot_deps</span></a></a><span> </span><a name="local-1628204673"><a href="#local-1628204673"><span class="hs-identifier">ds_w_fvs</span></a></a><span>
</span><a name="line-1198"></a><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628204663"><span class="hs-identifier hs-var">boot_info</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1199"></a><span>                     </span><a href="TcRnTypes.html#SelfBoot"><span class="hs-identifier hs-var">SelfBoot</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sb_tcs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204674"><a href="#local-1628204674"><span class="hs-identifier">tcs</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="NameSet.html#isEmptyNameSet"><span class="hs-identifier hs-var">isEmptyNameSet</span></a><span> </span><a href="#local-1628204674"><span class="hs-identifier hs-var">tcs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1200"></a><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204665"><span class="hs-identifier hs-var">add_one</span></a><span> </span><a href="#local-1628204674"><span class="hs-identifier hs-var">tcs</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204673"><span class="hs-identifier hs-var">ds_w_fvs</span></a><span>
</span><a name="line-1201"></a><span>                     </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628204673"><span class="hs-identifier hs-var">ds_w_fvs</span></a><span>
</span><a name="line-1202"></a><span>
</span><a name="line-1203"></a><span>             </span><span class="hs-identifier">add_one</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1204"></a><span>             </span><a name="local-1628204665"><a href="#local-1628204665"><span class="hs-identifier">add_one</span></a></a><span> </span><a name="local-1628204675"><a href="#local-1628204675"><span class="hs-identifier">tcs</span></a></a><span> </span><a name="local-1628204676"><a href="#local-1628204676"><span class="hs-identifier">pr</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-1628204677"><a href="#local-1628204677"><span class="hs-identifier">decl</span></a></a><span class="hs-special">,</span><a name="local-1628204678"><a href="#local-1628204678"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1205"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628204666"><span class="hs-identifier hs-var">has_local_imports</span></a><span> </span><a href="#local-1628204678"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1628204677"><span class="hs-identifier hs-var">decl</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204678"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204675"><span class="hs-identifier hs-var">tcs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1206"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>             </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204676"><span class="hs-identifier hs-var">pr</span></a><span>
</span><a name="line-1207"></a><span>
</span><a name="line-1208"></a><span>             </span><a name="local-1628204666"><a href="#local-1628204666"><span class="hs-identifier">has_local_imports</span></a></a><span> </span><a name="local-1628204679"><a href="#local-1628204679"><span class="hs-identifier">fvs</span></a></a><span>
</span><a name="line-1209"></a><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#foldNameSet"><span class="hs-identifier hs-var">foldNameSet</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">||</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Name.html#nameIsHomePackageImport"><span class="hs-identifier hs-var">nameIsHomePackageImport</span></a><span> </span><a href="#local-1628204662"><span class="hs-identifier hs-var">this_mod</span></a><span class="hs-special">)</span><span>
</span><a name="line-1210"></a><span>                               </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-1628204679"><span class="hs-identifier hs-var">fvs</span></a><span>
</span><a name="line-1211"></a><span>
</span><a name="line-1212"></a><span>             </span><a name="local-1628204667"><a href="#local-1628204667"><span class="hs-identifier">ds_w_fvs'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204664"><span class="hs-identifier hs-var">add_boot_deps</span></a><span> </span><a href="#local-1628204658"><span class="hs-identifier hs-var">ds_w_fvs</span></a><span>
</span><a name="line-1213"></a><span>
</span><a name="line-1214"></a><span>             </span><span class="hs-identifier">sccs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1215"></a><span>             </span><a name="local-1628204668"><a href="#local-1628204668"><span class="hs-identifier">sccs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#depAnalTyClDecls"><span class="hs-identifier hs-var">depAnalTyClDecls</span></a><span> </span><a href="#local-1628204667"><span class="hs-identifier hs-var">ds_w_fvs'</span></a><span>
</span><a name="line-1216"></a><span>
</span><a name="line-1217"></a><span>             </span><a name="local-1628204669"><a href="#local-1628204669"><span class="hs-identifier">all_fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><span class="hs-special">(</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span class="hs-special">)</span><span> </span><a href="NameSet.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a><span> </span><a href="#local-1628204667"><span class="hs-identifier hs-var">ds_w_fvs'</span></a><span>
</span><a name="line-1218"></a><span>
</span><a name="line-1219"></a><span>             </span><a name="local-1628204670"><a href="#local-1628204670"><span class="hs-identifier">raw_groups</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Graph.html#flattenSCC"><span class="hs-identifier hs-var">flattenSCC</span></a><span> </span><a href="#local-1628204668"><span class="hs-identifier hs-var">sccs</span></a><span>
</span><a name="line-1220"></a><span>             </span><span class="hs-comment">-- See Note [Role annotations in the renamer]</span><span>
</span><a name="line-1221"></a><span>             </span><span class="hs-special">(</span><a name="local-1628204671"><a href="#local-1628204671"><span class="hs-identifier">groups</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204672"><a href="#local-1628204672"><span class="hs-identifier">orphan_roles</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1222"></a><span>               </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628204680"><a href="#local-1628204680"><span class="hs-identifier">group</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628204681"><a href="#local-1628204681"><span class="hs-identifier">groups_acc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204682"><a href="#local-1628204682"><span class="hs-identifier">orphans_acc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1223"></a><span>                         </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204683"><a href="#local-1628204683"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#tcdName"><span class="hs-identifier hs-var">tcdName</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204680"><span class="hs-identifier hs-var">group</span></a><span>
</span><a name="line-1224"></a><span>                             </span><a name="local-1628204684"><a href="#local-1628204684"><span class="hs-identifier">roles</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a><span> </span><span class="hs-special">(</span><a href="NameEnv.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a><span> </span><a href="#local-1628204682"><span class="hs-identifier hs-var">orphans_acc</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204683"><span class="hs-identifier hs-var">names</span></a><span>
</span><a name="line-1225"></a><span>                             </span><a name="local-1628204685"><a href="#local-1628204685"><span class="hs-identifier">orphans'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#delListFromNameEnv"><span class="hs-identifier hs-var">delListFromNameEnv</span></a><span> </span><a href="#local-1628204682"><span class="hs-identifier hs-var">orphans_acc</span></a><span> </span><a href="#local-1628204683"><span class="hs-identifier hs-var">names</span></a><span>
</span><a name="line-1226"></a><span>                              </span><span class="hs-comment">-- there doesn't seem to be an interface to</span><span>
</span><a name="line-1227"></a><span>                              </span><span class="hs-comment">-- do the above more efficiently</span><span>
</span><a name="line-1228"></a><span>                         </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span> </span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-var">TyClGroup</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">group_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204680"><span class="hs-identifier hs-var">group</span></a><span>
</span><a name="line-1229"></a><span>                                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">group_roles</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204684"><span class="hs-identifier hs-var">roles</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628204681"><span class="hs-identifier hs-var">groups_acc</span></a><span>
</span><a name="line-1230"></a><span>                            </span><span class="hs-special">,</span><span> </span><a href="#local-1628204685"><span class="hs-identifier hs-var">orphans'</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1231"></a><span>                       </span><span class="hs-special">)</span><span>
</span><a name="line-1232"></a><span>                       </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-1628204660"><span class="hs-identifier hs-var">role_annot_env</span></a><span class="hs-special">)</span><span>
</span><a name="line-1233"></a><span>                       </span><a href="#local-1628204670"><span class="hs-identifier hs-var">raw_groups</span></a><span>
</span><a name="line-1234"></a><span>
</span><a name="line-1235"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><a href="RnSource.html#orphanRoleAnnotErr"><span class="hs-identifier hs-var">orphanRoleAnnotErr</span></a><span> </span><span class="hs-special">(</span><a href="NameEnv.html#nameEnvElts"><span class="hs-identifier hs-var">nameEnvElts</span></a><span> </span><a href="#local-1628204672"><span class="hs-identifier hs-var">orphan_roles</span></a><span class="hs-special">)</span><span>
</span><a name="line-1236"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;rnTycl&quot;</span><span>  </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204658"><span class="hs-identifier hs-var">ds_w_fvs</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204668"><span class="hs-identifier hs-var">sccs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1237"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204671"><span class="hs-identifier hs-var">groups</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204669"><span class="hs-identifier hs-var">all_fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1238"></a><span>
</span><a name="line-1239"></a><span class="hs-identifier">rnTyClDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#TyClDecl"><span class="hs-identifier hs-type">TyClDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-1240"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyClDecl"><span class="hs-identifier hs-type">TyClDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1241"></a><span>
</span><a name="line-1242"></a><span class="hs-comment">-- All flavours of type family declarations (&quot;type family&quot;, &quot;newtype family&quot;,</span><span>
</span><a name="line-1243"></a><span class="hs-comment">-- and &quot;data family&quot;), both top level and (for an associated type)</span><span>
</span><a name="line-1244"></a><span class="hs-comment">-- in a class decl</span><span>
</span><a name="line-1245"></a><a name="rnTyClDecl"><a href="RnSource.html#rnTyClDecl"><span class="hs-identifier">rnTyClDecl</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#FamDecl"><span class="hs-identifier hs-var">FamDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcdFam</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204686"><a href="#local-1628204686"><span class="hs-identifier">decl</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1246"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204687"><a href="#local-1628204687"><span class="hs-identifier">decl'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204688"><a href="#local-1628204688"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnFamDecl"><span class="hs-identifier hs-var">rnFamDecl</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-1628204686"><span class="hs-identifier hs-var">decl</span></a><span>
</span><a name="line-1247"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#FamDecl"><span class="hs-identifier hs-var">FamDecl</span></a><span> </span><a href="#local-1628204687"><span class="hs-identifier hs-var">decl'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204688"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1248"></a><span>
</span><a name="line-1249"></a><span class="hs-identifier">rnTyClDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#SynDecl"><span class="hs-identifier hs-var">SynDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcdLName</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204689"><a href="#local-1628204689"><span class="hs-identifier">tycon</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdTyVars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204690"><a href="#local-1628204690"><span class="hs-identifier">tyvars</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdRhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204691"><a href="#local-1628204691"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1250"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204692"><a href="#local-1628204692"><span class="hs-identifier">tycon'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedTopBndrRn"><span class="hs-identifier hs-var">lookupLocatedTopBndrRn</span></a><span> </span><a href="#local-1628204689"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1251"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204693"><a href="#local-1628204693"><span class="hs-identifier">kvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#freeKiTyVarsKindVars"><span class="hs-identifier hs-var">freeKiTyVarsKindVars</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="RnTypes.html#extractHsTyRdrTyVars"><span class="hs-identifier hs-var">extractHsTyRdrTyVars</span></a><span> </span><a href="#local-1628204691"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1252"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204694"><a href="#local-1628204694"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnEnv.html#TySynCtx"><span class="hs-identifier hs-var">TySynCtx</span></a><span> </span><a href="#local-1628204689"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1253"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;rntycl-ty&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204689"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204693"><span class="hs-identifier hs-var">kvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1254"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-1628204698"><a href="#local-1628204698"><span class="hs-identifier">tyvars'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204699"><a href="#local-1628204699"><span class="hs-identifier">rhs'</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1628204700"><a href="#local-1628204700"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#bindHsQTyVars"><span class="hs-identifier hs-var">bindHsQTyVars</span></a><span> </span><a href="#local-1628204694"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-1628204693"><span class="hs-identifier hs-var">kvs</span></a><span> </span><a href="#local-1628204690"><span class="hs-identifier hs-var">tyvars</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1255"></a><span>                                    </span><span class="hs-glyph">\</span><span> </span><a name="local-1628204695"><a href="#local-1628204695"><span class="hs-identifier">tyvars'</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1256"></a><span>                                    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204696"><a href="#local-1628204696"><span class="hs-identifier">rhs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204697"><a href="#local-1628204697"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnTySyn"><span class="hs-identifier hs-var">rnTySyn</span></a><span> </span><a href="#local-1628204694"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-1628204691"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1257"></a><span>                                       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-1628204695"><span class="hs-identifier hs-var">tyvars'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204696"><span class="hs-identifier hs-var">rhs'</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-1628204697"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1258"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#SynDecl"><span class="hs-identifier hs-var">SynDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcdLName</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204692"><span class="hs-identifier hs-var">tycon'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdTyVars</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204698"><span class="hs-identifier hs-var">tyvars'</span></a><span>
</span><a name="line-1259"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdRhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204699"><span class="hs-identifier hs-var">rhs'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdFVs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204700"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="#local-1628204700"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1260"></a><span>
</span><a name="line-1261"></a><span class="hs-comment">-- &quot;data&quot;, &quot;newtype&quot; declarations</span><span>
</span><a name="line-1262"></a><span class="hs-comment">-- both top level and (for an associated type) in an instance decl</span><span>
</span><a name="line-1263"></a><span class="hs-identifier">rnTyClDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DataDecl"><span class="hs-identifier hs-var">DataDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcdLName</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204701"><a href="#local-1628204701"><span class="hs-identifier">tycon</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdTyVars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204702"><a href="#local-1628204702"><span class="hs-identifier">tyvars</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdDataDefn</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204703"><a href="#local-1628204703"><span class="hs-identifier">defn</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1264"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204704"><a href="#local-1628204704"><span class="hs-identifier">tycon'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedTopBndrRn"><span class="hs-identifier hs-var">lookupLocatedTopBndrRn</span></a><span> </span><a href="#local-1628204701"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1265"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204705"><a href="#local-1628204705"><span class="hs-identifier">kvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#extractDataDefnKindVars"><span class="hs-identifier hs-var">extractDataDefnKindVars</span></a><span> </span><a href="#local-1628204703"><span class="hs-identifier hs-var">defn</span></a><span>
</span><a name="line-1266"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204706"><a href="#local-1628204706"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnEnv.html#TyDataCtx"><span class="hs-identifier hs-var">TyDataCtx</span></a><span> </span><a href="#local-1628204701"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1267"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;rntycl-data&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204701"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204705"><span class="hs-identifier hs-var">kvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1268"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-1628204714"><a href="#local-1628204714"><span class="hs-identifier">tyvars'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204715"><a href="#local-1628204715"><span class="hs-identifier">defn'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204716"><a href="#local-1628204716"><span class="hs-identifier">no_kvs</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1628204717"><a href="#local-1628204717"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1269"></a><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#bindHsQTyVars"><span class="hs-identifier hs-var">bindHsQTyVars</span></a><span> </span><a href="#local-1628204706"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-1628204705"><span class="hs-identifier hs-var">kvs</span></a><span> </span><a href="#local-1628204702"><span class="hs-identifier hs-var">tyvars</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628204707"><a href="#local-1628204707"><span class="hs-identifier">tyvars'</span></a></a><span> </span><a name="local-1628204708"><a href="#local-1628204708"><span class="hs-identifier">dep_vars</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1270"></a><span>              </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-1628204709"><a href="#local-1628204709"><span class="hs-identifier">defn'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204710"><a href="#local-1628204710"><span class="hs-identifier">kind_sig_fvs</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1628204711"><a href="#local-1628204711"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnDataDefn"><span class="hs-identifier hs-var">rnDataDefn</span></a><span> </span><a href="#local-1628204706"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-1628204703"><span class="hs-identifier hs-var">defn</span></a><span>
</span><a name="line-1271"></a><span>                 </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204712"><a href="#local-1628204712"><span class="hs-identifier">sig_tvs</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#filterNameSet"><span class="hs-identifier hs-var">filterNameSet</span></a><span> </span><a href="Name.html#isTyVarName"><span class="hs-identifier hs-var">isTyVarName</span></a><span> </span><a href="#local-1628204710"><span class="hs-identifier hs-var">kind_sig_fvs</span></a><span>
</span><a name="line-1272"></a><span>                       </span><a name="local-1628204713"><a href="#local-1628204713"><span class="hs-identifier">unbound_sig_tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204712"><span class="hs-identifier hs-var">sig_tvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#minusNameSet"><span class="hs-identifier hs-var">minusNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204708"><span class="hs-identifier hs-var">dep_vars</span></a><span>
</span><a name="line-1273"></a><span>                 </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-1628204707"><span class="hs-identifier hs-var">tyvars'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204709"><span class="hs-identifier hs-var">defn'</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#isEmptyNameSet"><span class="hs-identifier hs-var">isEmptyNameSet</span></a><span> </span><a href="#local-1628204713"><span class="hs-identifier hs-var">unbound_sig_tvs</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-1628204711"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1274"></a><span>          </span><span class="hs-comment">-- See Note [Complete user-supplied kind signatures] in HsDecls</span><span>
</span><a name="line-1275"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204718"><a href="#local-1628204718"><span class="hs-identifier">typeintype</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html#TypeInType"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">TypeInType</span></a><span>
</span><a name="line-1276"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204719"><a href="#local-1628204719"><span class="hs-identifier">cusk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsTypes.html#hsTvbAllKinded"><span class="hs-identifier hs-var">hsTvbAllKinded</span></a><span> </span><a href="#local-1628204714"><span class="hs-identifier hs-var">tyvars'</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-1277"></a><span>                    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-1628204718"><span class="hs-identifier hs-var">typeintype</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-1628204716"><span class="hs-identifier hs-var">no_kvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1278"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DataDecl"><span class="hs-identifier hs-var">DataDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcdLName</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204704"><span class="hs-identifier hs-var">tycon'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdTyVars</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204714"><span class="hs-identifier hs-var">tyvars'</span></a><span>
</span><a name="line-1279"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdDataDefn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204715"><span class="hs-identifier hs-var">defn'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdDataCusk</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204719"><span class="hs-identifier hs-var">cusk</span></a><span>
</span><a name="line-1280"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdFVs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204717"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="#local-1628204717"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1281"></a><span>
</span><a name="line-1282"></a><span class="hs-identifier">rnTyClDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ClassDecl"><span class="hs-identifier hs-var">ClassDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcdCtxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204720"><a href="#local-1628204720"><span class="hs-identifier">context</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdLName</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204721"><a href="#local-1628204721"><span class="hs-identifier">lcls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1283"></a><span>                        </span><span class="hs-identifier">tcdTyVars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204722"><a href="#local-1628204722"><span class="hs-identifier">tyvars</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdFDs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204723"><a href="#local-1628204723"><span class="hs-identifier">fds</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdSigs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204724"><a href="#local-1628204724"><span class="hs-identifier">sigs</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1284"></a><span>                        </span><span class="hs-identifier">tcdMeths</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204725"><a href="#local-1628204725"><span class="hs-identifier">mbinds</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdATs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204726"><a href="#local-1628204726"><span class="hs-identifier">ats</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdATDefs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204727"><a href="#local-1628204727"><span class="hs-identifier">at_defs</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1285"></a><span>                        </span><span class="hs-identifier">tcdDocs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204728"><a href="#local-1628204728"><span class="hs-identifier">docs</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1286"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1628204730"><a href="#local-1628204730"><span class="hs-identifier">lcls'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedTopBndrRn"><span class="hs-identifier hs-var">lookupLocatedTopBndrRn</span></a><span> </span><a href="#local-1628204721"><span class="hs-identifier hs-var">lcls</span></a><span>
</span><a name="line-1287"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204731"><a href="#local-1628204731"><span class="hs-identifier">cls'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628204730"><span class="hs-identifier hs-var">lcls'</span></a><span>
</span><a name="line-1288"></a><span>              </span><a name="local-1628204732"><a href="#local-1628204732"><span class="hs-identifier">kvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- No scoped kind vars except those in</span><span>
</span><a name="line-1289"></a><span>                        </span><span class="hs-comment">-- kind signatures on the tyvars</span><span>
</span><a name="line-1290"></a><span>
</span><a name="line-1291"></a><span>        </span><span class="hs-comment">-- Tyvars scope over superclass context and method signatures</span><span>
</span><a name="line-1292"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-1628204740"><a href="#local-1628204740"><span class="hs-identifier">tyvars'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204741"><a href="#local-1628204741"><span class="hs-identifier">context'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204742"><a href="#local-1628204742"><span class="hs-identifier">fds'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204743"><a href="#local-1628204743"><span class="hs-identifier">ats'</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1628204744"><a href="#local-1628204744"><span class="hs-identifier">stuff_fvs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1293"></a><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#bindHsQTyVars"><span class="hs-identifier hs-var">bindHsQTyVars</span></a><span> </span><a href="#local-1628204729"><span class="hs-identifier hs-var">cls_doc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-1628204732"><span class="hs-identifier hs-var">kvs</span></a><span> </span><a href="#local-1628204722"><span class="hs-identifier hs-var">tyvars</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628204733"><a href="#local-1628204733"><span class="hs-identifier">tyvars'</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1294"></a><span>                  </span><span class="hs-comment">-- Checks for distinct tyvars</span><span>
</span><a name="line-1295"></a><span>             </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204734"><a href="#local-1628204734"><span class="hs-identifier">context'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204735"><a href="#local-1628204735"><span class="hs-identifier">cxt_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnContext"><span class="hs-identifier hs-var">rnContext</span></a><span> </span><a href="#local-1628204729"><span class="hs-identifier hs-var">cls_doc</span></a><span> </span><a href="#local-1628204720"><span class="hs-identifier hs-var">context</span></a><span>
</span><a name="line-1296"></a><span>             </span><span class="hs-special">;</span><span> </span><a name="local-1628204736"><a href="#local-1628204736"><span class="hs-identifier">fds'</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnFds"><span class="hs-identifier hs-var">rnFds</span></a><span> </span><a href="#local-1628204723"><span class="hs-identifier hs-var">fds</span></a><span>
</span><a name="line-1297"></a><span>                         </span><span class="hs-comment">-- The fundeps have no free variables</span><span>
</span><a name="line-1298"></a><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204737"><a href="#local-1628204737"><span class="hs-identifier">ats'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204738"><a href="#local-1628204738"><span class="hs-identifier">fv_ats</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnATDecls"><span class="hs-identifier hs-var">rnATDecls</span></a><span> </span><a href="#local-1628204731"><span class="hs-identifier hs-var">cls'</span></a><span> </span><a href="#local-1628204726"><span class="hs-identifier hs-var">ats</span></a><span>
</span><a name="line-1299"></a><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204739"><a href="#local-1628204739"><span class="hs-identifier">fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204735"><span class="hs-identifier hs-var">cxt_fvs</span></a><span>     </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span>
</span><a name="line-1300"></a><span>                         </span><a href="#local-1628204738"><span class="hs-identifier hs-var">fv_ats</span></a><span>
</span><a name="line-1301"></a><span>             </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-1628204733"><span class="hs-identifier hs-var">tyvars'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204734"><span class="hs-identifier hs-var">context'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204736"><span class="hs-identifier hs-var">fds'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204737"><span class="hs-identifier hs-var">ats'</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-1628204739"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1302"></a><span>
</span><a name="line-1303"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204745"><a href="#local-1628204745"><span class="hs-identifier">at_defs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204746"><a href="#local-1628204746"><span class="hs-identifier">fv_at_defs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><span class="hs-special">(</span><a href="RnSource.html#rnTyFamDefltEqn"><span class="hs-identifier hs-var">rnTyFamDefltEqn</span></a><span> </span><a href="#local-1628204731"><span class="hs-identifier hs-var">cls'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204727"><span class="hs-identifier hs-var">at_defs</span></a><span>
</span><a name="line-1304"></a><span>
</span><a name="line-1305"></a><span>        </span><span class="hs-comment">-- No need to check for duplicate associated type decls</span><span>
</span><a name="line-1306"></a><span>        </span><span class="hs-comment">-- since that is done by RnNames.extendGlobalRdrEnvRn</span><span>
</span><a name="line-1307"></a><span>
</span><a name="line-1308"></a><span>        </span><span class="hs-comment">-- Check the signatures</span><span>
</span><a name="line-1309"></a><span>        </span><span class="hs-comment">-- First process the class op sigs (op_sigs), then the fixity sigs (non_op_sigs).</span><span>
</span><a name="line-1310"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204747"><a href="#local-1628204747"><span class="hs-identifier">sig_rdr_names_w_locs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-1628204749"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#ClassOpSig"><span class="hs-identifier hs-var">ClassOpSig</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a name="local-1628204748"><a href="#local-1628204748"><span class="hs-identifier">ops</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204724"><span class="hs-identifier hs-var">sigs</span></a><span>
</span><a name="line-1311"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a name="local-1628204749"><a href="#local-1628204749"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204748"><span class="hs-identifier hs-var">ops</span></a><span class="hs-special">]</span><span>
</span><a name="line-1312"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="RnEnv.html#checkDupRdrNames"><span class="hs-identifier hs-var">checkDupRdrNames</span></a><span> </span><a href="#local-1628204747"><span class="hs-identifier hs-var">sig_rdr_names_w_locs</span></a><span>
</span><a name="line-1313"></a><span>                </span><span class="hs-comment">-- Typechecker is responsible for checking that we only</span><span>
</span><a name="line-1314"></a><span>                </span><span class="hs-comment">-- give default-method bindings for things in this class.</span><span>
</span><a name="line-1315"></a><span>                </span><span class="hs-comment">-- The renamer *could* check this for class decls, but can't</span><span>
</span><a name="line-1316"></a><span>                </span><span class="hs-comment">-- for instance decls.</span><span>
</span><a name="line-1317"></a><span>
</span><a name="line-1318"></a><span>        </span><span class="hs-comment">-- The newLocals call is tiresome: given a generic class decl</span><span>
</span><a name="line-1319"></a><span>        </span><span class="hs-comment">--      class C a where</span><span>
</span><a name="line-1320"></a><span>        </span><span class="hs-comment">--        op :: a -&gt; a</span><span>
</span><a name="line-1321"></a><span>        </span><span class="hs-comment">--        op {| x+y |} (Inl a) = ...</span><span>
</span><a name="line-1322"></a><span>        </span><span class="hs-comment">--        op {| x+y |} (Inr b) = ...</span><span>
</span><a name="line-1323"></a><span>        </span><span class="hs-comment">--        op {| a*b |} (a*b)   = ...</span><span>
</span><a name="line-1324"></a><span>        </span><span class="hs-comment">-- we want to name both &quot;x&quot; tyvars with the same unique, so that they are</span><span>
</span><a name="line-1325"></a><span>        </span><span class="hs-comment">-- easy to group together in the typechecker.</span><span>
</span><a name="line-1326"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204750"><a href="#local-1628204750"><span class="hs-identifier">mbinds'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204751"><a href="#local-1628204751"><span class="hs-identifier">sigs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204752"><a href="#local-1628204752"><span class="hs-identifier">meth_fvs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1327"></a><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnBinds.html#rnMethodBinds"><span class="hs-identifier hs-var">rnMethodBinds</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-1628204731"><span class="hs-identifier hs-var">cls'</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#hsAllLTyVarNames"><span class="hs-identifier hs-var">hsAllLTyVarNames</span></a><span> </span><a href="#local-1628204740"><span class="hs-identifier hs-var">tyvars'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204725"><span class="hs-identifier hs-var">mbinds</span></a><span> </span><a href="#local-1628204724"><span class="hs-identifier hs-var">sigs</span></a><span>
</span><a name="line-1328"></a><span>                </span><span class="hs-comment">-- No need to check for duplicate method signatures</span><span>
</span><a name="line-1329"></a><span>                </span><span class="hs-comment">-- since that is done by RnNames.extendGlobalRdrEnvRn</span><span>
</span><a name="line-1330"></a><span>                </span><span class="hs-comment">-- and the methods are already in scope</span><span>
</span><a name="line-1331"></a><span>
</span><a name="line-1332"></a><span>  </span><span class="hs-comment">-- Haddock docs</span><span>
</span><a name="line-1333"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628204753"><a href="#local-1628204753"><span class="hs-identifier">docs'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><a href="RnSource.html#rnDocDecl"><span class="hs-identifier hs-var">rnDocDecl</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204728"><span class="hs-identifier hs-var">docs</span></a><span>
</span><a name="line-1334"></a><span>
</span><a name="line-1335"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204754"><a href="#local-1628204754"><span class="hs-identifier">all_fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204752"><span class="hs-identifier hs-var">meth_fvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204744"><span class="hs-identifier hs-var">stuff_fvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204746"><span class="hs-identifier hs-var">fv_at_defs</span></a><span>
</span><a name="line-1336"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ClassDecl"><span class="hs-identifier hs-var">ClassDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcdCtxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204741"><span class="hs-identifier hs-var">context'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdLName</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204730"><span class="hs-identifier hs-var">lcls'</span></a><span class="hs-special">,</span><span>
</span><a name="line-1337"></a><span>                              </span><span class="hs-identifier">tcdTyVars</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204740"><span class="hs-identifier hs-var">tyvars'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdFDs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204742"><span class="hs-identifier hs-var">fds'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdSigs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204751"><span class="hs-identifier hs-var">sigs'</span></a><span class="hs-special">,</span><span>
</span><a name="line-1338"></a><span>                              </span><span class="hs-identifier">tcdMeths</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204750"><span class="hs-identifier hs-var">mbinds'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdATs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204743"><span class="hs-identifier hs-var">ats'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdATDefs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204745"><span class="hs-identifier hs-var">at_defs'</span></a><span class="hs-special">,</span><span>
</span><a name="line-1339"></a><span>                              </span><span class="hs-identifier">tcdDocs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204753"><span class="hs-identifier hs-var">docs'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdFVs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204754"><span class="hs-identifier hs-var">all_fvs</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><a name="line-1340"></a><span>                  </span><a href="#local-1628204754"><span class="hs-identifier hs-var">all_fvs</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1341"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1342"></a><span>    </span><a name="local-1628204729"><a href="#local-1628204729"><span class="hs-identifier">cls_doc</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnEnv.html#ClassDeclCtx"><span class="hs-identifier hs-var">ClassDeclCtx</span></a><span> </span><a href="#local-1628204721"><span class="hs-identifier hs-var">lcls</span></a><span>
</span><a name="line-1343"></a><span>
</span><a name="line-1344"></a><span class="hs-comment">-- &quot;type&quot; and &quot;type instance&quot; declarations</span><span>
</span><a name="line-1345"></a><span class="hs-identifier">rnTySyn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnEnv.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1346"></a><a name="rnTySyn"><a href="RnSource.html#rnTySyn"><span class="hs-identifier">rnTySyn</span></a></a><span> </span><a name="local-1628204755"><a href="#local-1628204755"><span class="hs-identifier">doc</span></a></a><span> </span><a name="local-1628204756"><a href="#local-1628204756"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#rnLHsType"><span class="hs-identifier hs-var">rnLHsType</span></a><span> </span><a href="#local-1628204755"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-1628204756"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1347"></a><span>
</span><a name="line-1348"></a><span class="hs-comment">-- | Renames role annotations, returning them as the values in a NameEnv</span><span>
</span><a name="line-1349"></a><span class="hs-comment">-- and checks for duplicate role annotations.</span><span>
</span><a name="line-1350"></a><span class="hs-comment">-- It is quite convenient to do both of these in the same place.</span><span>
</span><a name="line-1351"></a><span class="hs-comment">-- See also Note [Role annotations in the renamer]</span><span>
</span><a name="line-1352"></a><span class="hs-identifier">rnRoleAnnots</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>  </span><span class="hs-comment">-- ^ of the decls in this group</span><span>
</span><a name="line-1353"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LRoleAnnotDecl"><span class="hs-identifier hs-type">LRoleAnnotDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span>
</span><a name="line-1354"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#LRoleAnnotDecl"><span class="hs-identifier hs-type">LRoleAnnotDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1355"></a><a name="rnRoleAnnots"><a href="RnSource.html#rnRoleAnnots"><span class="hs-identifier">rnRoleAnnots</span></a></a><span> </span><a name="local-1628204757"><a href="#local-1628204757"><span class="hs-identifier">decl_names</span></a></a><span> </span><a name="local-1628204758"><a href="#local-1628204758"><span class="hs-identifier">role_annots</span></a></a><span>
</span><a name="line-1356"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>  </span><span class="hs-comment">-- check for duplicates *before* renaming, to avoid lumping</span><span>
</span><a name="line-1357"></a><span>          </span><span class="hs-comment">-- together all the unboundNames</span><span>
</span><a name="line-1358"></a><span>         </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628204763"><a href="#local-1628204763"><span class="hs-identifier">no_dups</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204764"><a href="#local-1628204764"><span class="hs-identifier">dup_annots</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="ListSetOps.html#removeDups"><span class="hs-identifier hs-var">removeDups</span></a><span> </span><a href="#local-1628204765"><span class="hs-identifier hs-var">role_annots_cmp</span></a><span> </span><a href="#local-1628204758"><span class="hs-identifier hs-var">role_annots</span></a><span>
</span><a name="line-1359"></a><span>             </span><a name="local-1628204765"><a href="#local-1628204765"><span class="hs-identifier">role_annots_cmp</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204766"><a href="#local-1628204766"><span class="hs-identifier">annot1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204767"><a href="#local-1628204767"><span class="hs-identifier">annot2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1360"></a><span>               </span><span class="hs-glyph">=</span><span> </span><a href="HsDecls.html#roleAnnotDeclName"><span class="hs-identifier hs-var">roleAnnotDeclName</span></a><span> </span><a href="#local-1628204766"><span class="hs-identifier hs-var">annot1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="HsDecls.html#roleAnnotDeclName"><span class="hs-identifier hs-var">roleAnnotDeclName</span></a><span> </span><a href="#local-1628204767"><span class="hs-identifier hs-var">annot2</span></a><span>
</span><a name="line-1361"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><a href="RnSource.html#dupRoleAnnotErr"><span class="hs-identifier hs-var">dupRoleAnnotErr</span></a><span> </span><a href="#local-1628204764"><span class="hs-identifier hs-var">dup_annots</span></a><span>
</span><a name="line-1362"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204768"><a href="#local-1628204768"><span class="hs-identifier">role_annots'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><a href="#local-1628204759"><span class="hs-identifier hs-var">rn_role_annot1</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204763"><span class="hs-identifier hs-var">no_dups</span></a><span>
</span><a name="line-1363"></a><span>          </span><span class="hs-comment">-- some of the role annots will be unbound; we don't wish</span><span>
</span><a name="line-1364"></a><span>          </span><span class="hs-comment">-- to include these</span><span>
</span><a name="line-1365"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="NameEnv.html#mkNameEnv"><span class="hs-identifier hs-var">mkNameEnv</span></a><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-1628204770"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204769"><span class="hs-identifier hs-var">ra</span></a><span class="hs-special">)</span><span>
</span><a name="line-1366"></a><span>                            </span><span class="hs-glyph">|</span><span> </span><a name="local-1628204769"><a href="#local-1628204769"><span class="hs-identifier">ra</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204768"><span class="hs-identifier hs-var">role_annots'</span></a><span>
</span><a name="line-1367"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204770"><a href="#local-1628204770"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsDecls.html#roleAnnotDeclName"><span class="hs-identifier hs-var">roleAnnotDeclName</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628204769"><span class="hs-identifier hs-var">ra</span></a><span class="hs-special">)</span><span>
</span><a name="line-1368"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="PrelNames.html#isUnboundName"><span class="hs-identifier hs-var">isUnboundName</span></a><span> </span><a href="#local-1628204770"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1369"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1370"></a><span>    </span><a name="local-1628204759"><a href="#local-1628204759"><span class="hs-identifier">rn_role_annot1</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#RoleAnnotDecl"><span class="hs-identifier hs-var">RoleAnnotDecl</span></a><span> </span><a name="local-1628204760"><a href="#local-1628204760"><span class="hs-identifier">tycon</span></a></a><span> </span><a name="local-1628204761"><a href="#local-1628204761"><span class="hs-identifier">roles</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1371"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>  </span><span class="hs-comment">-- the name is an *occurrence*, but look it up only in the</span><span>
</span><a name="line-1372"></a><span>              </span><span class="hs-comment">-- decls defined in this group (see #10263)</span><span>
</span><a name="line-1373"></a><span>             </span><a name="local-1628204762"><a href="#local-1628204762"><span class="hs-identifier">tycon'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupSigCtxtOccRn"><span class="hs-identifier hs-var">lookupSigCtxtOccRn</span></a><span> </span><span class="hs-special">(</span><a href="RnEnv.html#RoleAnnotCtxt"><span class="hs-identifier hs-var">RoleAnnotCtxt</span></a><span> </span><a href="#local-1628204757"><span class="hs-identifier hs-var">decl_names</span></a><span class="hs-special">)</span><span>
</span><a name="line-1374"></a><span>                                          </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;role annotation&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1375"></a><span>                                          </span><a href="#local-1628204760"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1376"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsDecls.html#RoleAnnotDecl"><span class="hs-identifier hs-var">RoleAnnotDecl</span></a><span> </span><a href="#local-1628204762"><span class="hs-identifier hs-var">tycon'</span></a><span> </span><a href="#local-1628204761"><span class="hs-identifier hs-var">roles</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1377"></a><span>
</span><a name="line-1378"></a><span class="hs-identifier">dupRoleAnnotErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LRoleAnnotDecl"><span class="hs-identifier hs-type">LRoleAnnotDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1379"></a><a name="dupRoleAnnotErr"><a href="RnSource.html#dupRoleAnnotErr"><span class="hs-identifier">dupRoleAnnotErr</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;dupRoleAnnotErr&quot;</span><span>
</span><a name="line-1380"></a><span class="hs-identifier">dupRoleAnnotErr</span><span> </span><a name="local-1628204771"><a href="#local-1628204771"><span class="hs-identifier">list</span></a></a><span>
</span><a name="line-1381"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a><span> </span><a href="#local-1628204773"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1382"></a><span>    </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Duplicate role annotations for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1383"></a><span>          </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsDecls.html#roleAnnotDeclName"><span class="hs-identifier hs-var">roleAnnotDeclName</span></a><span> </span><a href="#local-1628204774"><span class="hs-identifier hs-var">first_decl</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a><span class="hs-special">)</span><span>
</span><a name="line-1384"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1628204775"><span class="hs-identifier hs-var">pp_role_annot</span></a><span> </span><a href="#local-1628204772"><span class="hs-identifier hs-var">sorted_list</span></a><span class="hs-special">)</span><span>
</span><a name="line-1385"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-1386"></a><span>      </span><a name="local-1628204772"><a href="#local-1628204772"><span class="hs-identifier">sorted_list</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a><span> </span><a href="#local-1628204776"><span class="hs-identifier hs-var">cmp_annot</span></a><span> </span><a href="#local-1628204771"><span class="hs-identifier hs-var">list</span></a><span>
</span><a name="line-1387"></a><span>      </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204773"><a href="#local-1628204773"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204774"><a href="#local-1628204774"><span class="hs-identifier">first_decl</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204772"><span class="hs-identifier hs-var">sorted_list</span></a><span>
</span><a name="line-1388"></a><span>
</span><a name="line-1389"></a><span>      </span><a name="local-1628204775"><a href="#local-1628204775"><span class="hs-identifier">pp_role_annot</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204777"><a href="#local-1628204777"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204778"><a href="#local-1628204778"><span class="hs-identifier">decl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204778"><span class="hs-identifier hs-var">decl</span></a><span class="hs-special">)</span><span>
</span><a name="line-1390"></a><span>                                      </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;-- written at&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204777"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1391"></a><span>
</span><a name="line-1392"></a><span>      </span><a name="local-1628204776"><a href="#local-1628204776"><span class="hs-identifier">cmp_annot</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204779"><a href="#local-1628204779"><span class="hs-identifier">loc1</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204780"><a href="#local-1628204780"><span class="hs-identifier">loc2</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204779"><span class="hs-identifier hs-var">loc1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-1628204780"><span class="hs-identifier hs-var">loc2</span></a><span>
</span><a name="line-1393"></a><span>
</span><a name="line-1394"></a><span class="hs-identifier">orphanRoleAnnotErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#LRoleAnnotDecl"><span class="hs-identifier hs-type">LRoleAnnotDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1395"></a><a name="orphanRoleAnnotErr"><a href="RnSource.html#orphanRoleAnnotErr"><span class="hs-identifier">orphanRoleAnnotErr</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204781"><a href="#local-1628204781"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204782"><a href="#local-1628204782"><span class="hs-identifier">decl</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1396"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a><span> </span><a href="#local-1628204781"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1397"></a><span>    </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Role annotation for a type previously declared:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1398"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204782"><span class="hs-identifier hs-var">decl</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span>
</span><a name="line-1399"></a><span>    </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The role annotation must be given where&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1400"></a><span>            </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsDecls.html#roleAnnotDeclName"><span class="hs-identifier hs-var">roleAnnotDeclName</span></a><span> </span><a href="#local-1628204782"><span class="hs-identifier hs-var">decl</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1401"></a><span>            </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;is declared.&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1402"></a><span>
</span><a name="line-1403"></a><span class="hs-identifier">rnDataDefn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnEnv.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#HsDataDefn"><span class="hs-identifier hs-type">HsDataDefn</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-1404"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="HsDecls.html#HsDataDefn"><span class="hs-identifier hs-type">HsDataDefn</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1405"></a><span>                </span><span class="hs-comment">-- the NameSet includes all Names free in the kind signature</span><span>
</span><a name="line-1406"></a><span>                </span><span class="hs-comment">-- See Note [Complete user-supplied kind signatures]</span><span>
</span><a name="line-1407"></a><a name="rnDataDefn"><a href="RnSource.html#rnDataDefn"><span class="hs-identifier">rnDataDefn</span></a></a><span> </span><a name="local-1628204783"><a href="#local-1628204783"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsDataDefn"><span class="hs-identifier hs-var">HsDataDefn</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dd_ND</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204784"><a href="#local-1628204784"><span class="hs-identifier">new_or_data</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">dd_cType</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204785"><a href="#local-1628204785"><span class="hs-identifier">cType</span></a></a><span>
</span><a name="line-1408"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dd_ctxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204786"><a href="#local-1628204786"><span class="hs-identifier">context</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">dd_cons</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204787"><a href="#local-1628204787"><span class="hs-identifier">condecls</span></a></a><span>
</span><a name="line-1409"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dd_kindSig</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204788"><a href="#local-1628204788"><span class="hs-identifier">m_sig</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">dd_derivs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204789"><a href="#local-1628204789"><span class="hs-identifier">derivs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1410"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204790"><span class="hs-identifier hs-var">h98_style</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628204786"><span class="hs-identifier hs-var">context</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1411"></a><span>                  </span><span class="hs-special">(</span><a href="RnSource.html#badGadtStupidTheta"><span class="hs-identifier hs-var">badGadtStupidTheta</span></a><span> </span><a href="#local-1628204783"><span class="hs-identifier hs-var">doc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1412"></a><span>
</span><a name="line-1413"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204797"><a href="#local-1628204797"><span class="hs-identifier">m_sig'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204798"><a href="#local-1628204798"><span class="hs-identifier">sig_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628204788"><span class="hs-identifier hs-var">m_sig</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1414"></a><span>             </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628204796"><a href="#local-1628204796"><span class="hs-identifier">sig</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Arrow.html#first"><span class="hs-identifier hs-var">first</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="RnTypes.html#rnLHsKind"><span class="hs-identifier hs-var">rnLHsKind</span></a><span> </span><a href="#local-1628204783"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-1628204796"><span class="hs-identifier hs-var">sig</span></a><span>
</span><a name="line-1415"></a><span>             </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1416"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204799"><a href="#local-1628204799"><span class="hs-identifier">context'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204800"><a href="#local-1628204800"><span class="hs-identifier">fvs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnContext"><span class="hs-identifier hs-var">rnContext</span></a><span> </span><a href="#local-1628204783"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-1628204786"><span class="hs-identifier hs-var">context</span></a><span>
</span><a name="line-1417"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204801"><a href="#local-1628204801"><span class="hs-identifier">derivs'</span></a></a><span class="hs-special">,</span><span>  </span><a name="local-1628204802"><a href="#local-1628204802"><span class="hs-identifier">fvs3</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204791"><span class="hs-identifier hs-var">rn_derivs</span></a><span> </span><a href="#local-1628204789"><span class="hs-identifier hs-var">derivs</span></a><span>
</span><a name="line-1418"></a><span>
</span><a name="line-1419"></a><span>        </span><span class="hs-comment">-- For the constructor declarations, drop the LocalRdrEnv</span><span>
</span><a name="line-1420"></a><span>        </span><span class="hs-comment">-- in the GADT case, where the type variables in the declaration</span><span>
</span><a name="line-1421"></a><span>        </span><span class="hs-comment">-- do not scope over the constructor signatures</span><span>
</span><a name="line-1422"></a><span>        </span><span class="hs-comment">-- data T a where { T1 :: forall b. b-&gt; b }</span><span>
</span><a name="line-1423"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204803"><a href="#local-1628204803"><span class="hs-identifier">zap_lcl_env</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628204790"><span class="hs-identifier hs-var">h98_style</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628204804"><a href="#local-1628204804"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628204804"><span class="hs-identifier hs-var">thing</span></a><span>
</span><a name="line-1424"></a><span>                            </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setLocalRdrEnv"><span class="hs-identifier hs-var">setLocalRdrEnv</span></a><span> </span><a href="RdrName.html#emptyLocalRdrEnv"><span class="hs-identifier hs-var">emptyLocalRdrEnv</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1425"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204805"><a href="#local-1628204805"><span class="hs-identifier">condecls'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204806"><a href="#local-1628204806"><span class="hs-identifier">con_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204803"><span class="hs-identifier hs-var">zap_lcl_env</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="RnSource.html#rnConDecls"><span class="hs-identifier hs-var">rnConDecls</span></a><span> </span><a href="#local-1628204787"><span class="hs-identifier hs-var">condecls</span></a><span>
</span><a name="line-1426"></a><span>           </span><span class="hs-comment">-- No need to check for duplicate constructor decls</span><span>
</span><a name="line-1427"></a><span>           </span><span class="hs-comment">-- since that is done by RnNames.extendGlobalRdrEnvRn</span><span>
</span><a name="line-1428"></a><span>
</span><a name="line-1429"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204807"><a href="#local-1628204807"><span class="hs-identifier">all_fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204800"><span class="hs-identifier hs-var">fvs1</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204802"><span class="hs-identifier hs-var">fvs3</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span>
</span><a name="line-1430"></a><span>                        </span><a href="#local-1628204806"><span class="hs-identifier hs-var">con_fvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204798"><span class="hs-identifier hs-var">sig_fvs</span></a><span>
</span><a name="line-1431"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span> </span><a href="HsDecls.html#HsDataDefn"><span class="hs-identifier hs-var">HsDataDefn</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dd_ND</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204784"><span class="hs-identifier hs-var">new_or_data</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">dd_cType</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204785"><span class="hs-identifier hs-var">cType</span></a><span>
</span><a name="line-1432"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dd_ctxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204799"><span class="hs-identifier hs-var">context'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">dd_kindSig</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204797"><span class="hs-identifier hs-var">m_sig'</span></a><span>
</span><a name="line-1433"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dd_cons</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204805"><span class="hs-identifier hs-var">condecls'</span></a><span>
</span><a name="line-1434"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dd_derivs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204801"><span class="hs-identifier hs-var">derivs'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1435"></a><span>                  </span><span class="hs-special">,</span><span> </span><a href="#local-1628204798"><span class="hs-identifier hs-var">sig_fvs</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1436"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="#local-1628204807"><span class="hs-identifier hs-var">all_fvs</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1437"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-1438"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1439"></a><span>    </span><a name="local-1628204790"><a href="#local-1628204790"><span class="hs-identifier">h98_style</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628204787"><span class="hs-identifier hs-var">condecls</span></a><span> </span><span class="hs-keyword">of</span><span>  </span><span class="hs-comment">-- Note [Stupid theta]</span><span>
</span><a name="line-1440"></a><span>                     </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ConDeclGADT"><span class="hs-identifier hs-var">ConDeclGADT</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1441"></a><span>                     </span><span class="hs-identifier">_</span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1442"></a><span>
</span><a name="line-1443"></a><span>    </span><a name="local-1628204791"><a href="#local-1628204791"><span class="hs-identifier">rn_derivs</span></a></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1444"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1445"></a><span>    </span><span class="hs-identifier">rn_derivs</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204792"><a href="#local-1628204792"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204793"><a href="#local-1628204793"><span class="hs-identifier">ds</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1446"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204794"><a href="#local-1628204794"><span class="hs-identifier">ds'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204795"><a href="#local-1628204795"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#mapFvRn"><span class="hs-identifier hs-var">mapFvRn</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#rnHsSigType"><span class="hs-identifier hs-var">rnHsSigType</span></a><span> </span><a href="#local-1628204783"><span class="hs-identifier hs-var">doc</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204793"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-1447"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628204792"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-1628204794"><span class="hs-identifier hs-var">ds'</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-1628204795"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1448"></a><span>
</span><a name="line-1449"></a><span class="hs-identifier">badGadtStupidTheta</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnEnv.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1450"></a><a name="badGadtStupidTheta"><a href="RnSource.html#badGadtStupidTheta"><span class="hs-identifier">badGadtStupidTheta</span></a></a><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1451"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;No context is allowed on a GADT-style data declaration&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-1452"></a><span>          </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;(You can put a context on each contructor, though.)&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-1453"></a><span>
</span><a name="line-1454"></a><span class="hs-identifier">rnFamDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-comment">-- Just cls =&gt; this FamilyDecl is nested</span><span>
</span><a name="line-1455"></a><span>                        </span><span class="hs-comment">--             inside an *class decl* for cls</span><span>
</span><a name="line-1456"></a><span>                        </span><span class="hs-comment">--             used for associated types</span><span>
</span><a name="line-1457"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#FamilyDecl"><span class="hs-identifier hs-type">FamilyDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-1458"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#FamilyDecl"><span class="hs-identifier hs-type">FamilyDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1459"></a><a name="rnFamDecl"><a href="RnSource.html#rnFamDecl"><span class="hs-identifier">rnFamDecl</span></a></a><span> </span><a name="local-1628204808"><a href="#local-1628204808"><span class="hs-identifier">mb_cls</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#FamilyDecl"><span class="hs-identifier hs-var">FamilyDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fdLName</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204809"><a href="#local-1628204809"><span class="hs-identifier">tycon</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fdTyVars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204810"><a href="#local-1628204810"><span class="hs-identifier">tyvars</span></a></a><span>
</span><a name="line-1460"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fdInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204811"><a href="#local-1628204811"><span class="hs-identifier">info</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fdResultSig</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204812"><a href="#local-1628204812"><span class="hs-identifier">res_sig</span></a></a><span>
</span><a name="line-1461"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fdInjectivityAnn</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204813"><a href="#local-1628204813"><span class="hs-identifier">injectivity</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1462"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204819"><a href="#local-1628204819"><span class="hs-identifier">tycon'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedTopBndrRn"><span class="hs-identifier hs-var">lookupLocatedTopBndrRn</span></a><span> </span><a href="#local-1628204809"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1463"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204820"><a href="#local-1628204820"><span class="hs-identifier">kvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#extractRdrKindSigVars"><span class="hs-identifier hs-var">extractRdrKindSigVars</span></a><span> </span><a href="#local-1628204812"><span class="hs-identifier hs-var">res_sig</span></a><span>
</span><a name="line-1464"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-1628204827"><a href="#local-1628204827"><span class="hs-identifier">tyvars'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204828"><a href="#local-1628204828"><span class="hs-identifier">res_sig'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204829"><a href="#local-1628204829"><span class="hs-identifier">injectivity'</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1628204830"><a href="#local-1628204830"><span class="hs-identifier">fv1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-1465"></a><span>            </span><a href="RnTypes.html#bindHsQTyVars"><span class="hs-identifier hs-var">bindHsQTyVars</span></a><span> </span><a href="#local-1628204814"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-1628204808"><span class="hs-identifier hs-var">mb_cls</span></a><span> </span><a href="#local-1628204820"><span class="hs-identifier hs-var">kvs</span></a><span> </span><a href="#local-1628204810"><span class="hs-identifier hs-var">tyvars</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1466"></a><span>            </span><span class="hs-glyph">\</span><span> </span><a name="local-1628204821"><a href="#local-1628204821"><span class="hs-identifier">tyvars'</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsQTvs"><span class="hs-identifier hs-var">HsQTvs</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsq_implicit</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204822"><a href="#local-1628204822"><span class="hs-identifier">rn_kvs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1467"></a><span>            </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204823"><a href="#local-1628204823"><span class="hs-identifier">rn_sig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#rnFamResultSig"><span class="hs-identifier hs-var">rnFamResultSig</span></a><span> </span><a href="#local-1628204814"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-1628204822"><span class="hs-identifier hs-var">rn_kvs</span></a><span>
</span><a name="line-1468"></a><span>               </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204824"><a href="#local-1628204824"><span class="hs-identifier">res_sig'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204825"><a href="#local-1628204825"><span class="hs-identifier">fv_kind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#wrapLocFstM"><span class="hs-identifier hs-var">wrapLocFstM</span></a><span> </span><a href="#local-1628204823"><span class="hs-identifier hs-var">rn_sig</span></a><span> </span><a href="#local-1628204812"><span class="hs-identifier hs-var">res_sig</span></a><span>
</span><a name="line-1469"></a><span>               </span><span class="hs-special">;</span><span> </span><a name="local-1628204826"><a href="#local-1628204826"><span class="hs-identifier">injectivity'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a><span> </span><span class="hs-special">(</span><a href="RnSource.html#rnInjectivityAnn"><span class="hs-identifier hs-var">rnInjectivityAnn</span></a><span> </span><a href="#local-1628204821"><span class="hs-identifier hs-var">tyvars'</span></a><span> </span><a href="#local-1628204824"><span class="hs-identifier hs-var">res_sig'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1470"></a><span>                                          </span><a href="#local-1628204813"><span class="hs-identifier hs-var">injectivity</span></a><span>
</span><a name="line-1471"></a><span>               </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><a href="#local-1628204821"><span class="hs-identifier hs-var">tyvars'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204824"><span class="hs-identifier hs-var">res_sig'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204826"><span class="hs-identifier hs-var">injectivity'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span> </span><a href="#local-1628204825"><span class="hs-identifier hs-var">fv_kind</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1472"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204831"><a href="#local-1628204831"><span class="hs-identifier">info'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204832"><a href="#local-1628204832"><span class="hs-identifier">fv2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204815"><span class="hs-identifier hs-var">rn_info</span></a><span> </span><a href="#local-1628204811"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-1473"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#FamilyDecl"><span class="hs-identifier hs-var">FamilyDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fdLName</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204819"><span class="hs-identifier hs-var">tycon'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fdTyVars</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204827"><span class="hs-identifier hs-var">tyvars'</span></a><span>
</span><a name="line-1474"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fdInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204831"><span class="hs-identifier hs-var">info'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fdResultSig</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204828"><span class="hs-identifier hs-var">res_sig'</span></a><span>
</span><a name="line-1475"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fdInjectivityAnn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204829"><span class="hs-identifier hs-var">injectivity'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1476"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="#local-1628204830"><span class="hs-identifier hs-var">fv1</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204832"><span class="hs-identifier hs-var">fv2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1477"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1478"></a><span>     </span><a name="local-1628204814"><a href="#local-1628204814"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnEnv.html#TyFamilyCtx"><span class="hs-identifier hs-var">TyFamilyCtx</span></a><span> </span><a href="#local-1628204809"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1479"></a><span>
</span><a name="line-1480"></a><span>     </span><span class="hs-comment">----------------------</span><span>
</span><a name="line-1481"></a><span>     </span><a name="local-1628204815"><a href="#local-1628204815"><span class="hs-identifier">rn_info</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ClosedTypeFamily"><span class="hs-identifier hs-var">ClosedTypeFamily</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628204816"><a href="#local-1628204816"><span class="hs-identifier">eqns</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1482"></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204817"><a href="#local-1628204817"><span class="hs-identifier">eqns'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204818"><a href="#local-1628204818"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><span class="hs-special">(</span><a href="RnSource.html#rnTyFamInstEqn"><span class="hs-identifier hs-var">rnTyFamInstEqn</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204816"><span class="hs-identifier hs-var">eqns</span></a><span>
</span><a name="line-1483"></a><span>                                                    </span><span class="hs-comment">-- no class context,</span><span>
</span><a name="line-1484"></a><span>            </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ClosedTypeFamily"><span class="hs-identifier hs-var">ClosedTypeFamily</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628204817"><span class="hs-identifier hs-var">eqns'</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-1628204818"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1485"></a><span>     </span><span class="hs-identifier">rn_info</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ClosedTypeFamily"><span class="hs-identifier hs-var">ClosedTypeFamily</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span>
</span><a name="line-1486"></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ClosedTypeFamily"><span class="hs-identifier hs-var">ClosedTypeFamily</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1487"></a><span>     </span><span class="hs-identifier">rn_info</span><span> </span><a href="HsDecls.html#OpenTypeFamily"><span class="hs-identifier hs-var">OpenTypeFamily</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#OpenTypeFamily"><span class="hs-identifier hs-var">OpenTypeFamily</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1488"></a><span>     </span><span class="hs-identifier">rn_info</span><span> </span><a href="HsDecls.html#DataFamily"><span class="hs-identifier hs-var">DataFamily</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DataFamily"><span class="hs-identifier hs-var">DataFamily</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1489"></a><span>
</span><a name="line-1490"></a><span class="hs-identifier">rnFamResultSig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnEnv.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span>
</span><a name="line-1491"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- kind variables already in scope</span><span>
</span><a name="line-1492"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#FamilyResultSig"><span class="hs-identifier hs-type">FamilyResultSig</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-1493"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#FamilyResultSig"><span class="hs-identifier hs-type">FamilyResultSig</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1494"></a><a name="rnFamResultSig"><a href="RnSource.html#rnFamResultSig"><span class="hs-identifier">rnFamResultSig</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="HsDecls.html#NoSig"><span class="hs-identifier hs-var">NoSig</span></a><span>
</span><a name="line-1495"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#NoSig"><span class="hs-identifier hs-var">NoSig</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1496"></a><span class="hs-identifier">rnFamResultSig</span><span> </span><a name="local-1628204833"><a href="#local-1628204833"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#KindSig"><span class="hs-identifier hs-var">KindSig</span></a><span> </span><a name="local-1628204834"><a href="#local-1628204834"><span class="hs-identifier">kind</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1497"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204835"><a href="#local-1628204835"><span class="hs-identifier">rndKind</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204836"><a href="#local-1628204836"><span class="hs-identifier">ftvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsKind"><span class="hs-identifier hs-var">rnLHsKind</span></a><span> </span><a href="#local-1628204833"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-1628204834"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-1498"></a><span>        </span><span class="hs-special">;</span><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#KindSig"><span class="hs-identifier hs-var">KindSig</span></a><span> </span><a href="#local-1628204835"><span class="hs-identifier hs-var">rndKind</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204836"><span class="hs-identifier hs-var">ftvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1499"></a><span class="hs-identifier">rnFamResultSig</span><span> </span><a name="local-1628204837"><a href="#local-1628204837"><span class="hs-identifier">doc</span></a></a><span> </span><a name="local-1628204838"><a href="#local-1628204838"><span class="hs-identifier">kv_names</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyVarSig"><span class="hs-identifier hs-var">TyVarSig</span></a><span> </span><a name="local-1628204839"><a href="#local-1628204839"><span class="hs-identifier">tvbndr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1500"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- `TyVarSig` tells us that user named the result of a type family by</span><span>
</span><a name="line-1501"></a><span>          </span><span class="hs-comment">-- writing `= tyvar` or `= (tyvar :: kind)`. In such case we want to</span><span>
</span><a name="line-1502"></a><span>          </span><span class="hs-comment">-- be sure that the supplied result name is not identical to an</span><span>
</span><a name="line-1503"></a><span>          </span><span class="hs-comment">-- already in-scope type variable from an enclosing class.</span><span>
</span><a name="line-1504"></a><span>          </span><span class="hs-comment">--</span><span>
</span><a name="line-1505"></a><span>          </span><span class="hs-comment">--  Example of disallowed declaration:</span><span>
</span><a name="line-1506"></a><span>          </span><span class="hs-comment">--         class C a b where</span><span>
</span><a name="line-1507"></a><span>          </span><span class="hs-comment">--            type F b = a | a -&gt; b</span><span>
</span><a name="line-1508"></a><span>          </span><a name="local-1628204840"><a href="#local-1628204840"><span class="hs-identifier">rdr_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getLocalRdrEnv"><span class="hs-identifier hs-var">getLocalRdrEnv</span></a><span>
</span><a name="line-1509"></a><span>       </span><span class="hs-special">;</span><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204841"><a href="#local-1628204841"><span class="hs-identifier">resName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsTypes.html#hsLTyVarName"><span class="hs-identifier hs-var">hsLTyVarName</span></a><span> </span><a href="#local-1628204839"><span class="hs-identifier hs-var">tvbndr</span></a><span>
</span><a name="line-1510"></a><span>       </span><span class="hs-special">;</span><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204841"><span class="hs-identifier hs-var">resName</span></a><span> </span><span class="hs-special">`</span><a href="RdrName.html#elemLocalRdrEnv"><span class="hs-identifier hs-var">elemLocalRdrEnv</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204840"><span class="hs-identifier hs-var">rdr_env</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1511"></a><span>          </span><a href="TcRnMonad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#getLoc"><span class="hs-identifier hs-var">getLoc</span></a><span> </span><a href="#local-1628204839"><span class="hs-identifier hs-var">tvbndr</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1512"></a><span>                     </span><span class="hs-special">(</span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Type variable&quot;</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204841"><span class="hs-identifier hs-var">resName</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span>
</span><a name="line-1513"></a><span>                           </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;naming a type family result,&quot;</span><span>
</span><a name="line-1514"></a><span>                           </span><span class="hs-special">]</span><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span>
</span><a name="line-1515"></a><span>                      </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;shadows an already bound type variable&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1516"></a><span>
</span><a name="line-1517"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnTypes.html#bindLHsTyVarBndr"><span class="hs-identifier hs-var">bindLHsTyVarBndr</span></a><span> </span><a href="#local-1628204837"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-comment">-- this might be a lie, but it's used for</span><span>
</span><a name="line-1518"></a><span>                                      </span><span class="hs-comment">-- scoping checks that are irrelevant here</span><span>
</span><a name="line-1519"></a><span>                          </span><span class="hs-special">(</span><a href="NameSet.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a><span> </span><a href="#local-1628204838"><span class="hs-identifier hs-var">kv_names</span></a><span class="hs-special">)</span><span> </span><a href="NameSet.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a><span>
</span><a name="line-1520"></a><span>                                       </span><span class="hs-comment">-- use of emptyNameSet here avoids</span><span>
</span><a name="line-1521"></a><span>                                       </span><span class="hs-comment">-- redundant duplicate errors</span><span>
</span><a name="line-1522"></a><span>                          </span><a href="#local-1628204839"><span class="hs-identifier hs-var">tvbndr</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204842"><a href="#local-1628204842"><span class="hs-identifier">tvbndr'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1523"></a><span>         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyVarSig"><span class="hs-identifier hs-var">TyVarSig</span></a><span> </span><a href="#local-1628204842"><span class="hs-identifier hs-var">tvbndr'</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#unitFV"><span class="hs-identifier hs-var">unitFV</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#hsLTyVarName"><span class="hs-identifier hs-var">hsLTyVarName</span></a><span> </span><a href="#local-1628204842"><span class="hs-identifier hs-var">tvbndr'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1524"></a><span>
</span><a name="line-1525"></a><span class="hs-comment">-- Note [Renaming injectivity annotation]</span><span>
</span><a name="line-1526"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-1527"></a><span class="hs-comment">--</span><span>
</span><a name="line-1528"></a><span class="hs-comment">-- During renaming of injectivity annotation we have to make several checks to</span><span>
</span><a name="line-1529"></a><span class="hs-comment">-- make sure that it is well-formed.  At the moment injectivity annotation</span><span>
</span><a name="line-1530"></a><span class="hs-comment">-- consists of a single injectivity condition, so the terms &quot;injectivity</span><span>
</span><a name="line-1531"></a><span class="hs-comment">-- annotation&quot; and &quot;injectivity condition&quot; might be used interchangeably.  See</span><span>
</span><a name="line-1532"></a><span class="hs-comment">-- Note [Injectivity annotation] for a detailed discussion of currently allowed</span><span>
</span><a name="line-1533"></a><span class="hs-comment">-- injectivity annotations.</span><span>
</span><a name="line-1534"></a><span class="hs-comment">--</span><span>
</span><a name="line-1535"></a><span class="hs-comment">-- Checking LHS is simple because the only type variable allowed on the LHS of</span><span>
</span><a name="line-1536"></a><span class="hs-comment">-- injectivity condition is the variable naming the result in type family head.</span><span>
</span><a name="line-1537"></a><span class="hs-comment">-- Example of disallowed annotation:</span><span>
</span><a name="line-1538"></a><span class="hs-comment">--</span><span>
</span><a name="line-1539"></a><span class="hs-comment">--     type family Foo a b = r | b -&gt; a</span><span>
</span><a name="line-1540"></a><span class="hs-comment">--</span><span>
</span><a name="line-1541"></a><span class="hs-comment">-- Verifying RHS of injectivity consists of checking that:</span><span>
</span><a name="line-1542"></a><span class="hs-comment">--</span><span>
</span><a name="line-1543"></a><span class="hs-comment">--  1. only variables defined in type family head appear on the RHS (kind</span><span>
</span><a name="line-1544"></a><span class="hs-comment">--     variables are also allowed).  Example of disallowed annotation:</span><span>
</span><a name="line-1545"></a><span class="hs-comment">--</span><span>
</span><a name="line-1546"></a><span class="hs-comment">--        type family Foo a = r | r -&gt; b</span><span>
</span><a name="line-1547"></a><span class="hs-comment">--</span><span>
</span><a name="line-1548"></a><span class="hs-comment">--  2. for associated types the result variable does not shadow any of type</span><span>
</span><a name="line-1549"></a><span class="hs-comment">--     class variables. Example of disallowed annotation:</span><span>
</span><a name="line-1550"></a><span class="hs-comment">--</span><span>
</span><a name="line-1551"></a><span class="hs-comment">--        class Foo a b where</span><span>
</span><a name="line-1552"></a><span class="hs-comment">--           type F a = b | b -&gt; a</span><span>
</span><a name="line-1553"></a><span class="hs-comment">--</span><span>
</span><a name="line-1554"></a><span class="hs-comment">-- Breaking any of these assumptions results in an error.</span><span>
</span><a name="line-1555"></a><span>
</span><a name="line-1556"></a><span class="hs-comment">-- | Rename injectivity annotation. Note that injectivity annotation is just the</span><span>
</span><a name="line-1557"></a><span class="hs-comment">-- part after the &quot;|&quot;.  Everything that appears before it is renamed in</span><span>
</span><a name="line-1558"></a><span class="hs-comment">-- rnFamDecl.</span><span>
</span><a name="line-1559"></a><span class="hs-identifier">rnInjectivityAnn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsQTyVars"><span class="hs-identifier hs-type">LHsQTyVars</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>            </span><span class="hs-comment">-- ^ Type variables declared in</span><span>
</span><a name="line-1560"></a><span>                                               </span><span class="hs-comment">--   type family head</span><span>
</span><a name="line-1561"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#LFamilyResultSig"><span class="hs-identifier hs-type">LFamilyResultSig</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>      </span><span class="hs-comment">-- ^ Result signature</span><span>
</span><a name="line-1562"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#LInjectivityAnn"><span class="hs-identifier hs-type">LInjectivityAnn</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>    </span><span class="hs-comment">-- ^ Injectivity annotation</span><span>
</span><a name="line-1563"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#LInjectivityAnn"><span class="hs-identifier hs-type">LInjectivityAnn</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1564"></a><a name="rnInjectivityAnn"><a href="RnSource.html#rnInjectivityAnn"><span class="hs-identifier">rnInjectivityAnn</span></a></a><span> </span><a name="local-1628204843"><a href="#local-1628204843"><span class="hs-identifier">tvBndrs</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyVarSig"><span class="hs-identifier hs-var">TyVarSig</span></a><span> </span><a name="local-1628204844"><a href="#local-1628204844"><span class="hs-identifier">resTv</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1565"></a><span>                 </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204845"><a href="#local-1628204845"><span class="hs-identifier">srcSpan</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#InjectivityAnn"><span class="hs-identifier hs-var">InjectivityAnn</span></a><span> </span><a name="local-1628204846"><a href="#local-1628204846"><span class="hs-identifier">injFrom</span></a></a><span> </span><a name="local-1628204847"><a href="#local-1628204847"><span class="hs-identifier">injTo</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1566"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1567"></a><span>   </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204850"><a href="#local-1628204850"><span class="hs-identifier">injDecl'</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#InjectivityAnn"><span class="hs-identifier hs-var">InjectivityAnn</span></a><span> </span><a name="local-1628204851"><a href="#local-1628204851"><span class="hs-identifier">injFrom'</span></a></a><span> </span><a name="local-1628204852"><a href="#local-1628204852"><span class="hs-identifier">injTo'</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1628204853"><a href="#local-1628204853"><span class="hs-identifier">noRnErrors</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1568"></a><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#askNoErrs"><span class="hs-identifier hs-var">askNoErrs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1569"></a><span>             </span><a href="RnEnv.html#bindLocalNames"><span class="hs-identifier hs-var">bindLocalNames</span></a><span> </span><span class="hs-special">[</span><a href="HsTypes.html#hsLTyVarName"><span class="hs-identifier hs-var">hsLTyVarName</span></a><span> </span><a href="#local-1628204844"><span class="hs-identifier hs-var">resTv</span></a><span class="hs-special">]</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1570"></a><span>             </span><span class="hs-comment">-- The return type variable scopes over the injectivity annotation</span><span>
</span><a name="line-1571"></a><span>             </span><span class="hs-comment">-- e.g.   type family F a = (r::*) | r -&gt; a</span><span>
</span><a name="line-1572"></a><span>             </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204848"><a href="#local-1628204848"><span class="hs-identifier">injFrom'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLTyVar"><span class="hs-identifier hs-var">rnLTyVar</span></a><span> </span><a href="#local-1628204846"><span class="hs-identifier hs-var">injFrom</span></a><span>
</span><a name="line-1573"></a><span>                </span><span class="hs-special">;</span><span> </span><a name="local-1628204849"><a href="#local-1628204849"><span class="hs-identifier">injTo'</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="RnTypes.html#rnLTyVar"><span class="hs-identifier hs-var">rnLTyVar</span></a><span> </span><a href="#local-1628204847"><span class="hs-identifier hs-var">injTo</span></a><span>
</span><a name="line-1574"></a><span>                </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628204845"><span class="hs-identifier hs-var">srcSpan</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#InjectivityAnn"><span class="hs-identifier hs-var">InjectivityAnn</span></a><span> </span><a href="#local-1628204848"><span class="hs-identifier hs-var">injFrom'</span></a><span> </span><a href="#local-1628204849"><span class="hs-identifier hs-var">injTo'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1575"></a><span>
</span><a name="line-1576"></a><span>   </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204854"><a href="#local-1628204854"><span class="hs-identifier">tvNames</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Base.html#fromList"><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsTypes.html#hsAllLTyVarNames"><span class="hs-identifier hs-var">hsAllLTyVarNames</span></a><span> </span><a href="#local-1628204843"><span class="hs-identifier hs-var">tvBndrs</span></a><span>
</span><a name="line-1577"></a><span>         </span><a name="local-1628204855"><a href="#local-1628204855"><span class="hs-identifier">resName</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="HsTypes.html#hsLTyVarName"><span class="hs-identifier hs-var">hsLTyVarName</span></a><span> </span><a href="#local-1628204844"><span class="hs-identifier hs-var">resTv</span></a><span>
</span><a name="line-1578"></a><span>         </span><span class="hs-comment">-- See Note [Renaming injectivity annotation]</span><span>
</span><a name="line-1579"></a><span>         </span><a name="local-1628204856"><a href="#local-1628204856"><span class="hs-identifier">lhsValid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-special">(</span><a href="Name.html#stableNameCmp"><span class="hs-identifier hs-var">stableNameCmp</span></a><span> </span><a href="#local-1628204855"><span class="hs-identifier hs-var">resName</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628204851"><span class="hs-identifier hs-var">injFrom'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1580"></a><span>         </span><a name="local-1628204857"><a href="#local-1628204857"><span class="hs-identifier">rhsValid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Base.html#fromList"><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628204852"><span class="hs-identifier hs-var">injTo'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Base.html#difference"><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">difference</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204854"><span class="hs-identifier hs-var">tvNames</span></a><span>
</span><a name="line-1581"></a><span>
</span><a name="line-1582"></a><span>   </span><span class="hs-comment">-- if renaming of type variables ended with errors (eg. there were</span><span>
</span><a name="line-1583"></a><span>   </span><span class="hs-comment">-- not-in-scope variables) don't check the validity of injectivity</span><span>
</span><a name="line-1584"></a><span>   </span><span class="hs-comment">-- annotation. This gives better error messages.</span><span>
</span><a name="line-1585"></a><span>   </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204853"><span class="hs-identifier hs-var">noRnErrors</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-1628204856"><span class="hs-identifier hs-var">lhsValid</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1586"></a><span>        </span><a href="TcRnMonad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#getLoc"><span class="hs-identifier hs-var">getLoc</span></a><span> </span><a href="#local-1628204846"><span class="hs-identifier hs-var">injFrom</span></a><span class="hs-special">)</span><span>
</span><a name="line-1587"></a><span>              </span><span class="hs-special">(</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-string">&quot;Incorrect type variable on the LHS of &quot;</span><span>
</span><a name="line-1588"></a><span>                           </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot;injectivity condition&quot;</span><span>
</span><a name="line-1589"></a><span>              </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">5</span><span>
</span><a name="line-1590"></a><span>              </span><span class="hs-special">(</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Expected :&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204855"><span class="hs-identifier hs-var">resName</span></a><span>
</span><a name="line-1591"></a><span>                     </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Actual   :&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204846"><span class="hs-identifier hs-var">injFrom</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1592"></a><span>
</span><a name="line-1593"></a><span>   </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204853"><span class="hs-identifier hs-var">noRnErrors</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Base.html#null"><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628204857"><span class="hs-identifier hs-var">rhsValid</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1594"></a><span>      </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204858"><a href="#local-1628204858"><span class="hs-identifier">errorVars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Base.html#toList"><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toList</span></a><span> </span><a href="#local-1628204857"><span class="hs-identifier hs-var">rhsValid</span></a><span>
</span><a name="line-1595"></a><span>         </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a><span> </span><a href="#local-1628204845"><span class="hs-identifier hs-var">srcSpan</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span>
</span><a name="line-1596"></a><span>                        </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Unknown type variable&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#plural"><span class="hs-identifier hs-var">plural</span></a><span> </span><a href="#local-1628204858"><span class="hs-identifier hs-var">errorVars</span></a><span>
</span><a name="line-1597"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;on the RHS of injectivity condition:&quot;</span><span>
</span><a name="line-1598"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#interpp%27SP"><span class="hs-identifier hs-var">interpp'SP</span></a><span> </span><a href="#local-1628204858"><span class="hs-identifier hs-var">errorVars</span></a><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1599"></a><span>
</span><a name="line-1600"></a><span>   </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628204850"><span class="hs-identifier hs-var">injDecl'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1601"></a><span>
</span><a name="line-1602"></a><span class="hs-comment">-- We can only hit this case when the user writes injectivity annotation without</span><span>
</span><a name="line-1603"></a><span class="hs-comment">-- naming the result:</span><span>
</span><a name="line-1604"></a><span class="hs-comment">--</span><span>
</span><a name="line-1605"></a><span class="hs-comment">--   type family F a | result -&gt; a</span><span>
</span><a name="line-1606"></a><span class="hs-comment">--   type family F a :: * | result -&gt; a</span><span>
</span><a name="line-1607"></a><span class="hs-comment">--</span><span>
</span><a name="line-1608"></a><span class="hs-comment">-- So we rename injectivity annotation like we normally would except that</span><span>
</span><a name="line-1609"></a><span class="hs-comment">-- this time we expect &quot;result&quot; to be reported not in scope by rnLTyVar.</span><span>
</span><a name="line-1610"></a><span class="hs-identifier">rnInjectivityAnn</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204859"><a href="#local-1628204859"><span class="hs-identifier">srcSpan</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#InjectivityAnn"><span class="hs-identifier hs-var">InjectivityAnn</span></a><span> </span><a name="local-1628204860"><a href="#local-1628204860"><span class="hs-identifier">injFrom</span></a></a><span> </span><a name="local-1628204861"><a href="#local-1628204861"><span class="hs-identifier">injTo</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1611"></a><span>   </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-1628204859"><span class="hs-identifier hs-var">srcSpan</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1612"></a><span>   </span><span class="hs-special">(</span><a name="local-1628204864"><a href="#local-1628204864"><span class="hs-identifier">injDecl'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#askNoErrs"><span class="hs-identifier hs-var">askNoErrs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1613"></a><span>     </span><a name="local-1628204862"><a href="#local-1628204862"><span class="hs-identifier">injFrom'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLTyVar"><span class="hs-identifier hs-var">rnLTyVar</span></a><span> </span><a href="#local-1628204860"><span class="hs-identifier hs-var">injFrom</span></a><span>
</span><a name="line-1614"></a><span>     </span><a name="local-1628204863"><a href="#local-1628204863"><span class="hs-identifier">injTo'</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="RnTypes.html#rnLTyVar"><span class="hs-identifier hs-var">rnLTyVar</span></a><span> </span><a href="#local-1628204861"><span class="hs-identifier hs-var">injTo</span></a><span>
</span><a name="line-1615"></a><span>     </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628204859"><span class="hs-identifier hs-var">srcSpan</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#InjectivityAnn"><span class="hs-identifier hs-var">InjectivityAnn</span></a><span> </span><a href="#local-1628204862"><span class="hs-identifier hs-var">injFrom'</span></a><span> </span><a href="#local-1628204863"><span class="hs-identifier hs-var">injTo'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1616"></a><span>   </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-1628204864"><span class="hs-identifier hs-var">injDecl'</span></a><span>
</span><a name="line-1617"></a><span>
</span><a name="line-1618"></a><span class="hs-comment">{-
Note [Stupid theta]
~~~~~~~~~~~~~~~~~~~
Trac #3850 complains about a regression wrt 6.10 for
     data Show a =&gt; T a
There is no reason not to allow the stupid theta if there are no data
constructors.  It's still stupid, but does no harm, and I don't want
to cause programs to break unnecessarily (notably HList).  So if there
are no data constructors we allow h98_style = True
-}</span><span>
</span><a name="line-1628"></a><span>
</span><a name="line-1629"></a><span class="hs-identifier">depAnalTyClDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="HsDecls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1630"></a><span class="hs-comment">-- See Note [Dependency analysis of type and class decls]</span><span>
</span><a name="line-1631"></a><a name="depAnalTyClDecls"><a href="RnSource.html#depAnalTyClDecls"><span class="hs-identifier">depAnalTyClDecls</span></a></a><span> </span><a name="local-1628204865"><a href="#local-1628204865"><span class="hs-identifier">ds_w_fvs</span></a></a><span>
</span><a name="line-1632"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Digraph.html#stronglyConnCompFromEdgedVertices"><span class="hs-identifier hs-var">stronglyConnCompFromEdgedVertices</span></a><span> </span><a href="#local-1628204866"><span class="hs-identifier hs-var">edges</span></a><span>
</span><a name="line-1633"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1634"></a><span>    </span><a name="local-1628204866"><a href="#local-1628204866"><span class="hs-identifier">edges</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-1628204870"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">,</span><span> </span><a href="HsDecls.html#tcdName"><span class="hs-identifier hs-var">tcdName</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628204870"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1628204867"><span class="hs-identifier hs-var">get_parent</span></a><span> </span><span class="hs-special">(</span><a href="NameSet.html#nameSetElems"><span class="hs-identifier hs-var">nameSetElems</span></a><span> </span><a href="#local-1628204871"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1635"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-1628204870"><a href="#local-1628204870"><span class="hs-identifier">d</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204871"><a href="#local-1628204871"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204865"><span class="hs-identifier hs-var">ds_w_fvs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1636"></a><span>
</span><a name="line-1637"></a><span>    </span><span class="hs-comment">-- We also need to consider data constructor names since</span><span>
</span><a name="line-1638"></a><span>    </span><span class="hs-comment">-- they may appear in types because of promotion.</span><span>
</span><a name="line-1639"></a><span>    </span><a name="local-1628204867"><a href="#local-1628204867"><span class="hs-identifier">get_parent</span></a></a><span> </span><a name="local-1628204872"><a href="#local-1628204872"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a><span> </span><a href="#local-1628204868"><span class="hs-identifier hs-var">assoc_env</span></a><span> </span><a href="#local-1628204872"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><a href="Maybes.html#orElse"><span class="hs-identifier hs-var">orElse</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204872"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1640"></a><span>
</span><a name="line-1641"></a><span>    </span><span class="hs-identifier">assoc_env</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>   </span><span class="hs-comment">-- Maps a data constructor back</span><span>
</span><a name="line-1642"></a><span>                                </span><span class="hs-comment">-- to its parent type constructor</span><span>
</span><a name="line-1643"></a><span>    </span><a name="local-1628204868"><a href="#local-1628204868"><span class="hs-identifier">assoc_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#mkNameEnv"><span class="hs-identifier hs-var">mkNameEnv</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a><span> </span><a href="#local-1628204869"><span class="hs-identifier hs-var">assoc_env_list</span></a><span>
</span><a name="line-1644"></a><span>    </span><a name="local-1628204869"><a href="#local-1628204869"><span class="hs-identifier">assoc_env_list</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1645"></a><span>      </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204873"><a href="#local-1628204873"><span class="hs-identifier">d</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204865"><span class="hs-identifier hs-var">ds_w_fvs</span></a><span>
</span><a name="line-1646"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628204873"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1647"></a><span>        </span><a href="HsDecls.html#ClassDecl"><span class="hs-identifier hs-var">ClassDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcdLName</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204874"><a href="#local-1628204874"><span class="hs-identifier">cls_name</span></a></a><span>
</span><a name="line-1648"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdATs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204875"><a href="#local-1628204875"><span class="hs-identifier">ats</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1649"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#FamilyDecl"><span class="hs-identifier hs-var">FamilyDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fdLName</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204876"><a href="#local-1628204876"><span class="hs-identifier">fam_name</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204875"><span class="hs-identifier hs-var">ats</span></a><span>
</span><a name="line-1650"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-1628204876"><span class="hs-identifier hs-var">fam_name</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204874"><span class="hs-identifier hs-var">cls_name</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1651"></a><span>        </span><a href="HsDecls.html#DataDecl"><span class="hs-identifier hs-var">DataDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcdLName</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204877"><a href="#local-1628204877"><span class="hs-identifier">data_name</span></a></a><span>
</span><a name="line-1652"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdDataDefn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsDecls.html#HsDataDefn"><span class="hs-identifier hs-var">HsDataDefn</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dd_cons</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204878"><a href="#local-1628204878"><span class="hs-identifier">cons</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1653"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204879"><a href="#local-1628204879"><span class="hs-identifier">dc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204878"><span class="hs-identifier hs-var">cons</span></a><span>
</span><a name="line-1654"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsDecls.html#getConNames"><span class="hs-identifier hs-var">getConNames</span></a><span> </span><a href="#local-1628204879"><span class="hs-identifier hs-var">dc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a><span> </span><a href="#local-1628204877"><span class="hs-identifier hs-var">data_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1655"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1656"></a><span>
</span><a name="line-1657"></a><span class="hs-comment">{-
Note [Dependency analysis of type and class decls]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We need to do dependency analysis on type and class declarations
else we get bad error messages.  Consider

     data T f a = MkT f a
     data S f a = MkS f (T f a)

This has a kind error, but the error message is better if you
check T first, (fixing its kind) and *then* S.  If you do kind
inference together, you might get an error reported in S, which
is jolly confusing.  See Trac #4875

Note [Role annotations in the renamer]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We must ensure that a type's role annotation is put in the same group as the
proper type declaration. This is because role annotations are needed during
type-checking when creating the type's TyCon. So, rnRoleAnnots builds a
NameEnv (LRoleAnnotDecl Name) that maps a name to a role annotation for that
type, if any. Then, this map can be used to add the role annotations to the
groups after dependency analysis.

This process checks for duplicate role annotations, where we must be careful
to do the check *before* renaming to avoid calling all unbound names duplicates
of one another.

The renaming process, as usual, might identify and report errors for unbound
names. We exclude the annotations for unbound names in the annotation
environment to avoid spurious errors for orphaned annotations.

We then (in rnTyClDecls) do a check for orphan role annotations (role
annotations without an accompanying type decl). The check works by folding
over raw_groups (of type [[TyClDecl Name]]), selecting out the relevant
role declarations for each group, as well as diminishing the annotation
environment. After the fold is complete, anything left over in the name
environment must be an orphan, and errors are generated.

An earlier version of this algorithm short-cut the orphan check by renaming
only with names declared in this module. But, this check is insufficient in
the case of staged module compilation (Template Haskell, GHCi).
See #8485. With the new lookup process (which includes types declared in other
modules), we get better error messages, too.

*********************************************************
*                                                      *
\subsection{Support code for type/data declarations}
*                                                      *
*********************************************************
-}</span><span>
</span><a name="line-1707"></a><span>
</span><a name="line-1708"></a><span class="hs-comment">---------------</span><span>
</span><a name="line-1709"></a><span class="hs-identifier">badAssocRhs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1710"></a><a name="badAssocRhs"><a href="RnSource.html#badAssocRhs"><span class="hs-identifier">badAssocRhs</span></a></a><span> </span><a name="local-1628204880"><a href="#local-1628204880"><span class="hs-identifier">ns</span></a></a><span>
</span><a name="line-1711"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The RHS of an associated type declaration mentions&quot;</span><span>
</span><a name="line-1712"></a><span>                  </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#pprWithCommas"><span class="hs-identifier hs-var">pprWithCommas</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204880"><span class="hs-identifier hs-var">ns</span></a><span class="hs-special">)</span><span>
</span><a name="line-1713"></a><span>               </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;All such variables must be bound on the LHS&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1714"></a><span>
</span><a name="line-1715"></a><span class="hs-comment">-----------------</span><span>
</span><a name="line-1716"></a><span class="hs-identifier">rnConDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LConDecl"><span class="hs-identifier hs-type">LConDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="HsDecls.html#LConDecl"><span class="hs-identifier hs-type">LConDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1717"></a><a name="rnConDecls"><a href="RnSource.html#rnConDecls"><span class="hs-identifier">rnConDecls</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnEnv.html#mapFvRn"><span class="hs-identifier hs-var">mapFvRn</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocFstM"><span class="hs-identifier hs-var">wrapLocFstM</span></a><span> </span><a href="RnSource.html#rnConDecl"><span class="hs-identifier hs-var">rnConDecl</span></a><span class="hs-special">)</span><span>
</span><a name="line-1718"></a><span>
</span><a name="line-1719"></a><span class="hs-identifier">rnConDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#ConDecl"><span class="hs-identifier hs-type">ConDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ConDecl"><span class="hs-identifier hs-type">ConDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1720"></a><a name="rnConDecl"><a href="RnSource.html#rnConDecl"><span class="hs-identifier">rnConDecl</span></a></a><span> </span><a name="local-1628204881"><a href="#local-1628204881"><span class="hs-identifier">decl</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#ConDeclH98"><span class="hs-identifier hs-var">ConDeclH98</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">con_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204882"><a href="#local-1628204882"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_qvars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204883"><a href="#local-1628204883"><span class="hs-identifier">qtvs</span></a></a><span>
</span><a name="line-1721"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_cxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204884"><a href="#local-1628204884"><span class="hs-identifier">mcxt</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_details</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204885"><a href="#local-1628204885"><span class="hs-identifier">details</span></a></a><span>
</span><a name="line-1722"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_doc</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204886"><a href="#local-1628204886"><span class="hs-identifier">mb_doc</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1723"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#addLocM"><span class="hs-identifier hs-var">addLocM</span></a><span> </span><a href="RnNames.html#checkConName"><span class="hs-identifier hs-var">checkConName</span></a><span> </span><a href="#local-1628204882"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1724"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628204894"><a href="#local-1628204894"><span class="hs-identifier">new_name</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedTopBndrRn"><span class="hs-identifier hs-var">lookupLocatedTopBndrRn</span></a><span> </span><a href="#local-1628204882"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1725"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204895"><a href="#local-1628204895"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnEnv.html#ConDeclCtx"><span class="hs-identifier hs-var">ConDeclCtx</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628204894"><span class="hs-identifier hs-var">new_name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1726"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628204896"><a href="#local-1628204896"><span class="hs-identifier">mb_doc'</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnHsDoc.html#rnMbLHsDoc"><span class="hs-identifier hs-var">rnMbLHsDoc</span></a><span> </span><a href="#local-1628204886"><span class="hs-identifier hs-var">mb_doc</span></a><span>
</span><a name="line-1727"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204897"><a href="#local-1628204897"><span class="hs-identifier">kvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204898"><a href="#local-1628204898"><span class="hs-identifier">qtvs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204889"><span class="hs-identifier hs-var">get_con_qtvs</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#hsConDeclArgTys"><span class="hs-identifier hs-var">hsConDeclArgTys</span></a><span> </span><a href="#local-1628204885"><span class="hs-identifier hs-var">details</span></a><span class="hs-special">)</span><span>
</span><a name="line-1728"></a><span>
</span><a name="line-1729"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="RnTypes.html#bindHsQTyVars"><span class="hs-identifier hs-var">bindHsQTyVars</span></a><span> </span><a href="#local-1628204895"><span class="hs-identifier hs-var">doc</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="RnEnv.html#inHsDocContext"><span class="hs-identifier hs-var">inHsDocContext</span></a><span> </span><a href="#local-1628204895"><span class="hs-identifier hs-var">doc</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-1628204897"><span class="hs-identifier hs-var">kvs</span></a><span> </span><a href="#local-1628204898"><span class="hs-identifier hs-var">qtvs'</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1730"></a><span>          </span><span class="hs-glyph">\</span><a name="local-1628204899"><a href="#local-1628204899"><span class="hs-identifier">new_tyvars</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1731"></a><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204903"><a href="#local-1628204903"><span class="hs-identifier">new_context</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204904"><a href="#local-1628204904"><span class="hs-identifier">fvs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628204884"><span class="hs-identifier hs-var">mcxt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1732"></a><span>                             </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">,</span><a href="NameSet.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1733"></a><span>                             </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628204900"><a href="#local-1628204900"><span class="hs-identifier">lcxt</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204901"><a href="#local-1628204901"><span class="hs-identifier">lctx'</span></a></a><span class="hs-special">,</span><a name="local-1628204902"><a href="#local-1628204902"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnContext"><span class="hs-identifier hs-var">rnContext</span></a><span> </span><a href="#local-1628204895"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-1628204900"><span class="hs-identifier hs-var">lcxt</span></a><span>
</span><a name="line-1734"></a><span>                                             </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628204901"><span class="hs-identifier hs-var">lctx'</span></a><span class="hs-special">,</span><a href="#local-1628204902"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1735"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204905"><a href="#local-1628204905"><span class="hs-identifier">new_details</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204906"><a href="#local-1628204906"><span class="hs-identifier">fvs2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnConDeclDetails"><span class="hs-identifier hs-var">rnConDeclDetails</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628204894"><span class="hs-identifier hs-var">new_name</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204895"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-1628204885"><span class="hs-identifier hs-var">details</span></a><span>
</span><a name="line-1736"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628204907"><a href="#local-1628204907"><span class="hs-identifier">new_details'</span></a></a><span class="hs-special">,</span><a name="local-1628204908"><a href="#local-1628204908"><span class="hs-identifier">fvs3</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1628204905"><span class="hs-identifier hs-var">new_details</span></a><span class="hs-special">,</span><a href="NameSet.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1737"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;rnConDecl&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204882"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span>
</span><a name="line-1738"></a><span>             </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;free_kvs:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204897"><span class="hs-identifier hs-var">kvs</span></a><span>
</span><a name="line-1739"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;qtvs:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204883"><span class="hs-identifier hs-var">qtvs</span></a><span>
</span><a name="line-1740"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;qtvs':&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204898"><span class="hs-identifier hs-var">qtvs'</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1741"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204909"><a href="#local-1628204909"><span class="hs-identifier">all_fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204904"><span class="hs-identifier hs-var">fvs1</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204906"><span class="hs-identifier hs-var">fvs2</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204908"><span class="hs-identifier hs-var">fvs3</span></a><span>
</span><a name="line-1742"></a><span>              </span><a name="local-1628204910"><a href="#local-1628204910"><span class="hs-identifier">new_tyvars'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628204883"><span class="hs-identifier hs-var">qtvs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1743"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1744"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628204899"><span class="hs-identifier hs-var">new_tyvars</span></a><span>
</span><a name="line-1745"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204881"><span class="hs-identifier hs-var">decl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">con_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204894"><span class="hs-identifier hs-var">new_name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_qvars</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204910"><span class="hs-identifier hs-var">new_tyvars'</span></a><span>
</span><a name="line-1746"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_cxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204903"><span class="hs-identifier hs-var">new_context</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_details</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204907"><span class="hs-identifier hs-var">new_details'</span></a><span>
</span><a name="line-1747"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_doc</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204896"><span class="hs-identifier hs-var">mb_doc'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><a name="line-1748"></a><span>                  </span><a href="#local-1628204909"><span class="hs-identifier hs-var">all_fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-1749"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1750"></a><span>    </span><a name="local-1628204887"><a href="#local-1628204887"><span class="hs-identifier">cxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628204884"><span class="hs-identifier hs-var">mcxt</span></a><span>
</span><a name="line-1751"></a><span>    </span><a name="local-1628204888"><a href="#local-1628204888"><span class="hs-identifier">get_rdr_tvs</span></a></a><span> </span><a name="local-1628204890"><a href="#local-1628204890"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#extractHsTysRdrTyVars"><span class="hs-identifier hs-var">extractHsTysRdrTyVars</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204887"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628204890"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-1752"></a><span>
</span><a name="line-1753"></a><span>    </span><span class="hs-identifier">get_con_qtvs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span>
</span><a name="line-1754"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="HsTypes.html#LHsQTyVars"><span class="hs-identifier hs-type">LHsQTyVars</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">)</span><span>
</span><a name="line-1755"></a><span>    </span><a name="local-1628204889"><a href="#local-1628204889"><span class="hs-identifier">get_con_qtvs</span></a></a><span> </span><a name="local-1628204891"><a href="#local-1628204891"><span class="hs-identifier">arg_tys</span></a></a><span>
</span><a name="line-1756"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628204892"><a href="#local-1628204892"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204883"><span class="hs-identifier hs-var">qtvs</span></a><span>   </span><span class="hs-comment">-- data T = forall a. MkT (a -&gt; a)</span><span>
</span><a name="line-1757"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204893"><a href="#local-1628204893"><span class="hs-identifier">free_vars</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204888"><span class="hs-identifier hs-var">get_rdr_tvs</span></a><span> </span><a href="#local-1628204891"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-1758"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#freeKiTyVarsKindVars"><span class="hs-identifier hs-var">freeKiTyVarsKindVars</span></a><span> </span><a href="#local-1628204893"><span class="hs-identifier hs-var">free_vars</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204892"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1759"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>  </span><span class="hs-comment">-- data T = MkT (a -&gt; a)</span><span>
</span><a name="line-1760"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="HsTypes.html#mkHsQTvs"><span class="hs-identifier hs-var">mkHsQTvs</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1761"></a><span>
</span><a name="line-1762"></a><span class="hs-identifier">rnConDecl</span><span> </span><a name="local-1628204911"><a href="#local-1628204911"><span class="hs-identifier">decl</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#ConDeclGADT"><span class="hs-identifier hs-var">ConDeclGADT</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">con_names</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204912"><a href="#local-1628204912"><span class="hs-identifier">names</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_type</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204913"><a href="#local-1628204913"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1763"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_doc</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204914"><a href="#local-1628204914"><span class="hs-identifier">mb_doc</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1764"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#addLocM"><span class="hs-identifier hs-var">addLocM</span></a><span> </span><a href="RnNames.html#checkConName"><span class="hs-identifier hs-var">checkConName</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204912"><span class="hs-identifier hs-var">names</span></a><span>
</span><a name="line-1765"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628204915"><a href="#local-1628204915"><span class="hs-identifier">new_names</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="RnEnv.html#lookupLocatedTopBndrRn"><span class="hs-identifier hs-var">lookupLocatedTopBndrRn</span></a><span> </span><a href="#local-1628204912"><span class="hs-identifier hs-var">names</span></a><span>
</span><a name="line-1766"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204916"><a href="#local-1628204916"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnEnv.html#ConDeclCtx"><span class="hs-identifier hs-var">ConDeclCtx</span></a><span> </span><a href="#local-1628204915"><span class="hs-identifier hs-var">new_names</span></a><span>
</span><a name="line-1767"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628204917"><a href="#local-1628204917"><span class="hs-identifier">mb_doc'</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnHsDoc.html#rnMbLHsDoc"><span class="hs-identifier hs-var">rnMbLHsDoc</span></a><span> </span><a href="#local-1628204914"><span class="hs-identifier hs-var">mb_doc</span></a><span>
</span><a name="line-1768"></a><span>
</span><a name="line-1769"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204918"><a href="#local-1628204918"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204919"><a href="#local-1628204919"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnHsSigType"><span class="hs-identifier hs-var">rnHsSigType</span></a><span> </span><a href="#local-1628204916"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-1628204913"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1770"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;rnConDecl&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204912"><span class="hs-identifier hs-var">names</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span>
</span><a name="line-1771"></a><span>             </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;fvs:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204919"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1772"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204911"><span class="hs-identifier hs-var">decl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">con_names</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204915"><span class="hs-identifier hs-var">new_names</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_type</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204918"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1773"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_doc</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204917"><span class="hs-identifier hs-var">mb_doc'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><a name="line-1774"></a><span>                  </span><a href="#local-1628204919"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1775"></a><span>
</span><a name="line-1776"></a><span class="hs-identifier">rnConDeclDetails</span><span>
</span><a name="line-1777"></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-1778"></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnEnv.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span>
</span><a name="line-1779"></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#HsConDetails"><span class="hs-identifier hs-type">HsConDetails</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><span class="hs-special">[</span><a href="HsTypes.html#LConDeclField"><span class="hs-identifier hs-type">LConDeclField</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1780"></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsConDetails"><span class="hs-identifier hs-type">HsConDetails</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><span class="hs-special">[</span><a href="HsTypes.html#LConDeclField"><span class="hs-identifier hs-type">LConDeclField</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1781"></a><a name="rnConDeclDetails"><a href="RnSource.html#rnConDeclDetails"><span class="hs-identifier">rnConDeclDetails</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204920"><a href="#local-1628204920"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#PrefixCon"><span class="hs-identifier hs-var">PrefixCon</span></a><span> </span><a name="local-1628204921"><a href="#local-1628204921"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1782"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204922"><a href="#local-1628204922"><span class="hs-identifier">new_tys</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204923"><a href="#local-1628204923"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTypes"><span class="hs-identifier hs-var">rnLHsTypes</span></a><span> </span><a href="#local-1628204920"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-1628204921"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1783"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#PrefixCon"><span class="hs-identifier hs-var">PrefixCon</span></a><span> </span><a href="#local-1628204922"><span class="hs-identifier hs-var">new_tys</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204923"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1784"></a><span>
</span><a name="line-1785"></a><span class="hs-identifier">rnConDeclDetails</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204924"><a href="#local-1628204924"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#InfixCon"><span class="hs-identifier hs-var">InfixCon</span></a><span> </span><a name="local-1628204925"><a href="#local-1628204925"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-1628204926"><a href="#local-1628204926"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1786"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204927"><a href="#local-1628204927"><span class="hs-identifier">new_ty1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204928"><a href="#local-1628204928"><span class="hs-identifier">fvs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsType"><span class="hs-identifier hs-var">rnLHsType</span></a><span> </span><a href="#local-1628204924"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-1628204925"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-1787"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204929"><a href="#local-1628204929"><span class="hs-identifier">new_ty2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204930"><a href="#local-1628204930"><span class="hs-identifier">fvs2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsType"><span class="hs-identifier hs-var">rnLHsType</span></a><span> </span><a href="#local-1628204924"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-1628204926"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-1788"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#InfixCon"><span class="hs-identifier hs-var">InfixCon</span></a><span> </span><a href="#local-1628204927"><span class="hs-identifier hs-var">new_ty1</span></a><span> </span><a href="#local-1628204929"><span class="hs-identifier hs-var">new_ty2</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204928"><span class="hs-identifier hs-var">fvs1</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204930"><span class="hs-identifier hs-var">fvs2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1789"></a><span>
</span><a name="line-1790"></a><span class="hs-identifier">rnConDeclDetails</span><span> </span><a name="local-1628204931"><a href="#local-1628204931"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-1628204932"><a href="#local-1628204932"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#RecCon"><span class="hs-identifier hs-var">RecCon</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204933"><a href="#local-1628204933"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1628204934"><a href="#local-1628204934"><span class="hs-identifier">fields</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1791"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1628204935"><a href="#local-1628204935"><span class="hs-identifier">fls</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupConstructorFields"><span class="hs-identifier hs-var">lookupConstructorFields</span></a><span> </span><a href="#local-1628204931"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-1792"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204936"><a href="#local-1628204936"><span class="hs-identifier">new_fields</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204937"><a href="#local-1628204937"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnConDeclFields"><span class="hs-identifier hs-var">rnConDeclFields</span></a><span> </span><a href="#local-1628204932"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-1628204935"><span class="hs-identifier hs-var">fls</span></a><span> </span><a href="#local-1628204934"><span class="hs-identifier hs-var">fields</span></a><span>
</span><a name="line-1793"></a><span>                </span><span class="hs-comment">-- No need to check for duplicate fields</span><span>
</span><a name="line-1794"></a><span>                </span><span class="hs-comment">-- since that is done by RnNames.extendGlobalRdrEnvRn</span><span>
</span><a name="line-1795"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#RecCon"><span class="hs-identifier hs-var">RecCon</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628204933"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1628204936"><span class="hs-identifier hs-var">new_fields</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-1628204937"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1796"></a><span>
</span><a name="line-1797"></a><span class="hs-comment">-------------------------------------------------</span><span>
</span><a name="line-1798"></a><span>
</span><a name="line-1799"></a><span class="hs-comment">-- | Brings pattern synonym names and also pattern synonym selectors</span><span>
</span><a name="line-1800"></a><span class="hs-comment">-- from record pattern synonyms into scope.</span><span>
</span><a name="line-1801"></a><span class="hs-identifier">extendPatSynEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsBinds.html#HsValBinds"><span class="hs-identifier hs-type">HsValBinds</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnEnv.html#MiniFixityEnv"><span class="hs-identifier hs-type">MiniFixityEnv</span></a><span>
</span><a name="line-1802"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span> </span><a href="TcRnTypes.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a><span> </span><a href="#local-1628204241"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628204241"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1803"></a><a name="extendPatSynEnv"><a href="RnSource.html#extendPatSynEnv"><span class="hs-identifier">extendPatSynEnv</span></a></a><span> </span><a name="local-1628204938"><a href="#local-1628204938"><span class="hs-identifier">val_decls</span></a></a><span> </span><a name="local-1628204939"><a href="#local-1628204939"><span class="hs-identifier">local_fix_env</span></a></a><span> </span><a name="local-1628204940"><a href="#local-1628204940"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1804"></a><span>     </span><a name="local-1628204959"><a href="#local-1628204959"><span class="hs-identifier">names_with_fls</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204941"><span class="hs-identifier hs-var">new_ps</span></a><span> </span><a href="#local-1628204938"><span class="hs-identifier hs-var">val_decls</span></a><span>
</span><a name="line-1805"></a><span>   </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204960"><a href="#local-1628204960"><span class="hs-identifier">pat_syn_bndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1806"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628204961"><span class="hs-identifier hs-var">name</span></a><span class="hs-glyph">:</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-identifier">flSelector</span><span> </span><a href="#local-1628204962"><span class="hs-identifier hs-var">fields</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-1628204961"><a href="#local-1628204961"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204962"><a href="#local-1628204962"><span class="hs-identifier">fields</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204959"><span class="hs-identifier hs-var">names_with_fls</span></a><span class="hs-special">]</span><span>
</span><a name="line-1807"></a><span>   </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204963"><a href="#local-1628204963"><span class="hs-identifier">avails</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Avail.html#patSynAvail"><span class="hs-identifier hs-var">patSynAvail</span></a><span> </span><a href="#local-1628204960"><span class="hs-identifier hs-var">pat_syn_bndrs</span></a><span>
</span><a name="line-1808"></a><span>   </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204964"><a href="#local-1628204964"><span class="hs-identifier">gbl_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204965"><a href="#local-1628204965"><span class="hs-identifier">lcl_env</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-1809"></a><span>        </span><a href="RnNames.html#extendGlobalRdrEnvRn"><span class="hs-identifier hs-var">extendGlobalRdrEnvRn</span></a><span> </span><a href="#local-1628204963"><span class="hs-identifier hs-var">avails</span></a><span> </span><a href="#local-1628204939"><span class="hs-identifier hs-var">local_fix_env</span></a><span>
</span><a name="line-1810"></a><span>
</span><a name="line-1811"></a><span>
</span><a name="line-1812"></a><span>   </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204966"><a href="#local-1628204966"><span class="hs-identifier">field_env'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#extendNameEnvList"><span class="hs-identifier hs-var">extendNameEnvList</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcg_field_env</span><span> </span><a href="#local-1628204964"><span class="hs-identifier hs-var">gbl_env</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204959"><span class="hs-identifier hs-var">names_with_fls</span></a><span>
</span><a name="line-1813"></a><span>         </span><a name="local-1628204967"><a href="#local-1628204967"><span class="hs-identifier">final_gbl_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204964"><span class="hs-identifier hs-var">gbl_env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_field_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204966"><span class="hs-identifier hs-var">field_env'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1814"></a><span>   </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#setEnvs"><span class="hs-identifier hs-var">setEnvs</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204967"><span class="hs-identifier hs-var">final_gbl_env</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204965"><span class="hs-identifier hs-var">lcl_env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1628204940"><span class="hs-identifier hs-var">thing</span></a><span> </span><a href="#local-1628204960"><span class="hs-identifier hs-var">pat_syn_bndrs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1815"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1816"></a><span>    </span><span class="hs-identifier">new_ps</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsBinds.html#HsValBinds"><span class="hs-identifier hs-type">HsValBinds</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1817"></a><span>    </span><a name="local-1628204941"><a href="#local-1628204941"><span class="hs-identifier">new_ps</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#ValBindsIn"><span class="hs-identifier hs-var">ValBindsIn</span></a><span> </span><a name="local-1628204943"><a href="#local-1628204943"><span class="hs-identifier">binds</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#foldrBagM"><span class="hs-identifier hs-var">foldrBagM</span></a><span> </span><a href="#local-1628204942"><span class="hs-identifier hs-var">new_ps'</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-1628204943"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-1818"></a><span>    </span><span class="hs-identifier">new_ps</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;new_ps&quot;</span><span>
</span><a name="line-1819"></a><span>
</span><a name="line-1820"></a><span>    </span><span class="hs-identifier">new_ps'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsBinds.html#LHsBindLR"><span class="hs-identifier hs-type">LHsBindLR</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-1821"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1822"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1823"></a><span>    </span><a name="local-1628204942"><a href="#local-1628204942"><span class="hs-identifier">new_ps'</span></a></a><span> </span><a name="local-1628204944"><a href="#local-1628204944"><span class="hs-identifier">bind</span></a></a><span> </span><a name="local-1628204945"><a href="#local-1628204945"><span class="hs-identifier">names</span></a></a><span>
</span><a name="line-1824"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204946"><a href="#local-1628204946"><span class="hs-identifier">bind_loc</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#PatSynBind"><span class="hs-identifier hs-var">PatSynBind</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#PSB"><span class="hs-identifier hs-var">PSB</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">psb_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204947"><a href="#local-1628204947"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-1825"></a><span>                                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">psb_args</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsBinds.html#RecordPatSyn"><span class="hs-identifier hs-var">RecordPatSyn</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204944"><span class="hs-identifier hs-var">bind</span></a><span>
</span><a name="line-1826"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1827"></a><span>          </span><a name="local-1628204949"><a href="#local-1628204949"><span class="hs-identifier">bnd_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#newTopSrcBinder"><span class="hs-identifier hs-var">newTopSrcBinder</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628204946"><span class="hs-identifier hs-var">bind_loc</span></a><span> </span><a href="#local-1628204947"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-1828"></a><span>          </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204950"><a href="#local-1628204950"><span class="hs-identifier">rnames</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-identifier">recordPatSynSelectorId</span><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-1829"></a><span>              </span><span class="hs-identifier">mkFieldOcc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LFieldOcc"><span class="hs-identifier hs-type">LFieldOcc</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-1830"></a><span>              </span><a name="local-1628204951"><a href="#local-1628204951"><span class="hs-identifier">mkFieldOcc</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204953"><a href="#local-1628204953"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1628204954"><a href="#local-1628204954"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628204953"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#FieldOcc"><span class="hs-identifier hs-var">FieldOcc</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628204953"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1628204954"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><a href="PlaceHolder.html#PlaceHolder"><span class="hs-identifier hs-var">PlaceHolder</span></a><span class="hs-special">)</span><span>
</span><a name="line-1831"></a><span>              </span><a name="local-1628204952"><a href="#local-1628204952"><span class="hs-identifier">field_occs</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1628204951"><span class="hs-identifier hs-var">mkFieldOcc</span></a><span> </span><a href="#local-1628204950"><span class="hs-identifier hs-var">rnames</span></a><span>
</span><a name="line-1832"></a><span>          </span><a name="local-1628204955"><a href="#local-1628204955"><span class="hs-identifier">flds</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="RnNames.html#newRecordSelector"><span class="hs-identifier hs-var">newRecordSelector</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">[</span><a href="#local-1628204949"><span class="hs-identifier hs-var">bnd_name</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-1628204952"><span class="hs-identifier hs-var">field_occs</span></a><span>
</span><a name="line-1833"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-1628204949"><span class="hs-identifier hs-var">bnd_name</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204955"><span class="hs-identifier hs-var">flds</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><span> </span><a href="#local-1628204945"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">)</span><span>
</span><a name="line-1834"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204956"><a href="#local-1628204956"><span class="hs-identifier">bind_loc</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#PatSynBind"><span class="hs-identifier hs-var">PatSynBind</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#PSB"><span class="hs-identifier hs-var">PSB</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">psb_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204957"><a href="#local-1628204957"><span class="hs-identifier">n</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204944"><span class="hs-identifier hs-var">bind</span></a><span>
</span><a name="line-1835"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1836"></a><span>        </span><a name="local-1628204958"><a href="#local-1628204958"><span class="hs-identifier">bnd_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#newTopSrcBinder"><span class="hs-identifier hs-var">newTopSrcBinder</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628204956"><span class="hs-identifier hs-var">bind_loc</span></a><span> </span><a href="#local-1628204957"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-1837"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-1628204958"><span class="hs-identifier hs-var">bnd_name</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span> </span><a href="#local-1628204945"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">)</span><span>
</span><a name="line-1838"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1839"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628204945"><span class="hs-identifier hs-var">names</span></a><span>
</span><a name="line-1840"></a><span>
</span><a name="line-1841"></a><span class="hs-comment">{-
*********************************************************
*                                                      *
\subsection{Support code to rename types}
*                                                      *
*********************************************************
-}</span><span>
</span><a name="line-1848"></a><span>
</span><a name="line-1849"></a><span class="hs-identifier">rnFds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><span class="hs-special">(</span><a href="Class.html#FunDep"><span class="hs-identifier hs-type">FunDep</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1850"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><span class="hs-special">(</span><a href="Class.html#FunDep"><span class="hs-identifier hs-type">FunDep</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1851"></a><a name="rnFds"><a href="RnSource.html#rnFds"><span class="hs-identifier">rnFds</span></a></a><span> </span><a name="local-1628204968"><a href="#local-1628204968"><span class="hs-identifier">fds</span></a></a><span>
</span><a name="line-1852"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><a href="#local-1628204969"><span class="hs-identifier hs-var">rn_fds</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204968"><span class="hs-identifier hs-var">fds</span></a><span>
</span><a name="line-1853"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1854"></a><span>    </span><a name="local-1628204969"><a href="#local-1628204969"><span class="hs-identifier">rn_fds</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628204970"><a href="#local-1628204970"><span class="hs-identifier">tys1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204971"><a href="#local-1628204971"><span class="hs-identifier">tys2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1855"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204972"><a href="#local-1628204972"><span class="hs-identifier">tys1'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnHsTyVars"><span class="hs-identifier hs-var">rnHsTyVars</span></a><span> </span><a href="#local-1628204970"><span class="hs-identifier hs-var">tys1</span></a><span>
</span><a name="line-1856"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-1628204973"><a href="#local-1628204973"><span class="hs-identifier">tys2'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnHsTyVars"><span class="hs-identifier hs-var">rnHsTyVars</span></a><span> </span><a href="#local-1628204971"><span class="hs-identifier hs-var">tys2</span></a><span>
</span><a name="line-1857"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204972"><span class="hs-identifier hs-var">tys1'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204973"><span class="hs-identifier hs-var">tys2'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1858"></a><span>
</span><a name="line-1859"></a><span class="hs-identifier">rnHsTyVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1860"></a><a name="rnHsTyVars"><a href="RnSource.html#rnHsTyVars"><span class="hs-identifier">rnHsTyVars</span></a></a><span> </span><a name="local-1628204974"><a href="#local-1628204974"><span class="hs-identifier">tvs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="RnSource.html#rnHsTyVar"><span class="hs-identifier hs-var">rnHsTyVar</span></a><span> </span><a href="#local-1628204974"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-1861"></a><span>
</span><a name="line-1862"></a><span class="hs-identifier">rnHsTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1863"></a><a name="rnHsTyVar"><a href="RnSource.html#rnHsTyVar"><span class="hs-identifier">rnHsTyVar</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204975"><a href="#local-1628204975"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1628204976"><a href="#local-1628204976"><span class="hs-identifier">tyvar</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1864"></a><span>  </span><a name="local-1628204977"><a href="#local-1628204977"><span class="hs-identifier">tyvar'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupOccRn"><span class="hs-identifier hs-var">lookupOccRn</span></a><span> </span><a href="#local-1628204976"><span class="hs-identifier hs-var">tyvar</span></a><span>
</span><a name="line-1865"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628204975"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1628204977"><span class="hs-identifier hs-var">tyvar'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1866"></a><span>
</span><a name="line-1867"></a><span class="hs-comment">{-
*********************************************************
*                                                      *
        findSplice
*                                                      *
*********************************************************

This code marches down the declarations, looking for the first
Template Haskell splice.  As it does so it
        a) groups the declarations into a HsGroup
        b) runs any top-level quasi-quotes
-}</span><span>
</span><a name="line-1879"></a><span>
</span><a name="line-1880"></a><span class="hs-identifier">findSplice</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#SpliceDecl"><span class="hs-identifier hs-type">SpliceDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1881"></a><a name="findSplice"><a href="RnSource.html#findSplice"><span class="hs-identifier">findSplice</span></a></a><span> </span><a name="local-1628204978"><a href="#local-1628204978"><span class="hs-identifier">ds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><a href="HsDecls.html#emptyRdrGroup"><span class="hs-identifier hs-var">emptyRdrGroup</span></a><span> </span><a href="#local-1628204978"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-1882"></a><span>
</span><a name="line-1883"></a><span class="hs-identifier">addl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span>
</span><a name="line-1884"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#SpliceDecl"><span class="hs-identifier hs-type">SpliceDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1885"></a><span class="hs-comment">-- This stuff reverses the declarations (again) but it doesn't matter</span><span>
</span><a name="line-1886"></a><a name="addl"><a href="RnSource.html#addl"><span class="hs-identifier">addl</span></a></a><span> </span><a name="local-1628204979"><a href="#local-1628204979"><span class="hs-identifier">gp</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204979"><span class="hs-identifier hs-var">gp</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span>
</span><a name="line-1887"></a><span class="hs-identifier">addl</span><span> </span><a name="local-1628204980"><a href="#local-1628204980"><span class="hs-identifier">gp</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628204981"><a href="#local-1628204981"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1628204982"><a href="#local-1628204982"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-1628204983"><a href="#local-1628204983"><span class="hs-identifier">ds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#add"><span class="hs-identifier hs-var">add</span></a><span> </span><a href="#local-1628204980"><span class="hs-identifier hs-var">gp</span></a><span> </span><a href="#local-1628204981"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1628204982"><span class="hs-identifier hs-var">d</span></a><span> </span><a href="#local-1628204983"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-1888"></a><span>
</span><a name="line-1889"></a><span>
</span><a name="line-1890"></a><span class="hs-identifier">add</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#HsDecl"><span class="hs-identifier hs-type">HsDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span>
</span><a name="line-1891"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#SpliceDecl"><span class="hs-identifier hs-type">SpliceDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1892"></a><span>
</span><a name="line-1893"></a><span class="hs-comment">-- #10047: Declaration QuasiQuoters are expanded immediately, without</span><span>
</span><a name="line-1894"></a><span class="hs-comment">--         causing a group split</span><span>
</span><a name="line-1895"></a><a name="add"><a href="RnSource.html#add"><span class="hs-identifier">add</span></a></a><span> </span><a name="local-1628204984"><a href="#local-1628204984"><span class="hs-identifier">gp</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#SpliceD"><span class="hs-identifier hs-var">SpliceD</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#SpliceDecl"><span class="hs-identifier hs-var">SpliceDecl</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204985"><a href="#local-1628204985"><span class="hs-identifier">qq</span></a></a><span class="hs-glyph">@</span><a href="HsExpr.html#HsQuasiQuote"><span class="hs-identifier hs-var">HsQuasiQuote</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-1628204986"><a href="#local-1628204986"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-1896"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204987"><a href="#local-1628204987"><span class="hs-identifier">ds'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSplice.html#rnTopSpliceDecls"><span class="hs-identifier hs-var">rnTopSpliceDecls</span></a><span> </span><a href="#local-1628204985"><span class="hs-identifier hs-var">qq</span></a><span>
</span><a name="line-1897"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><a href="#local-1628204984"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204987"><span class="hs-identifier hs-var">ds'</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628204986"><span class="hs-identifier hs-var">ds</span></a><span class="hs-special">)</span><span>
</span><a name="line-1898"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-1899"></a><span>
</span><a name="line-1900"></a><span class="hs-identifier">add</span><span> </span><a name="local-1628204988"><a href="#local-1628204988"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1628204989"><a href="#local-1628204989"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#SpliceD"><span class="hs-identifier hs-var">SpliceD</span></a><span> </span><a name="local-1628204990"><a href="#local-1628204990"><span class="hs-identifier">splice</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#SpliceDecl"><span class="hs-identifier hs-var">SpliceDecl</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204991"><a href="#local-1628204991"><span class="hs-identifier">flag</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-1628204992"><a href="#local-1628204992"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-1901"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- We've found a top-level splice.  If it is an *implicit* one</span><span>
</span><a name="line-1902"></a><span>         </span><span class="hs-comment">-- (i.e. a naked top level expression)</span><span>
</span><a name="line-1903"></a><span>         </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628204991"><span class="hs-identifier hs-var">flag</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1904"></a><span>           </span><a href="HsDecls.html#ExplicitSplice"><span class="hs-identifier hs-var">ExplicitSplice</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1905"></a><span>           </span><a href="HsDecls.html#ImplicitSplice"><span class="hs-identifier hs-var">ImplicitSplice</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204994"><a href="#local-1628204994"><span class="hs-identifier">th_on</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html#TemplateHaskell"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">TemplateHaskell</span></a><span>
</span><a name="line-1906"></a><span>                                </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><a href="#local-1628204994"><span class="hs-identifier hs-var">th_on</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-1628204989"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1907"></a><span>                                  </span><a href="TcRnMonad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a><span> </span><a href="#local-1628204993"><span class="hs-identifier hs-var">badImplicitSplice</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1908"></a><span>
</span><a name="line-1909"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204988"><span class="hs-identifier hs-var">gp</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204990"><span class="hs-identifier hs-var">splice</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204992"><span class="hs-identifier hs-var">ds</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1910"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1911"></a><span>    </span><a name="local-1628204993"><a href="#local-1628204993"><span class="hs-identifier">badImplicitSplice</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Parse error: naked expression at top level&quot;</span><span>
</span><a name="line-1912"></a><span>                     </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Perhaps you intended to use TemplateHaskell&quot;</span><span>
</span><a name="line-1913"></a><span>
</span><a name="line-1914"></a><span class="hs-comment">-- Class declarations: pull out the fixity signatures to the top</span><span>
</span><a name="line-1915"></a><span class="hs-identifier">add</span><span> </span><a name="local-1628204995"><a href="#local-1628204995"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204996"><a href="#local-1628204996"><span class="hs-identifier">ts</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hs_fixds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204997"><a href="#local-1628204997"><span class="hs-identifier">fs</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628204998"><a href="#local-1628204998"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyClD"><span class="hs-identifier hs-var">TyClD</span></a><span> </span><a name="local-1628204999"><a href="#local-1628204999"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628205000"><a href="#local-1628205000"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-1916"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="HsDecls.html#isClassDecl"><span class="hs-identifier hs-var">isClassDecl</span></a><span> </span><a href="#local-1628204999"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-1917"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628205001"><a href="#local-1628205001"><span class="hs-identifier">fsigs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628205002"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1628205003"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628205002"><a href="#local-1628205002"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#FixSig"><span class="hs-identifier hs-var">FixSig</span></a><span> </span><a name="local-1628205003"><a href="#local-1628205003"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">tcdSigs</span><span> </span><a href="#local-1628204999"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-1918"></a><span>    </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204995"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#add_tycld"><span class="hs-identifier hs-var">add_tycld</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628204998"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1628204999"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204996"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hs_fixds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628205001"><span class="hs-identifier hs-var">fsigs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628204997"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-1628205000"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-1919"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1920"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204995"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#add_tycld"><span class="hs-identifier hs-var">add_tycld</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628204998"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1628204999"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204996"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-1628205000"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-1921"></a><span>
</span><a name="line-1922"></a><span class="hs-comment">-- Signatures: fixity sigs go a different place than all others</span><span>
</span><a name="line-1923"></a><span class="hs-identifier">add</span><span> </span><a name="local-1628205004"><a href="#local-1628205004"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_fixds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628205005"><a href="#local-1628205005"><span class="hs-identifier">ts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628205006"><a href="#local-1628205006"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#SigD"><span class="hs-identifier hs-var">SigD</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#FixSig"><span class="hs-identifier hs-var">FixSig</span></a><span> </span><a name="local-1628205007"><a href="#local-1628205007"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-1628205008"><a href="#local-1628205008"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-1924"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628205004"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_fixds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628205006"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1628205007"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628205005"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-1628205008"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-1925"></a><span class="hs-identifier">add</span><span> </span><a name="local-1628205009"><a href="#local-1628205009"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_valds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628205010"><a href="#local-1628205010"><span class="hs-identifier">ts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628205011"><a href="#local-1628205011"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#SigD"><span class="hs-identifier hs-var">SigD</span></a><span> </span><a name="local-1628205012"><a href="#local-1628205012"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628205013"><a href="#local-1628205013"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-1926"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628205009"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_valds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#add_sig"><span class="hs-identifier hs-var">add_sig</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628205011"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1628205012"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628205010"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-1628205013"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-1927"></a><span>
</span><a name="line-1928"></a><span class="hs-comment">-- Value declarations: use add_bind</span><span>
</span><a name="line-1929"></a><span class="hs-identifier">add</span><span> </span><a name="local-1628205014"><a href="#local-1628205014"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_valds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628205015"><a href="#local-1628205015"><span class="hs-identifier">ts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628205016"><a href="#local-1628205016"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ValD"><span class="hs-identifier hs-var">ValD</span></a><span> </span><a name="local-1628205017"><a href="#local-1628205017"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628205018"><a href="#local-1628205018"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-1930"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628205014"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_valds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#add_bind"><span class="hs-identifier hs-var">add_bind</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628205016"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1628205017"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628205015"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-1628205018"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-1931"></a><span>
</span><a name="line-1932"></a><span class="hs-comment">-- Role annotations: added to the TyClGroup</span><span>
</span><a name="line-1933"></a><span class="hs-identifier">add</span><span> </span><a name="local-1628205019"><a href="#local-1628205019"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628205020"><a href="#local-1628205020"><span class="hs-identifier">ts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628205021"><a href="#local-1628205021"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#RoleAnnotD"><span class="hs-identifier hs-var">RoleAnnotD</span></a><span> </span><a name="local-1628205022"><a href="#local-1628205022"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628205023"><a href="#local-1628205023"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-1934"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628205019"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#add_role_annot"><span class="hs-identifier hs-var">add_role_annot</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628205021"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1628205022"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628205020"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-1628205023"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-1935"></a><span>
</span><a name="line-1936"></a><span class="hs-comment">-- The rest are routine</span><span>
</span><a name="line-1937"></a><span class="hs-identifier">add</span><span> </span><a name="local-1628205024"><a href="#local-1628205024"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_instds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628205025"><a href="#local-1628205025"><span class="hs-identifier">ts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><a name="local-1628205026"><a href="#local-1628205026"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#InstD"><span class="hs-identifier hs-var">InstD</span></a><span> </span><a name="local-1628205027"><a href="#local-1628205027"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628205028"><a href="#local-1628205028"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-1938"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628205024"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_instds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628205026"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1628205027"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628205025"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-1628205028"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-1939"></a><span class="hs-identifier">add</span><span> </span><a name="local-1628205029"><a href="#local-1628205029"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_derivds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628205030"><a href="#local-1628205030"><span class="hs-identifier">ts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><a name="local-1628205031"><a href="#local-1628205031"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DerivD"><span class="hs-identifier hs-var">DerivD</span></a><span> </span><a name="local-1628205032"><a href="#local-1628205032"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628205033"><a href="#local-1628205033"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-1940"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628205029"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_derivds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628205031"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1628205032"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628205030"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-1628205033"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-1941"></a><span class="hs-identifier">add</span><span> </span><a name="local-1628205034"><a href="#local-1628205034"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_defds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628205035"><a href="#local-1628205035"><span class="hs-identifier">ts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><a name="local-1628205036"><a href="#local-1628205036"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DefD"><span class="hs-identifier hs-var">DefD</span></a><span> </span><a name="local-1628205037"><a href="#local-1628205037"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628205038"><a href="#local-1628205038"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-1942"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628205034"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_defds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628205036"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1628205037"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628205035"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-1628205038"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-1943"></a><span class="hs-identifier">add</span><span> </span><a name="local-1628205039"><a href="#local-1628205039"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_fords</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628205040"><a href="#local-1628205040"><span class="hs-identifier">ts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628205041"><a href="#local-1628205041"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ForD"><span class="hs-identifier hs-var">ForD</span></a><span> </span><a name="local-1628205042"><a href="#local-1628205042"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628205043"><a href="#local-1628205043"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-1944"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628205039"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_fords</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628205041"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1628205042"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628205040"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-1628205043"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-1945"></a><span class="hs-identifier">add</span><span> </span><a name="local-1628205044"><a href="#local-1628205044"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_warnds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628205045"><a href="#local-1628205045"><span class="hs-identifier">ts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><a name="local-1628205046"><a href="#local-1628205046"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#WarningD"><span class="hs-identifier hs-var">WarningD</span></a><span> </span><a name="local-1628205047"><a href="#local-1628205047"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628205048"><a href="#local-1628205048"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-1946"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628205044"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_warnds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628205046"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1628205047"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628205045"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-1628205048"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-1947"></a><span class="hs-identifier">add</span><span> </span><a name="local-1628205049"><a href="#local-1628205049"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_annds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628205050"><a href="#local-1628205050"><span class="hs-identifier">ts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628205051"><a href="#local-1628205051"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#AnnD"><span class="hs-identifier hs-var">AnnD</span></a><span> </span><a name="local-1628205052"><a href="#local-1628205052"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628205053"><a href="#local-1628205053"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-1948"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628205049"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_annds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628205051"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1628205052"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628205050"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-1628205053"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-1949"></a><span class="hs-identifier">add</span><span> </span><a name="local-1628205054"><a href="#local-1628205054"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_ruleds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628205055"><a href="#local-1628205055"><span class="hs-identifier">ts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628205056"><a href="#local-1628205056"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#RuleD"><span class="hs-identifier hs-var">RuleD</span></a><span> </span><a name="local-1628205057"><a href="#local-1628205057"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628205058"><a href="#local-1628205058"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-1950"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628205054"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_ruleds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628205056"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1628205057"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628205055"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-1628205058"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-1951"></a><span class="hs-identifier">add</span><span> </span><a name="local-1628205059"><a href="#local-1628205059"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_vects</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628205060"><a href="#local-1628205060"><span class="hs-identifier">ts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628205061"><a href="#local-1628205061"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#VectD"><span class="hs-identifier hs-var">VectD</span></a><span> </span><a name="local-1628205062"><a href="#local-1628205062"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628205063"><a href="#local-1628205063"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-1952"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628205059"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_vects</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628205061"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1628205062"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628205060"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-1628205063"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-1953"></a><span class="hs-identifier">add</span><span> </span><a name="local-1628205064"><a href="#local-1628205064"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1628205065"><a href="#local-1628205065"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DocD"><span class="hs-identifier hs-var">DocD</span></a><span> </span><a name="local-1628205066"><a href="#local-1628205066"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628205067"><a href="#local-1628205067"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-1954"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628205064"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_docs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628205065"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1628205066"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hs_docs</span><span> </span><a href="#local-1628205064"><span class="hs-identifier hs-var">gp</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><a href="#local-1628205067"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-1955"></a><span>
</span><a name="line-1956"></a><span class="hs-identifier">add_tycld</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a><span> </span><a href="#local-1628204240"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-type">TyClGroup</span></a><span> </span><a href="#local-1628204240"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-type">TyClGroup</span></a><span> </span><a href="#local-1628204240"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-1957"></a><a name="add_tycld"><a href="RnSource.html#add_tycld"><span class="hs-identifier">add_tycld</span></a></a><span> </span><a name="local-1628205068"><a href="#local-1628205068"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-var">TyClGroup</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">group_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-1628205068"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">group_roles</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span class="hs-special">]</span><span>
</span><a name="line-1958"></a><span class="hs-identifier">add_tycld</span><span> </span><a name="local-1628205069"><a href="#local-1628205069"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628205070"><a href="#local-1628205070"><span class="hs-identifier">ds</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-var">TyClGroup</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">group_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628205071"><a href="#local-1628205071"><span class="hs-identifier">tyclds</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-1628205072"><a href="#local-1628205072"><span class="hs-identifier">dss</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1959"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628205070"><span class="hs-identifier hs-var">ds</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">group_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628205069"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628205071"><span class="hs-identifier hs-var">tyclds</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628205072"><span class="hs-identifier hs-var">dss</span></a><span>
</span><a name="line-1960"></a><span>
</span><a name="line-1961"></a><span class="hs-identifier">add_role_annot</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#LRoleAnnotDecl"><span class="hs-identifier hs-type">LRoleAnnotDecl</span></a><span> </span><a href="#local-1628204239"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-type">TyClGroup</span></a><span> </span><a href="#local-1628204239"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-type">TyClGroup</span></a><span> </span><a href="#local-1628204239"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-1962"></a><a name="add_role_annot"><a href="RnSource.html#add_role_annot"><span class="hs-identifier">add_role_annot</span></a></a><span> </span><a name="local-1628205073"><a href="#local-1628205073"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-var">TyClGroup</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">group_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">group_roles</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-1628205073"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span class="hs-special">]</span><span>
</span><a name="line-1963"></a><span class="hs-identifier">add_role_annot</span><span> </span><a name="local-1628205074"><a href="#local-1628205074"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628205075"><a href="#local-1628205075"><span class="hs-identifier">tycls</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-var">TyClGroup</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">group_roles</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628205076"><a href="#local-1628205076"><span class="hs-identifier">roles</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-1628205077"><a href="#local-1628205077"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1964"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628205075"><span class="hs-identifier hs-var">tycls</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">group_roles</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628205074"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628205076"><span class="hs-identifier hs-var">roles</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628205077"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-1965"></a><span>
</span><a name="line-1966"></a><span class="hs-identifier">add_bind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsBinds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a><span> </span><a href="#local-1628204238"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsBinds.html#HsValBinds"><span class="hs-identifier hs-type">HsValBinds</span></a><span> </span><a href="#local-1628204238"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsBinds.html#HsValBinds"><span class="hs-identifier hs-type">HsValBinds</span></a><span> </span><a href="#local-1628204238"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1967"></a><a name="add_bind"><a href="RnSource.html#add_bind"><span class="hs-identifier">add_bind</span></a></a><span> </span><a name="local-1628205078"><a href="#local-1628205078"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#ValBindsIn"><span class="hs-identifier hs-var">ValBindsIn</span></a><span> </span><a name="local-1628205079"><a href="#local-1628205079"><span class="hs-identifier">bs</span></a></a><span> </span><a name="local-1628205080"><a href="#local-1628205080"><span class="hs-identifier">sigs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsBinds.html#ValBindsIn"><span class="hs-identifier hs-var">ValBindsIn</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628205079"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#snocBag"><span class="hs-identifier hs-var">snocBag</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628205078"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628205080"><span class="hs-identifier hs-var">sigs</span></a><span>
</span><a name="line-1968"></a><span class="hs-identifier">add_bind</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#ValBindsOut"><span class="hs-identifier hs-var">ValBindsOut</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;RdrHsSyn:add_bind&quot;</span><span>
</span><a name="line-1969"></a><span>
</span><a name="line-1970"></a><span class="hs-identifier">add_sig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsBinds.html#LSig"><span class="hs-identifier hs-type">LSig</span></a><span> </span><a href="#local-1628204237"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsBinds.html#HsValBinds"><span class="hs-identifier hs-type">HsValBinds</span></a><span> </span><a href="#local-1628204237"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsBinds.html#HsValBinds"><span class="hs-identifier hs-type">HsValBinds</span></a><span> </span><a href="#local-1628204237"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1971"></a><a name="add_sig"><a href="RnSource.html#add_sig"><span class="hs-identifier">add_sig</span></a></a><span> </span><a name="local-1628205081"><a href="#local-1628205081"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#ValBindsIn"><span class="hs-identifier hs-var">ValBindsIn</span></a><span> </span><a name="local-1628205082"><a href="#local-1628205082"><span class="hs-identifier">bs</span></a></a><span> </span><a name="local-1628205083"><a href="#local-1628205083"><span class="hs-identifier">sigs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsBinds.html#ValBindsIn"><span class="hs-identifier hs-var">ValBindsIn</span></a><span> </span><a href="#local-1628205082"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628205081"><span class="hs-identifier hs-var">s</span></a><span class="hs-glyph">:</span><a href="#local-1628205083"><span class="hs-identifier hs-var">sigs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1972"></a><span class="hs-identifier">add_sig</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#ValBindsOut"><span class="hs-identifier hs-var">ValBindsOut</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;RdrHsSyn:add_sig&quot;</span><span>
</span><a name="line-1973"></a></pre></body></html>