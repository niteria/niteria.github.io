<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998
-}</span><span>
</span><a name="line-5"></a><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">BuildTyCl</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-9"></a><span>        </span><a href="BuildTyCl.html#buildDataCon"><span class="hs-identifier hs-var">buildDataCon</span></a><span class="hs-special">,</span><span>
</span><a name="line-10"></a><span>        </span><a href="BuildTyCl.html#buildPatSyn"><span class="hs-identifier hs-var">buildPatSyn</span></a><span class="hs-special">,</span><span>
</span><a name="line-11"></a><span>        </span><a href="BuildTyCl.html#TcMethInfo"><span class="hs-identifier hs-type">TcMethInfo</span></a><span class="hs-special">,</span><span> </span><a href="BuildTyCl.html#buildClass"><span class="hs-identifier hs-var">buildClass</span></a><span class="hs-special">,</span><span>
</span><a name="line-12"></a><span>        </span><a href="BuildTyCl.html#distinctAbstractTyConRhs"><span class="hs-identifier hs-var">distinctAbstractTyConRhs</span></a><span class="hs-special">,</span><span> </span><a href="BuildTyCl.html#totallyAbstractTyConRhs"><span class="hs-identifier hs-var">totallyAbstractTyConRhs</span></a><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>        </span><a href="BuildTyCl.html#mkNewTyConRhs"><span class="hs-identifier hs-var">mkNewTyConRhs</span></a><span class="hs-special">,</span><span> </span><a href="BuildTyCl.html#mkDataTyConRhs"><span class="hs-identifier hs-var">mkDataTyConRhs</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>        </span><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a><span class="hs-special">,</span><span> </span><a href="BuildTyCl.html#newTyConRepName"><span class="hs-identifier hs-var">newTyConRepName</span></a><span>
</span><a name="line-15"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><a href="IfaceEnv.html"><span class="hs-identifier">IfaceEnv</span></a><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><a href="FamInstEnv.html"><span class="hs-identifier">FamInstEnv</span></a><span class="hs-special">(</span><span> </span><a href="FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a><span class="hs-special">,</span><span> </span><a href="FamInstEnv.html#mkNewTypeCoAxiom"><span class="hs-identifier hs-var">mkNewTypeCoAxiom</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><a href="TysWiredIn.html"><span class="hs-identifier">TysWiredIn</span></a><span class="hs-special">(</span><span> </span><a href="TysWiredIn.html#isCTupleTyConName"><span class="hs-identifier hs-var">isCTupleTyConName</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><a href="DataCon.html"><span class="hs-identifier">DataCon</span></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><a href="PatSyn.html"><span class="hs-identifier">PatSyn</span></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><a href="Var.html"><span class="hs-identifier">Var</span></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><a href="VarSet.html"><span class="hs-identifier">VarSet</span></a><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><a href="MkId.html"><span class="hs-identifier">MkId</span></a><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><a href="Class.html"><span class="hs-identifier">Class</span></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><a href="TyCon.html"><span class="hs-identifier">TyCon</span></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><a href="TyCoRep.html"><span class="hs-identifier">TyCoRep</span></a><span class="hs-special">(</span><span> </span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><a href="Id.html"><span class="hs-identifier">Id</span></a><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><a href="TcType.html"><span class="hs-identifier">TcType</span></a><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span class="hs-special">(</span><span> </span><a href="SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnMonad.html"><span class="hs-identifier">TcRnMonad</span></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><a href="UniqSupply.html"><span class="hs-identifier">UniqSupply</span></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-identifier">distinctAbstractTyConRhs</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">totallyAbstractTyConRhs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#AlgTyConRhs"><span class="hs-identifier hs-type">AlgTyConRhs</span></a><span>
</span><a name="line-44"></a><a name="distinctAbstractTyConRhs"><a href="BuildTyCl.html#distinctAbstractTyConRhs"><span class="hs-identifier">distinctAbstractTyConRhs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#AbstractTyCon"><span class="hs-identifier hs-var">AbstractTyCon</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-45"></a><a name="totallyAbstractTyConRhs"><a href="BuildTyCl.html#totallyAbstractTyConRhs"><span class="hs-identifier">totallyAbstractTyConRhs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#AbstractTyCon"><span class="hs-identifier hs-var">AbstractTyCon</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span class="hs-identifier">mkDataTyConRhs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#AlgTyConRhs"><span class="hs-identifier hs-type">AlgTyConRhs</span></a><span>
</span><a name="line-48"></a><a name="mkDataTyConRhs"><a href="BuildTyCl.html#mkDataTyConRhs"><span class="hs-identifier">mkDataTyConRhs</span></a></a><span> </span><a name="local-1627991081"><a href="#local-1627991081"><span class="hs-identifier">cons</span></a></a><span>
</span><a name="line-49"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#DataTyCon"><span class="hs-identifier hs-var">DataTyCon</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-50"></a><span>        </span><span class="hs-identifier">data_cons</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627991081"><span class="hs-identifier hs-var">cons</span></a><span class="hs-special">,</span><span>
</span><a name="line-51"></a><span>        </span><span class="hs-identifier">is_enum</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1627991081"><span class="hs-identifier hs-var">cons</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a><span> </span><a href="#local-1627991082"><span class="hs-identifier hs-var">is_enum_con</span></a><span> </span><a href="#local-1627991081"><span class="hs-identifier hs-var">cons</span></a><span>
</span><a name="line-52"></a><span>                  </span><span class="hs-comment">-- See Note [Enumeration types] in TyCon</span><span>
</span><a name="line-53"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-54"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-55"></a><span>    </span><a name="local-1627991082"><a href="#local-1627991082"><span class="hs-identifier">is_enum_con</span></a></a><span> </span><a name="local-1627991083"><a href="#local-1627991083"><span class="hs-identifier">con</span></a></a><span>
</span><a name="line-56"></a><span>       </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-1627991084"><a href="#local-1627991084"><span class="hs-identifier">_univ_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627991085"><a href="#local-1627991085"><span class="hs-identifier">ex_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627991086"><a href="#local-1627991086"><span class="hs-identifier">eq_spec</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627991087"><a href="#local-1627991087"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627991088"><a href="#local-1627991088"><span class="hs-identifier">arg_tys</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627991089"><a href="#local-1627991089"><span class="hs-identifier">_res</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-57"></a><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DataCon.html#dataConFullSig"><span class="hs-identifier hs-var">dataConFullSig</span></a><span> </span><a href="#local-1627991083"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-58"></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1627991085"><span class="hs-identifier hs-var">ex_tvs</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1627991086"><span class="hs-identifier hs-var">eq_spec</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1627991087"><span class="hs-identifier hs-var">theta</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1627991088"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-identifier">mkNewTyConRhs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-1627991079"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627991080"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="TyCon.html#AlgTyConRhs"><span class="hs-identifier hs-type">AlgTyConRhs</span></a><span>
</span><a name="line-62"></a><span class="hs-comment">-- ^ Monadic because it makes a Name for the coercion TyCon</span><span>
</span><a name="line-63"></a><span class="hs-comment">--   We pass the Name of the parent TyCon, as well as the TyCon itself,</span><span>
</span><a name="line-64"></a><span class="hs-comment">--   because the latter is part of a knot, whereas the former is not.</span><span>
</span><a name="line-65"></a><a name="mkNewTyConRhs"><a href="BuildTyCl.html#mkNewTyConRhs"><span class="hs-identifier">mkNewTyConRhs</span></a></a><span> </span><a name="local-1627991090"><a href="#local-1627991090"><span class="hs-identifier">tycon_name</span></a></a><span> </span><a name="local-1627991091"><a href="#local-1627991091"><span class="hs-identifier">tycon</span></a></a><span> </span><a name="local-1627991092"><a href="#local-1627991092"><span class="hs-identifier">con</span></a></a><span>
</span><a name="line-66"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1627991111"><a href="#local-1627991111"><span class="hs-identifier">co_tycon_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a><span> </span><a href="#local-1627991090"><span class="hs-identifier hs-var">tycon_name</span></a><span> </span><a href="OccName.html#mkNewTyCoOcc"><span class="hs-identifier hs-var">mkNewTyCoOcc</span></a><span>
</span><a name="line-67"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627991112"><a href="#local-1627991112"><span class="hs-identifier">nt_ax</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FamInstEnv.html#mkNewTypeCoAxiom"><span class="hs-identifier hs-var">mkNewTypeCoAxiom</span></a><span> </span><a href="#local-1627991111"><span class="hs-identifier hs-var">co_tycon_name</span></a><span> </span><a href="#local-1627991091"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="#local-1627991097"><span class="hs-identifier hs-var">etad_tvs</span></a><span> </span><a href="#local-1627991098"><span class="hs-identifier hs-var">etad_roles</span></a><span> </span><a href="#local-1627991099"><span class="hs-identifier hs-var">etad_rhs</span></a><span>
</span><a name="line-68"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;mkNewTyConRhs&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627991112"><span class="hs-identifier hs-var">nt_ax</span></a><span class="hs-special">)</span><span>
</span><a name="line-69"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#NewTyCon"><span class="hs-identifier hs-var">NewTyCon</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">data_con</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627991092"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">,</span><span>
</span><a name="line-70"></a><span>                             </span><span class="hs-identifier">nt_rhs</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627991096"><span class="hs-identifier hs-var">rhs_ty</span></a><span class="hs-special">,</span><span>
</span><a name="line-71"></a><span>                             </span><span class="hs-identifier">nt_etad_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1627991097"><span class="hs-identifier hs-var">etad_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627991099"><span class="hs-identifier hs-var">etad_rhs</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-72"></a><span>                             </span><span class="hs-identifier">nt_co</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627991112"><span class="hs-identifier hs-var">nt_ax</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-73"></a><span>                             </span><span class="hs-comment">-- Coreview looks through newtypes with a Nothing</span><span>
</span><a name="line-74"></a><span>                             </span><span class="hs-comment">-- for nt_co, or uses explicit coercions otherwise</span><span>
</span><a name="line-75"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-76"></a><span>    </span><a name="local-1627991093"><a href="#local-1627991093"><span class="hs-identifier">tvs</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-1627991091"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-77"></a><span>    </span><a name="local-1627991094"><a href="#local-1627991094"><span class="hs-identifier">roles</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a><span> </span><a href="#local-1627991091"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-78"></a><span>    </span><a name="local-1627991095"><a href="#local-1627991095"><span class="hs-identifier">inst_con_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#piResultTys"><span class="hs-identifier hs-var">piResultTys</span></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#dataConUserType"><span class="hs-identifier hs-var">dataConUserType</span></a><span> </span><a href="#local-1627991092"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><a href="#local-1627991093"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-79"></a><span>    </span><a name="local-1627991096"><a href="#local-1627991096"><span class="hs-identifier">rhs_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isFunTy</span><span> </span><span class="hs-identifier">inst_con_ty</span><span> </span><span class="hs-special">)</span><span> </span><a href="#local-1627991095"><span class="hs-identifier hs-var">funArgTy</span></a><span> </span><span class="hs-identifier">inst_con_ty</span><span>
</span><a name="line-80"></a><span>        </span><span class="hs-comment">-- Instantiate the data con with the</span><span>
</span><a name="line-81"></a><span>        </span><span class="hs-comment">-- type variables from the tycon</span><span>
</span><a name="line-82"></a><span>        </span><span class="hs-comment">-- NB: a newtype DataCon has a type that must look like</span><span>
</span><a name="line-83"></a><span>        </span><span class="hs-comment">--        forall tvs.  &lt;arg-ty&gt; -&gt; T tvs</span><span>
</span><a name="line-84"></a><span>        </span><span class="hs-comment">-- Note that we *can't* use dataConInstOrigArgTys here because</span><span>
</span><a name="line-85"></a><span>        </span><span class="hs-comment">-- the newtype arising from   class Foo a =&gt; Bar a where {}</span><span>
</span><a name="line-86"></a><span>        </span><span class="hs-comment">-- has a single argument (Foo a) that is a *type class*, so</span><span>
</span><a name="line-87"></a><span>        </span><span class="hs-comment">-- dataConInstOrigArgTys returns [].</span><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span>    </span><span class="hs-identifier">etad_tvs</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Matched lazily, so that mkNewTypeCo can</span><span>
</span><a name="line-90"></a><span>    </span><span class="hs-identifier">etad_roles</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- return a TyCon without pulling on rhs_ty</span><span>
</span><a name="line-91"></a><span>    </span><span class="hs-identifier">etad_rhs</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>     </span><span class="hs-comment">-- See Note [Tricky iface loop] in LoadIface</span><span>
</span><a name="line-92"></a><span>    </span><span class="hs-special">(</span><a name="local-1627991097"><a href="#local-1627991097"><span class="hs-identifier">etad_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627991098"><a href="#local-1627991098"><span class="hs-identifier">etad_roles</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627991099"><a href="#local-1627991099"><span class="hs-identifier">etad_rhs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627991100"><span class="hs-identifier hs-var">eta_reduce</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-1627991093"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-1627991094"><span class="hs-identifier hs-var">roles</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627991096"><span class="hs-identifier hs-var">rhs_ty</span></a><span>
</span><a name="line-93"></a><span>
</span><a name="line-94"></a><span>    </span><span class="hs-identifier">eta_reduce</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- Reversed</span><span>
</span><a name="line-95"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- also reversed</span><span>
</span><a name="line-96"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>          </span><span class="hs-comment">-- Rhs type</span><span>
</span><a name="line-97"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Eta-reduced version</span><span>
</span><a name="line-98"></a><span>                                           </span><span class="hs-comment">-- (tyvars in normal order)</span><span>
</span><a name="line-99"></a><span>    </span><a name="local-1627991100"><a href="#local-1627991100"><span class="hs-identifier">eta_reduce</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627991101"><a href="#local-1627991101"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-1627991103"><a href="#local-1627991103"><span class="hs-identifier">rs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627991104"><a href="#local-1627991104"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1627991105"><a href="#local-1627991105"><span class="hs-identifier">fun</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627991106"><a href="#local-1627991106"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitAppTy_maybe"><span class="hs-identifier hs-var">splitAppTy_maybe</span></a><span> </span><a href="#local-1627991104"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span>
</span><a name="line-100"></a><span>                                  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627991107"><a href="#local-1627991107"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#getTyVar_maybe"><span class="hs-identifier hs-var">getTyVar_maybe</span></a><span> </span><a href="#local-1627991106"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">,</span><span>
</span><a name="line-101"></a><span>                                  </span><a href="#local-1627991107"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1627991101"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span>
</span><a name="line-102"></a><span>                                  </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-1627991101"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-1627991105"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">)</span><span>
</span><a name="line-103"></a><span>                                </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627991100"><span class="hs-identifier hs-var">eta_reduce</span></a><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-1627991103"><span class="hs-identifier hs-var">rs</span></a><span> </span><a href="#local-1627991105"><span class="hs-identifier hs-var">fun</span></a><span>
</span><a name="line-104"></a><span>    </span><span class="hs-identifier">eta_reduce</span><span> </span><a name="local-1627991108"><a href="#local-1627991108"><span class="hs-identifier">tvs</span></a></a><span> </span><a name="local-1627991109"><a href="#local-1627991109"><span class="hs-identifier">rs</span></a></a><span> </span><a name="local-1627991110"><a href="#local-1627991110"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-1627991108"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-1627991109"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627991110"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-comment">------------------------------------------------------</span><span>
</span><a name="line-107"></a><span class="hs-identifier">buildDataCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a><span>
</span><a name="line-108"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-109"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>                     </span><span class="hs-comment">-- Declared infix</span><span>
</span><a name="line-110"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyConRepName"><span class="hs-identifier hs-type">TyConRepName</span></a><span>
</span><a name="line-111"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DataCon.html#HsSrcBang"><span class="hs-identifier hs-type">HsSrcBang</span></a><span class="hs-special">]</span><span>
</span><a name="line-112"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">[</span><a href="DataCon.html#HsImplBang"><span class="hs-identifier hs-type">HsImplBang</span></a><span class="hs-special">]</span><span>
</span><a name="line-113"></a><span>                </span><span class="hs-comment">-- See Note [Bangs on imported data constructors] in MkId</span><span>
</span><a name="line-114"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a><span class="hs-special">]</span><span>             </span><span class="hs-comment">-- Field labels</span><span>
</span><a name="line-115"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- Universals; see</span><span>
</span><a name="line-116"></a><span>                                       </span><span class="hs-comment">-- Note [TyBinders in DataCons] in DataCon</span><span>
</span><a name="line-117"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- existentials</span><span>
</span><a name="line-118"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DataCon.html#EqSpec"><span class="hs-identifier hs-type">EqSpec</span></a><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- Equality spec</span><span>
</span><a name="line-119"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span>                </span><span class="hs-comment">-- Does not include the &quot;stupid theta&quot;</span><span>
</span><a name="line-120"></a><span>                                       </span><span class="hs-comment">-- or the GADT equalities</span><span>
</span><a name="line-121"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>           </span><span class="hs-comment">-- Argument and result types</span><span>
</span><a name="line-122"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>                    </span><span class="hs-comment">-- Rep tycon</span><span>
</span><a name="line-123"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-1627991077"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627991078"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span>
</span><a name="line-124"></a><span class="hs-comment">-- A wrapper for DataCon.mkDataCon that</span><span>
</span><a name="line-125"></a><span class="hs-comment">--   a) makes the worker Id</span><span>
</span><a name="line-126"></a><span class="hs-comment">--   b) makes the wrapper Id if necessary, including</span><span>
</span><a name="line-127"></a><span class="hs-comment">--      allocating its unique (hence monadic)</span><span>
</span><a name="line-128"></a><span class="hs-comment">--   c) Sorts out the TyBinders. See Note [TyBinders in DataCons] in DataCon</span><span>
</span><a name="line-129"></a><a name="buildDataCon"><a href="BuildTyCl.html#buildDataCon"><span class="hs-identifier">buildDataCon</span></a></a><span> </span><a name="local-1627991113"><a href="#local-1627991113"><span class="hs-identifier">fam_envs</span></a></a><span> </span><a name="local-1627991114"><a href="#local-1627991114"><span class="hs-identifier">src_name</span></a></a><span> </span><a name="local-1627991115"><a href="#local-1627991115"><span class="hs-identifier">declared_infix</span></a></a><span> </span><a name="local-1627991116"><a href="#local-1627991116"><span class="hs-identifier">prom_info</span></a></a><span> </span><a name="local-1627991117"><a href="#local-1627991117"><span class="hs-identifier">src_bangs</span></a></a><span> </span><a name="local-1627991118"><a href="#local-1627991118"><span class="hs-identifier">impl_bangs</span></a></a><span> </span><a name="local-1627991119"><a href="#local-1627991119"><span class="hs-identifier">field_lbls</span></a></a><span>
</span><a name="line-130"></a><span>             </span><a name="local-1627991120"><a href="#local-1627991120"><span class="hs-identifier">univ_tvs</span></a></a><span> </span><a name="local-1627991121"><a href="#local-1627991121"><span class="hs-identifier">univ_bndrs</span></a></a><span> </span><a name="local-1627991122"><a href="#local-1627991122"><span class="hs-identifier">ex_tvs</span></a></a><span> </span><a name="local-1627991123"><a href="#local-1627991123"><span class="hs-identifier">ex_bndrs</span></a></a><span> </span><a name="local-1627991124"><a href="#local-1627991124"><span class="hs-identifier">eq_spec</span></a></a><span> </span><a name="local-1627991125"><a href="#local-1627991125"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-1627991126"><a href="#local-1627991126"><span class="hs-identifier">arg_tys</span></a></a><span> </span><a name="local-1627991127"><a href="#local-1627991127"><span class="hs-identifier">res_ty</span></a></a><span> </span><a name="local-1627991128"><a href="#local-1627991128"><span class="hs-identifier">rep_tycon</span></a></a><span>
</span><a name="line-131"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1627991129"><a href="#local-1627991129"><span class="hs-identifier">wrap_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a><span> </span><a href="#local-1627991114"><span class="hs-identifier hs-var">src_name</span></a><span> </span><a href="OccName.html#mkDataConWrapperOcc"><span class="hs-identifier hs-var">mkDataConWrapperOcc</span></a><span>
</span><a name="line-132"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1627991130"><a href="#local-1627991130"><span class="hs-identifier">work_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a><span> </span><a href="#local-1627991114"><span class="hs-identifier hs-var">src_name</span></a><span> </span><a href="OccName.html#mkDataConWorkerOcc"><span class="hs-identifier hs-var">mkDataConWorkerOcc</span></a><span>
</span><a name="line-133"></a><span>        </span><span class="hs-comment">-- This last one takes the name of the data constructor in the source</span><span>
</span><a name="line-134"></a><span>        </span><span class="hs-comment">-- code, which (for Haskell source anyway) will be in the DataName name</span><span>
</span><a name="line-135"></a><span>        </span><span class="hs-comment">-- space, and puts it into the VarName name space</span><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;buildDataCon 1&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627991114"><span class="hs-identifier hs-var">src_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-138"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1627991131"><a href="#local-1627991131"><span class="hs-identifier">us</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUniqueSupply"><span class="hs-identifier hs-var">newUniqueSupply</span></a><span>
</span><a name="line-139"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1627991132"><a href="#local-1627991132"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-140"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627991133"><a href="#local-1627991133"><span class="hs-identifier">dc_bndrs</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="BuildTyCl.html#mkDataConUnivTyBinders"><span class="hs-identifier hs-var">mkDataConUnivTyBinders</span></a><span> </span><a href="#local-1627991121"><span class="hs-identifier hs-var">univ_bndrs</span></a><span> </span><a href="#local-1627991120"><span class="hs-identifier hs-var">univ_tvs</span></a><span>
</span><a name="line-141"></a><span>              </span><a name="local-1627991134"><a href="#local-1627991134"><span class="hs-identifier">stupid_ctxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="BuildTyCl.html#mkDataConStupidTheta"><span class="hs-identifier hs-var">mkDataConStupidTheta</span></a><span> </span><a href="#local-1627991128"><span class="hs-identifier hs-var">rep_tycon</span></a><span> </span><a href="#local-1627991126"><span class="hs-identifier hs-var">arg_tys</span></a><span> </span><a href="#local-1627991120"><span class="hs-identifier hs-var">univ_tvs</span></a><span>
</span><a name="line-142"></a><span>              </span><a name="local-1627991135"><a href="#local-1627991135"><span class="hs-identifier">data_con</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DataCon.html#mkDataCon"><span class="hs-identifier hs-var">mkDataCon</span></a><span> </span><a href="#local-1627991114"><span class="hs-identifier hs-var">src_name</span></a><span> </span><a href="#local-1627991115"><span class="hs-identifier hs-var">declared_infix</span></a><span> </span><a href="#local-1627991116"><span class="hs-identifier hs-var">prom_info</span></a><span>
</span><a name="line-143"></a><span>                                   </span><a href="#local-1627991117"><span class="hs-identifier hs-var">src_bangs</span></a><span> </span><a href="#local-1627991119"><span class="hs-identifier hs-var">field_lbls</span></a><span>
</span><a name="line-144"></a><span>                                   </span><a href="#local-1627991120"><span class="hs-identifier hs-var">univ_tvs</span></a><span> </span><a href="#local-1627991133"><span class="hs-identifier hs-var">dc_bndrs</span></a><span> </span><a href="#local-1627991122"><span class="hs-identifier hs-var">ex_tvs</span></a><span> </span><a href="#local-1627991123"><span class="hs-identifier hs-var">ex_bndrs</span></a><span> </span><a href="#local-1627991124"><span class="hs-identifier hs-var">eq_spec</span></a><span> </span><a href="#local-1627991125"><span class="hs-identifier hs-var">ctxt</span></a><span>
</span><a name="line-145"></a><span>                                   </span><a href="#local-1627991126"><span class="hs-identifier hs-var">arg_tys</span></a><span> </span><a href="#local-1627991127"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><a href="TyCon.html#NoRRI"><span class="hs-identifier hs-var">NoRRI</span></a><span> </span><a href="#local-1627991128"><span class="hs-identifier hs-var">rep_tycon</span></a><span>
</span><a name="line-146"></a><span>                                   </span><a href="#local-1627991134"><span class="hs-identifier hs-var">stupid_ctxt</span></a><span> </span><a href="#local-1627991136"><span class="hs-identifier hs-var">dc_wrk</span></a><span> </span><a href="#local-1627991137"><span class="hs-identifier hs-var">dc_rep</span></a><span>
</span><a name="line-147"></a><span>              </span><a name="local-1627991136"><a href="#local-1627991136"><span class="hs-identifier">dc_wrk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkId.html#mkDataConWorkId"><span class="hs-identifier hs-var">mkDataConWorkId</span></a><span> </span><a href="#local-1627991130"><span class="hs-identifier hs-var">work_name</span></a><span> </span><a href="#local-1627991135"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-148"></a><span>              </span><a name="local-1627991137"><a href="#local-1627991137"><span class="hs-identifier">dc_rep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqSupply.html#initUs_"><span class="hs-identifier hs-var">initUs_</span></a><span> </span><a href="#local-1627991131"><span class="hs-identifier hs-var">us</span></a><span> </span><span class="hs-special">(</span><a href="MkId.html#mkDataConRep"><span class="hs-identifier hs-var">mkDataConRep</span></a><span> </span><a href="#local-1627991132"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627991113"><span class="hs-identifier hs-var">fam_envs</span></a><span> </span><a href="#local-1627991129"><span class="hs-identifier hs-var">wrap_name</span></a><span>
</span><a name="line-149"></a><span>                                                </span><a href="#local-1627991118"><span class="hs-identifier hs-var">impl_bangs</span></a><span> </span><a href="#local-1627991135"><span class="hs-identifier hs-var">data_con</span></a><span class="hs-special">)</span><span>
</span><a name="line-150"></a><span>
</span><a name="line-151"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;buildDataCon 2&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627991114"><span class="hs-identifier hs-var">src_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-152"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1627991135"><span class="hs-identifier hs-var">data_con</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span class="hs-comment">-- The stupid context for a data constructor should be limited to</span><span>
</span><a name="line-156"></a><span class="hs-comment">-- the type variables mentioned in the arg_tys</span><span>
</span><a name="line-157"></a><span class="hs-comment">-- ToDo: Or functionally dependent on?</span><span>
</span><a name="line-158"></a><span class="hs-comment">--       This whole stupid theta thing is, well, stupid.</span><span>
</span><a name="line-159"></a><span class="hs-identifier">mkDataConStupidTheta</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">]</span><span>
</span><a name="line-160"></a><a name="mkDataConStupidTheta"><a href="BuildTyCl.html#mkDataConStupidTheta"><span class="hs-identifier">mkDataConStupidTheta</span></a></a><span> </span><a name="local-1627991138"><a href="#local-1627991138"><span class="hs-identifier">tycon</span></a></a><span> </span><a name="local-1627991139"><a href="#local-1627991139"><span class="hs-identifier">arg_tys</span></a></a><span> </span><a name="local-1627991140"><a href="#local-1627991140"><span class="hs-identifier">univ_tvs</span></a></a><span>
</span><a name="line-161"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1627991142"><span class="hs-identifier hs-var">stupid_theta</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- The common case</span><span>
</span><a name="line-162"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="#local-1627991144"><span class="hs-identifier hs-var">in_arg_tys</span></a><span> </span><a href="#local-1627991142"><span class="hs-identifier hs-var">stupid_theta</span></a><span>
</span><a name="line-163"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-164"></a><span>    </span><a name="local-1627991141"><a href="#local-1627991141"><span class="hs-identifier">tc_subst</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#zipTvSubst"><span class="hs-identifier hs-var">zipTvSubst</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-1627991138"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><a href="#local-1627991140"><span class="hs-identifier hs-var">univ_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-165"></a><span>    </span><a name="local-1627991142"><a href="#local-1627991142"><span class="hs-identifier">stupid_theta</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTheta"><span class="hs-identifier hs-var">substTheta</span></a><span> </span><a href="#local-1627991141"><span class="hs-identifier hs-var">tc_subst</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#tyConStupidTheta"><span class="hs-identifier hs-var">tyConStupidTheta</span></a><span> </span><a href="#local-1627991138"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span>
</span><a name="line-166"></a><span>        </span><span class="hs-comment">-- Start by instantiating the master copy of the</span><span>
</span><a name="line-167"></a><span>        </span><span class="hs-comment">-- stupid theta, taken from the TyCon</span><span>
</span><a name="line-168"></a><span>
</span><a name="line-169"></a><span>    </span><a name="local-1627991143"><a href="#local-1627991143"><span class="hs-identifier">arg_tyvars</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><a href="#local-1627991139"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-170"></a><span>    </span><a name="local-1627991144"><a href="#local-1627991144"><span class="hs-identifier">in_arg_tys</span></a></a><span> </span><a name="local-1627991145"><a href="#local-1627991145"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="VarSet.html#isEmptyVarSet"><span class="hs-identifier hs-var">isEmptyVarSet</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-171"></a><span>                      </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-1627991145"><span class="hs-identifier hs-var">pred</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#intersectVarSet"><span class="hs-identifier hs-var">intersectVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627991143"><span class="hs-identifier hs-var">arg_tyvars</span></a><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span class="hs-identifier">mkDataConUnivTyBinders</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- From the TyCon</span><span>
</span><a name="line-175"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span>              </span><span class="hs-comment">-- For the DataCon</span><span>
</span><a name="line-176"></a><span class="hs-comment">-- See Note [Building the TyBinders for a DataCon]</span><span>
</span><a name="line-177"></a><a name="mkDataConUnivTyBinders"><a href="BuildTyCl.html#mkDataConUnivTyBinders"><span class="hs-identifier">mkDataConUnivTyBinders</span></a></a><span> </span><a name="local-1627991146"><a href="#local-1627991146"><span class="hs-identifier">bndrs</span></a></a><span> </span><a name="local-1627991147"><a href="#local-1627991147"><span class="hs-identifier">tvs</span></a></a><span>
</span><a name="line-178"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a><span> </span><a href="#local-1627991148"><span class="hs-identifier hs-var">mk_binder</span></a><span> </span><a href="#local-1627991146"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><a href="#local-1627991147"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-179"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-180"></a><span>   </span><a name="local-1627991148"><a href="#local-1627991148"><span class="hs-identifier">mk_binder</span></a></a><span> </span><a name="local-1627991149"><a href="#local-1627991149"><span class="hs-identifier">bndr</span></a></a><span> </span><a name="local-1627991150"><a href="#local-1627991150"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkNamedBinder"><span class="hs-identifier hs-var">mkNamedBinder</span></a><span> </span><a href="#local-1627991151"><span class="hs-identifier hs-var">vis</span></a><span> </span><a href="#local-1627991150"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-181"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-182"></a><span>        </span><a name="local-1627991151"><a href="#local-1627991151"><span class="hs-identifier">vis</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627991149"><span class="hs-identifier hs-var">bndr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-183"></a><span>                </span><a href="TyCoRep.html#Anon"><span class="hs-identifier hs-var">Anon</span></a><span> </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Specified"><span class="hs-identifier hs-var">Specified</span></a><span>
</span><a name="line-184"></a><span>                </span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a href="TyCoRep.html#Visible"><span class="hs-identifier hs-var">Visible</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Specified"><span class="hs-identifier hs-var">Specified</span></a><span>
</span><a name="line-185"></a><span>                </span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627991152"><a href="#local-1627991152"><span class="hs-identifier">vis</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627991152"><span class="hs-identifier hs-var">vis</span></a><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span class="hs-comment">{- Note [Building the TyBinders for a DataCon]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
A DataCon needs to keep track of the visibility of its universals and
existentials, so that visible type application can work properly. This
is done by storing the universal and existential TyBinders, along with
the TyVars.  See Note [TyBinders in DataCons] in DataCon.

During construction of a DataCon, we often start from the TyBinders of
the parent TyCon.  For example
   data Maybe a = Nothing | Just a
The DataCons start from the TyBinders of the parent TyCon.

But the ultimate TyBinders for the DataCon are *different* than those
of the DataCon. Here is an example:

  data App a b = MkApp (a b) -- App :: forall {k}. (k-&gt;*) -&gt; k -&gt; *

The TyCon has

  tyConTyVars    = [ k:*,                      a:k-&gt;*,      b:k]
  tyConTyBinders = [ Named (k :: *) Invisible, Anon (k-&gt;*), Anon k ]

The TyBinders for App line up with App's kind, given above.

But the DataCon MkApp has the type
  MkApp :: forall {k} (a:k-&gt;*) (b:k). a b -&gt; App k a b

That is, its TyBinders should be

  dataConUnivTyVars = [ Named (k:*)    Invisible
                      , Named (a:k-&gt;*) Specified
                      , Named (b:k)    Specified ]

So we want to take the TyCon's TyBinders and the TyCon's TyVars and
merge them, pulling
  - variable names from the TyVars
  - visibilities from the TyBinders
  - but changing Anon/Visible to Specified

The last part about Visible-&gt;Specified comes from this:
  data T k (a:k) b = MkT (a b)
Here k is Visible in T's kind, but we don't have Visible binders in
the TyBinders for a term (see Note [No Visible TyBinder in terms]
in TyCoRep), so we change it to Specified when making MkT's TyBinders

This merging operation is done by mkDataConUnivTyBinders. In contrast,
the TyBinders passed to mkDataCon are the final TyBinders stored in the
DataCon (mkDataCon does no further work).
-}</span><span>
</span><a name="line-236"></a><span>
</span><a name="line-237"></a><span class="hs-comment">------------------------------------------------------</span><span>
</span><a name="line-238"></a><span class="hs-identifier">buildPatSyn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-239"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">,</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>
</span><a name="line-240"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Univ and req</span><span>
</span><a name="line-241"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Ex and prov</span><span>
</span><a name="line-242"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>               </span><span class="hs-comment">-- ^ Argument types</span><span>
</span><a name="line-243"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>                 </span><span class="hs-comment">-- ^ Result type</span><span>
</span><a name="line-244"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a><span class="hs-special">]</span><span>         </span><span class="hs-comment">-- ^ Field labels for</span><span>
</span><a name="line-245"></a><span>                                    </span><span class="hs-comment">--   a record pattern synonym</span><span>
</span><a name="line-246"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PatSyn.html#PatSyn"><span class="hs-identifier hs-type">PatSyn</span></a><span>
</span><a name="line-247"></a><a name="buildPatSyn"><a href="BuildTyCl.html#buildPatSyn"><span class="hs-identifier">buildPatSyn</span></a></a><span> </span><a name="local-1627991153"><a href="#local-1627991153"><span class="hs-identifier">src_name</span></a></a><span> </span><a name="local-1627991154"><a href="#local-1627991154"><span class="hs-identifier">declared_infix</span></a></a><span> </span><a name="local-1627991155"><a href="#local-1627991155"><span class="hs-identifier">matcher</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-1627991156"><a href="#local-1627991156"><span class="hs-identifier">matcher_id</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-1627991157"><a href="#local-1627991157"><span class="hs-identifier">builder</span></a></a><span>
</span><a name="line-248"></a><span>            </span><span class="hs-special">(</span><a name="local-1627991158"><a href="#local-1627991158"><span class="hs-identifier">univ_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627991159"><a href="#local-1627991159"><span class="hs-identifier">univ_bndrs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627991160"><a href="#local-1627991160"><span class="hs-identifier">req_theta</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627991161"><a href="#local-1627991161"><span class="hs-identifier">ex_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627991162"><a href="#local-1627991162"><span class="hs-identifier">ex_bndrs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627991163"><a href="#local-1627991163"><span class="hs-identifier">prov_theta</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627991164"><a href="#local-1627991164"><span class="hs-identifier">arg_tys</span></a></a><span>
</span><a name="line-249"></a><span>            </span><a name="local-1627991165"><a href="#local-1627991165"><span class="hs-identifier">pat_ty</span></a></a><span> </span><a name="local-1627991166"><a href="#local-1627991166"><span class="hs-identifier">field_labels</span></a></a><span>
</span><a name="line-250"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- The assertion checks that the matcher is</span><span>
</span><a name="line-251"></a><span>    </span><span class="hs-comment">-- compatible with the pattern synonym</span><span>
</span><a name="line-252"></a><span>    </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">and</span></a><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">univ_tvs</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">equalLength</span><span class="hs-special">`</span><span> </span><a href="Util.html#equalLength"><span class="hs-identifier hs-var">univ_tvs1</span></a><span>
</span><a name="line-253"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ex_tvs</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">equalLength</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">ex_tvs1</span><span>
</span><a name="line-254"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_ty</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">eqType</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">substTy</span><span> </span><span class="hs-identifier">subst</span><span> </span><span class="hs-identifier">pat_ty1</span><span>
</span><a name="line-255"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">prov_theta</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">eqTypes</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">substTys</span><span> </span><span class="hs-identifier">subst</span><span> </span><span class="hs-identifier">prov_theta1</span><span>
</span><a name="line-256"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">req_theta</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">eqTypes</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">substTys</span><span> </span><span class="hs-identifier">subst</span><span> </span><span class="hs-identifier">req_theta1</span><span>
</span><a name="line-257"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">arg_tys</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">eqTypes</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">substTys</span><span> </span><span class="hs-identifier">subst</span><span> </span><span class="hs-identifier">arg_tys1</span><span>
</span><a name="line-258"></a><span>                 </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-259"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">univ_tvs</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">twiddle</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">univ_tvs1</span><span>
</span><a name="line-260"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">ex_tvs</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">twiddle</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">ex_tvs1</span><span>
</span><a name="line-261"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">pat_ty</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">twiddle</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">pat_ty1</span><span>
</span><a name="line-262"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">prov_theta</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">twiddle</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">prov_theta1</span><span>
</span><a name="line-263"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">req_theta</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">twiddle</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">req_theta1</span><span>
</span><a name="line-264"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">arg_tys</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">twiddle</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">arg_tys1</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-265"></a><span>    </span><a href="PatSyn.html#mkPatSyn"><span class="hs-identifier hs-var">mkPatSyn</span></a><span> </span><a href="#local-1627991153"><span class="hs-identifier hs-var">src_name</span></a><span> </span><a href="#local-1627991154"><span class="hs-identifier hs-var">declared_infix</span></a><span>
</span><a name="line-266"></a><span>             </span><span class="hs-special">(</span><a href="#local-1627991158"><span class="hs-identifier hs-var">univ_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627991159"><span class="hs-identifier hs-var">univ_bndrs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627991160"><span class="hs-identifier hs-var">req_theta</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627991161"><span class="hs-identifier hs-var">ex_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627991162"><span class="hs-identifier hs-var">ex_bndrs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627991163"><span class="hs-identifier hs-var">prov_theta</span></a><span class="hs-special">)</span><span>
</span><a name="line-267"></a><span>             </span><a href="#local-1627991164"><span class="hs-identifier hs-var">arg_tys</span></a><span> </span><a href="#local-1627991165"><span class="hs-identifier hs-var">pat_ty</span></a><span>
</span><a name="line-268"></a><span>             </span><a href="#local-1627991155"><span class="hs-identifier hs-var">matcher</span></a><span> </span><a href="#local-1627991157"><span class="hs-identifier hs-var">builder</span></a><span> </span><a href="#local-1627991166"><span class="hs-identifier hs-var">field_labels</span></a><span>
</span><a name="line-269"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-270"></a><span>    </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-1627991167"><a href="#local-1627991167"><span class="hs-identifier">univ_tvs1</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1627991168"><a href="#local-1627991168"><span class="hs-identifier">req_theta1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627991169"><a href="#local-1627991169"><span class="hs-identifier">tau</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitSigmaTy"><span class="hs-identifier hs-var">tcSplitSigmaTy</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1627991156"><span class="hs-identifier hs-var">matcher_id</span></a><span>
</span><a name="line-271"></a><span>    </span><span class="hs-special">(</span><span class="hs-special">[</span><a name="local-1627991170"><a href="#local-1627991170"><span class="hs-identifier">pat_ty1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627991171"><a href="#local-1627991171"><span class="hs-identifier">cont_sigma</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitFunTys"><span class="hs-identifier hs-var">tcSplitFunTys</span></a><span> </span><a href="#local-1627991169"><span class="hs-identifier hs-var">tau</span></a><span>
</span><a name="line-272"></a><span>    </span><span class="hs-special">(</span><a name="local-1627991172"><a href="#local-1627991172"><span class="hs-identifier">ex_tvs1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627991173"><a href="#local-1627991173"><span class="hs-identifier">prov_theta1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627991174"><a href="#local-1627991174"><span class="hs-identifier">cont_tau</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitSigmaTy"><span class="hs-identifier hs-var">tcSplitSigmaTy</span></a><span> </span><a href="#local-1627991171"><span class="hs-identifier hs-var">cont_sigma</span></a><span>
</span><a name="line-273"></a><span>    </span><span class="hs-special">(</span><a name="local-1627991175"><a href="#local-1627991175"><span class="hs-identifier">arg_tys1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitFunTys"><span class="hs-identifier hs-var">tcSplitFunTys</span></a><span> </span><a href="#local-1627991174"><span class="hs-identifier hs-var">cont_tau</span></a><span>
</span><a name="line-274"></a><span>    </span><a name="local-1627991176"><a href="#local-1627991176"><span class="hs-identifier">twiddle</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'~'</span><span>
</span><a name="line-275"></a><span>    </span><a name="local-1627991177"><a href="#local-1627991177"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#zipTvSubst"><span class="hs-identifier hs-var">zipTvSubst</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627991167"><span class="hs-identifier hs-var">univ_tvs1</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627991172"><span class="hs-identifier hs-var">ex_tvs1</span></a><span class="hs-special">)</span><span>
</span><a name="line-276"></a><span>                       </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627991158"><span class="hs-identifier hs-var">univ_tvs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627991161"><span class="hs-identifier hs-var">ex_tvs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-277"></a><span>
</span><a name="line-278"></a><span class="hs-comment">------------------------------------------------------</span><span>
</span><a name="line-279"></a><span class="hs-keyword">type</span><span> </span><a name="TcMethInfo"><a href="BuildTyCl.html#TcMethInfo"><span class="hs-identifier">TcMethInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#DefMethSpec"><span class="hs-identifier hs-type">DefMethSpec</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-280"></a><span>        </span><span class="hs-comment">-- A temporary intermediate, to communicate between</span><span>
</span><a name="line-281"></a><span>        </span><span class="hs-comment">-- tcClassSigs and buildClass.</span><span>
</span><a name="line-282"></a><span>
</span><a name="line-283"></a><span class="hs-identifier">buildClass</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>  </span><span class="hs-comment">-- Name of the class/tycon (they have the same Name)</span><span>
</span><a name="line-284"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span>
</span><a name="line-285"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span>                   </span><span class="hs-comment">-- of the tycon</span><span>
</span><a name="line-286"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Class.html#FunDep"><span class="hs-identifier hs-type">FunDep</span></a><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>               </span><span class="hs-comment">-- Functional dependencies</span><span>
</span><a name="line-287"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Class.html#ClassATItem"><span class="hs-identifier hs-type">ClassATItem</span></a><span class="hs-special">]</span><span>                </span><span class="hs-comment">-- Associated types</span><span>
</span><a name="line-288"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="BuildTyCl.html#TcMethInfo"><span class="hs-identifier hs-type">TcMethInfo</span></a><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- Method info</span><span>
</span><a name="line-289"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Class.html#ClassMinimalDef"><span class="hs-identifier hs-type">ClassMinimalDef</span></a><span>              </span><span class="hs-comment">-- Minimal complete definition</span><span>
</span><a name="line-290"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a><span>                      </span><span class="hs-comment">-- Info for type constructor</span><span>
</span><a name="line-291"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-1627991075"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627991076"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><a name="buildClass"><a href="BuildTyCl.html#buildClass"><span class="hs-identifier">buildClass</span></a></a><span> </span><a name="local-1627991178"><a href="#local-1627991178"><span class="hs-identifier">tycon_name</span></a></a><span> </span><a name="local-1627991179"><a href="#local-1627991179"><span class="hs-identifier">tvs</span></a></a><span> </span><a name="local-1627991180"><a href="#local-1627991180"><span class="hs-identifier">roles</span></a></a><span> </span><a name="local-1627991181"><a href="#local-1627991181"><span class="hs-identifier">sc_theta</span></a></a><span> </span><a name="local-1627991182"><a href="#local-1627991182"><span class="hs-identifier">binders</span></a></a><span>
</span><a name="line-294"></a><span>           </span><a name="local-1627991183"><a href="#local-1627991183"><span class="hs-identifier">fds</span></a></a><span> </span><a name="local-1627991184"><a href="#local-1627991184"><span class="hs-identifier">at_items</span></a></a><span> </span><a name="local-1627991185"><a href="#local-1627991185"><span class="hs-identifier">sig_stuff</span></a></a><span> </span><a name="local-1627991186"><a href="#local-1627991186"><span class="hs-identifier">mindef</span></a></a><span> </span><a name="local-1627991187"><a href="#local-1627991187"><span class="hs-identifier">tc_isrec</span></a></a><span>
</span><a name="line-295"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IOEnv.html#fixM"><span class="hs-identifier hs-var">fixM</span></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1627991198"><a href="#local-1627991198"><span class="hs-identifier">rec_clas</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>       </span><span class="hs-comment">-- Only name generation inside loop</span><span>
</span><a name="line-296"></a><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;buildClass&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-297"></a><span>
</span><a name="line-298"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1627991199"><a href="#local-1627991199"><span class="hs-identifier">datacon_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a><span> </span><a href="#local-1627991178"><span class="hs-identifier hs-var">tycon_name</span></a><span> </span><a href="OccName.html#mkClassDataConOcc"><span class="hs-identifier hs-var">mkClassDataConOcc</span></a><span>
</span><a name="line-299"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1627991200"><a href="#local-1627991200"><span class="hs-identifier">tc_rep_name</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newTyConRepName"><span class="hs-identifier hs-var">newTyConRepName</span></a><span> </span><a href="#local-1627991178"><span class="hs-identifier hs-var">tycon_name</span></a><span>
</span><a name="line-300"></a><span>
</span><a name="line-301"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1627991201"><a href="#local-1627991201"><span class="hs-identifier">op_items</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627991189"><span class="hs-identifier hs-var">mk_op_item</span></a><span> </span><a href="#local-1627991198"><span class="hs-identifier hs-var">rec_clas</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627991185"><span class="hs-identifier hs-var">sig_stuff</span></a><span>
</span><a name="line-302"></a><span>                        </span><span class="hs-comment">-- Build the selector id and default method id</span><span>
</span><a name="line-303"></a><span>
</span><a name="line-304"></a><span>              </span><span class="hs-comment">-- Make selectors for the superclasses</span><span>
</span><a name="line-305"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1627991202"><a href="#local-1627991202"><span class="hs-identifier">sc_sel_names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span>  </span><span class="hs-special">(</span><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a><span> </span><a href="#local-1627991178"><span class="hs-identifier hs-var">tycon_name</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="OccName.html#mkSuperDictSelOcc"><span class="hs-identifier hs-var">mkSuperDictSelOcc</span></a><span class="hs-special">)</span><span>
</span><a name="line-306"></a><span>                                </span><span class="hs-special">(</span><a href="Util.html#takeList"><span class="hs-identifier hs-var">takeList</span></a><span> </span><a href="#local-1627991181"><span class="hs-identifier hs-var">sc_theta</span></a><span> </span><span class="hs-special">[</span><a href="BasicTypes.html#fIRST_TAG"><span class="hs-identifier hs-var">fIRST_TAG</span></a><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-307"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627991203"><a href="#local-1627991203"><span class="hs-identifier">sc_sel_ids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="MkId.html#mkDictSelId"><span class="hs-identifier hs-var">mkDictSelId</span></a><span> </span><a href="#local-1627991204"><span class="hs-identifier hs-var">sc_name</span></a><span> </span><a href="#local-1627991198"><span class="hs-identifier hs-var">rec_clas</span></a><span>
</span><a name="line-308"></a><span>                           </span><span class="hs-glyph">|</span><span> </span><a name="local-1627991204"><a href="#local-1627991204"><span class="hs-identifier">sc_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627991202"><span class="hs-identifier hs-var">sc_sel_names</span></a><span class="hs-special">]</span><span>
</span><a name="line-309"></a><span>              </span><span class="hs-comment">-- We number off the Dict superclass selectors, 1, 2, 3 etc so that we</span><span>
</span><a name="line-310"></a><span>              </span><span class="hs-comment">-- can construct names for the selectors. Thus</span><span>
</span><a name="line-311"></a><span>              </span><span class="hs-comment">--      class (C a, C b) =&gt; D a b where ...</span><span>
</span><a name="line-312"></a><span>              </span><span class="hs-comment">-- gives superclass selectors</span><span>
</span><a name="line-313"></a><span>              </span><span class="hs-comment">--      D_sc1, D_sc2</span><span>
</span><a name="line-314"></a><span>              </span><span class="hs-comment">-- (We used to call them D_C, but now we can have two different</span><span>
</span><a name="line-315"></a><span>              </span><span class="hs-comment">--  superclasses both called C!)</span><span>
</span><a name="line-316"></a><span>
</span><a name="line-317"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627991205"><a href="#local-1627991205"><span class="hs-identifier">use_newtype</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#isSingleton"><span class="hs-identifier hs-var">isSingleton</span></a><span> </span><a href="#local-1627991209"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-318"></a><span>                </span><span class="hs-comment">-- Use a newtype if the data constructor</span><span>
</span><a name="line-319"></a><span>                </span><span class="hs-comment">--   (a) has exactly one value field</span><span>
</span><a name="line-320"></a><span>                </span><span class="hs-comment">--       i.e. exactly one operation or superclass taken together</span><span>
</span><a name="line-321"></a><span>                </span><span class="hs-comment">--   (b) that value is of lifted type (which they always are, because</span><span>
</span><a name="line-322"></a><span>                </span><span class="hs-comment">--       we box equality superclasses)</span><span>
</span><a name="line-323"></a><span>                </span><span class="hs-comment">-- See note [Class newtypes and equality predicates]</span><span>
</span><a name="line-324"></a><span>
</span><a name="line-325"></a><span>                </span><span class="hs-comment">-- We treat the dictionary superclasses as ordinary arguments.</span><span>
</span><a name="line-326"></a><span>                </span><span class="hs-comment">-- That means that in the case of</span><span>
</span><a name="line-327"></a><span>                </span><span class="hs-comment">--     class C a =&gt; D a</span><span>
</span><a name="line-328"></a><span>                </span><span class="hs-comment">-- we don't get a newtype with no arguments!</span><span>
</span><a name="line-329"></a><span>              </span><a name="local-1627991206"><a href="#local-1627991206"><span class="hs-identifier">args</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627991202"><span class="hs-identifier hs-var">sc_sel_names</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627991208"><span class="hs-identifier hs-var">op_names</span></a><span>
</span><a name="line-330"></a><span>              </span><a name="local-1627991207"><a href="#local-1627991207"><span class="hs-identifier">op_tys</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-1627991211"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-1627991211"><a href="#local-1627991211"><span class="hs-identifier">ty</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627991185"><span class="hs-identifier hs-var">sig_stuff</span></a><span class="hs-special">]</span><span>
</span><a name="line-331"></a><span>              </span><a name="local-1627991208"><a href="#local-1627991208"><span class="hs-identifier">op_names</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-1627991212"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-1627991212"><a href="#local-1627991212"><span class="hs-identifier">op</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627991185"><span class="hs-identifier hs-var">sig_stuff</span></a><span class="hs-special">]</span><span>
</span><a name="line-332"></a><span>              </span><a name="local-1627991209"><a href="#local-1627991209"><span class="hs-identifier">arg_tys</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627991181"><span class="hs-identifier hs-var">sc_theta</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627991207"><span class="hs-identifier hs-var">op_tys</span></a><span>
</span><a name="line-333"></a><span>              </span><a name="local-1627991210"><a href="#local-1627991210"><span class="hs-identifier">rec_tycon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">classTyCon</span><span> </span><a href="#local-1627991198"><span class="hs-identifier hs-var">rec_clas</span></a><span>
</span><a name="line-334"></a><span>
</span><a name="line-335"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1627991213"><a href="#local-1627991213"><span class="hs-identifier">rep_nm</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newTyConRepName"><span class="hs-identifier hs-var">newTyConRepName</span></a><span> </span><a href="#local-1627991199"><span class="hs-identifier hs-var">datacon_name</span></a><span>
</span><a name="line-336"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1627991214"><a href="#local-1627991214"><span class="hs-identifier">dict_con</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#buildDataCon"><span class="hs-identifier hs-var">buildDataCon</span></a><span> </span><span class="hs-special">(</span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;buildClass: FamInstEnvs&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-337"></a><span>                                   </span><a href="#local-1627991199"><span class="hs-identifier hs-var">datacon_name</span></a><span>
</span><a name="line-338"></a><span>                                   </span><span class="hs-identifier hs-var">False</span><span>        </span><span class="hs-comment">-- Not declared infix</span><span>
</span><a name="line-339"></a><span>                                   </span><a href="#local-1627991213"><span class="hs-identifier hs-var">rep_nm</span></a><span>
</span><a name="line-340"></a><span>                                   </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><a href="#local-1627991188"><span class="hs-identifier hs-var">no_bang</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627991206"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-341"></a><span>                                   </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><a href="DataCon.html#HsLazy"><span class="hs-identifier hs-var">HsLazy</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627991206"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-342"></a><span>                                   </span><span class="hs-special">[</span><span class="hs-comment">{- No fields -}</span><span class="hs-special">]</span><span>
</span><a name="line-343"></a><span>                                   </span><a href="#local-1627991179"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-1627991182"><span class="hs-identifier hs-var">binders</span></a><span>
</span><a name="line-344"></a><span>                                   </span><span class="hs-special">[</span><span class="hs-comment">{- no existentials -}</span><span class="hs-special">]</span><span>
</span><a name="line-345"></a><span>                                   </span><span class="hs-special">[</span><span class="hs-comment">{- no existentials -}</span><span class="hs-special">]</span><span>
</span><a name="line-346"></a><span>                                   </span><span class="hs-special">[</span><span class="hs-comment">{- No GADT equalities -}</span><span class="hs-special">]</span><span>
</span><a name="line-347"></a><span>                                   </span><span class="hs-special">[</span><span class="hs-comment">{- No theta -}</span><span class="hs-special">]</span><span>
</span><a name="line-348"></a><span>                                   </span><a href="#local-1627991209"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-349"></a><span>                                   </span><span class="hs-special">(</span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-1627991210"><span class="hs-identifier hs-var">rec_tycon</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><a href="#local-1627991179"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-350"></a><span>                                   </span><a href="#local-1627991210"><span class="hs-identifier hs-var">rec_tycon</span></a><span>
</span><a name="line-351"></a><span>
</span><a name="line-352"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1627991215"><a href="#local-1627991215"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1627991205"><span class="hs-identifier hs-var">use_newtype</span></a><span>
</span><a name="line-353"></a><span>                 </span><span class="hs-keyword">then</span><span> </span><a href="BuildTyCl.html#mkNewTyConRhs"><span class="hs-identifier hs-var">mkNewTyConRhs</span></a><span> </span><a href="#local-1627991178"><span class="hs-identifier hs-var">tycon_name</span></a><span> </span><a href="#local-1627991210"><span class="hs-identifier hs-var">rec_tycon</span></a><span> </span><a href="#local-1627991214"><span class="hs-identifier hs-var">dict_con</span></a><span>
</span><a name="line-354"></a><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="TysWiredIn.html#isCTupleTyConName"><span class="hs-identifier hs-var">isCTupleTyConName</span></a><span> </span><a href="#local-1627991178"><span class="hs-identifier hs-var">tycon_name</span></a><span>
</span><a name="line-355"></a><span>                 </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#TupleTyCon"><span class="hs-identifier hs-var">TupleTyCon</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">data_con</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627991214"><span class="hs-identifier hs-var">dict_con</span></a><span>
</span><a name="line-356"></a><span>                                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tup_sort</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#ConstraintTuple"><span class="hs-identifier hs-var">ConstraintTuple</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-357"></a><span>                 </span><span class="hs-keyword">else</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="BuildTyCl.html#mkDataTyConRhs"><span class="hs-identifier hs-var">mkDataTyConRhs</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627991214"><span class="hs-identifier hs-var">dict_con</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-358"></a><span>
</span><a name="line-359"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1627991216"><a href="#local-1627991216"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#mkClassTyCon"><span class="hs-identifier hs-var">mkClassTyCon</span></a><span> </span><a href="#local-1627991178"><span class="hs-identifier hs-var">tycon_name</span></a><span> </span><a href="#local-1627991182"><span class="hs-identifier hs-var">binders</span></a><span> </span><a href="#local-1627991179"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-1627991180"><span class="hs-identifier hs-var">roles</span></a><span>
</span><a name="line-360"></a><span>                                     </span><a href="#local-1627991215"><span class="hs-identifier hs-var">rhs</span></a><span> </span><a href="#local-1627991198"><span class="hs-identifier hs-var">rec_clas</span></a><span> </span><a href="#local-1627991187"><span class="hs-identifier hs-var">tc_isrec</span></a><span> </span><a href="#local-1627991200"><span class="hs-identifier hs-var">tc_rep_name</span></a><span>
</span><a name="line-361"></a><span>                </span><span class="hs-comment">-- A class can be recursive, and in the case of newtypes</span><span>
</span><a name="line-362"></a><span>                </span><span class="hs-comment">-- this matters.  For example</span><span>
</span><a name="line-363"></a><span>                </span><span class="hs-comment">--      class C a where { op :: C b =&gt; a -&gt; b -&gt; Int }</span><span>
</span><a name="line-364"></a><span>                </span><span class="hs-comment">-- Because C has only one operation, it is represented by</span><span>
</span><a name="line-365"></a><span>                </span><span class="hs-comment">-- a newtype, and it should be a *recursive* newtype.</span><span>
</span><a name="line-366"></a><span>                </span><span class="hs-comment">-- [If we don't make it a recursive newtype, we'll expand the</span><span>
</span><a name="line-367"></a><span>                </span><span class="hs-comment">-- newtype like a synonym, but that will lead to an infinite</span><span>
</span><a name="line-368"></a><span>                </span><span class="hs-comment">-- type]</span><span>
</span><a name="line-369"></a><span>
</span><a name="line-370"></a><span>              </span><span class="hs-special">;</span><span> </span><a name="local-1627991217"><a href="#local-1627991217"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Class.html#mkClass"><span class="hs-identifier hs-var">mkClass</span></a><span> </span><a href="#local-1627991179"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-1627991183"><span class="hs-identifier hs-var">fds</span></a><span>
</span><a name="line-371"></a><span>                                 </span><a href="#local-1627991181"><span class="hs-identifier hs-var">sc_theta</span></a><span> </span><a href="#local-1627991203"><span class="hs-identifier hs-var">sc_sel_ids</span></a><span> </span><a href="#local-1627991184"><span class="hs-identifier hs-var">at_items</span></a><span>
</span><a name="line-372"></a><span>                                 </span><a href="#local-1627991201"><span class="hs-identifier hs-var">op_items</span></a><span> </span><a href="#local-1627991186"><span class="hs-identifier hs-var">mindef</span></a><span> </span><a href="#local-1627991216"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-373"></a><span>              </span><span class="hs-special">}</span><span>
</span><a name="line-374"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;buildClass&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627991216"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span>
</span><a name="line-375"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1627991217"><span class="hs-identifier hs-var">result</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-376"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-377"></a><span>    </span><a name="local-1627991188"><a href="#local-1627991188"><span class="hs-identifier">no_bang</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DataCon.html#HsSrcBang"><span class="hs-identifier hs-var">HsSrcBang</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="DataCon.html#NoSrcUnpack"><span class="hs-identifier hs-var">NoSrcUnpack</span></a><span> </span><a href="DataCon.html#NoSrcStrict"><span class="hs-identifier hs-var">NoSrcStrict</span></a><span>
</span><a name="line-378"></a><span>
</span><a name="line-379"></a><span>    </span><span class="hs-identifier">mk_op_item</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BuildTyCl.html#TcMethInfo"><span class="hs-identifier hs-type">TcMethInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-1627991190"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-1627991191"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Class.html#ClassOpItem"><span class="hs-identifier hs-type">ClassOpItem</span></a><span>
</span><a name="line-380"></a><span>    </span><a name="local-1627991189"><a href="#local-1627991189"><span class="hs-identifier">mk_op_item</span></a></a><span> </span><a name="local-1627991192"><a href="#local-1627991192"><span class="hs-identifier">rec_clas</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627991193"><a href="#local-1627991193"><span class="hs-identifier">op_name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627991194"><a href="#local-1627991194"><span class="hs-identifier">dm_spec</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-381"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1627991197"><a href="#local-1627991197"><span class="hs-identifier">dm_info</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627991194"><span class="hs-identifier hs-var">dm_spec</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-382"></a><span>                          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-383"></a><span>                          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627991195"><a href="#local-1627991195"><span class="hs-identifier">spec</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1627991196"><a href="#local-1627991196"><span class="hs-identifier">dm_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a><span> </span><a href="#local-1627991193"><span class="hs-identifier hs-var">op_name</span></a><span> </span><a href="OccName.html#mkDefaultMethodOcc"><span class="hs-identifier hs-var">mkDefaultMethodOcc</span></a><span>
</span><a name="line-384"></a><span>                                          </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627991196"><span class="hs-identifier hs-var">dm_name</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627991195"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-385"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="MkId.html#mkDictSelId"><span class="hs-identifier hs-var">mkDictSelId</span></a><span> </span><a href="#local-1627991193"><span class="hs-identifier hs-var">op_name</span></a><span> </span><a href="#local-1627991192"><span class="hs-identifier hs-var">rec_clas</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627991197"><span class="hs-identifier hs-var">dm_info</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-386"></a><span>
</span><a name="line-387"></a><span class="hs-comment">{-
Note [Class newtypes and equality predicates]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
        class (a ~ F b) =&gt; C a b where
          op :: a -&gt; b

We cannot represent this by a newtype, even though it's not
existential, because there are two value fields (the equality
predicate and op. See Trac #2238

Moreover,
          class (a ~ F b) =&gt; C a b where {}
Here we can't use a newtype either, even though there is only
one field, because equality predicates are unboxed, and classes
are boxed.
-}</span><span>
</span><a name="line-404"></a><span>
</span><a name="line-405"></a><span class="hs-identifier">newImplicitBinder</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>                       </span><span class="hs-comment">-- Base name</span><span>
</span><a name="line-406"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- Occurrence name modifier</span><span>
</span><a name="line-407"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-1627991073"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627991074"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>            </span><span class="hs-comment">-- Implicit name</span><span>
</span><a name="line-408"></a><span class="hs-comment">-- Called in BuildTyCl to allocate the implicit binders of type/class decls</span><span>
</span><a name="line-409"></a><span class="hs-comment">-- For source type/class decls, this is the first occurrence</span><span>
</span><a name="line-410"></a><span class="hs-comment">-- For iface ones, the LoadIface has alrady allocated a suitable name in the cache</span><span>
</span><a name="line-411"></a><a name="newImplicitBinder"><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier">newImplicitBinder</span></a></a><span> </span><a name="local-1627991218"><a href="#local-1627991218"><span class="hs-identifier">base_name</span></a></a><span> </span><a name="local-1627991219"><a href="#local-1627991219"><span class="hs-identifier">mk_sys_occ</span></a></a><span>
</span><a name="line-412"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627991222"><a href="#local-1627991222"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Name.html#nameModule_maybe"><span class="hs-identifier hs-var">nameModule_maybe</span></a><span> </span><a href="#local-1627991218"><span class="hs-identifier hs-var">base_name</span></a><span>
</span><a name="line-413"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IfaceEnv.html#newGlobalBinder"><span class="hs-identifier hs-var">newGlobalBinder</span></a><span> </span><a href="#local-1627991222"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="#local-1627991220"><span class="hs-identifier hs-var">occ</span></a><span> </span><a href="#local-1627991221"><span class="hs-identifier hs-var">loc</span></a><span>
</span><a name="line-414"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>           </span><span class="hs-comment">-- When typechecking a [d| decl bracket |],</span><span>
</span><a name="line-415"></a><span>                        </span><span class="hs-comment">-- TH generates types, classes etc with Internal names,</span><span>
</span><a name="line-416"></a><span>                        </span><span class="hs-comment">-- so we follow suit for the implicit binders</span><span>
</span><a name="line-417"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1627991223"><a href="#local-1627991223"><span class="hs-identifier">uniq</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a><span>
</span><a name="line-418"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#mkInternalName"><span class="hs-identifier hs-var">mkInternalName</span></a><span> </span><a href="#local-1627991223"><span class="hs-identifier hs-var">uniq</span></a><span> </span><a href="#local-1627991220"><span class="hs-identifier hs-var">occ</span></a><span> </span><a href="#local-1627991221"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-419"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-420"></a><span>    </span><a name="local-1627991220"><a href="#local-1627991220"><span class="hs-identifier">occ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627991219"><span class="hs-identifier hs-var">mk_sys_occ</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-1627991218"><span class="hs-identifier hs-var">base_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-421"></a><span>    </span><a name="local-1627991221"><a href="#local-1627991221"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#nameSrcSpan"><span class="hs-identifier hs-var">nameSrcSpan</span></a><span> </span><a href="#local-1627991218"><span class="hs-identifier hs-var">base_name</span></a><span>
</span><a name="line-422"></a><span>
</span><a name="line-423"></a><span class="hs-comment">-- | Make the 'TyConRepName' for this 'TyCon'</span><span>
</span><a name="line-424"></a><span class="hs-identifier">newTyConRepName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-1627991071"><span class="hs-identifier hs-type">gbl</span></a><span> </span><a href="#local-1627991072"><span class="hs-identifier hs-type">lcl</span></a><span> </span><a href="TyCon.html#TyConRepName"><span class="hs-identifier hs-type">TyConRepName</span></a><span>
</span><a name="line-425"></a><a name="newTyConRepName"><a href="BuildTyCl.html#newTyConRepName"><span class="hs-identifier">newTyConRepName</span></a></a><span> </span><a name="local-1627991224"><a href="#local-1627991224"><span class="hs-identifier">tc_name</span></a></a><span>
</span><a name="line-426"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627991225"><a href="#local-1627991225"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Name.html#nameModule_maybe"><span class="hs-identifier hs-var">nameModule_maybe</span></a><span> </span><a href="#local-1627991224"><span class="hs-identifier hs-var">tc_name</span></a><span>
</span><a name="line-427"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-1627991226"><a href="#local-1627991226"><span class="hs-identifier">mod</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627991227"><a href="#local-1627991227"><span class="hs-identifier">occ</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#tyConRepModOcc"><span class="hs-identifier hs-var">tyConRepModOcc</span></a><span> </span><a href="#local-1627991225"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-1627991224"><span class="hs-identifier hs-var">tc_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-428"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IfaceEnv.html#newGlobalBinder"><span class="hs-identifier hs-var">newGlobalBinder</span></a><span> </span><a href="#local-1627991226"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="#local-1627991227"><span class="hs-identifier hs-var">occ</span></a><span> </span><a href="SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a><span>
</span><a name="line-429"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-430"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a><span> </span><a href="#local-1627991224"><span class="hs-identifier hs-var">tc_name</span></a><span> </span><a href="OccName.html#mkTyConRepOcc"><span class="hs-identifier hs-var">mkTyConRepOcc</span></a><span>
</span><a name="line-431"></a></pre></body></html>